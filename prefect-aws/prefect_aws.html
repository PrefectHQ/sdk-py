<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.0"/>
    <title>prefect_aws API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>




            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#AwsCredentials">AwsCredentials</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#AwsCredentials.aws_access_key_id">aws_access_key_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsCredentials.aws_secret_access_key">aws_secret_access_key</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsCredentials.aws_session_token">aws_session_token</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsCredentials.profile_name">profile_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsCredentials.region_name">region_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsCredentials.aws_client_parameters">aws_client_parameters</a>
                        </li>
                        <li>
                                <a class="class" href="#AwsCredentials.Config">AwsCredentials.Config</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#AwsCredentials.Config.arbitrary_types_allowed">arbitrary_types_allowed</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#AwsCredentials.get_boto3_session">get_boto3_session</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsCredentials.get_client">get_client</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsCredentials.get_s3_client">get_s3_client</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsCredentials.get_secrets_manager_client">get_secrets_manager_client</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AwsClientParameters">AwsClientParameters</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#AwsClientParameters.api_version">api_version</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsClientParameters.use_ssl">use_ssl</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsClientParameters.verify">verify</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsClientParameters.verify_cert_path">verify_cert_path</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsClientParameters.endpoint_url">endpoint_url</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsClientParameters.config">config</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsClientParameters.instantiate_config">instantiate_config</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsClientParameters.deprecated_verify_cert_path">deprecated_verify_cert_path</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsClientParameters.verify_cert_path_and_verify">verify_cert_path_and_verify</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsClientParameters.get_params_override">get_params_override</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#LambdaFunction">LambdaFunction</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#LambdaFunction.function_name">function_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#LambdaFunction.qualifier">qualifier</a>
                        </li>
                        <li>
                                <a class="variable" href="#LambdaFunction.aws_credentials">aws_credentials</a>
                        </li>
                        <li>
                                <a class="class" href="#LambdaFunction.Config">LambdaFunction.Config</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#LambdaFunction.Config.smart_union">smart_union</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#LambdaFunction.invoke">invoke</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MinIOCredentials">MinIOCredentials</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MinIOCredentials.minio_root_user">minio_root_user</a>
                        </li>
                        <li>
                                <a class="variable" href="#MinIOCredentials.minio_root_password">minio_root_password</a>
                        </li>
                        <li>
                                <a class="variable" href="#MinIOCredentials.region_name">region_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#MinIOCredentials.aws_client_parameters">aws_client_parameters</a>
                        </li>
                        <li>
                                <a class="class" href="#MinIOCredentials.Config">MinIOCredentials.Config</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#MinIOCredentials.Config.arbitrary_types_allowed">arbitrary_types_allowed</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#MinIOCredentials.get_boto3_session">get_boto3_session</a>
                        </li>
                        <li>
                                <a class="function" href="#MinIOCredentials.get_client">get_client</a>
                        </li>
                        <li>
                                <a class="function" href="#MinIOCredentials.get_s3_client">get_s3_client</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#S3Bucket">S3Bucket</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#S3Bucket.bucket_name">bucket_name</a>
                        </li>
                        <li>
                                <a class="variable" href="#S3Bucket.credentials">credentials</a>
                        </li>
                        <li>
                                <a class="variable" href="#S3Bucket.bucket_folder">bucket_folder</a>
                        </li>
                        <li>
                                <a class="variable" href="#S3Bucket.basepath">basepath</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.get_directory">get_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.put_directory">put_directory</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.read_path">read_path</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.write_path">write_path</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.list_objects">list_objects</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.download_object_to_path">download_object_to_path</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.download_object_to_file_object">download_object_to_file_object</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.download_folder_to_path">download_folder_to_path</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.stream_from">stream_from</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.upload_from_path">upload_from_path</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.upload_from_file_object">upload_from_file_object</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.upload_from_folder">upload_from_folder</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.copy_object">copy_object</a>
                        </li>
                        <li>
                                <a class="function" href="#S3Bucket.move_object">move_object</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ECSTask">ECSTask</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#ECSTask.__init__">ECSTask</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.aws_credentials">aws_credentials</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_definition_arn">task_definition_arn</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_definition">task_definition</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.family">family</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.image">image</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.auto_deregister_task_definition">auto_deregister_task_definition</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.cpu">cpu</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.memory">memory</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.execution_role_arn">execution_role_arn</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.configure_cloudwatch_logs">configure_cloudwatch_logs</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.cloudwatch_logs_options">cloudwatch_logs_options</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.stream_output">stream_output</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.launch_type">launch_type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.vpc_id">vpc_id</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.cluster">cluster</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.env">env</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_role_arn">task_role_arn</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_customizations">task_customizations</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_start_timeout_seconds">task_start_timeout_seconds</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSTask.task_watch_poll_interval">task_watch_poll_interval</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.set_default_configure_cloudwatch_logs">set_default_configure_cloudwatch_logs</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn">configure_cloudwatch_logs_requires_execution_role_arn</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs">cloudwatch_logs_options_requires_configure_cloudwatch_logs</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.image_is_required">image_is_required</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.cast_customizations_to_a_json_patch">cast_customizations_to_a_json_patch</a>
                        </li>
                        <li>
                                <a class="class" href="#ECSTask.Config">ECSTask.Config</a>
                                        <ul class="memberlist">
                                    <li>
                                            <a class="variable" href="#ECSTask.Config.arbitrary_types_allowed">arbitrary_types_allowed</a>
                                    </li>
                                    <li>
                                            <a class="variable" href="#ECSTask.Config.json_encoders">json_encoders</a>
                                    </li>
                            </ul>

                        </li>
                        <li>
                                <a class="function" href="#ECSTask.dict">dict</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.prepare_for_flow_run">prepare_for_flow_run</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.kill">kill</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.get_corresponding_worker_type">get_corresponding_worker_type</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.generate_work_pool_base_job_template">generate_work_pool_base_job_template</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSTask.preview">preview</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#AwsSecret">AwsSecret</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#AwsSecret.aws_credentials">aws_credentials</a>
                        </li>
                        <li>
                                <a class="variable" href="#AwsSecret.secret_name">secret_name</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsSecret.read_secret">read_secret</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsSecret.write_secret">write_secret</a>
                        </li>
                        <li>
                                <a class="function" href="#AwsSecret.delete_secret">delete_secret</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#ECSWorker">ECSWorker</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#ECSWorker.type">type</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSWorker.job_configuration">job_configuration</a>
                        </li>
                        <li>
                                <a class="variable" href="#ECSWorker.job_configuration_variables">job_configuration_variables</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSWorker.run">run</a>
                        </li>
                        <li>
                                <a class="function" href="#ECSWorker.kill_infrastructure">kill_infrastructure</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
prefect_aws    </h1>

                
                        <input id="mod-prefect_aws-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-prefect_aws-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_version</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="kn">from</span> <span class="nn">.credentials</span> <span class="kn">import</span> <span class="n">AwsCredentials</span><span class="p">,</span> <span class="n">MinIOCredentials</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="kn">from</span> <span class="nn">.client_parameters</span> <span class="kn">import</span> <span class="n">AwsClientParameters</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a><span class="kn">from</span> <span class="nn">.lambda_function</span> <span class="kn">import</span> <span class="n">LambdaFunction</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="kn">from</span> <span class="nn">.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span> <span class="nn">.ecs</span> <span class="kn">import</span> <span class="n">ECSTask</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a><span class="kn">from</span> <span class="nn">.secrets_manager</span> <span class="kn">import</span> <span class="n">AwsSecret</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span> <span class="nn">.workers</span> <span class="kn">import</span> <span class="n">ECSWorker</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span> <span class="nn">prefect._internal.compatibility.deprecated</span> <span class="kn">import</span> <span class="p">(</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a>    <span class="n">register_renamed_module</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="p">)</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="n">register_renamed_module</span><span class="p">(</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="s2">&quot;prefect_aws.projects&quot;</span><span class="p">,</span> <span class="s2">&quot;prefect_aws.deployments&quot;</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;Jun 2023&quot;</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="p">)</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a><span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">19</span></a>    <span class="s2">&quot;AwsCredentials&quot;</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">20</span></a>    <span class="s2">&quot;AwsClientParameters&quot;</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">21</span></a>    <span class="s2">&quot;LambdaFunction&quot;</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">22</span></a>    <span class="s2">&quot;MinIOCredentials&quot;</span><span class="p">,</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">23</span></a>    <span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">24</span></a>    <span class="s2">&quot;ECSTask&quot;</span><span class="p">,</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">25</span></a>    <span class="s2">&quot;AwsSecret&quot;</span><span class="p">,</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">26</span></a>    <span class="s2">&quot;ECSWorker&quot;</span><span class="p">,</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">27</span></a><span class="p">]</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">28</span></a>
</span><span id="L-29"><a href="#L-29"><span class="linenos">29</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="n">_version</span><span class="o">.</span><span class="n">__version__</span>
</span></pre></div>


            </section>
                <section id="AwsCredentials">
                            <input id="AwsCredentials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AwsCredentials</span><wbr>(<span class="base">prefect.blocks.abstract.CredentialsBlock</span>):

                <label class="view-source-button" for="AwsCredentials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials-60"><a href="#AwsCredentials-60"><span class="linenos"> 60</span></a><span class="k">class</span> <span class="nc">AwsCredentials</span><span class="p">(</span><span class="n">CredentialsBlock</span><span class="p">):</span>
</span><span id="AwsCredentials-61"><a href="#AwsCredentials-61"><span class="linenos"> 61</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-62"><a href="#AwsCredentials-62"><span class="linenos"> 62</span></a><span class="sd">    Block used to manage authentication with AWS. AWS authentication is</span>
</span><span id="AwsCredentials-63"><a href="#AwsCredentials-63"><span class="linenos"> 63</span></a><span class="sd">    handled via the `boto3` module. Refer to the</span>
</span><span id="AwsCredentials-64"><a href="#AwsCredentials-64"><span class="linenos"> 64</span></a><span class="sd">    [boto3 docs](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html)</span>
</span><span id="AwsCredentials-65"><a href="#AwsCredentials-65"><span class="linenos"> 65</span></a><span class="sd">    for more info about the possible credential configurations.</span>
</span><span id="AwsCredentials-66"><a href="#AwsCredentials-66"><span class="linenos"> 66</span></a>
</span><span id="AwsCredentials-67"><a href="#AwsCredentials-67"><span class="linenos"> 67</span></a><span class="sd">    Example:</span>
</span><span id="AwsCredentials-68"><a href="#AwsCredentials-68"><span class="linenos"> 68</span></a><span class="sd">        Load stored AWS credentials:</span>
</span><span id="AwsCredentials-69"><a href="#AwsCredentials-69"><span class="linenos"> 69</span></a><span class="sd">        ```python</span>
</span><span id="AwsCredentials-70"><a href="#AwsCredentials-70"><span class="linenos"> 70</span></a><span class="sd">        from prefect_aws import AwsCredentials</span>
</span><span id="AwsCredentials-71"><a href="#AwsCredentials-71"><span class="linenos"> 71</span></a>
</span><span id="AwsCredentials-72"><a href="#AwsCredentials-72"><span class="linenos"> 72</span></a><span class="sd">        aws_credentials_block = AwsCredentials.load(&quot;BLOCK_NAME&quot;)</span>
</span><span id="AwsCredentials-73"><a href="#AwsCredentials-73"><span class="linenos"> 73</span></a><span class="sd">        ```</span>
</span><span id="AwsCredentials-74"><a href="#AwsCredentials-74"><span class="linenos"> 74</span></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa E501</span>
</span><span id="AwsCredentials-75"><a href="#AwsCredentials-75"><span class="linenos"> 75</span></a>
</span><span id="AwsCredentials-76"><a href="#AwsCredentials-76"><span class="linenos"> 76</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="AwsCredentials-77"><a href="#AwsCredentials-77"><span class="linenos"> 77</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;AWS Credentials&quot;</span>
</span><span id="AwsCredentials-78"><a href="#AwsCredentials-78"><span class="linenos"> 78</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/credentials/#prefect_aws.credentials.AwsCredentials&quot;</span>  <span class="c1"># noqa</span>
</span><span id="AwsCredentials-79"><a href="#AwsCredentials-79"><span class="linenos"> 79</span></a>
</span><span id="AwsCredentials-80"><a href="#AwsCredentials-80"><span class="linenos"> 80</span></a>    <span class="n">aws_access_key_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-81"><a href="#AwsCredentials-81"><span class="linenos"> 81</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsCredentials-82"><a href="#AwsCredentials-82"><span class="linenos"> 82</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A specific AWS access key ID.&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-83"><a href="#AwsCredentials-83"><span class="linenos"> 83</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Access Key ID&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-84"><a href="#AwsCredentials-84"><span class="linenos"> 84</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-85"><a href="#AwsCredentials-85"><span class="linenos"> 85</span></a>    <span class="n">aws_secret_access_key</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">SecretStr</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-86"><a href="#AwsCredentials-86"><span class="linenos"> 86</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsCredentials-87"><a href="#AwsCredentials-87"><span class="linenos"> 87</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A specific AWS secret access key.&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-88"><a href="#AwsCredentials-88"><span class="linenos"> 88</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Access Key Secret&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-89"><a href="#AwsCredentials-89"><span class="linenos"> 89</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-90"><a href="#AwsCredentials-90"><span class="linenos"> 90</span></a>    <span class="n">aws_session_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-91"><a href="#AwsCredentials-91"><span class="linenos"> 91</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsCredentials-92"><a href="#AwsCredentials-92"><span class="linenos"> 92</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="AwsCredentials-93"><a href="#AwsCredentials-93"><span class="linenos"> 93</span></a>            <span class="s2">&quot;The session key for your AWS account. &quot;</span>
</span><span id="AwsCredentials-94"><a href="#AwsCredentials-94"><span class="linenos"> 94</span></a>            <span class="s2">&quot;This is only needed when you are using temporary credentials.&quot;</span>
</span><span id="AwsCredentials-95"><a href="#AwsCredentials-95"><span class="linenos"> 95</span></a>        <span class="p">),</span>
</span><span id="AwsCredentials-96"><a href="#AwsCredentials-96"><span class="linenos"> 96</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Session Token&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-97"><a href="#AwsCredentials-97"><span class="linenos"> 97</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-98"><a href="#AwsCredentials-98"><span class="linenos"> 98</span></a>    <span class="n">profile_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-99"><a href="#AwsCredentials-99"><span class="linenos"> 99</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The profile to use when creating your session.&quot;</span>
</span><span id="AwsCredentials-100"><a href="#AwsCredentials-100"><span class="linenos">100</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-101"><a href="#AwsCredentials-101"><span class="linenos">101</span></a>    <span class="n">region_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-102"><a href="#AwsCredentials-102"><span class="linenos">102</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsCredentials-103"><a href="#AwsCredentials-103"><span class="linenos">103</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The AWS Region where you want to create new connections.&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-104"><a href="#AwsCredentials-104"><span class="linenos">104</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-105"><a href="#AwsCredentials-105"><span class="linenos">105</span></a>    <span class="n">aws_client_parameters</span><span class="p">:</span> <span class="n">AwsClientParameters</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsCredentials-106"><a href="#AwsCredentials-106"><span class="linenos">106</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsClientParameters</span><span class="p">,</span>
</span><span id="AwsCredentials-107"><a href="#AwsCredentials-107"><span class="linenos">107</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extra parameters to initialize the Client.&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-108"><a href="#AwsCredentials-108"><span class="linenos">108</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Client Parameters&quot;</span><span class="p">,</span>
</span><span id="AwsCredentials-109"><a href="#AwsCredentials-109"><span class="linenos">109</span></a>    <span class="p">)</span>
</span><span id="AwsCredentials-110"><a href="#AwsCredentials-110"><span class="linenos">110</span></a>
</span><span id="AwsCredentials-111"><a href="#AwsCredentials-111"><span class="linenos">111</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="AwsCredentials-112"><a href="#AwsCredentials-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for pydantic model.&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-113"><a href="#AwsCredentials-113"><span class="linenos">113</span></a>
</span><span id="AwsCredentials-114"><a href="#AwsCredentials-114"><span class="linenos">114</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AwsCredentials-115"><a href="#AwsCredentials-115"><span class="linenos">115</span></a>
</span><span id="AwsCredentials-116"><a href="#AwsCredentials-116"><span class="linenos">116</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AwsCredentials-117"><a href="#AwsCredentials-117"><span class="linenos">117</span></a>        <span class="n">field_hashes</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="AwsCredentials-118"><a href="#AwsCredentials-118"><span class="linenos">118</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_access_key_id</span><span class="p">),</span>
</span><span id="AwsCredentials-119"><a href="#AwsCredentials-119"><span class="linenos">119</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_secret_access_key</span><span class="p">),</span>
</span><span id="AwsCredentials-120"><a href="#AwsCredentials-120"><span class="linenos">120</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_session_token</span><span class="p">),</span>
</span><span id="AwsCredentials-121"><a href="#AwsCredentials-121"><span class="linenos">121</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">),</span>
</span><span id="AwsCredentials-122"><a href="#AwsCredentials-122"><span class="linenos">122</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">),</span>
</span><span id="AwsCredentials-123"><a href="#AwsCredentials-123"><span class="linenos">123</span></a>            <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_client_parameters</span><span class="p">),</span>
</span><span id="AwsCredentials-124"><a href="#AwsCredentials-124"><span class="linenos">124</span></a>        <span class="p">)</span>
</span><span id="AwsCredentials-125"><a href="#AwsCredentials-125"><span class="linenos">125</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">field_hashes</span><span class="p">)</span>
</span><span id="AwsCredentials-126"><a href="#AwsCredentials-126"><span class="linenos">126</span></a>
</span><span id="AwsCredentials-127"><a href="#AwsCredentials-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">get_boto3_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
</span><span id="AwsCredentials-128"><a href="#AwsCredentials-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-129"><a href="#AwsCredentials-129"><span class="linenos">129</span></a><span class="sd">        Returns an authenticated boto3 session that can be used to create clients</span>
</span><span id="AwsCredentials-130"><a href="#AwsCredentials-130"><span class="linenos">130</span></a><span class="sd">        for AWS services</span>
</span><span id="AwsCredentials-131"><a href="#AwsCredentials-131"><span class="linenos">131</span></a>
</span><span id="AwsCredentials-132"><a href="#AwsCredentials-132"><span class="linenos">132</span></a><span class="sd">        Example:</span>
</span><span id="AwsCredentials-133"><a href="#AwsCredentials-133"><span class="linenos">133</span></a><span class="sd">            Create an S3 client from an authorized boto3 session:</span>
</span><span id="AwsCredentials-134"><a href="#AwsCredentials-134"><span class="linenos">134</span></a><span class="sd">            ```python</span>
</span><span id="AwsCredentials-135"><a href="#AwsCredentials-135"><span class="linenos">135</span></a><span class="sd">            aws_credentials = AwsCredentials(</span>
</span><span id="AwsCredentials-136"><a href="#AwsCredentials-136"><span class="linenos">136</span></a><span class="sd">                aws_access_key_id = &quot;access_key_id&quot;,</span>
</span><span id="AwsCredentials-137"><a href="#AwsCredentials-137"><span class="linenos">137</span></a><span class="sd">                aws_secret_access_key = &quot;secret_access_key&quot;</span>
</span><span id="AwsCredentials-138"><a href="#AwsCredentials-138"><span class="linenos">138</span></a><span class="sd">                )</span>
</span><span id="AwsCredentials-139"><a href="#AwsCredentials-139"><span class="linenos">139</span></a><span class="sd">            s3_client = aws_credentials.get_boto3_session().client(&quot;s3&quot;)</span>
</span><span id="AwsCredentials-140"><a href="#AwsCredentials-140"><span class="linenos">140</span></a><span class="sd">            ```</span>
</span><span id="AwsCredentials-141"><a href="#AwsCredentials-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials-142"><a href="#AwsCredentials-142"><span class="linenos">142</span></a>
</span><span id="AwsCredentials-143"><a href="#AwsCredentials-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_secret_access_key</span><span class="p">:</span>
</span><span id="AwsCredentials-144"><a href="#AwsCredentials-144"><span class="linenos">144</span></a>            <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_secret_access_key</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span id="AwsCredentials-145"><a href="#AwsCredentials-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AwsCredentials-146"><a href="#AwsCredentials-146"><span class="linenos">146</span></a>            <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AwsCredentials-147"><a href="#AwsCredentials-147"><span class="linenos">147</span></a>
</span><span id="AwsCredentials-148"><a href="#AwsCredentials-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span id="AwsCredentials-149"><a href="#AwsCredentials-149"><span class="linenos">149</span></a>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_access_key_id</span><span class="p">,</span>
</span><span id="AwsCredentials-150"><a href="#AwsCredentials-150"><span class="linenos">150</span></a>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">aws_secret_access_key</span><span class="p">,</span>
</span><span id="AwsCredentials-151"><a href="#AwsCredentials-151"><span class="linenos">151</span></a>            <span class="n">aws_session_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_session_token</span><span class="p">,</span>
</span><span id="AwsCredentials-152"><a href="#AwsCredentials-152"><span class="linenos">152</span></a>            <span class="n">profile_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">,</span>
</span><span id="AwsCredentials-153"><a href="#AwsCredentials-153"><span class="linenos">153</span></a>            <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
</span><span id="AwsCredentials-154"><a href="#AwsCredentials-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span><span id="AwsCredentials-155"><a href="#AwsCredentials-155"><span class="linenos">155</span></a>
</span><span id="AwsCredentials-156"><a href="#AwsCredentials-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]):</span>
</span><span id="AwsCredentials-157"><a href="#AwsCredentials-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-158"><a href="#AwsCredentials-158"><span class="linenos">158</span></a><span class="sd">        Helper method to dynamically get a client type.</span>
</span><span id="AwsCredentials-159"><a href="#AwsCredentials-159"><span class="linenos">159</span></a>
</span><span id="AwsCredentials-160"><a href="#AwsCredentials-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="AwsCredentials-161"><a href="#AwsCredentials-161"><span class="linenos">161</span></a><span class="sd">            client_type: The client&#39;s service name.</span>
</span><span id="AwsCredentials-162"><a href="#AwsCredentials-162"><span class="linenos">162</span></a>
</span><span id="AwsCredentials-163"><a href="#AwsCredentials-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials-164"><a href="#AwsCredentials-164"><span class="linenos">164</span></a><span class="sd">            An authenticated client.</span>
</span><span id="AwsCredentials-165"><a href="#AwsCredentials-165"><span class="linenos">165</span></a>
</span><span id="AwsCredentials-166"><a href="#AwsCredentials-166"><span class="linenos">166</span></a><span class="sd">        Raises:</span>
</span><span id="AwsCredentials-167"><a href="#AwsCredentials-167"><span class="linenos">167</span></a><span class="sd">            ValueError: if the client is not supported.</span>
</span><span id="AwsCredentials-168"><a href="#AwsCredentials-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials-169"><a href="#AwsCredentials-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client_type</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">):</span>
</span><span id="AwsCredentials-170"><a href="#AwsCredentials-170"><span class="linenos">170</span></a>            <span class="n">client_type</span> <span class="o">=</span> <span class="n">client_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="AwsCredentials-171"><a href="#AwsCredentials-171"><span class="linenos">171</span></a>
</span><span id="AwsCredentials-172"><a href="#AwsCredentials-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">_get_client_cached</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="o">=</span><span class="n">client_type</span><span class="p">)</span>
</span><span id="AwsCredentials-173"><a href="#AwsCredentials-173"><span class="linenos">173</span></a>
</span><span id="AwsCredentials-174"><a href="#AwsCredentials-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">get_s3_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="AwsCredentials-175"><a href="#AwsCredentials-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-176"><a href="#AwsCredentials-176"><span class="linenos">176</span></a><span class="sd">        Gets an authenticated S3 client.</span>
</span><span id="AwsCredentials-177"><a href="#AwsCredentials-177"><span class="linenos">177</span></a>
</span><span id="AwsCredentials-178"><a href="#AwsCredentials-178"><span class="linenos">178</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials-179"><a href="#AwsCredentials-179"><span class="linenos">179</span></a><span class="sd">            An authenticated S3 client.</span>
</span><span id="AwsCredentials-180"><a href="#AwsCredentials-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials-181"><a href="#AwsCredentials-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">S3</span><span class="p">)</span>
</span><span id="AwsCredentials-182"><a href="#AwsCredentials-182"><span class="linenos">182</span></a>
</span><span id="AwsCredentials-183"><a href="#AwsCredentials-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">get_secrets_manager_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecretsManagerClient</span><span class="p">:</span>
</span><span id="AwsCredentials-184"><a href="#AwsCredentials-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials-185"><a href="#AwsCredentials-185"><span class="linenos">185</span></a><span class="sd">        Gets an authenticated Secrets Manager client.</span>
</span><span id="AwsCredentials-186"><a href="#AwsCredentials-186"><span class="linenos">186</span></a>
</span><span id="AwsCredentials-187"><a href="#AwsCredentials-187"><span class="linenos">187</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials-188"><a href="#AwsCredentials-188"><span class="linenos">188</span></a><span class="sd">            An authenticated Secrets Manager client.</span>
</span><span id="AwsCredentials-189"><a href="#AwsCredentials-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials-190"><a href="#AwsCredentials-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">SECRETS_MANAGER</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Block used to manage authentication with AWS. AWS authentication is
handled via the <code>boto3</code> module. Refer to the
<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/credentials.html">boto3 docs</a>
for more info about the possible credential configurations.</p>

<p>Example:
    Load stored AWS credentials:
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws</span> <span class="kn">import</span> <span class="n">AwsCredentials</span>
 <br />
    <span class="n">aws_credentials_block</span> <span class="o">=</span> <span class="n"><a href="#AwsCredentials.load">AwsCredentials.load</a></span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            <div id="AwsCredentials.aws_access_key_id" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_access_key_id</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.aws_access_key_id"></a>
    
    

                            </div>
                            <div id="AwsCredentials.aws_secret_access_key" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_secret_access_key</span><span class="annotation">: Optional[pydantic.v1.types.SecretStr]</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.aws_secret_access_key"></a>
    
    

                            </div>
                            <div id="AwsCredentials.aws_session_token" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_session_token</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.aws_session_token"></a>
    
    

                            </div>
                            <div id="AwsCredentials.profile_name" class="classattr">
                                <div class="attr variable">
            <span class="name">profile_name</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.profile_name"></a>
    
    

                            </div>
                            <div id="AwsCredentials.region_name" class="classattr">
                                <div class="attr variable">
            <span class="name">region_name</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.region_name"></a>
    
    

                            </div>
                            <div id="AwsCredentials.aws_client_parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_client_parameters</span><span class="annotation">: <a href="#AwsClientParameters">AwsClientParameters</a></span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.aws_client_parameters"></a>
    
    

                            </div>
                            <div id="AwsCredentials.get_boto3_session" class="classattr">
                                        <input id="AwsCredentials.get_boto3_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boto3_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span>:</span></span>

                <label class="view-source-button" for="AwsCredentials.get_boto3_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials.get_boto3_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials.get_boto3_session-127"><a href="#AwsCredentials.get_boto3_session-127"><span class="linenos">127</span></a>    <span class="k">def</span> <span class="nf">get_boto3_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
</span><span id="AwsCredentials.get_boto3_session-128"><a href="#AwsCredentials.get_boto3_session-128"><span class="linenos">128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_boto3_session-129"><a href="#AwsCredentials.get_boto3_session-129"><span class="linenos">129</span></a><span class="sd">        Returns an authenticated boto3 session that can be used to create clients</span>
</span><span id="AwsCredentials.get_boto3_session-130"><a href="#AwsCredentials.get_boto3_session-130"><span class="linenos">130</span></a><span class="sd">        for AWS services</span>
</span><span id="AwsCredentials.get_boto3_session-131"><a href="#AwsCredentials.get_boto3_session-131"><span class="linenos">131</span></a>
</span><span id="AwsCredentials.get_boto3_session-132"><a href="#AwsCredentials.get_boto3_session-132"><span class="linenos">132</span></a><span class="sd">        Example:</span>
</span><span id="AwsCredentials.get_boto3_session-133"><a href="#AwsCredentials.get_boto3_session-133"><span class="linenos">133</span></a><span class="sd">            Create an S3 client from an authorized boto3 session:</span>
</span><span id="AwsCredentials.get_boto3_session-134"><a href="#AwsCredentials.get_boto3_session-134"><span class="linenos">134</span></a><span class="sd">            ```python</span>
</span><span id="AwsCredentials.get_boto3_session-135"><a href="#AwsCredentials.get_boto3_session-135"><span class="linenos">135</span></a><span class="sd">            aws_credentials = AwsCredentials(</span>
</span><span id="AwsCredentials.get_boto3_session-136"><a href="#AwsCredentials.get_boto3_session-136"><span class="linenos">136</span></a><span class="sd">                aws_access_key_id = &quot;access_key_id&quot;,</span>
</span><span id="AwsCredentials.get_boto3_session-137"><a href="#AwsCredentials.get_boto3_session-137"><span class="linenos">137</span></a><span class="sd">                aws_secret_access_key = &quot;secret_access_key&quot;</span>
</span><span id="AwsCredentials.get_boto3_session-138"><a href="#AwsCredentials.get_boto3_session-138"><span class="linenos">138</span></a><span class="sd">                )</span>
</span><span id="AwsCredentials.get_boto3_session-139"><a href="#AwsCredentials.get_boto3_session-139"><span class="linenos">139</span></a><span class="sd">            s3_client = aws_credentials.get_boto3_session().client(&quot;s3&quot;)</span>
</span><span id="AwsCredentials.get_boto3_session-140"><a href="#AwsCredentials.get_boto3_session-140"><span class="linenos">140</span></a><span class="sd">            ```</span>
</span><span id="AwsCredentials.get_boto3_session-141"><a href="#AwsCredentials.get_boto3_session-141"><span class="linenos">141</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_boto3_session-142"><a href="#AwsCredentials.get_boto3_session-142"><span class="linenos">142</span></a>
</span><span id="AwsCredentials.get_boto3_session-143"><a href="#AwsCredentials.get_boto3_session-143"><span class="linenos">143</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_secret_access_key</span><span class="p">:</span>
</span><span id="AwsCredentials.get_boto3_session-144"><a href="#AwsCredentials.get_boto3_session-144"><span class="linenos">144</span></a>            <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_secret_access_key</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span id="AwsCredentials.get_boto3_session-145"><a href="#AwsCredentials.get_boto3_session-145"><span class="linenos">145</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AwsCredentials.get_boto3_session-146"><a href="#AwsCredentials.get_boto3_session-146"><span class="linenos">146</span></a>            <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AwsCredentials.get_boto3_session-147"><a href="#AwsCredentials.get_boto3_session-147"><span class="linenos">147</span></a>
</span><span id="AwsCredentials.get_boto3_session-148"><a href="#AwsCredentials.get_boto3_session-148"><span class="linenos">148</span></a>        <span class="k">return</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span id="AwsCredentials.get_boto3_session-149"><a href="#AwsCredentials.get_boto3_session-149"><span class="linenos">149</span></a>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_access_key_id</span><span class="p">,</span>
</span><span id="AwsCredentials.get_boto3_session-150"><a href="#AwsCredentials.get_boto3_session-150"><span class="linenos">150</span></a>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">aws_secret_access_key</span><span class="p">,</span>
</span><span id="AwsCredentials.get_boto3_session-151"><a href="#AwsCredentials.get_boto3_session-151"><span class="linenos">151</span></a>            <span class="n">aws_session_token</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_session_token</span><span class="p">,</span>
</span><span id="AwsCredentials.get_boto3_session-152"><a href="#AwsCredentials.get_boto3_session-152"><span class="linenos">152</span></a>            <span class="n">profile_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">profile_name</span><span class="p">,</span>
</span><span id="AwsCredentials.get_boto3_session-153"><a href="#AwsCredentials.get_boto3_session-153"><span class="linenos">153</span></a>            <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
</span><span id="AwsCredentials.get_boto3_session-154"><a href="#AwsCredentials.get_boto3_session-154"><span class="linenos">154</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an authenticated boto3 session that can be used to create clients
for AWS services</p>

<p>Example:
    Create an S3 client from an authorized boto3 session:
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="n">aws_credentials</span> <span class="o">=</span> <span class="n">AwsCredentials</span><span class="p">(</span>
        <span class="n">aws_access_key_id</span> <span class="o">=</span> <span class="s2">&quot;access_key_id&quot;</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span> <span class="o">=</span> <span class="s2">&quot;secret_access_key&quot;</span>
        <span class="p">)</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_boto3_session</span><span class="p">()</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="AwsCredentials.get_client" class="classattr">
                                        <input id="AwsCredentials.get_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">prefect_aws</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">ClientType</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AwsCredentials.get_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials.get_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials.get_client-156"><a href="#AwsCredentials.get_client-156"><span class="linenos">156</span></a>    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]):</span>
</span><span id="AwsCredentials.get_client-157"><a href="#AwsCredentials.get_client-157"><span class="linenos">157</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_client-158"><a href="#AwsCredentials.get_client-158"><span class="linenos">158</span></a><span class="sd">        Helper method to dynamically get a client type.</span>
</span><span id="AwsCredentials.get_client-159"><a href="#AwsCredentials.get_client-159"><span class="linenos">159</span></a>
</span><span id="AwsCredentials.get_client-160"><a href="#AwsCredentials.get_client-160"><span class="linenos">160</span></a><span class="sd">        Args:</span>
</span><span id="AwsCredentials.get_client-161"><a href="#AwsCredentials.get_client-161"><span class="linenos">161</span></a><span class="sd">            client_type: The client&#39;s service name.</span>
</span><span id="AwsCredentials.get_client-162"><a href="#AwsCredentials.get_client-162"><span class="linenos">162</span></a>
</span><span id="AwsCredentials.get_client-163"><a href="#AwsCredentials.get_client-163"><span class="linenos">163</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials.get_client-164"><a href="#AwsCredentials.get_client-164"><span class="linenos">164</span></a><span class="sd">            An authenticated client.</span>
</span><span id="AwsCredentials.get_client-165"><a href="#AwsCredentials.get_client-165"><span class="linenos">165</span></a>
</span><span id="AwsCredentials.get_client-166"><a href="#AwsCredentials.get_client-166"><span class="linenos">166</span></a><span class="sd">        Raises:</span>
</span><span id="AwsCredentials.get_client-167"><a href="#AwsCredentials.get_client-167"><span class="linenos">167</span></a><span class="sd">            ValueError: if the client is not supported.</span>
</span><span id="AwsCredentials.get_client-168"><a href="#AwsCredentials.get_client-168"><span class="linenos">168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_client-169"><a href="#AwsCredentials.get_client-169"><span class="linenos">169</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client_type</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">):</span>
</span><span id="AwsCredentials.get_client-170"><a href="#AwsCredentials.get_client-170"><span class="linenos">170</span></a>            <span class="n">client_type</span> <span class="o">=</span> <span class="n">client_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="AwsCredentials.get_client-171"><a href="#AwsCredentials.get_client-171"><span class="linenos">171</span></a>
</span><span id="AwsCredentials.get_client-172"><a href="#AwsCredentials.get_client-172"><span class="linenos">172</span></a>        <span class="k">return</span> <span class="n">_get_client_cached</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="o">=</span><span class="n">client_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper method to dynamically get a client type.</p>

<p>Args:
    client_type: The client's service name.</p>

<p>Returns:
    An authenticated client.</p>

<p>Raises:
    ValueError: if the client is not supported.</p>
</div>


                            </div>
                            <div id="AwsCredentials.get_s3_client" class="classattr">
                                        <input id="AwsCredentials.get_s3_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_s3_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">mypy_boto3_s3</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">S3Client</span>:</span></span>

                <label class="view-source-button" for="AwsCredentials.get_s3_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials.get_s3_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials.get_s3_client-174"><a href="#AwsCredentials.get_s3_client-174"><span class="linenos">174</span></a>    <span class="k">def</span> <span class="nf">get_s3_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="AwsCredentials.get_s3_client-175"><a href="#AwsCredentials.get_s3_client-175"><span class="linenos">175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_s3_client-176"><a href="#AwsCredentials.get_s3_client-176"><span class="linenos">176</span></a><span class="sd">        Gets an authenticated S3 client.</span>
</span><span id="AwsCredentials.get_s3_client-177"><a href="#AwsCredentials.get_s3_client-177"><span class="linenos">177</span></a>
</span><span id="AwsCredentials.get_s3_client-178"><a href="#AwsCredentials.get_s3_client-178"><span class="linenos">178</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials.get_s3_client-179"><a href="#AwsCredentials.get_s3_client-179"><span class="linenos">179</span></a><span class="sd">            An authenticated S3 client.</span>
</span><span id="AwsCredentials.get_s3_client-180"><a href="#AwsCredentials.get_s3_client-180"><span class="linenos">180</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_s3_client-181"><a href="#AwsCredentials.get_s3_client-181"><span class="linenos">181</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">S3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets an authenticated S3 client.</p>

<p>Returns:
    An authenticated S3 client.</p>
</div>


                            </div>
                            <div id="AwsCredentials.get_secrets_manager_client" class="classattr">
                                        <input id="AwsCredentials.get_secrets_manager_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_secrets_manager_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">mypy_boto3_secretsmanager</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">SecretsManagerClient</span>:</span></span>

                <label class="view-source-button" for="AwsCredentials.get_secrets_manager_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials.get_secrets_manager_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials.get_secrets_manager_client-183"><a href="#AwsCredentials.get_secrets_manager_client-183"><span class="linenos">183</span></a>    <span class="k">def</span> <span class="nf">get_secrets_manager_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SecretsManagerClient</span><span class="p">:</span>
</span><span id="AwsCredentials.get_secrets_manager_client-184"><a href="#AwsCredentials.get_secrets_manager_client-184"><span class="linenos">184</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_secrets_manager_client-185"><a href="#AwsCredentials.get_secrets_manager_client-185"><span class="linenos">185</span></a><span class="sd">        Gets an authenticated Secrets Manager client.</span>
</span><span id="AwsCredentials.get_secrets_manager_client-186"><a href="#AwsCredentials.get_secrets_manager_client-186"><span class="linenos">186</span></a>
</span><span id="AwsCredentials.get_secrets_manager_client-187"><a href="#AwsCredentials.get_secrets_manager_client-187"><span class="linenos">187</span></a><span class="sd">        Returns:</span>
</span><span id="AwsCredentials.get_secrets_manager_client-188"><a href="#AwsCredentials.get_secrets_manager_client-188"><span class="linenos">188</span></a><span class="sd">            An authenticated Secrets Manager client.</span>
</span><span id="AwsCredentials.get_secrets_manager_client-189"><a href="#AwsCredentials.get_secrets_manager_client-189"><span class="linenos">189</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsCredentials.get_secrets_manager_client-190"><a href="#AwsCredentials.get_secrets_manager_client-190"><span class="linenos">190</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">SECRETS_MANAGER</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets an authenticated Secrets Manager client.</p>

<p>Returns:
    An authenticated Secrets Manager client.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="AwsCredentials.__init__" class="function">Block</dd>
                <dd id="AwsCredentials.block_initialization" class="function">block_initialization</dd>
                <dd id="AwsCredentials.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="AwsCredentials.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="AwsCredentials.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="AwsCredentials.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="AwsCredentials.get_description" class="function">get_description</dd>
                <dd id="AwsCredentials.get_code_example" class="function">get_code_example</dd>
                <dd id="AwsCredentials.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="AwsCredentials.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="AwsCredentials.load" class="function">load</dd>
                <dd id="AwsCredentials.is_block_class" class="function">is_block_class</dd>
                <dd id="AwsCredentials.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="AwsCredentials.save" class="function">save</dd>
                <dd id="AwsCredentials.delete" class="function">delete</dd>
                <dd id="AwsCredentials.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="AwsCredentials.json" class="function">json</dd>
                <dd id="AwsCredentials.copy" class="function">copy</dd>

            </div>
            <div><dt>prefect.blocks.abstract.CredentialsBlock</dt>
                                <dd id="AwsCredentials.logger" class="variable">logger</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="AwsCredentials.dict" class="function">dict</dd>
                <dd id="AwsCredentials.parse_obj" class="function">parse_obj</dd>
                <dd id="AwsCredentials.parse_raw" class="function">parse_raw</dd>
                <dd id="AwsCredentials.parse_file" class="function">parse_file</dd>
                <dd id="AwsCredentials.from_orm" class="function">from_orm</dd>
                <dd id="AwsCredentials.construct" class="function">construct</dd>
                <dd id="AwsCredentials.schema" class="function">schema</dd>
                <dd id="AwsCredentials.schema_json" class="function">schema_json</dd>
                <dd id="AwsCredentials.validate" class="function">validate</dd>
                <dd id="AwsCredentials.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="AwsCredentials.Config">
                            <input id="AwsCredentials.Config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AwsCredentials.Config</span>:

                <label class="view-source-button" for="AwsCredentials.Config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsCredentials.Config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsCredentials.Config-111"><a href="#AwsCredentials.Config-111"><span class="linenos">111</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="AwsCredentials.Config-112"><a href="#AwsCredentials.Config-112"><span class="linenos">112</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for pydantic model.&quot;&quot;&quot;</span>
</span><span id="AwsCredentials.Config-113"><a href="#AwsCredentials.Config-113"><span class="linenos">113</span></a>
</span><span id="AwsCredentials.Config-114"><a href="#AwsCredentials.Config-114"><span class="linenos">114</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Config class for pydantic model.</p>
</div>


                            <div id="AwsCredentials.Config.arbitrary_types_allowed" class="classattr">
                                <div class="attr variable">
            <span class="name">arbitrary_types_allowed</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#AwsCredentials.Config.arbitrary_types_allowed"></a>
    
    

                            </div>
                </section>
                <section id="AwsClientParameters">
                            <input id="AwsClientParameters-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AwsClientParameters</span><wbr>(<span class="base">pydantic.v1.main.BaseModel</span>):

                <label class="view-source-button" for="AwsClientParameters-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsClientParameters"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsClientParameters-19"><a href="#AwsClientParameters-19"><span class="linenos"> 19</span></a><span class="k">class</span> <span class="nc">AwsClientParameters</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
</span><span id="AwsClientParameters-20"><a href="#AwsClientParameters-20"><span class="linenos"> 20</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-21"><a href="#AwsClientParameters-21"><span class="linenos"> 21</span></a><span class="sd">    Model used to manage extra parameters that you can pass when you initialize</span>
</span><span id="AwsClientParameters-22"><a href="#AwsClientParameters-22"><span class="linenos"> 22</span></a><span class="sd">    the Client. If you want to find more information, see</span>
</span><span id="AwsClientParameters-23"><a href="#AwsClientParameters-23"><span class="linenos"> 23</span></a><span class="sd">    [boto3 docs](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html)</span>
</span><span id="AwsClientParameters-24"><a href="#AwsClientParameters-24"><span class="linenos"> 24</span></a><span class="sd">    for more info about the possible client configurations.</span>
</span><span id="AwsClientParameters-25"><a href="#AwsClientParameters-25"><span class="linenos"> 25</span></a>
</span><span id="AwsClientParameters-26"><a href="#AwsClientParameters-26"><span class="linenos"> 26</span></a><span class="sd">    Attributes:</span>
</span><span id="AwsClientParameters-27"><a href="#AwsClientParameters-27"><span class="linenos"> 27</span></a><span class="sd">        api_version: The API version to use. By default, botocore will</span>
</span><span id="AwsClientParameters-28"><a href="#AwsClientParameters-28"><span class="linenos"> 28</span></a><span class="sd">            use the latest API version when creating a client. You only need</span>
</span><span id="AwsClientParameters-29"><a href="#AwsClientParameters-29"><span class="linenos"> 29</span></a><span class="sd">            to specify this parameter if you want to use a previous API version</span>
</span><span id="AwsClientParameters-30"><a href="#AwsClientParameters-30"><span class="linenos"> 30</span></a><span class="sd">            of the client.</span>
</span><span id="AwsClientParameters-31"><a href="#AwsClientParameters-31"><span class="linenos"> 31</span></a><span class="sd">        use_ssl: Whether or not to use SSL. By default, SSL is used.</span>
</span><span id="AwsClientParameters-32"><a href="#AwsClientParameters-32"><span class="linenos"> 32</span></a><span class="sd">            Note that not all services support non-ssl connections.</span>
</span><span id="AwsClientParameters-33"><a href="#AwsClientParameters-33"><span class="linenos"> 33</span></a><span class="sd">        verify: Whether or not to verify SSL certificates. By default</span>
</span><span id="AwsClientParameters-34"><a href="#AwsClientParameters-34"><span class="linenos"> 34</span></a><span class="sd">            SSL certificates are verified. If False, SSL will still be used</span>
</span><span id="AwsClientParameters-35"><a href="#AwsClientParameters-35"><span class="linenos"> 35</span></a><span class="sd">            (unless use_ssl is False), but SSL certificates</span>
</span><span id="AwsClientParameters-36"><a href="#AwsClientParameters-36"><span class="linenos"> 36</span></a><span class="sd">            will not be verified. Passing a file path to this is deprecated.</span>
</span><span id="AwsClientParameters-37"><a href="#AwsClientParameters-37"><span class="linenos"> 37</span></a><span class="sd">        verify_cert_path: A filename of the CA cert bundle to</span>
</span><span id="AwsClientParameters-38"><a href="#AwsClientParameters-38"><span class="linenos"> 38</span></a><span class="sd">            use. You can specify this argument if you want to use a</span>
</span><span id="AwsClientParameters-39"><a href="#AwsClientParameters-39"><span class="linenos"> 39</span></a><span class="sd">            different CA cert bundle than the one used by botocore.</span>
</span><span id="AwsClientParameters-40"><a href="#AwsClientParameters-40"><span class="linenos"> 40</span></a><span class="sd">        endpoint_url: The complete URL to use for the constructed</span>
</span><span id="AwsClientParameters-41"><a href="#AwsClientParameters-41"><span class="linenos"> 41</span></a><span class="sd">            client. Normally, botocore will automatically construct the</span>
</span><span id="AwsClientParameters-42"><a href="#AwsClientParameters-42"><span class="linenos"> 42</span></a><span class="sd">            appropriate URL to use when communicating with a service. You</span>
</span><span id="AwsClientParameters-43"><a href="#AwsClientParameters-43"><span class="linenos"> 43</span></a><span class="sd">            can specify a complete URL (including the &quot;http/https&quot; scheme)</span>
</span><span id="AwsClientParameters-44"><a href="#AwsClientParameters-44"><span class="linenos"> 44</span></a><span class="sd">            to override this behavior. If this value is provided,</span>
</span><span id="AwsClientParameters-45"><a href="#AwsClientParameters-45"><span class="linenos"> 45</span></a><span class="sd">            then ``use_ssl`` is ignored.</span>
</span><span id="AwsClientParameters-46"><a href="#AwsClientParameters-46"><span class="linenos"> 46</span></a><span class="sd">        config: Advanced configuration for Botocore clients. See</span>
</span><span id="AwsClientParameters-47"><a href="#AwsClientParameters-47"><span class="linenos"> 47</span></a><span class="sd">            [botocore docs](https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html)</span>
</span><span id="AwsClientParameters-48"><a href="#AwsClientParameters-48"><span class="linenos"> 48</span></a><span class="sd">            for more details.</span>
</span><span id="AwsClientParameters-49"><a href="#AwsClientParameters-49"><span class="linenos"> 49</span></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa E501</span>
</span><span id="AwsClientParameters-50"><a href="#AwsClientParameters-50"><span class="linenos"> 50</span></a>
</span><span id="AwsClientParameters-51"><a href="#AwsClientParameters-51"><span class="linenos"> 51</span></a>    <span class="n">api_version</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-52"><a href="#AwsClientParameters-52"><span class="linenos"> 52</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The API version to use.&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;API Version&quot;</span>
</span><span id="AwsClientParameters-53"><a href="#AwsClientParameters-53"><span class="linenos"> 53</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-54"><a href="#AwsClientParameters-54"><span class="linenos"> 54</span></a>    <span class="n">use_ssl</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-55"><a href="#AwsClientParameters-55"><span class="linenos"> 55</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether or not to use SSL.&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Use SSL&quot;</span>
</span><span id="AwsClientParameters-56"><a href="#AwsClientParameters-56"><span class="linenos"> 56</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-57"><a href="#AwsClientParameters-57"><span class="linenos"> 57</span></a>    <span class="n">verify</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">FilePath</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-58"><a href="#AwsClientParameters-58"><span class="linenos"> 58</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether or not to verify SSL certificates.&quot;</span>
</span><span id="AwsClientParameters-59"><a href="#AwsClientParameters-59"><span class="linenos"> 59</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-60"><a href="#AwsClientParameters-60"><span class="linenos"> 60</span></a>    <span class="n">verify_cert_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FilePath</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-61"><a href="#AwsClientParameters-61"><span class="linenos"> 61</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsClientParameters-62"><a href="#AwsClientParameters-62"><span class="linenos"> 62</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Path to the CA cert bundle to use.&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-63"><a href="#AwsClientParameters-63"><span class="linenos"> 63</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Certificate Authority Bundle File Path&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-64"><a href="#AwsClientParameters-64"><span class="linenos"> 64</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-65"><a href="#AwsClientParameters-65"><span class="linenos"> 65</span></a>    <span class="n">endpoint_url</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-66"><a href="#AwsClientParameters-66"><span class="linenos"> 66</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsClientParameters-67"><a href="#AwsClientParameters-67"><span class="linenos"> 67</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The complete URL to use for the constructed client.&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-68"><a href="#AwsClientParameters-68"><span class="linenos"> 68</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Endpoint URL&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-69"><a href="#AwsClientParameters-69"><span class="linenos"> 69</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-70"><a href="#AwsClientParameters-70"><span class="linenos"> 70</span></a>    <span class="n">config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="AwsClientParameters-71"><a href="#AwsClientParameters-71"><span class="linenos"> 71</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="AwsClientParameters-72"><a href="#AwsClientParameters-72"><span class="linenos"> 72</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Advanced configuration for Botocore clients.&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-73"><a href="#AwsClientParameters-73"><span class="linenos"> 73</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Botocore Config&quot;</span><span class="p">,</span>
</span><span id="AwsClientParameters-74"><a href="#AwsClientParameters-74"><span class="linenos"> 74</span></a>    <span class="p">)</span>
</span><span id="AwsClientParameters-75"><a href="#AwsClientParameters-75"><span class="linenos"> 75</span></a>
</span><span id="AwsClientParameters-76"><a href="#AwsClientParameters-76"><span class="linenos"> 76</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AwsClientParameters-77"><a href="#AwsClientParameters-77"><span class="linenos"> 77</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span>
</span><span id="AwsClientParameters-78"><a href="#AwsClientParameters-78"><span class="linenos"> 78</span></a>            <span class="p">(</span>
</span><span id="AwsClientParameters-79"><a href="#AwsClientParameters-79"><span class="linenos"> 79</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">api_version</span><span class="p">,</span>
</span><span id="AwsClientParameters-80"><a href="#AwsClientParameters-80"><span class="linenos"> 80</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">use_ssl</span><span class="p">,</span>
</span><span id="AwsClientParameters-81"><a href="#AwsClientParameters-81"><span class="linenos"> 81</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">verify</span><span class="p">,</span>
</span><span id="AwsClientParameters-82"><a href="#AwsClientParameters-82"><span class="linenos"> 82</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">verify_cert_path</span><span class="p">,</span>
</span><span id="AwsClientParameters-83"><a href="#AwsClientParameters-83"><span class="linenos"> 83</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">endpoint_url</span><span class="p">,</span>
</span><span id="AwsClientParameters-84"><a href="#AwsClientParameters-84"><span class="linenos"> 84</span></a>                <span class="n">hash_collection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">),</span>
</span><span id="AwsClientParameters-85"><a href="#AwsClientParameters-85"><span class="linenos"> 85</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters-86"><a href="#AwsClientParameters-86"><span class="linenos"> 86</span></a>        <span class="p">)</span>
</span><span id="AwsClientParameters-87"><a href="#AwsClientParameters-87"><span class="linenos"> 87</span></a>
</span><span id="AwsClientParameters-88"><a href="#AwsClientParameters-88"><span class="linenos"> 88</span></a>    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AwsClientParameters-89"><a href="#AwsClientParameters-89"><span class="linenos"> 89</span></a>    <span class="k">def</span> <span class="nf">instantiate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Config</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters-90"><a href="#AwsClientParameters-90"><span class="linenos"> 90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-91"><a href="#AwsClientParameters-91"><span class="linenos"> 91</span></a><span class="sd">        Casts lists to Config instances.</span>
</span><span id="AwsClientParameters-92"><a href="#AwsClientParameters-92"><span class="linenos"> 92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-93"><a href="#AwsClientParameters-93"><span class="linenos"> 93</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Config</span><span class="p">):</span>
</span><span id="AwsClientParameters-94"><a href="#AwsClientParameters-94"><span class="linenos"> 94</span></a>            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_user_provided_options&quot;</span><span class="p">]</span>
</span><span id="AwsClientParameters-95"><a href="#AwsClientParameters-95"><span class="linenos"> 95</span></a>        <span class="k">return</span> <span class="n">value</span>
</span><span id="AwsClientParameters-96"><a href="#AwsClientParameters-96"><span class="linenos"> 96</span></a>
</span><span id="AwsClientParameters-97"><a href="#AwsClientParameters-97"><span class="linenos"> 97</span></a>    <span class="nd">@root_validator</span>
</span><span id="AwsClientParameters-98"><a href="#AwsClientParameters-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">deprecated_verify_cert_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters-99"><a href="#AwsClientParameters-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-100"><a href="#AwsClientParameters-100"><span class="linenos">100</span></a><span class="sd">        If verify is not a bool, raise a warning.</span>
</span><span id="AwsClientParameters-101"><a href="#AwsClientParameters-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-102"><a href="#AwsClientParameters-102"><span class="linenos">102</span></a>        <span class="n">verify</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters-103"><a href="#AwsClientParameters-103"><span class="linenos">103</span></a>
</span><span id="AwsClientParameters-104"><a href="#AwsClientParameters-104"><span class="linenos">104</span></a>        <span class="c1"># deprecate using verify in favor of verify_cert_path</span>
</span><span id="AwsClientParameters-105"><a href="#AwsClientParameters-105"><span class="linenos">105</span></a>        <span class="c1"># so the UI looks nicer</span>
</span><span id="AwsClientParameters-106"><a href="#AwsClientParameters-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">verify</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verify</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="AwsClientParameters-107"><a href="#AwsClientParameters-107"><span class="linenos">107</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters-108"><a href="#AwsClientParameters-108"><span class="linenos">108</span></a>                <span class="p">(</span>
</span><span id="AwsClientParameters-109"><a href="#AwsClientParameters-109"><span class="linenos">109</span></a>                    <span class="s2">&quot;verify should be a boolean. &quot;</span>
</span><span id="AwsClientParameters-110"><a href="#AwsClientParameters-110"><span class="linenos">110</span></a>                    <span class="s2">&quot;If you want to use a CA cert bundle, use verify_cert_path instead.&quot;</span>
</span><span id="AwsClientParameters-111"><a href="#AwsClientParameters-111"><span class="linenos">111</span></a>                <span class="p">),</span>
</span><span id="AwsClientParameters-112"><a href="#AwsClientParameters-112"><span class="linenos">112</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AwsClientParameters-113"><a href="#AwsClientParameters-113"><span class="linenos">113</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters-114"><a href="#AwsClientParameters-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="AwsClientParameters-115"><a href="#AwsClientParameters-115"><span class="linenos">115</span></a>
</span><span id="AwsClientParameters-116"><a href="#AwsClientParameters-116"><span class="linenos">116</span></a>    <span class="nd">@root_validator</span>
</span><span id="AwsClientParameters-117"><a href="#AwsClientParameters-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">verify_cert_path_and_verify</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters-118"><a href="#AwsClientParameters-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-119"><a href="#AwsClientParameters-119"><span class="linenos">119</span></a><span class="sd">        If verify_cert_path is set but verify is False, raise a warning.</span>
</span><span id="AwsClientParameters-120"><a href="#AwsClientParameters-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-121"><a href="#AwsClientParameters-121"><span class="linenos">121</span></a>        <span class="n">verify</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="AwsClientParameters-122"><a href="#AwsClientParameters-122"><span class="linenos">122</span></a>        <span class="n">verify_cert_path</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters-123"><a href="#AwsClientParameters-123"><span class="linenos">123</span></a>
</span><span id="AwsClientParameters-124"><a href="#AwsClientParameters-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">verify_cert_path</span><span class="p">:</span>
</span><span id="AwsClientParameters-125"><a href="#AwsClientParameters-125"><span class="linenos">125</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters-126"><a href="#AwsClientParameters-126"><span class="linenos">126</span></a>                <span class="s2">&quot;verify_cert_path is set but verify is False. &quot;</span>
</span><span id="AwsClientParameters-127"><a href="#AwsClientParameters-127"><span class="linenos">127</span></a>                <span class="s2">&quot;verify_cert_path will be ignored.&quot;</span>
</span><span id="AwsClientParameters-128"><a href="#AwsClientParameters-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters-129"><a href="#AwsClientParameters-129"><span class="linenos">129</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AwsClientParameters-130"><a href="#AwsClientParameters-130"><span class="linenos">130</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verify</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">verify_cert_path</span><span class="p">:</span>
</span><span id="AwsClientParameters-131"><a href="#AwsClientParameters-131"><span class="linenos">131</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters-132"><a href="#AwsClientParameters-132"><span class="linenos">132</span></a>                <span class="s2">&quot;verify_cert_path is set but verify is also set as a file path. &quot;</span>
</span><span id="AwsClientParameters-133"><a href="#AwsClientParameters-133"><span class="linenos">133</span></a>                <span class="s2">&quot;verify_cert_path will take precedence.&quot;</span>
</span><span id="AwsClientParameters-134"><a href="#AwsClientParameters-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters-135"><a href="#AwsClientParameters-135"><span class="linenos">135</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;verify&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AwsClientParameters-136"><a href="#AwsClientParameters-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="AwsClientParameters-137"><a href="#AwsClientParameters-137"><span class="linenos">137</span></a>
</span><span id="AwsClientParameters-138"><a href="#AwsClientParameters-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">get_params_override</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters-139"><a href="#AwsClientParameters-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-140"><a href="#AwsClientParameters-140"><span class="linenos">140</span></a><span class="sd">        Return the dictionary of the parameters to override.</span>
</span><span id="AwsClientParameters-141"><a href="#AwsClientParameters-141"><span class="linenos">141</span></a><span class="sd">        The parameters to override are the one which are not None.</span>
</span><span id="AwsClientParameters-142"><a href="#AwsClientParameters-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters-143"><a href="#AwsClientParameters-143"><span class="linenos">143</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
</span><span id="AwsClientParameters-144"><a href="#AwsClientParameters-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">):</span>
</span><span id="AwsClientParameters-145"><a href="#AwsClientParameters-145"><span class="linenos">145</span></a>            <span class="c1"># to ensure that verify doesn&#39;t re-overwrite verify_cert_path</span>
</span><span id="AwsClientParameters-146"><a href="#AwsClientParameters-146"><span class="linenos">146</span></a>            <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters-147"><a href="#AwsClientParameters-147"><span class="linenos">147</span></a>
</span><span id="AwsClientParameters-148"><a href="#AwsClientParameters-148"><span class="linenos">148</span></a>        <span class="n">params_override</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AwsClientParameters-149"><a href="#AwsClientParameters-149"><span class="linenos">149</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AwsClientParameters-150"><a href="#AwsClientParameters-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsClientParameters-151"><a href="#AwsClientParameters-151"><span class="linenos">151</span></a>                <span class="k">continue</span>
</span><span id="AwsClientParameters-152"><a href="#AwsClientParameters-152"><span class="linenos">152</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters-153"><a href="#AwsClientParameters-153"><span class="linenos">153</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">)</span>
</span><span id="AwsClientParameters-154"><a href="#AwsClientParameters-154"><span class="linenos">154</span></a>                <span class="c1"># botocore UNSIGNED is an instance while actual signers can</span>
</span><span id="AwsClientParameters-155"><a href="#AwsClientParameters-155"><span class="linenos">155</span></a>                <span class="c1"># be fetched as strings</span>
</span><span id="AwsClientParameters-156"><a href="#AwsClientParameters-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">signature_version</span> <span class="o">==</span> <span class="s2">&quot;unsigned&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters-157"><a href="#AwsClientParameters-157"><span class="linenos">157</span></a>                    <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">signature_version</span> <span class="o">=</span> <span class="n">UNSIGNED</span>
</span><span id="AwsClientParameters-158"><a href="#AwsClientParameters-158"><span class="linenos">158</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;verify_cert_path&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters-159"><a href="#AwsClientParameters-159"><span class="linenos">159</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="s2">&quot;verify&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AwsClientParameters-160"><a href="#AwsClientParameters-160"><span class="linenos">160</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AwsClientParameters-161"><a href="#AwsClientParameters-161"><span class="linenos">161</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AwsClientParameters-162"><a href="#AwsClientParameters-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">params_override</span>
</span></pre></div>


            <div class="docstring"><p>Model used to manage extra parameters that you can pass when you initialize
the Client. If you want to find more information, see
<a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/core/session.html">boto3 docs</a>
for more info about the possible client configurations.</p>

<p>Attributes:
    api_version: The API version to use. By default, botocore will
        use the latest API version when creating a client. You only need
        to specify this parameter if you want to use a previous API version
        of the client.
    use_ssl: Whether or not to use SSL. By default, SSL is used.
        Note that not all services support non-ssl connections.
    verify: Whether or not to verify SSL certificates. By default
        SSL certificates are verified. If False, SSL will still be used
        (unless use_ssl is False), but SSL certificates
        will not be verified. Passing a file path to this is deprecated.
    verify_cert_path: A filename of the CA cert bundle to
        use. You can specify this argument if you want to use a
        different CA cert bundle than the one used by botocore.
    endpoint_url: The complete URL to use for the constructed
        client. Normally, botocore will automatically construct the
        appropriate URL to use when communicating with a service. You
        can specify a complete URL (including the "http/https" scheme)
        to override this behavior. If this value is provided,
        then <code><a href="#AwsClientParameters.use_ssl">use_ssl</a></code> is ignored.
    config: Advanced configuration for Botocore clients. See
        <a href="https://botocore.amazonaws.com/v1/documentation/api/latest/reference/config.html">botocore docs</a>
        for more details.</p>
</div>


                            <div id="AwsClientParameters.api_version" class="classattr">
                                <div class="attr variable">
            <span class="name">api_version</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.api_version"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.use_ssl" class="classattr">
                                <div class="attr variable">
            <span class="name">use_ssl</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.use_ssl"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.verify" class="classattr">
                                <div class="attr variable">
            <span class="name">verify</span><span class="annotation">: Union[bool, pydantic.v1.types.FilePath]</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.verify"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.verify_cert_path" class="classattr">
                                <div class="attr variable">
            <span class="name">verify_cert_path</span><span class="annotation">: Optional[pydantic.v1.types.FilePath]</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.verify_cert_path"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.endpoint_url" class="classattr">
                                <div class="attr variable">
            <span class="name">endpoint_url</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.endpoint_url"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.config" class="classattr">
                                <div class="attr variable">
            <span class="name">config</span><span class="annotation">: Optional[Dict[str, Any]]</span>

        
    </div>
    <a class="headerlink" href="#AwsClientParameters.config"></a>
    
    

                            </div>
                            <div id="AwsClientParameters.instantiate_config" class="classattr">
                                        <input id="AwsClientParameters.instantiate_config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@validator(&#39;config&#39;, pre=True)</div>

        <span class="def">def</span>
        <span class="name">instantiate_config</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">botocore</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">Config</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AwsClientParameters.instantiate_config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsClientParameters.instantiate_config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsClientParameters.instantiate_config-88"><a href="#AwsClientParameters.instantiate_config-88"><span class="linenos">88</span></a>    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="AwsClientParameters.instantiate_config-89"><a href="#AwsClientParameters.instantiate_config-89"><span class="linenos">89</span></a>    <span class="k">def</span> <span class="nf">instantiate_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Config</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters.instantiate_config-90"><a href="#AwsClientParameters.instantiate_config-90"><span class="linenos">90</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.instantiate_config-91"><a href="#AwsClientParameters.instantiate_config-91"><span class="linenos">91</span></a><span class="sd">        Casts lists to Config instances.</span>
</span><span id="AwsClientParameters.instantiate_config-92"><a href="#AwsClientParameters.instantiate_config-92"><span class="linenos">92</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.instantiate_config-93"><a href="#AwsClientParameters.instantiate_config-93"><span class="linenos">93</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Config</span><span class="p">):</span>
</span><span id="AwsClientParameters.instantiate_config-94"><a href="#AwsClientParameters.instantiate_config-94"><span class="linenos">94</span></a>            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">[</span><span class="s2">&quot;_user_provided_options&quot;</span><span class="p">]</span>
</span><span id="AwsClientParameters.instantiate_config-95"><a href="#AwsClientParameters.instantiate_config-95"><span class="linenos">95</span></a>        <span class="k">return</span> <span class="n">value</span>
</span></pre></div>


            <div class="docstring"><p>Casts lists to Config instances.</p>
</div>


                            </div>
                            <div id="AwsClientParameters.deprecated_verify_cert_path" class="classattr">
                                        <input id="AwsClientParameters.deprecated_verify_cert_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator</div>

        <span class="def">def</span>
        <span class="name">deprecated_verify_cert_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AwsClientParameters.deprecated_verify_cert_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsClientParameters.deprecated_verify_cert_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsClientParameters.deprecated_verify_cert_path-97"><a href="#AwsClientParameters.deprecated_verify_cert_path-97"><span class="linenos"> 97</span></a>    <span class="nd">@root_validator</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-98"><a href="#AwsClientParameters.deprecated_verify_cert_path-98"><span class="linenos"> 98</span></a>    <span class="k">def</span> <span class="nf">deprecated_verify_cert_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-99"><a href="#AwsClientParameters.deprecated_verify_cert_path-99"><span class="linenos"> 99</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-100"><a href="#AwsClientParameters.deprecated_verify_cert_path-100"><span class="linenos">100</span></a><span class="sd">        If verify is not a bool, raise a warning.</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-101"><a href="#AwsClientParameters.deprecated_verify_cert_path-101"><span class="linenos">101</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-102"><a href="#AwsClientParameters.deprecated_verify_cert_path-102"><span class="linenos">102</span></a>        <span class="n">verify</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-103"><a href="#AwsClientParameters.deprecated_verify_cert_path-103"><span class="linenos">103</span></a>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-104"><a href="#AwsClientParameters.deprecated_verify_cert_path-104"><span class="linenos">104</span></a>        <span class="c1"># deprecate using verify in favor of verify_cert_path</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-105"><a href="#AwsClientParameters.deprecated_verify_cert_path-105"><span class="linenos">105</span></a>        <span class="c1"># so the UI looks nicer</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-106"><a href="#AwsClientParameters.deprecated_verify_cert_path-106"><span class="linenos">106</span></a>        <span class="k">if</span> <span class="n">verify</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verify</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-107"><a href="#AwsClientParameters.deprecated_verify_cert_path-107"><span class="linenos">107</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-108"><a href="#AwsClientParameters.deprecated_verify_cert_path-108"><span class="linenos">108</span></a>                <span class="p">(</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-109"><a href="#AwsClientParameters.deprecated_verify_cert_path-109"><span class="linenos">109</span></a>                    <span class="s2">&quot;verify should be a boolean. &quot;</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-110"><a href="#AwsClientParameters.deprecated_verify_cert_path-110"><span class="linenos">110</span></a>                    <span class="s2">&quot;If you want to use a CA cert bundle, use verify_cert_path instead.&quot;</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-111"><a href="#AwsClientParameters.deprecated_verify_cert_path-111"><span class="linenos">111</span></a>                <span class="p">),</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-112"><a href="#AwsClientParameters.deprecated_verify_cert_path-112"><span class="linenos">112</span></a>                <span class="ne">DeprecationWarning</span><span class="p">,</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-113"><a href="#AwsClientParameters.deprecated_verify_cert_path-113"><span class="linenos">113</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters.deprecated_verify_cert_path-114"><a href="#AwsClientParameters.deprecated_verify_cert_path-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>If verify is not a bool, raise a warning.</p>
</div>


                            </div>
                            <div id="AwsClientParameters.verify_cert_path_and_verify" class="classattr">
                                        <input id="AwsClientParameters.verify_cert_path_and_verify-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator</div>

        <span class="def">def</span>
        <span class="name">verify_cert_path_and_verify</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AwsClientParameters.verify_cert_path_and_verify-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsClientParameters.verify_cert_path_and_verify"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsClientParameters.verify_cert_path_and_verify-116"><a href="#AwsClientParameters.verify_cert_path_and_verify-116"><span class="linenos">116</span></a>    <span class="nd">@root_validator</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-117"><a href="#AwsClientParameters.verify_cert_path_and_verify-117"><span class="linenos">117</span></a>    <span class="k">def</span> <span class="nf">verify_cert_path_and_verify</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-118"><a href="#AwsClientParameters.verify_cert_path_and_verify-118"><span class="linenos">118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-119"><a href="#AwsClientParameters.verify_cert_path_and_verify-119"><span class="linenos">119</span></a><span class="sd">        If verify_cert_path is set but verify is False, raise a warning.</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-120"><a href="#AwsClientParameters.verify_cert_path_and_verify-120"><span class="linenos">120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-121"><a href="#AwsClientParameters.verify_cert_path_and_verify-121"><span class="linenos">121</span></a>        <span class="n">verify</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-122"><a href="#AwsClientParameters.verify_cert_path_and_verify-122"><span class="linenos">122</span></a>        <span class="n">verify_cert_path</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-123"><a href="#AwsClientParameters.verify_cert_path_and_verify-123"><span class="linenos">123</span></a>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-124"><a href="#AwsClientParameters.verify_cert_path_and_verify-124"><span class="linenos">124</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify</span> <span class="ow">and</span> <span class="n">verify_cert_path</span><span class="p">:</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-125"><a href="#AwsClientParameters.verify_cert_path_and_verify-125"><span class="linenos">125</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-126"><a href="#AwsClientParameters.verify_cert_path_and_verify-126"><span class="linenos">126</span></a>                <span class="s2">&quot;verify_cert_path is set but verify is False. &quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-127"><a href="#AwsClientParameters.verify_cert_path_and_verify-127"><span class="linenos">127</span></a>                <span class="s2">&quot;verify_cert_path will be ignored.&quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-128"><a href="#AwsClientParameters.verify_cert_path_and_verify-128"><span class="linenos">128</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-129"><a href="#AwsClientParameters.verify_cert_path_and_verify-129"><span class="linenos">129</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-130"><a href="#AwsClientParameters.verify_cert_path_and_verify-130"><span class="linenos">130</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">verify</span><span class="p">,</span> <span class="nb">bool</span><span class="p">)</span> <span class="ow">and</span> <span class="n">verify_cert_path</span><span class="p">:</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-131"><a href="#AwsClientParameters.verify_cert_path_and_verify-131"><span class="linenos">131</span></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-132"><a href="#AwsClientParameters.verify_cert_path_and_verify-132"><span class="linenos">132</span></a>                <span class="s2">&quot;verify_cert_path is set but verify is also set as a file path. &quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-133"><a href="#AwsClientParameters.verify_cert_path_and_verify-133"><span class="linenos">133</span></a>                <span class="s2">&quot;verify_cert_path will take precedence.&quot;</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-134"><a href="#AwsClientParameters.verify_cert_path_and_verify-134"><span class="linenos">134</span></a>            <span class="p">)</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-135"><a href="#AwsClientParameters.verify_cert_path_and_verify-135"><span class="linenos">135</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;verify&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AwsClientParameters.verify_cert_path_and_verify-136"><a href="#AwsClientParameters.verify_cert_path_and_verify-136"><span class="linenos">136</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>If verify_cert_path is set but verify is False, raise a warning.</p>
</div>


                            </div>
                            <div id="AwsClientParameters.get_params_override" class="classattr">
                                        <input id="AwsClientParameters.get_params_override-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_params_override</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="AwsClientParameters.get_params_override-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsClientParameters.get_params_override"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsClientParameters.get_params_override-138"><a href="#AwsClientParameters.get_params_override-138"><span class="linenos">138</span></a>    <span class="k">def</span> <span class="nf">get_params_override</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="AwsClientParameters.get_params_override-139"><a href="#AwsClientParameters.get_params_override-139"><span class="linenos">139</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.get_params_override-140"><a href="#AwsClientParameters.get_params_override-140"><span class="linenos">140</span></a><span class="sd">        Return the dictionary of the parameters to override.</span>
</span><span id="AwsClientParameters.get_params_override-141"><a href="#AwsClientParameters.get_params_override-141"><span class="linenos">141</span></a><span class="sd">        The parameters to override are the one which are not None.</span>
</span><span id="AwsClientParameters.get_params_override-142"><a href="#AwsClientParameters.get_params_override-142"><span class="linenos">142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsClientParameters.get_params_override-143"><a href="#AwsClientParameters.get_params_override-143"><span class="linenos">143</span></a>        <span class="n">params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
</span><span id="AwsClientParameters.get_params_override-144"><a href="#AwsClientParameters.get_params_override-144"><span class="linenos">144</span></a>        <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;verify_cert_path&quot;</span><span class="p">):</span>
</span><span id="AwsClientParameters.get_params_override-145"><a href="#AwsClientParameters.get_params_override-145"><span class="linenos">145</span></a>            <span class="c1"># to ensure that verify doesn&#39;t re-overwrite verify_cert_path</span>
</span><span id="AwsClientParameters.get_params_override-146"><a href="#AwsClientParameters.get_params_override-146"><span class="linenos">146</span></a>            <span class="n">params</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;verify&quot;</span><span class="p">)</span>
</span><span id="AwsClientParameters.get_params_override-147"><a href="#AwsClientParameters.get_params_override-147"><span class="linenos">147</span></a>
</span><span id="AwsClientParameters.get_params_override-148"><a href="#AwsClientParameters.get_params_override-148"><span class="linenos">148</span></a>        <span class="n">params_override</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AwsClientParameters.get_params_override-149"><a href="#AwsClientParameters.get_params_override-149"><span class="linenos">149</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AwsClientParameters.get_params_override-150"><a href="#AwsClientParameters.get_params_override-150"><span class="linenos">150</span></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsClientParameters.get_params_override-151"><a href="#AwsClientParameters.get_params_override-151"><span class="linenos">151</span></a>                <span class="k">continue</span>
</span><span id="AwsClientParameters.get_params_override-152"><a href="#AwsClientParameters.get_params_override-152"><span class="linenos">152</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;config&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters.get_params_override-153"><a href="#AwsClientParameters.get_params_override-153"><span class="linenos">153</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="o">**</span><span class="n">value</span><span class="p">)</span>
</span><span id="AwsClientParameters.get_params_override-154"><a href="#AwsClientParameters.get_params_override-154"><span class="linenos">154</span></a>                <span class="c1"># botocore UNSIGNED is an instance while actual signers can</span>
</span><span id="AwsClientParameters.get_params_override-155"><a href="#AwsClientParameters.get_params_override-155"><span class="linenos">155</span></a>                <span class="c1"># be fetched as strings</span>
</span><span id="AwsClientParameters.get_params_override-156"><a href="#AwsClientParameters.get_params_override-156"><span class="linenos">156</span></a>                <span class="k">if</span> <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">signature_version</span> <span class="o">==</span> <span class="s2">&quot;unsigned&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters.get_params_override-157"><a href="#AwsClientParameters.get_params_override-157"><span class="linenos">157</span></a>                    <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">signature_version</span> <span class="o">=</span> <span class="n">UNSIGNED</span>
</span><span id="AwsClientParameters.get_params_override-158"><a href="#AwsClientParameters.get_params_override-158"><span class="linenos">158</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;verify_cert_path&quot;</span><span class="p">:</span>
</span><span id="AwsClientParameters.get_params_override-159"><a href="#AwsClientParameters.get_params_override-159"><span class="linenos">159</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="s2">&quot;verify&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AwsClientParameters.get_params_override-160"><a href="#AwsClientParameters.get_params_override-160"><span class="linenos">160</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AwsClientParameters.get_params_override-161"><a href="#AwsClientParameters.get_params_override-161"><span class="linenos">161</span></a>                <span class="n">params_override</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AwsClientParameters.get_params_override-162"><a href="#AwsClientParameters.get_params_override-162"><span class="linenos">162</span></a>        <span class="k">return</span> <span class="n">params_override</span>
</span></pre></div>


            <div class="docstring"><p>Return the dictionary of the parameters to override.
The parameters to override are the one which are not None.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="AwsClientParameters.__init__" class="function">BaseModel</dd>
                <dd id="AwsClientParameters.Config" class="variable">Config</dd>
                <dd id="AwsClientParameters.dict" class="function">dict</dd>
                <dd id="AwsClientParameters.json" class="function">json</dd>
                <dd id="AwsClientParameters.parse_obj" class="function">parse_obj</dd>
                <dd id="AwsClientParameters.parse_raw" class="function">parse_raw</dd>
                <dd id="AwsClientParameters.parse_file" class="function">parse_file</dd>
                <dd id="AwsClientParameters.from_orm" class="function">from_orm</dd>
                <dd id="AwsClientParameters.construct" class="function">construct</dd>
                <dd id="AwsClientParameters.copy" class="function">copy</dd>
                <dd id="AwsClientParameters.schema" class="function">schema</dd>
                <dd id="AwsClientParameters.schema_json" class="function">schema_json</dd>
                <dd id="AwsClientParameters.validate" class="function">validate</dd>
                <dd id="AwsClientParameters.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="LambdaFunction">
                            <input id="LambdaFunction-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LambdaFunction</span><wbr>(<span class="base">prefect.blocks.core.Block</span>):

                <label class="view-source-button" for="LambdaFunction-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LambdaFunction"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LambdaFunction-69"><a href="#LambdaFunction-69"><span class="linenos"> 69</span></a><span class="k">class</span> <span class="nc">LambdaFunction</span><span class="p">(</span><span class="n">Block</span><span class="p">):</span>
</span><span id="LambdaFunction-70"><a href="#LambdaFunction-70"><span class="linenos"> 70</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invoke a Lambda function. This block is part of the prefect-aws</span>
</span><span id="LambdaFunction-71"><a href="#LambdaFunction-71"><span class="linenos"> 71</span></a><span class="sd">    collection. Install prefect-aws with `pip install prefect-aws` to use this</span>
</span><span id="LambdaFunction-72"><a href="#LambdaFunction-72"><span class="linenos"> 72</span></a><span class="sd">    block.</span>
</span><span id="LambdaFunction-73"><a href="#LambdaFunction-73"><span class="linenos"> 73</span></a>
</span><span id="LambdaFunction-74"><a href="#LambdaFunction-74"><span class="linenos"> 74</span></a><span class="sd">    Attributes:</span>
</span><span id="LambdaFunction-75"><a href="#LambdaFunction-75"><span class="linenos"> 75</span></a><span class="sd">        function_name: The name, ARN, or partial ARN of the Lambda function to</span>
</span><span id="LambdaFunction-76"><a href="#LambdaFunction-76"><span class="linenos"> 76</span></a><span class="sd">            run. This must be the name of a function that is already deployed</span>
</span><span id="LambdaFunction-77"><a href="#LambdaFunction-77"><span class="linenos"> 77</span></a><span class="sd">            to AWS Lambda.</span>
</span><span id="LambdaFunction-78"><a href="#LambdaFunction-78"><span class="linenos"> 78</span></a><span class="sd">        qualifier: The version or alias of the Lambda function to use when</span>
</span><span id="LambdaFunction-79"><a href="#LambdaFunction-79"><span class="linenos"> 79</span></a><span class="sd">            invoked. If not specified, the latest (unqualified) version of the</span>
</span><span id="LambdaFunction-80"><a href="#LambdaFunction-80"><span class="linenos"> 80</span></a><span class="sd">            Lambda function will be used.</span>
</span><span id="LambdaFunction-81"><a href="#LambdaFunction-81"><span class="linenos"> 81</span></a><span class="sd">        aws_credentials: The AWS credentials to use to connect to AWS Lambda</span>
</span><span id="LambdaFunction-82"><a href="#LambdaFunction-82"><span class="linenos"> 82</span></a><span class="sd">            with a default factory of AwsCredentials.</span>
</span><span id="LambdaFunction-83"><a href="#LambdaFunction-83"><span class="linenos"> 83</span></a>
</span><span id="LambdaFunction-84"><a href="#LambdaFunction-84"><span class="linenos"> 84</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="LambdaFunction-85"><a href="#LambdaFunction-85"><span class="linenos"> 85</span></a>
</span><span id="LambdaFunction-86"><a href="#LambdaFunction-86"><span class="linenos"> 86</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;Lambda Function&quot;</span>
</span><span id="LambdaFunction-87"><a href="#LambdaFunction-87"><span class="linenos"> 87</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="LambdaFunction-88"><a href="#LambdaFunction-88"><span class="linenos"> 88</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/s3/#prefect_aws.lambda_function.LambdaFunction&quot;</span>  <span class="c1"># noqa</span>
</span><span id="LambdaFunction-89"><a href="#LambdaFunction-89"><span class="linenos"> 89</span></a>
</span><span id="LambdaFunction-90"><a href="#LambdaFunction-90"><span class="linenos"> 90</span></a>    <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="LambdaFunction-91"><a href="#LambdaFunction-91"><span class="linenos"> 91</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Function Name&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction-92"><a href="#LambdaFunction-92"><span class="linenos"> 92</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="LambdaFunction-93"><a href="#LambdaFunction-93"><span class="linenos"> 93</span></a>            <span class="s2">&quot;The name, ARN, or partial ARN of the Lambda function to run. This&quot;</span>
</span><span id="LambdaFunction-94"><a href="#LambdaFunction-94"><span class="linenos"> 94</span></a>            <span class="s2">&quot; must be the name of a function that is already deployed to AWS&quot;</span>
</span><span id="LambdaFunction-95"><a href="#LambdaFunction-95"><span class="linenos"> 95</span></a>            <span class="s2">&quot; Lambda.&quot;</span>
</span><span id="LambdaFunction-96"><a href="#LambdaFunction-96"><span class="linenos"> 96</span></a>        <span class="p">),</span>
</span><span id="LambdaFunction-97"><a href="#LambdaFunction-97"><span class="linenos"> 97</span></a>    <span class="p">)</span>
</span><span id="LambdaFunction-98"><a href="#LambdaFunction-98"><span class="linenos"> 98</span></a>    <span class="n">qualifier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="LambdaFunction-99"><a href="#LambdaFunction-99"><span class="linenos"> 99</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LambdaFunction-100"><a href="#LambdaFunction-100"><span class="linenos">100</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Qualifier&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction-101"><a href="#LambdaFunction-101"><span class="linenos">101</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="LambdaFunction-102"><a href="#LambdaFunction-102"><span class="linenos">102</span></a>            <span class="s2">&quot;The version or alias of the Lambda function to use when invoked. &quot;</span>
</span><span id="LambdaFunction-103"><a href="#LambdaFunction-103"><span class="linenos">103</span></a>            <span class="s2">&quot;If not specified, the latest (unqualified) version of the Lambda &quot;</span>
</span><span id="LambdaFunction-104"><a href="#LambdaFunction-104"><span class="linenos">104</span></a>            <span class="s2">&quot;function will be used.&quot;</span>
</span><span id="LambdaFunction-105"><a href="#LambdaFunction-105"><span class="linenos">105</span></a>        <span class="p">),</span>
</span><span id="LambdaFunction-106"><a href="#LambdaFunction-106"><span class="linenos">106</span></a>    <span class="p">)</span>
</span><span id="LambdaFunction-107"><a href="#LambdaFunction-107"><span class="linenos">107</span></a>    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="LambdaFunction-108"><a href="#LambdaFunction-108"><span class="linenos">108</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Credentials&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction-109"><a href="#LambdaFunction-109"><span class="linenos">109</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">,</span>
</span><span id="LambdaFunction-110"><a href="#LambdaFunction-110"><span class="linenos">110</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The AWS credentials to invoke the Lambda with.&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction-111"><a href="#LambdaFunction-111"><span class="linenos">111</span></a>    <span class="p">)</span>
</span><span id="LambdaFunction-112"><a href="#LambdaFunction-112"><span class="linenos">112</span></a>
</span><span id="LambdaFunction-113"><a href="#LambdaFunction-113"><span class="linenos">113</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="LambdaFunction-114"><a href="#LambdaFunction-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lambda&#39;s pydantic configuration.&quot;&quot;&quot;</span>
</span><span id="LambdaFunction-115"><a href="#LambdaFunction-115"><span class="linenos">115</span></a>
</span><span id="LambdaFunction-116"><a href="#LambdaFunction-116"><span class="linenos">116</span></a>        <span class="n">smart_union</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="LambdaFunction-117"><a href="#LambdaFunction-117"><span class="linenos">117</span></a>
</span><span id="LambdaFunction-118"><a href="#LambdaFunction-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="nf">_get_lambda_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="LambdaFunction-119"><a href="#LambdaFunction-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LambdaFunction-120"><a href="#LambdaFunction-120"><span class="linenos">120</span></a><span class="sd">        Retrieve a boto3 session and Lambda client</span>
</span><span id="LambdaFunction-121"><a href="#LambdaFunction-121"><span class="linenos">121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LambdaFunction-122"><a href="#LambdaFunction-122"><span class="linenos">122</span></a>        <span class="n">boto_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_boto3_session</span><span class="p">()</span>
</span><span id="LambdaFunction-123"><a href="#LambdaFunction-123"><span class="linenos">123</span></a>        <span class="n">lambda_client</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;lambda&quot;</span><span class="p">)</span>
</span><span id="LambdaFunction-124"><a href="#LambdaFunction-124"><span class="linenos">124</span></a>        <span class="k">return</span> <span class="n">lambda_client</span>
</span><span id="LambdaFunction-125"><a href="#LambdaFunction-125"><span class="linenos">125</span></a>
</span><span id="LambdaFunction-126"><a href="#LambdaFunction-126"><span class="linenos">126</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="LambdaFunction-127"><a href="#LambdaFunction-127"><span class="linenos">127</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span>
</span><span id="LambdaFunction-128"><a href="#LambdaFunction-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LambdaFunction-129"><a href="#LambdaFunction-129"><span class="linenos">129</span></a>        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LambdaFunction-130"><a href="#LambdaFunction-130"><span class="linenos">130</span></a>        <span class="n">invocation_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="LambdaFunction-131"><a href="#LambdaFunction-131"><span class="linenos">131</span></a>            <span class="s2">&quot;RequestResponse&quot;</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;DryRun&quot;</span>
</span><span id="LambdaFunction-132"><a href="#LambdaFunction-132"><span class="linenos">132</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RequestResponse&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction-133"><a href="#LambdaFunction-133"><span class="linenos">133</span></a>        <span class="n">tail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LambdaFunction-134"><a href="#LambdaFunction-134"><span class="linenos">134</span></a>        <span class="n">client_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LambdaFunction-135"><a href="#LambdaFunction-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="LambdaFunction-136"><a href="#LambdaFunction-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LambdaFunction-137"><a href="#LambdaFunction-137"><span class="linenos">137</span></a><span class="sd">        [Invoke](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html)</span>
</span><span id="LambdaFunction-138"><a href="#LambdaFunction-138"><span class="linenos">138</span></a><span class="sd">        the Lambda function with the given payload.</span>
</span><span id="LambdaFunction-139"><a href="#LambdaFunction-139"><span class="linenos">139</span></a>
</span><span id="LambdaFunction-140"><a href="#LambdaFunction-140"><span class="linenos">140</span></a><span class="sd">        Args:</span>
</span><span id="LambdaFunction-141"><a href="#LambdaFunction-141"><span class="linenos">141</span></a><span class="sd">            payload: The payload to send to the Lambda function.</span>
</span><span id="LambdaFunction-142"><a href="#LambdaFunction-142"><span class="linenos">142</span></a><span class="sd">            invocation_type: The invocation type of the Lambda function. This</span>
</span><span id="LambdaFunction-143"><a href="#LambdaFunction-143"><span class="linenos">143</span></a><span class="sd">                can be one of &quot;RequestResponse&quot;, &quot;Event&quot;, or &quot;DryRun&quot;. Uses</span>
</span><span id="LambdaFunction-144"><a href="#LambdaFunction-144"><span class="linenos">144</span></a><span class="sd">                &quot;RequestResponse&quot; by default.</span>
</span><span id="LambdaFunction-145"><a href="#LambdaFunction-145"><span class="linenos">145</span></a><span class="sd">            tail: If True, the response will include the base64-encoded last 4</span>
</span><span id="LambdaFunction-146"><a href="#LambdaFunction-146"><span class="linenos">146</span></a><span class="sd">                KB of log data produced by the Lambda function.</span>
</span><span id="LambdaFunction-147"><a href="#LambdaFunction-147"><span class="linenos">147</span></a><span class="sd">            client_context: The client context to send to the Lambda function.</span>
</span><span id="LambdaFunction-148"><a href="#LambdaFunction-148"><span class="linenos">148</span></a><span class="sd">                Limited to 3583 bytes.</span>
</span><span id="LambdaFunction-149"><a href="#LambdaFunction-149"><span class="linenos">149</span></a>
</span><span id="LambdaFunction-150"><a href="#LambdaFunction-150"><span class="linenos">150</span></a><span class="sd">        Returns:</span>
</span><span id="LambdaFunction-151"><a href="#LambdaFunction-151"><span class="linenos">151</span></a><span class="sd">            The response from the Lambda function.</span>
</span><span id="LambdaFunction-152"><a href="#LambdaFunction-152"><span class="linenos">152</span></a>
</span><span id="LambdaFunction-153"><a href="#LambdaFunction-153"><span class="linenos">153</span></a><span class="sd">        Examples:</span>
</span><span id="LambdaFunction-154"><a href="#LambdaFunction-154"><span class="linenos">154</span></a>
</span><span id="LambdaFunction-155"><a href="#LambdaFunction-155"><span class="linenos">155</span></a><span class="sd">            ```python</span>
</span><span id="LambdaFunction-156"><a href="#LambdaFunction-156"><span class="linenos">156</span></a><span class="sd">            from prefect_aws.lambda_function import LambdaFunction</span>
</span><span id="LambdaFunction-157"><a href="#LambdaFunction-157"><span class="linenos">157</span></a><span class="sd">            from prefect_aws.credentials import AwsCredentials</span>
</span><span id="LambdaFunction-158"><a href="#LambdaFunction-158"><span class="linenos">158</span></a>
</span><span id="LambdaFunction-159"><a href="#LambdaFunction-159"><span class="linenos">159</span></a><span class="sd">            credentials = AwsCredentials()</span>
</span><span id="LambdaFunction-160"><a href="#LambdaFunction-160"><span class="linenos">160</span></a><span class="sd">            lambda_function = LambdaFunction(</span>
</span><span id="LambdaFunction-161"><a href="#LambdaFunction-161"><span class="linenos">161</span></a><span class="sd">                function_name=&quot;test_lambda_function&quot;,</span>
</span><span id="LambdaFunction-162"><a href="#LambdaFunction-162"><span class="linenos">162</span></a><span class="sd">                aws_credentials=credentials,</span>
</span><span id="LambdaFunction-163"><a href="#LambdaFunction-163"><span class="linenos">163</span></a><span class="sd">            )</span>
</span><span id="LambdaFunction-164"><a href="#LambdaFunction-164"><span class="linenos">164</span></a><span class="sd">            response = lambda_function.invoke(</span>
</span><span id="LambdaFunction-165"><a href="#LambdaFunction-165"><span class="linenos">165</span></a><span class="sd">                payload={&quot;foo&quot;: &quot;bar&quot;},</span>
</span><span id="LambdaFunction-166"><a href="#LambdaFunction-166"><span class="linenos">166</span></a><span class="sd">                invocation_type=&quot;RequestResponse&quot;,</span>
</span><span id="LambdaFunction-167"><a href="#LambdaFunction-167"><span class="linenos">167</span></a><span class="sd">            )</span>
</span><span id="LambdaFunction-168"><a href="#LambdaFunction-168"><span class="linenos">168</span></a><span class="sd">            response[&quot;Payload&quot;].read()</span>
</span><span id="LambdaFunction-169"><a href="#LambdaFunction-169"><span class="linenos">169</span></a><span class="sd">            ```</span>
</span><span id="LambdaFunction-170"><a href="#LambdaFunction-170"><span class="linenos">170</span></a><span class="sd">            ```txt</span>
</span><span id="LambdaFunction-171"><a href="#LambdaFunction-171"><span class="linenos">171</span></a><span class="sd">            b&#39;{&quot;foo&quot;: &quot;bar&quot;}&#39;</span>
</span><span id="LambdaFunction-172"><a href="#LambdaFunction-172"><span class="linenos">172</span></a><span class="sd">            ```</span>
</span><span id="LambdaFunction-173"><a href="#LambdaFunction-173"><span class="linenos">173</span></a>
</span><span id="LambdaFunction-174"><a href="#LambdaFunction-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LambdaFunction-175"><a href="#LambdaFunction-175"><span class="linenos">175</span></a>        <span class="c1"># Add invocation arguments</span>
</span><span id="LambdaFunction-176"><a href="#LambdaFunction-176"><span class="linenos">176</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">FunctionName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)</span>
</span><span id="LambdaFunction-177"><a href="#LambdaFunction-177"><span class="linenos">177</span></a>
</span><span id="LambdaFunction-178"><a href="#LambdaFunction-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span><span id="LambdaFunction-179"><a href="#LambdaFunction-179"><span class="linenos">179</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="LambdaFunction-180"><a href="#LambdaFunction-180"><span class="linenos">180</span></a>
</span><span id="LambdaFunction-181"><a href="#LambdaFunction-181"><span class="linenos">181</span></a>        <span class="c1"># Let boto handle invalid invocation types</span>
</span><span id="LambdaFunction-182"><a href="#LambdaFunction-182"><span class="linenos">182</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;InvocationType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">invocation_type</span>
</span><span id="LambdaFunction-183"><a href="#LambdaFunction-183"><span class="linenos">183</span></a>
</span><span id="LambdaFunction-184"><a href="#LambdaFunction-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LambdaFunction-185"><a href="#LambdaFunction-185"><span class="linenos">185</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Qualifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span>
</span><span id="LambdaFunction-186"><a href="#LambdaFunction-186"><span class="linenos">186</span></a>
</span><span id="LambdaFunction-187"><a href="#LambdaFunction-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">tail</span><span class="p">:</span>
</span><span id="LambdaFunction-188"><a href="#LambdaFunction-188"><span class="linenos">188</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;LogType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tail&quot;</span>
</span><span id="LambdaFunction-189"><a href="#LambdaFunction-189"><span class="linenos">189</span></a>
</span><span id="LambdaFunction-190"><a href="#LambdaFunction-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="n">client_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LambdaFunction-191"><a href="#LambdaFunction-191"><span class="linenos">191</span></a>            <span class="c1"># For some reason this is string, but payload is bytes</span>
</span><span id="LambdaFunction-192"><a href="#LambdaFunction-192"><span class="linenos">192</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ClientContext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">client_context</span><span class="p">)</span>
</span><span id="LambdaFunction-193"><a href="#LambdaFunction-193"><span class="linenos">193</span></a>
</span><span id="LambdaFunction-194"><a href="#LambdaFunction-194"><span class="linenos">194</span></a>        <span class="c1"># Get client and invoke</span>
</span><span id="LambdaFunction-195"><a href="#LambdaFunction-195"><span class="linenos">195</span></a>        <span class="n">lambda_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lambda_client</span><span class="p">)</span>
</span><span id="LambdaFunction-196"><a href="#LambdaFunction-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">lambda_client</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Invoke a Lambda function. This block is part of the prefect-aws
collection. Install prefect-aws with <code>pip install prefect-aws</code> to use this
block.</p>

<p>Attributes:
    function_name: The name, ARN, or partial ARN of the Lambda function to
        run. This must be the name of a function that is already deployed
        to AWS Lambda.
    qualifier: The version or alias of the Lambda function to use when
        invoked. If not specified, the latest (unqualified) version of the
        Lambda function will be used.
    aws_credentials: The AWS credentials to use to connect to AWS Lambda
        with a default factory of AwsCredentials.</p>
</div>


                            <div id="LambdaFunction.function_name" class="classattr">
                                <div class="attr variable">
            <span class="name">function_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#LambdaFunction.function_name"></a>
    
    

                            </div>
                            <div id="LambdaFunction.qualifier" class="classattr">
                                <div class="attr variable">
            <span class="name">qualifier</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#LambdaFunction.qualifier"></a>
    
    

                            </div>
                            <div id="LambdaFunction.aws_credentials" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_credentials</span><span class="annotation">: <a href="#AwsCredentials">AwsCredentials</a></span>

        
    </div>
    <a class="headerlink" href="#LambdaFunction.aws_credentials"></a>
    
    

                            </div>
                            <div id="LambdaFunction.invoke" class="classattr">
                                        <input id="LambdaFunction.invoke-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">invoke</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">invocation_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;RequestResponse&#39;</span><span class="p">,</span> <span class="s1">&#39;Event&#39;</span><span class="p">,</span> <span class="s1">&#39;DryRun&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;RequestResponse&#39;</span>,</span><span class="param">	<span class="n">tail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">client_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="LambdaFunction.invoke-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LambdaFunction.invoke"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LambdaFunction.invoke-126"><a href="#LambdaFunction.invoke-126"><span class="linenos">126</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="LambdaFunction.invoke-127"><a href="#LambdaFunction.invoke-127"><span class="linenos">127</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">invoke</span><span class="p">(</span>
</span><span id="LambdaFunction.invoke-128"><a href="#LambdaFunction.invoke-128"><span class="linenos">128</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="LambdaFunction.invoke-129"><a href="#LambdaFunction.invoke-129"><span class="linenos">129</span></a>        <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LambdaFunction.invoke-130"><a href="#LambdaFunction.invoke-130"><span class="linenos">130</span></a>        <span class="n">invocation_type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
</span><span id="LambdaFunction.invoke-131"><a href="#LambdaFunction.invoke-131"><span class="linenos">131</span></a>            <span class="s2">&quot;RequestResponse&quot;</span><span class="p">,</span> <span class="s2">&quot;Event&quot;</span><span class="p">,</span> <span class="s2">&quot;DryRun&quot;</span>
</span><span id="LambdaFunction.invoke-132"><a href="#LambdaFunction.invoke-132"><span class="linenos">132</span></a>        <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RequestResponse&quot;</span><span class="p">,</span>
</span><span id="LambdaFunction.invoke-133"><a href="#LambdaFunction.invoke-133"><span class="linenos">133</span></a>        <span class="n">tail</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="LambdaFunction.invoke-134"><a href="#LambdaFunction.invoke-134"><span class="linenos">134</span></a>        <span class="n">client_context</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LambdaFunction.invoke-135"><a href="#LambdaFunction.invoke-135"><span class="linenos">135</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="LambdaFunction.invoke-136"><a href="#LambdaFunction.invoke-136"><span class="linenos">136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="LambdaFunction.invoke-137"><a href="#LambdaFunction.invoke-137"><span class="linenos">137</span></a><span class="sd">        [Invoke](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html)</span>
</span><span id="LambdaFunction.invoke-138"><a href="#LambdaFunction.invoke-138"><span class="linenos">138</span></a><span class="sd">        the Lambda function with the given payload.</span>
</span><span id="LambdaFunction.invoke-139"><a href="#LambdaFunction.invoke-139"><span class="linenos">139</span></a>
</span><span id="LambdaFunction.invoke-140"><a href="#LambdaFunction.invoke-140"><span class="linenos">140</span></a><span class="sd">        Args:</span>
</span><span id="LambdaFunction.invoke-141"><a href="#LambdaFunction.invoke-141"><span class="linenos">141</span></a><span class="sd">            payload: The payload to send to the Lambda function.</span>
</span><span id="LambdaFunction.invoke-142"><a href="#LambdaFunction.invoke-142"><span class="linenos">142</span></a><span class="sd">            invocation_type: The invocation type of the Lambda function. This</span>
</span><span id="LambdaFunction.invoke-143"><a href="#LambdaFunction.invoke-143"><span class="linenos">143</span></a><span class="sd">                can be one of &quot;RequestResponse&quot;, &quot;Event&quot;, or &quot;DryRun&quot;. Uses</span>
</span><span id="LambdaFunction.invoke-144"><a href="#LambdaFunction.invoke-144"><span class="linenos">144</span></a><span class="sd">                &quot;RequestResponse&quot; by default.</span>
</span><span id="LambdaFunction.invoke-145"><a href="#LambdaFunction.invoke-145"><span class="linenos">145</span></a><span class="sd">            tail: If True, the response will include the base64-encoded last 4</span>
</span><span id="LambdaFunction.invoke-146"><a href="#LambdaFunction.invoke-146"><span class="linenos">146</span></a><span class="sd">                KB of log data produced by the Lambda function.</span>
</span><span id="LambdaFunction.invoke-147"><a href="#LambdaFunction.invoke-147"><span class="linenos">147</span></a><span class="sd">            client_context: The client context to send to the Lambda function.</span>
</span><span id="LambdaFunction.invoke-148"><a href="#LambdaFunction.invoke-148"><span class="linenos">148</span></a><span class="sd">                Limited to 3583 bytes.</span>
</span><span id="LambdaFunction.invoke-149"><a href="#LambdaFunction.invoke-149"><span class="linenos">149</span></a>
</span><span id="LambdaFunction.invoke-150"><a href="#LambdaFunction.invoke-150"><span class="linenos">150</span></a><span class="sd">        Returns:</span>
</span><span id="LambdaFunction.invoke-151"><a href="#LambdaFunction.invoke-151"><span class="linenos">151</span></a><span class="sd">            The response from the Lambda function.</span>
</span><span id="LambdaFunction.invoke-152"><a href="#LambdaFunction.invoke-152"><span class="linenos">152</span></a>
</span><span id="LambdaFunction.invoke-153"><a href="#LambdaFunction.invoke-153"><span class="linenos">153</span></a><span class="sd">        Examples:</span>
</span><span id="LambdaFunction.invoke-154"><a href="#LambdaFunction.invoke-154"><span class="linenos">154</span></a>
</span><span id="LambdaFunction.invoke-155"><a href="#LambdaFunction.invoke-155"><span class="linenos">155</span></a><span class="sd">            ```python</span>
</span><span id="LambdaFunction.invoke-156"><a href="#LambdaFunction.invoke-156"><span class="linenos">156</span></a><span class="sd">            from prefect_aws.lambda_function import LambdaFunction</span>
</span><span id="LambdaFunction.invoke-157"><a href="#LambdaFunction.invoke-157"><span class="linenos">157</span></a><span class="sd">            from prefect_aws.credentials import AwsCredentials</span>
</span><span id="LambdaFunction.invoke-158"><a href="#LambdaFunction.invoke-158"><span class="linenos">158</span></a>
</span><span id="LambdaFunction.invoke-159"><a href="#LambdaFunction.invoke-159"><span class="linenos">159</span></a><span class="sd">            credentials = AwsCredentials()</span>
</span><span id="LambdaFunction.invoke-160"><a href="#LambdaFunction.invoke-160"><span class="linenos">160</span></a><span class="sd">            lambda_function = LambdaFunction(</span>
</span><span id="LambdaFunction.invoke-161"><a href="#LambdaFunction.invoke-161"><span class="linenos">161</span></a><span class="sd">                function_name=&quot;test_lambda_function&quot;,</span>
</span><span id="LambdaFunction.invoke-162"><a href="#LambdaFunction.invoke-162"><span class="linenos">162</span></a><span class="sd">                aws_credentials=credentials,</span>
</span><span id="LambdaFunction.invoke-163"><a href="#LambdaFunction.invoke-163"><span class="linenos">163</span></a><span class="sd">            )</span>
</span><span id="LambdaFunction.invoke-164"><a href="#LambdaFunction.invoke-164"><span class="linenos">164</span></a><span class="sd">            response = lambda_function.invoke(</span>
</span><span id="LambdaFunction.invoke-165"><a href="#LambdaFunction.invoke-165"><span class="linenos">165</span></a><span class="sd">                payload={&quot;foo&quot;: &quot;bar&quot;},</span>
</span><span id="LambdaFunction.invoke-166"><a href="#LambdaFunction.invoke-166"><span class="linenos">166</span></a><span class="sd">                invocation_type=&quot;RequestResponse&quot;,</span>
</span><span id="LambdaFunction.invoke-167"><a href="#LambdaFunction.invoke-167"><span class="linenos">167</span></a><span class="sd">            )</span>
</span><span id="LambdaFunction.invoke-168"><a href="#LambdaFunction.invoke-168"><span class="linenos">168</span></a><span class="sd">            response[&quot;Payload&quot;].read()</span>
</span><span id="LambdaFunction.invoke-169"><a href="#LambdaFunction.invoke-169"><span class="linenos">169</span></a><span class="sd">            ```</span>
</span><span id="LambdaFunction.invoke-170"><a href="#LambdaFunction.invoke-170"><span class="linenos">170</span></a><span class="sd">            ```txt</span>
</span><span id="LambdaFunction.invoke-171"><a href="#LambdaFunction.invoke-171"><span class="linenos">171</span></a><span class="sd">            b&#39;{&quot;foo&quot;: &quot;bar&quot;}&#39;</span>
</span><span id="LambdaFunction.invoke-172"><a href="#LambdaFunction.invoke-172"><span class="linenos">172</span></a><span class="sd">            ```</span>
</span><span id="LambdaFunction.invoke-173"><a href="#LambdaFunction.invoke-173"><span class="linenos">173</span></a>
</span><span id="LambdaFunction.invoke-174"><a href="#LambdaFunction.invoke-174"><span class="linenos">174</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="LambdaFunction.invoke-175"><a href="#LambdaFunction.invoke-175"><span class="linenos">175</span></a>        <span class="c1"># Add invocation arguments</span>
</span><span id="LambdaFunction.invoke-176"><a href="#LambdaFunction.invoke-176"><span class="linenos">176</span></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">FunctionName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)</span>
</span><span id="LambdaFunction.invoke-177"><a href="#LambdaFunction.invoke-177"><span class="linenos">177</span></a>
</span><span id="LambdaFunction.invoke-178"><a href="#LambdaFunction.invoke-178"><span class="linenos">178</span></a>        <span class="k">if</span> <span class="n">payload</span><span class="p">:</span>
</span><span id="LambdaFunction.invoke-179"><a href="#LambdaFunction.invoke-179"><span class="linenos">179</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Payload&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</span><span id="LambdaFunction.invoke-180"><a href="#LambdaFunction.invoke-180"><span class="linenos">180</span></a>
</span><span id="LambdaFunction.invoke-181"><a href="#LambdaFunction.invoke-181"><span class="linenos">181</span></a>        <span class="c1"># Let boto handle invalid invocation types</span>
</span><span id="LambdaFunction.invoke-182"><a href="#LambdaFunction.invoke-182"><span class="linenos">182</span></a>        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;InvocationType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">invocation_type</span>
</span><span id="LambdaFunction.invoke-183"><a href="#LambdaFunction.invoke-183"><span class="linenos">183</span></a>
</span><span id="LambdaFunction.invoke-184"><a href="#LambdaFunction.invoke-184"><span class="linenos">184</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LambdaFunction.invoke-185"><a href="#LambdaFunction.invoke-185"><span class="linenos">185</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;Qualifier&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qualifier</span>
</span><span id="LambdaFunction.invoke-186"><a href="#LambdaFunction.invoke-186"><span class="linenos">186</span></a>
</span><span id="LambdaFunction.invoke-187"><a href="#LambdaFunction.invoke-187"><span class="linenos">187</span></a>        <span class="k">if</span> <span class="n">tail</span><span class="p">:</span>
</span><span id="LambdaFunction.invoke-188"><a href="#LambdaFunction.invoke-188"><span class="linenos">188</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;LogType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Tail&quot;</span>
</span><span id="LambdaFunction.invoke-189"><a href="#LambdaFunction.invoke-189"><span class="linenos">189</span></a>
</span><span id="LambdaFunction.invoke-190"><a href="#LambdaFunction.invoke-190"><span class="linenos">190</span></a>        <span class="k">if</span> <span class="n">client_context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LambdaFunction.invoke-191"><a href="#LambdaFunction.invoke-191"><span class="linenos">191</span></a>            <span class="c1"># For some reason this is string, but payload is bytes</span>
</span><span id="LambdaFunction.invoke-192"><a href="#LambdaFunction.invoke-192"><span class="linenos">192</span></a>            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;ClientContext&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">client_context</span><span class="p">)</span>
</span><span id="LambdaFunction.invoke-193"><a href="#LambdaFunction.invoke-193"><span class="linenos">193</span></a>
</span><span id="LambdaFunction.invoke-194"><a href="#LambdaFunction.invoke-194"><span class="linenos">194</span></a>        <span class="c1"># Get client and invoke</span>
</span><span id="LambdaFunction.invoke-195"><a href="#LambdaFunction.invoke-195"><span class="linenos">195</span></a>        <span class="n">lambda_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_lambda_client</span><span class="p">)</span>
</span><span id="LambdaFunction.invoke-196"><a href="#LambdaFunction.invoke-196"><span class="linenos">196</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="n">lambda_client</span><span class="o">.</span><span class="n">invoke</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p><a href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/lambda/client/invoke.html">Invoke</a>
the Lambda function with the given payload.</p>

<p>Args:
    payload: The payload to send to the Lambda function.
    invocation_type: The invocation type of the Lambda function. This
        can be one of "RequestResponse", "Event", or "DryRun". Uses
        "RequestResponse" by default.
    tail: If True, the response will include the base64-encoded last 4
        KB of log data produced by the Lambda function.
    client_context: The client context to send to the Lambda function.
        Limited to 3583 bytes.</p>

<p>Returns:
    The response from the Lambda function.</p>

<p>Examples:
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.lambda_function</span> <span class="kn">import</span> <span class="n">LambdaFunction</span>
    <span class="kn">from</span> <span class="nn">prefect_aws.credentials</span> <span class="kn">import</span> <span class="n">AwsCredentials</span>
 <br />
    <span class="n">credentials</span> <span class="o">=</span> <span class="n">AwsCredentials</span><span class="p">()</span>
    <span class="n">lambda_function</span> <span class="o">=</span> <span class="n">LambdaFunction</span><span class="p">(</span>
        <span class="n">function_name</span><span class="o">=</span><span class="s2">&quot;test_lambda_function&quot;</span><span class="p">,</span>
        <span class="n">aws_credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">lambda_function</span><span class="o">.</span><span class="n">invoke</span><span class="p">(</span>
        <span class="n">payload</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;foo&quot;</span><span class="p">:</span> <span class="s2">&quot;bar&quot;</span><span class="p">},</span>
        <span class="n">invocation_type</span><span class="o">=</span><span class="s2">&quot;RequestResponse&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s2">&quot;Payload&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    </code></pre>
    </div></p>

<p><pre><code>b'{"foo": "bar"}'
</code></pre></p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="LambdaFunction.__init__" class="function">Block</dd>
                <dd id="LambdaFunction.block_initialization" class="function">block_initialization</dd>
                <dd id="LambdaFunction.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="LambdaFunction.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="LambdaFunction.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="LambdaFunction.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="LambdaFunction.get_description" class="function">get_description</dd>
                <dd id="LambdaFunction.get_code_example" class="function">get_code_example</dd>
                <dd id="LambdaFunction.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="LambdaFunction.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="LambdaFunction.load" class="function">load</dd>
                <dd id="LambdaFunction.is_block_class" class="function">is_block_class</dd>
                <dd id="LambdaFunction.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="LambdaFunction.save" class="function">save</dd>
                <dd id="LambdaFunction.delete" class="function">delete</dd>
                <dd id="LambdaFunction.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="LambdaFunction.json" class="function">json</dd>
                <dd id="LambdaFunction.copy" class="function">copy</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="LambdaFunction.dict" class="function">dict</dd>
                <dd id="LambdaFunction.parse_obj" class="function">parse_obj</dd>
                <dd id="LambdaFunction.parse_raw" class="function">parse_raw</dd>
                <dd id="LambdaFunction.parse_file" class="function">parse_file</dd>
                <dd id="LambdaFunction.from_orm" class="function">from_orm</dd>
                <dd id="LambdaFunction.construct" class="function">construct</dd>
                <dd id="LambdaFunction.schema" class="function">schema</dd>
                <dd id="LambdaFunction.schema_json" class="function">schema_json</dd>
                <dd id="LambdaFunction.validate" class="function">validate</dd>
                <dd id="LambdaFunction.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="LambdaFunction.Config">
                            <input id="LambdaFunction.Config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LambdaFunction.Config</span>:

                <label class="view-source-button" for="LambdaFunction.Config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LambdaFunction.Config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LambdaFunction.Config-113"><a href="#LambdaFunction.Config-113"><span class="linenos">113</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="LambdaFunction.Config-114"><a href="#LambdaFunction.Config-114"><span class="linenos">114</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Lambda&#39;s pydantic configuration.&quot;&quot;&quot;</span>
</span><span id="LambdaFunction.Config-115"><a href="#LambdaFunction.Config-115"><span class="linenos">115</span></a>
</span><span id="LambdaFunction.Config-116"><a href="#LambdaFunction.Config-116"><span class="linenos">116</span></a>        <span class="n">smart_union</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Lambda's pydantic configuration.</p>
</div>


                            <div id="LambdaFunction.Config.smart_union" class="classattr">
                                <div class="attr variable">
            <span class="name">smart_union</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#LambdaFunction.Config.smart_union"></a>
    
    

                            </div>
                </section>
                <section id="MinIOCredentials">
                            <input id="MinIOCredentials-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MinIOCredentials</span><wbr>(<span class="base">prefect.blocks.abstract.CredentialsBlock</span>):

                <label class="view-source-button" for="MinIOCredentials-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinIOCredentials"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinIOCredentials-193"><a href="#MinIOCredentials-193"><span class="linenos">193</span></a><span class="k">class</span> <span class="nc">MinIOCredentials</span><span class="p">(</span><span class="n">CredentialsBlock</span><span class="p">):</span>
</span><span id="MinIOCredentials-194"><a href="#MinIOCredentials-194"><span class="linenos">194</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-195"><a href="#MinIOCredentials-195"><span class="linenos">195</span></a><span class="sd">    Block used to manage authentication with MinIO. Refer to the</span>
</span><span id="MinIOCredentials-196"><a href="#MinIOCredentials-196"><span class="linenos">196</span></a><span class="sd">    [MinIO docs](https://docs.min.io/docs/minio-server-configuration-guide.html)</span>
</span><span id="MinIOCredentials-197"><a href="#MinIOCredentials-197"><span class="linenos">197</span></a><span class="sd">    for more info about the possible credential configurations.</span>
</span><span id="MinIOCredentials-198"><a href="#MinIOCredentials-198"><span class="linenos">198</span></a>
</span><span id="MinIOCredentials-199"><a href="#MinIOCredentials-199"><span class="linenos">199</span></a><span class="sd">    Attributes:</span>
</span><span id="MinIOCredentials-200"><a href="#MinIOCredentials-200"><span class="linenos">200</span></a><span class="sd">        minio_root_user: Admin or root user.</span>
</span><span id="MinIOCredentials-201"><a href="#MinIOCredentials-201"><span class="linenos">201</span></a><span class="sd">        minio_root_password: Admin or root password.</span>
</span><span id="MinIOCredentials-202"><a href="#MinIOCredentials-202"><span class="linenos">202</span></a><span class="sd">        region_name: Location of server, e.g. &quot;us-east-1&quot;.</span>
</span><span id="MinIOCredentials-203"><a href="#MinIOCredentials-203"><span class="linenos">203</span></a>
</span><span id="MinIOCredentials-204"><a href="#MinIOCredentials-204"><span class="linenos">204</span></a><span class="sd">    Example:</span>
</span><span id="MinIOCredentials-205"><a href="#MinIOCredentials-205"><span class="linenos">205</span></a><span class="sd">        Load stored MinIO credentials:</span>
</span><span id="MinIOCredentials-206"><a href="#MinIOCredentials-206"><span class="linenos">206</span></a><span class="sd">        ```python</span>
</span><span id="MinIOCredentials-207"><a href="#MinIOCredentials-207"><span class="linenos">207</span></a><span class="sd">        from prefect_aws import MinIOCredentials</span>
</span><span id="MinIOCredentials-208"><a href="#MinIOCredentials-208"><span class="linenos">208</span></a>
</span><span id="MinIOCredentials-209"><a href="#MinIOCredentials-209"><span class="linenos">209</span></a><span class="sd">        minio_credentials_block = MinIOCredentials.load(&quot;BLOCK_NAME&quot;)</span>
</span><span id="MinIOCredentials-210"><a href="#MinIOCredentials-210"><span class="linenos">210</span></a><span class="sd">        ```</span>
</span><span id="MinIOCredentials-211"><a href="#MinIOCredentials-211"><span class="linenos">211</span></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa E501</span>
</span><span id="MinIOCredentials-212"><a href="#MinIOCredentials-212"><span class="linenos">212</span></a>
</span><span id="MinIOCredentials-213"><a href="#MinIOCredentials-213"><span class="linenos">213</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/676cb17bcbdff601f97e0a02ff8bcb480e91ff40-250x250.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="MinIOCredentials-214"><a href="#MinIOCredentials-214"><span class="linenos">214</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;MinIO Credentials&quot;</span>
</span><span id="MinIOCredentials-215"><a href="#MinIOCredentials-215"><span class="linenos">215</span></a>    <span class="n">_description</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MinIOCredentials-216"><a href="#MinIOCredentials-216"><span class="linenos">216</span></a>        <span class="s2">&quot;Block used to manage authentication with MinIO. Refer to the MinIO &quot;</span>
</span><span id="MinIOCredentials-217"><a href="#MinIOCredentials-217"><span class="linenos">217</span></a>        <span class="s2">&quot;docs: https://docs.min.io/docs/minio-server-configuration-guide.html &quot;</span>
</span><span id="MinIOCredentials-218"><a href="#MinIOCredentials-218"><span class="linenos">218</span></a>        <span class="s2">&quot;for more info about the possible credential configurations.&quot;</span>
</span><span id="MinIOCredentials-219"><a href="#MinIOCredentials-219"><span class="linenos">219</span></a>    <span class="p">)</span>
</span><span id="MinIOCredentials-220"><a href="#MinIOCredentials-220"><span class="linenos">220</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/credentials/#prefect_aws.credentials.MinIOCredentials&quot;</span>  <span class="c1"># noqa</span>
</span><span id="MinIOCredentials-221"><a href="#MinIOCredentials-221"><span class="linenos">221</span></a>
</span><span id="MinIOCredentials-222"><a href="#MinIOCredentials-222"><span class="linenos">222</span></a>    <span class="n">minio_root_user</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Admin or root user.&quot;</span><span class="p">)</span>
</span><span id="MinIOCredentials-223"><a href="#MinIOCredentials-223"><span class="linenos">223</span></a>    <span class="n">minio_root_password</span><span class="p">:</span> <span class="n">SecretStr</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="MinIOCredentials-224"><a href="#MinIOCredentials-224"><span class="linenos">224</span></a>        <span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Admin or root password.&quot;</span>
</span><span id="MinIOCredentials-225"><a href="#MinIOCredentials-225"><span class="linenos">225</span></a>    <span class="p">)</span>
</span><span id="MinIOCredentials-226"><a href="#MinIOCredentials-226"><span class="linenos">226</span></a>    <span class="n">region_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="MinIOCredentials-227"><a href="#MinIOCredentials-227"><span class="linenos">227</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="MinIOCredentials-228"><a href="#MinIOCredentials-228"><span class="linenos">228</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The AWS Region where you want to create new connections.&quot;</span><span class="p">,</span>
</span><span id="MinIOCredentials-229"><a href="#MinIOCredentials-229"><span class="linenos">229</span></a>    <span class="p">)</span>
</span><span id="MinIOCredentials-230"><a href="#MinIOCredentials-230"><span class="linenos">230</span></a>    <span class="n">aws_client_parameters</span><span class="p">:</span> <span class="n">AwsClientParameters</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="MinIOCredentials-231"><a href="#MinIOCredentials-231"><span class="linenos">231</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsClientParameters</span><span class="p">,</span>
</span><span id="MinIOCredentials-232"><a href="#MinIOCredentials-232"><span class="linenos">232</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Extra parameters to initialize the Client.&quot;</span><span class="p">,</span>
</span><span id="MinIOCredentials-233"><a href="#MinIOCredentials-233"><span class="linenos">233</span></a>    <span class="p">)</span>
</span><span id="MinIOCredentials-234"><a href="#MinIOCredentials-234"><span class="linenos">234</span></a>
</span><span id="MinIOCredentials-235"><a href="#MinIOCredentials-235"><span class="linenos">235</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="MinIOCredentials-236"><a href="#MinIOCredentials-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for pydantic model.&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-237"><a href="#MinIOCredentials-237"><span class="linenos">237</span></a>
</span><span id="MinIOCredentials-238"><a href="#MinIOCredentials-238"><span class="linenos">238</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="MinIOCredentials-239"><a href="#MinIOCredentials-239"><span class="linenos">239</span></a>
</span><span id="MinIOCredentials-240"><a href="#MinIOCredentials-240"><span class="linenos">240</span></a>    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MinIOCredentials-241"><a href="#MinIOCredentials-241"><span class="linenos">241</span></a>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span>
</span><span id="MinIOCredentials-242"><a href="#MinIOCredentials-242"><span class="linenos">242</span></a>            <span class="p">(</span>
</span><span id="MinIOCredentials-243"><a href="#MinIOCredentials-243"><span class="linenos">243</span></a>                <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minio_root_user</span><span class="p">),</span>
</span><span id="MinIOCredentials-244"><a href="#MinIOCredentials-244"><span class="linenos">244</span></a>                <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minio_root_password</span><span class="p">),</span>
</span><span id="MinIOCredentials-245"><a href="#MinIOCredentials-245"><span class="linenos">245</span></a>                <span class="nb">hash</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">),</span>
</span><span id="MinIOCredentials-246"><a href="#MinIOCredentials-246"><span class="linenos">246</span></a>                <span class="nb">hash</span><span class="p">(</span><span class="nb">frozenset</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_client_parameters</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">())),</span>
</span><span id="MinIOCredentials-247"><a href="#MinIOCredentials-247"><span class="linenos">247</span></a>            <span class="p">)</span>
</span><span id="MinIOCredentials-248"><a href="#MinIOCredentials-248"><span class="linenos">248</span></a>        <span class="p">)</span>
</span><span id="MinIOCredentials-249"><a href="#MinIOCredentials-249"><span class="linenos">249</span></a>
</span><span id="MinIOCredentials-250"><a href="#MinIOCredentials-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">get_boto3_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
</span><span id="MinIOCredentials-251"><a href="#MinIOCredentials-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-252"><a href="#MinIOCredentials-252"><span class="linenos">252</span></a><span class="sd">        Returns an authenticated boto3 session that can be used to create clients</span>
</span><span id="MinIOCredentials-253"><a href="#MinIOCredentials-253"><span class="linenos">253</span></a><span class="sd">        and perform object operations on MinIO server.</span>
</span><span id="MinIOCredentials-254"><a href="#MinIOCredentials-254"><span class="linenos">254</span></a>
</span><span id="MinIOCredentials-255"><a href="#MinIOCredentials-255"><span class="linenos">255</span></a><span class="sd">        Example:</span>
</span><span id="MinIOCredentials-256"><a href="#MinIOCredentials-256"><span class="linenos">256</span></a><span class="sd">            Create an S3 client from an authorized boto3 session</span>
</span><span id="MinIOCredentials-257"><a href="#MinIOCredentials-257"><span class="linenos">257</span></a>
</span><span id="MinIOCredentials-258"><a href="#MinIOCredentials-258"><span class="linenos">258</span></a><span class="sd">            ```python</span>
</span><span id="MinIOCredentials-259"><a href="#MinIOCredentials-259"><span class="linenos">259</span></a><span class="sd">            minio_credentials = MinIOCredentials(</span>
</span><span id="MinIOCredentials-260"><a href="#MinIOCredentials-260"><span class="linenos">260</span></a><span class="sd">                minio_root_user = &quot;minio_root_user&quot;,</span>
</span><span id="MinIOCredentials-261"><a href="#MinIOCredentials-261"><span class="linenos">261</span></a><span class="sd">                minio_root_password = &quot;minio_root_password&quot;</span>
</span><span id="MinIOCredentials-262"><a href="#MinIOCredentials-262"><span class="linenos">262</span></a><span class="sd">            )</span>
</span><span id="MinIOCredentials-263"><a href="#MinIOCredentials-263"><span class="linenos">263</span></a><span class="sd">            s3_client = minio_credentials.get_boto3_session().client(</span>
</span><span id="MinIOCredentials-264"><a href="#MinIOCredentials-264"><span class="linenos">264</span></a><span class="sd">                service=&quot;s3&quot;,</span>
</span><span id="MinIOCredentials-265"><a href="#MinIOCredentials-265"><span class="linenos">265</span></a><span class="sd">                endpoint_url=&quot;http://localhost:9000&quot;</span>
</span><span id="MinIOCredentials-266"><a href="#MinIOCredentials-266"><span class="linenos">266</span></a><span class="sd">            )</span>
</span><span id="MinIOCredentials-267"><a href="#MinIOCredentials-267"><span class="linenos">267</span></a><span class="sd">            ```</span>
</span><span id="MinIOCredentials-268"><a href="#MinIOCredentials-268"><span class="linenos">268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-269"><a href="#MinIOCredentials-269"><span class="linenos">269</span></a>
</span><span id="MinIOCredentials-270"><a href="#MinIOCredentials-270"><span class="linenos">270</span></a>        <span class="n">minio_root_password</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MinIOCredentials-271"><a href="#MinIOCredentials-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">minio_root_password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span id="MinIOCredentials-272"><a href="#MinIOCredentials-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minio_root_password</span>
</span><span id="MinIOCredentials-273"><a href="#MinIOCredentials-273"><span class="linenos">273</span></a>            <span class="k">else</span> <span class="kc">None</span>
</span><span id="MinIOCredentials-274"><a href="#MinIOCredentials-274"><span class="linenos">274</span></a>        <span class="p">)</span>
</span><span id="MinIOCredentials-275"><a href="#MinIOCredentials-275"><span class="linenos">275</span></a>
</span><span id="MinIOCredentials-276"><a href="#MinIOCredentials-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span id="MinIOCredentials-277"><a href="#MinIOCredentials-277"><span class="linenos">277</span></a>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minio_root_user</span><span class="p">,</span>
</span><span id="MinIOCredentials-278"><a href="#MinIOCredentials-278"><span class="linenos">278</span></a>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">minio_root_password</span><span class="p">,</span>
</span><span id="MinIOCredentials-279"><a href="#MinIOCredentials-279"><span class="linenos">279</span></a>            <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
</span><span id="MinIOCredentials-280"><a href="#MinIOCredentials-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span><span id="MinIOCredentials-281"><a href="#MinIOCredentials-281"><span class="linenos">281</span></a>
</span><span id="MinIOCredentials-282"><a href="#MinIOCredentials-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]):</span>
</span><span id="MinIOCredentials-283"><a href="#MinIOCredentials-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-284"><a href="#MinIOCredentials-284"><span class="linenos">284</span></a><span class="sd">        Helper method to dynamically get a client type.</span>
</span><span id="MinIOCredentials-285"><a href="#MinIOCredentials-285"><span class="linenos">285</span></a>
</span><span id="MinIOCredentials-286"><a href="#MinIOCredentials-286"><span class="linenos">286</span></a><span class="sd">        Args:</span>
</span><span id="MinIOCredentials-287"><a href="#MinIOCredentials-287"><span class="linenos">287</span></a><span class="sd">            client_type: The client&#39;s service name.</span>
</span><span id="MinIOCredentials-288"><a href="#MinIOCredentials-288"><span class="linenos">288</span></a>
</span><span id="MinIOCredentials-289"><a href="#MinIOCredentials-289"><span class="linenos">289</span></a><span class="sd">        Returns:</span>
</span><span id="MinIOCredentials-290"><a href="#MinIOCredentials-290"><span class="linenos">290</span></a><span class="sd">            An authenticated client.</span>
</span><span id="MinIOCredentials-291"><a href="#MinIOCredentials-291"><span class="linenos">291</span></a>
</span><span id="MinIOCredentials-292"><a href="#MinIOCredentials-292"><span class="linenos">292</span></a><span class="sd">        Raises:</span>
</span><span id="MinIOCredentials-293"><a href="#MinIOCredentials-293"><span class="linenos">293</span></a><span class="sd">            ValueError: if the client is not supported.</span>
</span><span id="MinIOCredentials-294"><a href="#MinIOCredentials-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-295"><a href="#MinIOCredentials-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client_type</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">):</span>
</span><span id="MinIOCredentials-296"><a href="#MinIOCredentials-296"><span class="linenos">296</span></a>            <span class="n">client_type</span> <span class="o">=</span> <span class="n">client_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="MinIOCredentials-297"><a href="#MinIOCredentials-297"><span class="linenos">297</span></a>
</span><span id="MinIOCredentials-298"><a href="#MinIOCredentials-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">_get_client_cached</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="o">=</span><span class="n">client_type</span><span class="p">)</span>
</span><span id="MinIOCredentials-299"><a href="#MinIOCredentials-299"><span class="linenos">299</span></a>
</span><span id="MinIOCredentials-300"><a href="#MinIOCredentials-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="nf">get_s3_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="MinIOCredentials-301"><a href="#MinIOCredentials-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-302"><a href="#MinIOCredentials-302"><span class="linenos">302</span></a><span class="sd">        Gets an authenticated S3 client.</span>
</span><span id="MinIOCredentials-303"><a href="#MinIOCredentials-303"><span class="linenos">303</span></a>
</span><span id="MinIOCredentials-304"><a href="#MinIOCredentials-304"><span class="linenos">304</span></a><span class="sd">        Returns:</span>
</span><span id="MinIOCredentials-305"><a href="#MinIOCredentials-305"><span class="linenos">305</span></a><span class="sd">            An authenticated S3 client.</span>
</span><span id="MinIOCredentials-306"><a href="#MinIOCredentials-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials-307"><a href="#MinIOCredentials-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">S3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Block used to manage authentication with MinIO. Refer to the
<a href="https://docs.min.io/docs/minio-server-configuration-guide.html">MinIO docs</a>
for more info about the possible credential configurations.</p>

<p>Attributes:
    minio_root_user: Admin or root user.
    minio_root_password: Admin or root password.
    region_name: Location of server, e.g. "us-east-1".</p>

<p>Example:
    Load stored MinIO credentials:
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws</span> <span class="kn">import</span> <span class="n">MinIOCredentials</span>
 <br />
    <span class="n">minio_credentials_block</span> <span class="o">=</span> <span class="n"><a href="#MinIOCredentials.load">MinIOCredentials.load</a></span><span class="p">(</span><span class="s2">&quot;BLOCK_NAME&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            <div id="MinIOCredentials.minio_root_user" class="classattr">
                                <div class="attr variable">
            <span class="name">minio_root_user</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#MinIOCredentials.minio_root_user"></a>
    
    

                            </div>
                            <div id="MinIOCredentials.minio_root_password" class="classattr">
                                <div class="attr variable">
            <span class="name">minio_root_password</span><span class="annotation">: pydantic.v1.types.SecretStr</span>

        
    </div>
    <a class="headerlink" href="#MinIOCredentials.minio_root_password"></a>
    
    

                            </div>
                            <div id="MinIOCredentials.region_name" class="classattr">
                                <div class="attr variable">
            <span class="name">region_name</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#MinIOCredentials.region_name"></a>
    
    

                            </div>
                            <div id="MinIOCredentials.aws_client_parameters" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_client_parameters</span><span class="annotation">: <a href="#AwsClientParameters">AwsClientParameters</a></span>

        
    </div>
    <a class="headerlink" href="#MinIOCredentials.aws_client_parameters"></a>
    
    

                            </div>
                            <div id="MinIOCredentials.get_boto3_session" class="classattr">
                                        <input id="MinIOCredentials.get_boto3_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_boto3_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">boto3</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">Session</span>:</span></span>

                <label class="view-source-button" for="MinIOCredentials.get_boto3_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinIOCredentials.get_boto3_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinIOCredentials.get_boto3_session-250"><a href="#MinIOCredentials.get_boto3_session-250"><span class="linenos">250</span></a>    <span class="k">def</span> <span class="nf">get_boto3_session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">:</span>
</span><span id="MinIOCredentials.get_boto3_session-251"><a href="#MinIOCredentials.get_boto3_session-251"><span class="linenos">251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_boto3_session-252"><a href="#MinIOCredentials.get_boto3_session-252"><span class="linenos">252</span></a><span class="sd">        Returns an authenticated boto3 session that can be used to create clients</span>
</span><span id="MinIOCredentials.get_boto3_session-253"><a href="#MinIOCredentials.get_boto3_session-253"><span class="linenos">253</span></a><span class="sd">        and perform object operations on MinIO server.</span>
</span><span id="MinIOCredentials.get_boto3_session-254"><a href="#MinIOCredentials.get_boto3_session-254"><span class="linenos">254</span></a>
</span><span id="MinIOCredentials.get_boto3_session-255"><a href="#MinIOCredentials.get_boto3_session-255"><span class="linenos">255</span></a><span class="sd">        Example:</span>
</span><span id="MinIOCredentials.get_boto3_session-256"><a href="#MinIOCredentials.get_boto3_session-256"><span class="linenos">256</span></a><span class="sd">            Create an S3 client from an authorized boto3 session</span>
</span><span id="MinIOCredentials.get_boto3_session-257"><a href="#MinIOCredentials.get_boto3_session-257"><span class="linenos">257</span></a>
</span><span id="MinIOCredentials.get_boto3_session-258"><a href="#MinIOCredentials.get_boto3_session-258"><span class="linenos">258</span></a><span class="sd">            ```python</span>
</span><span id="MinIOCredentials.get_boto3_session-259"><a href="#MinIOCredentials.get_boto3_session-259"><span class="linenos">259</span></a><span class="sd">            minio_credentials = MinIOCredentials(</span>
</span><span id="MinIOCredentials.get_boto3_session-260"><a href="#MinIOCredentials.get_boto3_session-260"><span class="linenos">260</span></a><span class="sd">                minio_root_user = &quot;minio_root_user&quot;,</span>
</span><span id="MinIOCredentials.get_boto3_session-261"><a href="#MinIOCredentials.get_boto3_session-261"><span class="linenos">261</span></a><span class="sd">                minio_root_password = &quot;minio_root_password&quot;</span>
</span><span id="MinIOCredentials.get_boto3_session-262"><a href="#MinIOCredentials.get_boto3_session-262"><span class="linenos">262</span></a><span class="sd">            )</span>
</span><span id="MinIOCredentials.get_boto3_session-263"><a href="#MinIOCredentials.get_boto3_session-263"><span class="linenos">263</span></a><span class="sd">            s3_client = minio_credentials.get_boto3_session().client(</span>
</span><span id="MinIOCredentials.get_boto3_session-264"><a href="#MinIOCredentials.get_boto3_session-264"><span class="linenos">264</span></a><span class="sd">                service=&quot;s3&quot;,</span>
</span><span id="MinIOCredentials.get_boto3_session-265"><a href="#MinIOCredentials.get_boto3_session-265"><span class="linenos">265</span></a><span class="sd">                endpoint_url=&quot;http://localhost:9000&quot;</span>
</span><span id="MinIOCredentials.get_boto3_session-266"><a href="#MinIOCredentials.get_boto3_session-266"><span class="linenos">266</span></a><span class="sd">            )</span>
</span><span id="MinIOCredentials.get_boto3_session-267"><a href="#MinIOCredentials.get_boto3_session-267"><span class="linenos">267</span></a><span class="sd">            ```</span>
</span><span id="MinIOCredentials.get_boto3_session-268"><a href="#MinIOCredentials.get_boto3_session-268"><span class="linenos">268</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_boto3_session-269"><a href="#MinIOCredentials.get_boto3_session-269"><span class="linenos">269</span></a>
</span><span id="MinIOCredentials.get_boto3_session-270"><a href="#MinIOCredentials.get_boto3_session-270"><span class="linenos">270</span></a>        <span class="n">minio_root_password</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="MinIOCredentials.get_boto3_session-271"><a href="#MinIOCredentials.get_boto3_session-271"><span class="linenos">271</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">minio_root_password</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">()</span>
</span><span id="MinIOCredentials.get_boto3_session-272"><a href="#MinIOCredentials.get_boto3_session-272"><span class="linenos">272</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minio_root_password</span>
</span><span id="MinIOCredentials.get_boto3_session-273"><a href="#MinIOCredentials.get_boto3_session-273"><span class="linenos">273</span></a>            <span class="k">else</span> <span class="kc">None</span>
</span><span id="MinIOCredentials.get_boto3_session-274"><a href="#MinIOCredentials.get_boto3_session-274"><span class="linenos">274</span></a>        <span class="p">)</span>
</span><span id="MinIOCredentials.get_boto3_session-275"><a href="#MinIOCredentials.get_boto3_session-275"><span class="linenos">275</span></a>
</span><span id="MinIOCredentials.get_boto3_session-276"><a href="#MinIOCredentials.get_boto3_session-276"><span class="linenos">276</span></a>        <span class="k">return</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">(</span>
</span><span id="MinIOCredentials.get_boto3_session-277"><a href="#MinIOCredentials.get_boto3_session-277"><span class="linenos">277</span></a>            <span class="n">aws_access_key_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">minio_root_user</span><span class="p">,</span>
</span><span id="MinIOCredentials.get_boto3_session-278"><a href="#MinIOCredentials.get_boto3_session-278"><span class="linenos">278</span></a>            <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">minio_root_password</span><span class="p">,</span>
</span><span id="MinIOCredentials.get_boto3_session-279"><a href="#MinIOCredentials.get_boto3_session-279"><span class="linenos">279</span></a>            <span class="n">region_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span>
</span><span id="MinIOCredentials.get_boto3_session-280"><a href="#MinIOCredentials.get_boto3_session-280"><span class="linenos">280</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an authenticated boto3 session that can be used to create clients
and perform object operations on MinIO server.</p>

<p>Example:
    Create an S3 client from an authorized boto3 session
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="n">minio_credentials</span> <span class="o">=</span> <span class="n">MinIOCredentials</span><span class="p">(</span>
        <span class="n">minio_root_user</span> <span class="o">=</span> <span class="s2">&quot;minio_root_user&quot;</span><span class="p">,</span>
        <span class="n">minio_root_password</span> <span class="o">=</span> <span class="s2">&quot;minio_root_password&quot;</span>
    <span class="p">)</span>
    <span class="n">s3_client</span> <span class="o">=</span> <span class="n">minio_credentials</span><span class="o">.</span><span class="n">get_boto3_session</span><span class="p">()</span><span class="o">.</span><span class="n">client</span><span class="p">(</span>
        <span class="n">service</span><span class="o">=</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span>
        <span class="n">endpoint_url</span><span class="o">=</span><span class="s2">&quot;<a href="http://localhost:9000&amp;quot">http://localhost:9000&amp;quot</a>;</span>
    <span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="MinIOCredentials.get_client" class="classattr">
                                        <input id="MinIOCredentials.get_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">prefect_aws</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">ClientType</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MinIOCredentials.get_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinIOCredentials.get_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinIOCredentials.get_client-282"><a href="#MinIOCredentials.get_client-282"><span class="linenos">282</span></a>    <span class="k">def</span> <span class="nf">get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]):</span>
</span><span id="MinIOCredentials.get_client-283"><a href="#MinIOCredentials.get_client-283"><span class="linenos">283</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_client-284"><a href="#MinIOCredentials.get_client-284"><span class="linenos">284</span></a><span class="sd">        Helper method to dynamically get a client type.</span>
</span><span id="MinIOCredentials.get_client-285"><a href="#MinIOCredentials.get_client-285"><span class="linenos">285</span></a>
</span><span id="MinIOCredentials.get_client-286"><a href="#MinIOCredentials.get_client-286"><span class="linenos">286</span></a><span class="sd">        Args:</span>
</span><span id="MinIOCredentials.get_client-287"><a href="#MinIOCredentials.get_client-287"><span class="linenos">287</span></a><span class="sd">            client_type: The client&#39;s service name.</span>
</span><span id="MinIOCredentials.get_client-288"><a href="#MinIOCredentials.get_client-288"><span class="linenos">288</span></a>
</span><span id="MinIOCredentials.get_client-289"><a href="#MinIOCredentials.get_client-289"><span class="linenos">289</span></a><span class="sd">        Returns:</span>
</span><span id="MinIOCredentials.get_client-290"><a href="#MinIOCredentials.get_client-290"><span class="linenos">290</span></a><span class="sd">            An authenticated client.</span>
</span><span id="MinIOCredentials.get_client-291"><a href="#MinIOCredentials.get_client-291"><span class="linenos">291</span></a>
</span><span id="MinIOCredentials.get_client-292"><a href="#MinIOCredentials.get_client-292"><span class="linenos">292</span></a><span class="sd">        Raises:</span>
</span><span id="MinIOCredentials.get_client-293"><a href="#MinIOCredentials.get_client-293"><span class="linenos">293</span></a><span class="sd">            ValueError: if the client is not supported.</span>
</span><span id="MinIOCredentials.get_client-294"><a href="#MinIOCredentials.get_client-294"><span class="linenos">294</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_client-295"><a href="#MinIOCredentials.get_client-295"><span class="linenos">295</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">client_type</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">):</span>
</span><span id="MinIOCredentials.get_client-296"><a href="#MinIOCredentials.get_client-296"><span class="linenos">296</span></a>            <span class="n">client_type</span> <span class="o">=</span> <span class="n">client_type</span><span class="o">.</span><span class="n">value</span>
</span><span id="MinIOCredentials.get_client-297"><a href="#MinIOCredentials.get_client-297"><span class="linenos">297</span></a>
</span><span id="MinIOCredentials.get_client-298"><a href="#MinIOCredentials.get_client-298"><span class="linenos">298</span></a>        <span class="k">return</span> <span class="n">_get_client_cached</span><span class="p">(</span><span class="n">ctx</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_type</span><span class="o">=</span><span class="n">client_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper method to dynamically get a client type.</p>

<p>Args:
    client_type: The client's service name.</p>

<p>Returns:
    An authenticated client.</p>

<p>Raises:
    ValueError: if the client is not supported.</p>
</div>


                            </div>
                            <div id="MinIOCredentials.get_s3_client" class="classattr">
                                        <input id="MinIOCredentials.get_s3_client-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_s3_client</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="n">mypy_boto3_s3</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">S3Client</span>:</span></span>

                <label class="view-source-button" for="MinIOCredentials.get_s3_client-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinIOCredentials.get_s3_client"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinIOCredentials.get_s3_client-300"><a href="#MinIOCredentials.get_s3_client-300"><span class="linenos">300</span></a>    <span class="k">def</span> <span class="nf">get_s3_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">S3Client</span><span class="p">:</span>
</span><span id="MinIOCredentials.get_s3_client-301"><a href="#MinIOCredentials.get_s3_client-301"><span class="linenos">301</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_s3_client-302"><a href="#MinIOCredentials.get_s3_client-302"><span class="linenos">302</span></a><span class="sd">        Gets an authenticated S3 client.</span>
</span><span id="MinIOCredentials.get_s3_client-303"><a href="#MinIOCredentials.get_s3_client-303"><span class="linenos">303</span></a>
</span><span id="MinIOCredentials.get_s3_client-304"><a href="#MinIOCredentials.get_s3_client-304"><span class="linenos">304</span></a><span class="sd">        Returns:</span>
</span><span id="MinIOCredentials.get_s3_client-305"><a href="#MinIOCredentials.get_s3_client-305"><span class="linenos">305</span></a><span class="sd">            An authenticated S3 client.</span>
</span><span id="MinIOCredentials.get_s3_client-306"><a href="#MinIOCredentials.get_s3_client-306"><span class="linenos">306</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.get_s3_client-307"><a href="#MinIOCredentials.get_s3_client-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="o">=</span><span class="n">ClientType</span><span class="o">.</span><span class="n">S3</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets an authenticated S3 client.</p>

<p>Returns:
    An authenticated S3 client.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="MinIOCredentials.__init__" class="function">Block</dd>
                <dd id="MinIOCredentials.block_initialization" class="function">block_initialization</dd>
                <dd id="MinIOCredentials.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="MinIOCredentials.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="MinIOCredentials.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="MinIOCredentials.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="MinIOCredentials.get_description" class="function">get_description</dd>
                <dd id="MinIOCredentials.get_code_example" class="function">get_code_example</dd>
                <dd id="MinIOCredentials.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="MinIOCredentials.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="MinIOCredentials.load" class="function">load</dd>
                <dd id="MinIOCredentials.is_block_class" class="function">is_block_class</dd>
                <dd id="MinIOCredentials.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="MinIOCredentials.save" class="function">save</dd>
                <dd id="MinIOCredentials.delete" class="function">delete</dd>
                <dd id="MinIOCredentials.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="MinIOCredentials.json" class="function">json</dd>
                <dd id="MinIOCredentials.copy" class="function">copy</dd>

            </div>
            <div><dt>prefect.blocks.abstract.CredentialsBlock</dt>
                                <dd id="MinIOCredentials.logger" class="variable">logger</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="MinIOCredentials.dict" class="function">dict</dd>
                <dd id="MinIOCredentials.parse_obj" class="function">parse_obj</dd>
                <dd id="MinIOCredentials.parse_raw" class="function">parse_raw</dd>
                <dd id="MinIOCredentials.parse_file" class="function">parse_file</dd>
                <dd id="MinIOCredentials.from_orm" class="function">from_orm</dd>
                <dd id="MinIOCredentials.construct" class="function">construct</dd>
                <dd id="MinIOCredentials.schema" class="function">schema</dd>
                <dd id="MinIOCredentials.schema_json" class="function">schema_json</dd>
                <dd id="MinIOCredentials.validate" class="function">validate</dd>
                <dd id="MinIOCredentials.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MinIOCredentials.Config">
                            <input id="MinIOCredentials.Config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MinIOCredentials.Config</span>:

                <label class="view-source-button" for="MinIOCredentials.Config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MinIOCredentials.Config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MinIOCredentials.Config-235"><a href="#MinIOCredentials.Config-235"><span class="linenos">235</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="MinIOCredentials.Config-236"><a href="#MinIOCredentials.Config-236"><span class="linenos">236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Config class for pydantic model.&quot;&quot;&quot;</span>
</span><span id="MinIOCredentials.Config-237"><a href="#MinIOCredentials.Config-237"><span class="linenos">237</span></a>
</span><span id="MinIOCredentials.Config-238"><a href="#MinIOCredentials.Config-238"><span class="linenos">238</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Config class for pydantic model.</p>
</div>


                            <div id="MinIOCredentials.Config.arbitrary_types_allowed" class="classattr">
                                <div class="attr variable">
            <span class="name">arbitrary_types_allowed</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#MinIOCredentials.Config.arbitrary_types_allowed"></a>
    
    

                            </div>
                </section>
                <section id="S3Bucket">
                            <input id="S3Bucket-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">S3Bucket</span><wbr>(<span class="base">prefect.filesystems.WritableFileSystem</span>, <span class="base">prefect.filesystems.WritableDeploymentStorage</span>, <span class="base">prefect.blocks.abstract.ObjectStorageBlock</span>):

                <label class="view-source-button" for="S3Bucket-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket-397"><a href="#S3Bucket-397"><span class="linenos"> 397</span></a><span class="k">class</span> <span class="nc">S3Bucket</span><span class="p">(</span><span class="n">WritableFileSystem</span><span class="p">,</span> <span class="n">WritableDeploymentStorage</span><span class="p">,</span> <span class="n">ObjectStorageBlock</span><span class="p">):</span>
</span><span id="S3Bucket-398"><a href="#S3Bucket-398"><span class="linenos"> 398</span></a>
</span><span id="S3Bucket-399"><a href="#S3Bucket-399"><span class="linenos"> 399</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-400"><a href="#S3Bucket-400"><span class="linenos"> 400</span></a><span class="sd">    Block used to store data using AWS S3 or S3-compatible object storage like MinIO.</span>
</span><span id="S3Bucket-401"><a href="#S3Bucket-401"><span class="linenos"> 401</span></a>
</span><span id="S3Bucket-402"><a href="#S3Bucket-402"><span class="linenos"> 402</span></a><span class="sd">    Attributes:</span>
</span><span id="S3Bucket-403"><a href="#S3Bucket-403"><span class="linenos"> 403</span></a><span class="sd">        bucket_name: Name of your bucket.</span>
</span><span id="S3Bucket-404"><a href="#S3Bucket-404"><span class="linenos"> 404</span></a><span class="sd">        credentials: A block containing your credentials to AWS or MinIO.</span>
</span><span id="S3Bucket-405"><a href="#S3Bucket-405"><span class="linenos"> 405</span></a><span class="sd">        bucket_folder: A default path to a folder within the S3 bucket to use</span>
</span><span id="S3Bucket-406"><a href="#S3Bucket-406"><span class="linenos"> 406</span></a><span class="sd">            for reading and writing objects.</span>
</span><span id="S3Bucket-407"><a href="#S3Bucket-407"><span class="linenos"> 407</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="S3Bucket-408"><a href="#S3Bucket-408"><span class="linenos"> 408</span></a>
</span><span id="S3Bucket-409"><a href="#S3Bucket-409"><span class="linenos"> 409</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="S3Bucket-410"><a href="#S3Bucket-410"><span class="linenos"> 410</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;S3 Bucket&quot;</span>
</span><span id="S3Bucket-411"><a href="#S3Bucket-411"><span class="linenos"> 411</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="S3Bucket-412"><a href="#S3Bucket-412"><span class="linenos"> 412</span></a>        <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/s3/#prefect_aws.s3.S3Bucket&quot;</span>  <span class="c1"># noqa</span>
</span><span id="S3Bucket-413"><a href="#S3Bucket-413"><span class="linenos"> 413</span></a>    <span class="p">)</span>
</span><span id="S3Bucket-414"><a href="#S3Bucket-414"><span class="linenos"> 414</span></a>
</span><span id="S3Bucket-415"><a href="#S3Bucket-415"><span class="linenos"> 415</span></a>    <span class="n">bucket_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Name of your bucket.&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-416"><a href="#S3Bucket-416"><span class="linenos"> 416</span></a>
</span><span id="S3Bucket-417"><a href="#S3Bucket-417"><span class="linenos"> 417</span></a>    <span class="n">credentials</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">MinIOCredentials</span><span class="p">,</span> <span class="n">AwsCredentials</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="S3Bucket-418"><a href="#S3Bucket-418"><span class="linenos"> 418</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">,</span>
</span><span id="S3Bucket-419"><a href="#S3Bucket-419"><span class="linenos"> 419</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;A block containing your credentials to AWS or MinIO.&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-420"><a href="#S3Bucket-420"><span class="linenos"> 420</span></a>    <span class="p">)</span>
</span><span id="S3Bucket-421"><a href="#S3Bucket-421"><span class="linenos"> 421</span></a>
</span><span id="S3Bucket-422"><a href="#S3Bucket-422"><span class="linenos"> 422</span></a>    <span class="n">bucket_folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="S3Bucket-423"><a href="#S3Bucket-423"><span class="linenos"> 423</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-424"><a href="#S3Bucket-424"><span class="linenos"> 424</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="S3Bucket-425"><a href="#S3Bucket-425"><span class="linenos"> 425</span></a>            <span class="s2">&quot;A default path to a folder within the S3 bucket to use &quot;</span>
</span><span id="S3Bucket-426"><a href="#S3Bucket-426"><span class="linenos"> 426</span></a>            <span class="s2">&quot;for reading and writing objects.&quot;</span>
</span><span id="S3Bucket-427"><a href="#S3Bucket-427"><span class="linenos"> 427</span></a>        <span class="p">),</span>
</span><span id="S3Bucket-428"><a href="#S3Bucket-428"><span class="linenos"> 428</span></a>    <span class="p">)</span>
</span><span id="S3Bucket-429"><a href="#S3Bucket-429"><span class="linenos"> 429</span></a>
</span><span id="S3Bucket-430"><a href="#S3Bucket-430"><span class="linenos"> 430</span></a>    <span class="c1"># Property to maintain compatibility with storage block based deployments</span>
</span><span id="S3Bucket-431"><a href="#S3Bucket-431"><span class="linenos"> 431</span></a>    <span class="nd">@property</span>
</span><span id="S3Bucket-432"><a href="#S3Bucket-432"><span class="linenos"> 432</span></a>    <span class="k">def</span> <span class="nf">basepath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-433"><a href="#S3Bucket-433"><span class="linenos"> 433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-434"><a href="#S3Bucket-434"><span class="linenos"> 434</span></a><span class="sd">        The base path of the S3 bucket.</span>
</span><span id="S3Bucket-435"><a href="#S3Bucket-435"><span class="linenos"> 435</span></a>
</span><span id="S3Bucket-436"><a href="#S3Bucket-436"><span class="linenos"> 436</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-437"><a href="#S3Bucket-437"><span class="linenos"> 437</span></a><span class="sd">            str: The base path of the S3 bucket.</span>
</span><span id="S3Bucket-438"><a href="#S3Bucket-438"><span class="linenos"> 438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-439"><a href="#S3Bucket-439"><span class="linenos"> 439</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span>
</span><span id="S3Bucket-440"><a href="#S3Bucket-440"><span class="linenos"> 440</span></a>
</span><span id="S3Bucket-441"><a href="#S3Bucket-441"><span class="linenos"> 441</span></a>    <span class="nd">@basepath</span><span class="o">.</span><span class="n">setter</span>
</span><span id="S3Bucket-442"><a href="#S3Bucket-442"><span class="linenos"> 442</span></a>    <span class="k">def</span> <span class="nf">basepath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-443"><a href="#S3Bucket-443"><span class="linenos"> 443</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="S3Bucket-444"><a href="#S3Bucket-444"><span class="linenos"> 444</span></a>
</span><span id="S3Bucket-445"><a href="#S3Bucket-445"><span class="linenos"> 445</span></a>    <span class="k">def</span> <span class="nf">_resolve_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-446"><a href="#S3Bucket-446"><span class="linenos"> 446</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-447"><a href="#S3Bucket-447"><span class="linenos"> 447</span></a><span class="sd">        A helper function used in write_path to join `self.basepath` and `path`.</span>
</span><span id="S3Bucket-448"><a href="#S3Bucket-448"><span class="linenos"> 448</span></a>
</span><span id="S3Bucket-449"><a href="#S3Bucket-449"><span class="linenos"> 449</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-450"><a href="#S3Bucket-450"><span class="linenos"> 450</span></a>
</span><span id="S3Bucket-451"><a href="#S3Bucket-451"><span class="linenos"> 451</span></a><span class="sd">            path: Name of the key, e.g. &quot;file1&quot;. Each object in your</span>
</span><span id="S3Bucket-452"><a href="#S3Bucket-452"><span class="linenos"> 452</span></a><span class="sd">                bucket has a unique key (or key name).</span>
</span><span id="S3Bucket-453"><a href="#S3Bucket-453"><span class="linenos"> 453</span></a>
</span><span id="S3Bucket-454"><a href="#S3Bucket-454"><span class="linenos"> 454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-455"><a href="#S3Bucket-455"><span class="linenos"> 455</span></a>        <span class="c1"># If bucket_folder provided, it means we won&#39;t write to the root dir of</span>
</span><span id="S3Bucket-456"><a href="#S3Bucket-456"><span class="linenos"> 456</span></a>        <span class="c1"># the bucket. So we need to add it on the front of the path.</span>
</span><span id="S3Bucket-457"><a href="#S3Bucket-457"><span class="linenos"> 457</span></a>        <span class="c1">#</span>
</span><span id="S3Bucket-458"><a href="#S3Bucket-458"><span class="linenos"> 458</span></a>        <span class="c1"># AWS object key naming guidelines require &#39;/&#39; for bucket folders.</span>
</span><span id="S3Bucket-459"><a href="#S3Bucket-459"><span class="linenos"> 459</span></a>        <span class="c1"># Get POSIX path to prevent `pathlib` from inferring &#39;\&#39; on Windows OS</span>
</span><span id="S3Bucket-460"><a href="#S3Bucket-460"><span class="linenos"> 460</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="S3Bucket-461"><a href="#S3Bucket-461"><span class="linenos"> 461</span></a>            <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span> <span class="k">else</span> <span class="n">path</span>
</span><span id="S3Bucket-462"><a href="#S3Bucket-462"><span class="linenos"> 462</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-463"><a href="#S3Bucket-463"><span class="linenos"> 463</span></a>
</span><span id="S3Bucket-464"><a href="#S3Bucket-464"><span class="linenos"> 464</span></a>        <span class="k">return</span> <span class="n">path</span>
</span><span id="S3Bucket-465"><a href="#S3Bucket-465"><span class="linenos"> 465</span></a>
</span><span id="S3Bucket-466"><a href="#S3Bucket-466"><span class="linenos"> 466</span></a>    <span class="k">def</span> <span class="nf">_get_s3_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
</span><span id="S3Bucket-467"><a href="#S3Bucket-467"><span class="linenos"> 467</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-468"><a href="#S3Bucket-468"><span class="linenos"> 468</span></a><span class="sd">        Authenticate MinIO credentials or AWS credentials and return an S3 client.</span>
</span><span id="S3Bucket-469"><a href="#S3Bucket-469"><span class="linenos"> 469</span></a><span class="sd">        This is a helper function called by read_path() or write_path().</span>
</span><span id="S3Bucket-470"><a href="#S3Bucket-470"><span class="linenos"> 470</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-471"><a href="#S3Bucket-471"><span class="linenos"> 471</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-472"><a href="#S3Bucket-472"><span class="linenos"> 472</span></a>
</span><span id="S3Bucket-473"><a href="#S3Bucket-473"><span class="linenos"> 473</span></a>    <span class="k">def</span> <span class="nf">_get_bucket_resource</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">boto3</span><span class="o">.</span><span class="n">resource</span><span class="p">:</span>
</span><span id="S3Bucket-474"><a href="#S3Bucket-474"><span class="linenos"> 474</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-475"><a href="#S3Bucket-475"><span class="linenos"> 475</span></a><span class="sd">        Retrieves boto3 resource object for the configured bucket</span>
</span><span id="S3Bucket-476"><a href="#S3Bucket-476"><span class="linenos"> 476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-477"><a href="#S3Bucket-477"><span class="linenos"> 477</span></a>        <span class="n">params_override</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">aws_client_parameters</span><span class="o">.</span><span class="n">get_params_override</span><span class="p">()</span>
</span><span id="S3Bucket-478"><a href="#S3Bucket-478"><span class="linenos"> 478</span></a>        <span class="n">bucket</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="S3Bucket-479"><a href="#S3Bucket-479"><span class="linenos"> 479</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_boto3_session</span><span class="p">()</span>
</span><span id="S3Bucket-480"><a href="#S3Bucket-480"><span class="linenos"> 480</span></a>            <span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;s3&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">params_override</span><span class="p">)</span>
</span><span id="S3Bucket-481"><a href="#S3Bucket-481"><span class="linenos"> 481</span></a>            <span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">)</span>
</span><span id="S3Bucket-482"><a href="#S3Bucket-482"><span class="linenos"> 482</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-483"><a href="#S3Bucket-483"><span class="linenos"> 483</span></a>        <span class="k">return</span> <span class="n">bucket</span>
</span><span id="S3Bucket-484"><a href="#S3Bucket-484"><span class="linenos"> 484</span></a>
</span><span id="S3Bucket-485"><a href="#S3Bucket-485"><span class="linenos"> 485</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-486"><a href="#S3Bucket-486"><span class="linenos"> 486</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_directory</span><span class="p">(</span>
</span><span id="S3Bucket-487"><a href="#S3Bucket-487"><span class="linenos"> 487</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">from_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="S3Bucket-488"><a href="#S3Bucket-488"><span class="linenos"> 488</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-489"><a href="#S3Bucket-489"><span class="linenos"> 489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-490"><a href="#S3Bucket-490"><span class="linenos"> 490</span></a><span class="sd">        Copies a folder from the configured S3 bucket to a local directory.</span>
</span><span id="S3Bucket-491"><a href="#S3Bucket-491"><span class="linenos"> 491</span></a>
</span><span id="S3Bucket-492"><a href="#S3Bucket-492"><span class="linenos"> 492</span></a><span class="sd">        Defaults to copying the entire contents of the block&#39;s basepath to the current</span>
</span><span id="S3Bucket-493"><a href="#S3Bucket-493"><span class="linenos"> 493</span></a><span class="sd">        working directory.</span>
</span><span id="S3Bucket-494"><a href="#S3Bucket-494"><span class="linenos"> 494</span></a>
</span><span id="S3Bucket-495"><a href="#S3Bucket-495"><span class="linenos"> 495</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-496"><a href="#S3Bucket-496"><span class="linenos"> 496</span></a><span class="sd">            from_path: Path in S3 bucket to download from. Defaults to the block&#39;s</span>
</span><span id="S3Bucket-497"><a href="#S3Bucket-497"><span class="linenos"> 497</span></a><span class="sd">                configured basepath.</span>
</span><span id="S3Bucket-498"><a href="#S3Bucket-498"><span class="linenos"> 498</span></a><span class="sd">            local_path: Local path to download S3 contents to. Defaults to the current</span>
</span><span id="S3Bucket-499"><a href="#S3Bucket-499"><span class="linenos"> 499</span></a><span class="sd">                working directory.</span>
</span><span id="S3Bucket-500"><a href="#S3Bucket-500"><span class="linenos"> 500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-501"><a href="#S3Bucket-501"><span class="linenos"> 501</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span>
</span><span id="S3Bucket-502"><a href="#S3Bucket-502"><span class="linenos"> 502</span></a>        <span class="k">if</span> <span class="n">from_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-503"><a href="#S3Bucket-503"><span class="linenos"> 503</span></a>            <span class="n">from_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">bucket_folder</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="S3Bucket-504"><a href="#S3Bucket-504"><span class="linenos"> 504</span></a>
</span><span id="S3Bucket-505"><a href="#S3Bucket-505"><span class="linenos"> 505</span></a>        <span class="k">if</span> <span class="n">local_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-506"><a href="#S3Bucket-506"><span class="linenos"> 506</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket-507"><a href="#S3Bucket-507"><span class="linenos"> 507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket-508"><a href="#S3Bucket-508"><span class="linenos"> 508</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
</span><span id="S3Bucket-509"><a href="#S3Bucket-509"><span class="linenos"> 509</span></a>
</span><span id="S3Bucket-510"><a href="#S3Bucket-510"><span class="linenos"> 510</span></a>        <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bucket_resource</span><span class="p">()</span>
</span><span id="S3Bucket-511"><a href="#S3Bucket-511"><span class="linenos"> 511</span></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">from_path</span><span class="p">):</span>
</span><span id="S3Bucket-512"><a href="#S3Bucket-512"><span class="linenos"> 512</span></a>            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="S3Bucket-513"><a href="#S3Bucket-513"><span class="linenos"> 513</span></a>                <span class="c1"># object is a folder and will be created if it contains any objects</span>
</span><span id="S3Bucket-514"><a href="#S3Bucket-514"><span class="linenos"> 514</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket-515"><a href="#S3Bucket-515"><span class="linenos"> 515</span></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="S3Bucket-516"><a href="#S3Bucket-516"><span class="linenos"> 516</span></a>                <span class="n">local_path</span><span class="p">,</span>
</span><span id="S3Bucket-517"><a href="#S3Bucket-517"><span class="linenos"> 517</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">from_path</span><span class="p">),</span>
</span><span id="S3Bucket-518"><a href="#S3Bucket-518"><span class="linenos"> 518</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-519"><a href="#S3Bucket-519"><span class="linenos"> 519</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="S3Bucket-520"><a href="#S3Bucket-520"><span class="linenos"> 520</span></a>            <span class="n">bucket</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span><span id="S3Bucket-521"><a href="#S3Bucket-521"><span class="linenos"> 521</span></a>
</span><span id="S3Bucket-522"><a href="#S3Bucket-522"><span class="linenos"> 522</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-523"><a href="#S3Bucket-523"><span class="linenos"> 523</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">put_directory</span><span class="p">(</span>
</span><span id="S3Bucket-524"><a href="#S3Bucket-524"><span class="linenos"> 524</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-525"><a href="#S3Bucket-525"><span class="linenos"> 525</span></a>        <span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-526"><a href="#S3Bucket-526"><span class="linenos"> 526</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-527"><a href="#S3Bucket-527"><span class="linenos"> 527</span></a>        <span class="n">ignore_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-528"><a href="#S3Bucket-528"><span class="linenos"> 528</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="S3Bucket-529"><a href="#S3Bucket-529"><span class="linenos"> 529</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-530"><a href="#S3Bucket-530"><span class="linenos"> 530</span></a><span class="sd">        Uploads a directory from a given local path to the configured S3 bucket in a</span>
</span><span id="S3Bucket-531"><a href="#S3Bucket-531"><span class="linenos"> 531</span></a><span class="sd">        given folder.</span>
</span><span id="S3Bucket-532"><a href="#S3Bucket-532"><span class="linenos"> 532</span></a>
</span><span id="S3Bucket-533"><a href="#S3Bucket-533"><span class="linenos"> 533</span></a><span class="sd">        Defaults to uploading the entire contents the current working directory to the</span>
</span><span id="S3Bucket-534"><a href="#S3Bucket-534"><span class="linenos"> 534</span></a><span class="sd">        block&#39;s basepath.</span>
</span><span id="S3Bucket-535"><a href="#S3Bucket-535"><span class="linenos"> 535</span></a>
</span><span id="S3Bucket-536"><a href="#S3Bucket-536"><span class="linenos"> 536</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-537"><a href="#S3Bucket-537"><span class="linenos"> 537</span></a><span class="sd">            local_path: Path to local directory to upload from.</span>
</span><span id="S3Bucket-538"><a href="#S3Bucket-538"><span class="linenos"> 538</span></a><span class="sd">            to_path: Path in S3 bucket to upload to. Defaults to block&#39;s configured</span>
</span><span id="S3Bucket-539"><a href="#S3Bucket-539"><span class="linenos"> 539</span></a><span class="sd">                basepath.</span>
</span><span id="S3Bucket-540"><a href="#S3Bucket-540"><span class="linenos"> 540</span></a><span class="sd">            ignore_file: Path to file containing gitignore style expressions for</span>
</span><span id="S3Bucket-541"><a href="#S3Bucket-541"><span class="linenos"> 541</span></a><span class="sd">                filepaths to ignore.</span>
</span><span id="S3Bucket-542"><a href="#S3Bucket-542"><span class="linenos"> 542</span></a>
</span><span id="S3Bucket-543"><a href="#S3Bucket-543"><span class="linenos"> 543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-544"><a href="#S3Bucket-544"><span class="linenos"> 544</span></a>        <span class="n">to_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">to_path</span>
</span><span id="S3Bucket-545"><a href="#S3Bucket-545"><span class="linenos"> 545</span></a>
</span><span id="S3Bucket-546"><a href="#S3Bucket-546"><span class="linenos"> 546</span></a>        <span class="k">if</span> <span class="n">local_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-547"><a href="#S3Bucket-547"><span class="linenos"> 547</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="S3Bucket-548"><a href="#S3Bucket-548"><span class="linenos"> 548</span></a>
</span><span id="S3Bucket-549"><a href="#S3Bucket-549"><span class="linenos"> 549</span></a>        <span class="n">included_files</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="S3Bucket-550"><a href="#S3Bucket-550"><span class="linenos"> 550</span></a>        <span class="k">if</span> <span class="n">ignore_file</span><span class="p">:</span>
</span><span id="S3Bucket-551"><a href="#S3Bucket-551"><span class="linenos"> 551</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ignore_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="S3Bucket-552"><a href="#S3Bucket-552"><span class="linenos"> 552</span></a>                <span class="n">ignore_patterns</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="S3Bucket-553"><a href="#S3Bucket-553"><span class="linenos"> 553</span></a>
</span><span id="S3Bucket-554"><a href="#S3Bucket-554"><span class="linenos"> 554</span></a>            <span class="n">included_files</span> <span class="o">=</span> <span class="n">filter_files</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">ignore_patterns</span><span class="p">)</span>
</span><span id="S3Bucket-555"><a href="#S3Bucket-555"><span class="linenos"> 555</span></a>
</span><span id="S3Bucket-556"><a href="#S3Bucket-556"><span class="linenos"> 556</span></a>        <span class="n">uploaded_file_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="S3Bucket-557"><a href="#S3Bucket-557"><span class="linenos"> 557</span></a>        <span class="k">for</span> <span class="n">local_file_path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
</span><span id="S3Bucket-558"><a href="#S3Bucket-558"><span class="linenos"> 558</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="S3Bucket-559"><a href="#S3Bucket-559"><span class="linenos"> 559</span></a>                <span class="n">included_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="S3Bucket-560"><a href="#S3Bucket-560"><span class="linenos"> 560</span></a>                <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">local_file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">included_files</span>
</span><span id="S3Bucket-561"><a href="#S3Bucket-561"><span class="linenos"> 561</span></a>            <span class="p">):</span>
</span><span id="S3Bucket-562"><a href="#S3Bucket-562"><span class="linenos"> 562</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket-563"><a href="#S3Bucket-563"><span class="linenos"> 563</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">local_file_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket-564"><a href="#S3Bucket-564"><span class="linenos"> 564</span></a>                <span class="n">remote_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">local_file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span>
</span><span id="S3Bucket-565"><a href="#S3Bucket-565"><span class="linenos"> 565</span></a>                    <span class="n">local_path</span>
</span><span id="S3Bucket-566"><a href="#S3Bucket-566"><span class="linenos"> 566</span></a>                <span class="p">)</span>
</span><span id="S3Bucket-567"><a href="#S3Bucket-567"><span class="linenos"> 567</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
</span><span id="S3Bucket-568"><a href="#S3Bucket-568"><span class="linenos"> 568</span></a>                    <span class="n">local_file_content</span> <span class="o">=</span> <span class="n">local_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="S3Bucket-569"><a href="#S3Bucket-569"><span class="linenos"> 569</span></a>
</span><span id="S3Bucket-570"><a href="#S3Bucket-570"><span class="linenos"> 570</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_path</span><span class="p">(</span>
</span><span id="S3Bucket-571"><a href="#S3Bucket-571"><span class="linenos"> 571</span></a>                    <span class="n">remote_file_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span> <span class="n">content</span><span class="o">=</span><span class="n">local_file_content</span>
</span><span id="S3Bucket-572"><a href="#S3Bucket-572"><span class="linenos"> 572</span></a>                <span class="p">)</span>
</span><span id="S3Bucket-573"><a href="#S3Bucket-573"><span class="linenos"> 573</span></a>                <span class="n">uploaded_file_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="S3Bucket-574"><a href="#S3Bucket-574"><span class="linenos"> 574</span></a>
</span><span id="S3Bucket-575"><a href="#S3Bucket-575"><span class="linenos"> 575</span></a>        <span class="k">return</span> <span class="n">uploaded_file_count</span>
</span><span id="S3Bucket-576"><a href="#S3Bucket-576"><span class="linenos"> 576</span></a>
</span><span id="S3Bucket-577"><a href="#S3Bucket-577"><span class="linenos"> 577</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-578"><a href="#S3Bucket-578"><span class="linenos"> 578</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">read_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="S3Bucket-579"><a href="#S3Bucket-579"><span class="linenos"> 579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-580"><a href="#S3Bucket-580"><span class="linenos"> 580</span></a><span class="sd">        Read specified path from S3 and return contents. Provide the entire</span>
</span><span id="S3Bucket-581"><a href="#S3Bucket-581"><span class="linenos"> 581</span></a><span class="sd">        path to the key in S3.</span>
</span><span id="S3Bucket-582"><a href="#S3Bucket-582"><span class="linenos"> 582</span></a>
</span><span id="S3Bucket-583"><a href="#S3Bucket-583"><span class="linenos"> 583</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-584"><a href="#S3Bucket-584"><span class="linenos"> 584</span></a><span class="sd">            path: Entire path to (and including) the key.</span>
</span><span id="S3Bucket-585"><a href="#S3Bucket-585"><span class="linenos"> 585</span></a>
</span><span id="S3Bucket-586"><a href="#S3Bucket-586"><span class="linenos"> 586</span></a><span class="sd">        Example:</span>
</span><span id="S3Bucket-587"><a href="#S3Bucket-587"><span class="linenos"> 587</span></a><span class="sd">            Read &quot;subfolder/file1&quot; contents from an S3 bucket named &quot;bucket&quot;:</span>
</span><span id="S3Bucket-588"><a href="#S3Bucket-588"><span class="linenos"> 588</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-589"><a href="#S3Bucket-589"><span class="linenos"> 589</span></a><span class="sd">            from prefect_aws import AwsCredentials</span>
</span><span id="S3Bucket-590"><a href="#S3Bucket-590"><span class="linenos"> 590</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-591"><a href="#S3Bucket-591"><span class="linenos"> 591</span></a>
</span><span id="S3Bucket-592"><a href="#S3Bucket-592"><span class="linenos"> 592</span></a><span class="sd">            aws_creds = AwsCredentials(</span>
</span><span id="S3Bucket-593"><a href="#S3Bucket-593"><span class="linenos"> 593</span></a><span class="sd">                aws_access_key_id=AWS_ACCESS_KEY_ID,</span>
</span><span id="S3Bucket-594"><a href="#S3Bucket-594"><span class="linenos"> 594</span></a><span class="sd">                aws_secret_access_key=AWS_SECRET_ACCESS_KEY</span>
</span><span id="S3Bucket-595"><a href="#S3Bucket-595"><span class="linenos"> 595</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-596"><a href="#S3Bucket-596"><span class="linenos"> 596</span></a>
</span><span id="S3Bucket-597"><a href="#S3Bucket-597"><span class="linenos"> 597</span></a><span class="sd">            s3_bucket_block = S3Bucket(</span>
</span><span id="S3Bucket-598"><a href="#S3Bucket-598"><span class="linenos"> 598</span></a><span class="sd">                bucket_name=&quot;bucket&quot;,</span>
</span><span id="S3Bucket-599"><a href="#S3Bucket-599"><span class="linenos"> 599</span></a><span class="sd">                credentials=aws_creds,</span>
</span><span id="S3Bucket-600"><a href="#S3Bucket-600"><span class="linenos"> 600</span></a><span class="sd">                bucket_folder=&quot;subfolder&quot;</span>
</span><span id="S3Bucket-601"><a href="#S3Bucket-601"><span class="linenos"> 601</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-602"><a href="#S3Bucket-602"><span class="linenos"> 602</span></a>
</span><span id="S3Bucket-603"><a href="#S3Bucket-603"><span class="linenos"> 603</span></a><span class="sd">            key_contents = s3_bucket_block.read_path(path=&quot;subfolder/file1&quot;)</span>
</span><span id="S3Bucket-604"><a href="#S3Bucket-604"><span class="linenos"> 604</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-605"><a href="#S3Bucket-605"><span class="linenos"> 605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-606"><a href="#S3Bucket-606"><span class="linenos"> 606</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="S3Bucket-607"><a href="#S3Bucket-607"><span class="linenos"> 607</span></a>
</span><span id="S3Bucket-608"><a href="#S3Bucket-608"><span class="linenos"> 608</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_sync</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span><span id="S3Bucket-609"><a href="#S3Bucket-609"><span class="linenos"> 609</span></a>
</span><span id="S3Bucket-610"><a href="#S3Bucket-610"><span class="linenos"> 610</span></a>    <span class="k">def</span> <span class="nf">_read_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="S3Bucket-611"><a href="#S3Bucket-611"><span class="linenos"> 611</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-612"><a href="#S3Bucket-612"><span class="linenos"> 612</span></a><span class="sd">        Called by read_path(). Creates an S3 client and retrieves the</span>
</span><span id="S3Bucket-613"><a href="#S3Bucket-613"><span class="linenos"> 613</span></a><span class="sd">        contents from  a specified path.</span>
</span><span id="S3Bucket-614"><a href="#S3Bucket-614"><span class="linenos"> 614</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-615"><a href="#S3Bucket-615"><span class="linenos"> 615</span></a>
</span><span id="S3Bucket-616"><a href="#S3Bucket-616"><span class="linenos"> 616</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-617"><a href="#S3Bucket-617"><span class="linenos"> 617</span></a>
</span><span id="S3Bucket-618"><a href="#S3Bucket-618"><span class="linenos"> 618</span></a>        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="S3Bucket-619"><a href="#S3Bucket-619"><span class="linenos"> 619</span></a>            <span class="n">s3_client</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">Fileobj</span><span class="o">=</span><span class="n">stream</span><span class="p">)</span>
</span><span id="S3Bucket-620"><a href="#S3Bucket-620"><span class="linenos"> 620</span></a>            <span class="n">stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="S3Bucket-621"><a href="#S3Bucket-621"><span class="linenos"> 621</span></a>            <span class="n">output</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="S3Bucket-622"><a href="#S3Bucket-622"><span class="linenos"> 622</span></a>            <span class="k">return</span> <span class="n">output</span>
</span><span id="S3Bucket-623"><a href="#S3Bucket-623"><span class="linenos"> 623</span></a>
</span><span id="S3Bucket-624"><a href="#S3Bucket-624"><span class="linenos"> 624</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-625"><a href="#S3Bucket-625"><span class="linenos"> 625</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">write_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-626"><a href="#S3Bucket-626"><span class="linenos"> 626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-627"><a href="#S3Bucket-627"><span class="linenos"> 627</span></a><span class="sd">        Writes to an S3 bucket.</span>
</span><span id="S3Bucket-628"><a href="#S3Bucket-628"><span class="linenos"> 628</span></a>
</span><span id="S3Bucket-629"><a href="#S3Bucket-629"><span class="linenos"> 629</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-630"><a href="#S3Bucket-630"><span class="linenos"> 630</span></a>
</span><span id="S3Bucket-631"><a href="#S3Bucket-631"><span class="linenos"> 631</span></a><span class="sd">            path: The key name. Each object in your bucket has a unique</span>
</span><span id="S3Bucket-632"><a href="#S3Bucket-632"><span class="linenos"> 632</span></a><span class="sd">                key (or key name).</span>
</span><span id="S3Bucket-633"><a href="#S3Bucket-633"><span class="linenos"> 633</span></a><span class="sd">            content: What you are uploading to S3.</span>
</span><span id="S3Bucket-634"><a href="#S3Bucket-634"><span class="linenos"> 634</span></a>
</span><span id="S3Bucket-635"><a href="#S3Bucket-635"><span class="linenos"> 635</span></a><span class="sd">        Example:</span>
</span><span id="S3Bucket-636"><a href="#S3Bucket-636"><span class="linenos"> 636</span></a>
</span><span id="S3Bucket-637"><a href="#S3Bucket-637"><span class="linenos"> 637</span></a><span class="sd">            Write data to the path `dogs/small_dogs/havanese` in an S3 Bucket:</span>
</span><span id="S3Bucket-638"><a href="#S3Bucket-638"><span class="linenos"> 638</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-639"><a href="#S3Bucket-639"><span class="linenos"> 639</span></a><span class="sd">            from prefect_aws import MinioCredentials</span>
</span><span id="S3Bucket-640"><a href="#S3Bucket-640"><span class="linenos"> 640</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-641"><a href="#S3Bucket-641"><span class="linenos"> 641</span></a>
</span><span id="S3Bucket-642"><a href="#S3Bucket-642"><span class="linenos"> 642</span></a><span class="sd">            minio_creds = MinIOCredentials(</span>
</span><span id="S3Bucket-643"><a href="#S3Bucket-643"><span class="linenos"> 643</span></a><span class="sd">                minio_root_user = &quot;minioadmin&quot;,</span>
</span><span id="S3Bucket-644"><a href="#S3Bucket-644"><span class="linenos"> 644</span></a><span class="sd">                minio_root_password = &quot;minioadmin&quot;,</span>
</span><span id="S3Bucket-645"><a href="#S3Bucket-645"><span class="linenos"> 645</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-646"><a href="#S3Bucket-646"><span class="linenos"> 646</span></a>
</span><span id="S3Bucket-647"><a href="#S3Bucket-647"><span class="linenos"> 647</span></a><span class="sd">            s3_bucket_block = S3Bucket(</span>
</span><span id="S3Bucket-648"><a href="#S3Bucket-648"><span class="linenos"> 648</span></a><span class="sd">                bucket_name=&quot;bucket&quot;,</span>
</span><span id="S3Bucket-649"><a href="#S3Bucket-649"><span class="linenos"> 649</span></a><span class="sd">                minio_credentials=minio_creds,</span>
</span><span id="S3Bucket-650"><a href="#S3Bucket-650"><span class="linenos"> 650</span></a><span class="sd">                bucket_folder=&quot;dogs/smalldogs&quot;,</span>
</span><span id="S3Bucket-651"><a href="#S3Bucket-651"><span class="linenos"> 651</span></a><span class="sd">                endpoint_url=&quot;http://localhost:9000&quot;,</span>
</span><span id="S3Bucket-652"><a href="#S3Bucket-652"><span class="linenos"> 652</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-653"><a href="#S3Bucket-653"><span class="linenos"> 653</span></a><span class="sd">            s3_havanese_path = s3_bucket_block.write_path(path=&quot;havanese&quot;, content=data)</span>
</span><span id="S3Bucket-654"><a href="#S3Bucket-654"><span class="linenos"> 654</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-655"><a href="#S3Bucket-655"><span class="linenos"> 655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-656"><a href="#S3Bucket-656"><span class="linenos"> 656</span></a>
</span><span id="S3Bucket-657"><a href="#S3Bucket-657"><span class="linenos"> 657</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="S3Bucket-658"><a href="#S3Bucket-658"><span class="linenos"> 658</span></a>
</span><span id="S3Bucket-659"><a href="#S3Bucket-659"><span class="linenos"> 659</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_sync</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span id="S3Bucket-660"><a href="#S3Bucket-660"><span class="linenos"> 660</span></a>
</span><span id="S3Bucket-661"><a href="#S3Bucket-661"><span class="linenos"> 661</span></a>        <span class="k">return</span> <span class="n">path</span>
</span><span id="S3Bucket-662"><a href="#S3Bucket-662"><span class="linenos"> 662</span></a>
</span><span id="S3Bucket-663"><a href="#S3Bucket-663"><span class="linenos"> 663</span></a>    <span class="k">def</span> <span class="nf">_write_sync</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-664"><a href="#S3Bucket-664"><span class="linenos"> 664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-665"><a href="#S3Bucket-665"><span class="linenos"> 665</span></a><span class="sd">        Called by write_path(). Creates an S3 client and uploads a file</span>
</span><span id="S3Bucket-666"><a href="#S3Bucket-666"><span class="linenos"> 666</span></a><span class="sd">        object.</span>
</span><span id="S3Bucket-667"><a href="#S3Bucket-667"><span class="linenos"> 667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-668"><a href="#S3Bucket-668"><span class="linenos"> 668</span></a>
</span><span id="S3Bucket-669"><a href="#S3Bucket-669"><span class="linenos"> 669</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-670"><a href="#S3Bucket-670"><span class="linenos"> 670</span></a>
</span><span id="S3Bucket-671"><a href="#S3Bucket-671"><span class="linenos"> 671</span></a>        <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
</span><span id="S3Bucket-672"><a href="#S3Bucket-672"><span class="linenos"> 672</span></a>            <span class="n">s3_client</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">(</span><span class="n">Fileobj</span><span class="o">=</span><span class="n">stream</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
</span><span id="S3Bucket-673"><a href="#S3Bucket-673"><span class="linenos"> 673</span></a>
</span><span id="S3Bucket-674"><a href="#S3Bucket-674"><span class="linenos"> 674</span></a>    <span class="c1"># NEW BLOCK INTERFACE METHODS BELOW</span>
</span><span id="S3Bucket-675"><a href="#S3Bucket-675"><span class="linenos"> 675</span></a>    <span class="nd">@staticmethod</span>
</span><span id="S3Bucket-676"><a href="#S3Bucket-676"><span class="linenos"> 676</span></a>    <span class="k">def</span> <span class="nf">_list_objects_sync</span><span class="p">(</span><span class="n">page_iterator</span><span class="p">:</span> <span class="n">PageIterator</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="S3Bucket-677"><a href="#S3Bucket-677"><span class="linenos"> 677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-678"><a href="#S3Bucket-678"><span class="linenos"> 678</span></a><span class="sd">        Synchronous method to collect S3 objects into a list</span>
</span><span id="S3Bucket-679"><a href="#S3Bucket-679"><span class="linenos"> 679</span></a>
</span><span id="S3Bucket-680"><a href="#S3Bucket-680"><span class="linenos"> 680</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-681"><a href="#S3Bucket-681"><span class="linenos"> 681</span></a><span class="sd">            page_iterator: AWS Paginator for S3 objects</span>
</span><span id="S3Bucket-682"><a href="#S3Bucket-682"><span class="linenos"> 682</span></a>
</span><span id="S3Bucket-683"><a href="#S3Bucket-683"><span class="linenos"> 683</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-684"><a href="#S3Bucket-684"><span class="linenos"> 684</span></a><span class="sd">            List[Dict]: List of object information</span>
</span><span id="S3Bucket-685"><a href="#S3Bucket-685"><span class="linenos"> 685</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-686"><a href="#S3Bucket-686"><span class="linenos"> 686</span></a>        <span class="k">return</span> <span class="p">[</span>
</span><span id="S3Bucket-687"><a href="#S3Bucket-687"><span class="linenos"> 687</span></a>            <span class="n">content</span> <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="n">page_iterator</span> <span class="k">for</span> <span class="n">content</span> <span class="ow">in</span> <span class="n">page</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Contents&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="S3Bucket-688"><a href="#S3Bucket-688"><span class="linenos"> 688</span></a>        <span class="p">]</span>
</span><span id="S3Bucket-689"><a href="#S3Bucket-689"><span class="linenos"> 689</span></a>
</span><span id="S3Bucket-690"><a href="#S3Bucket-690"><span class="linenos"> 690</span></a>    <span class="k">def</span> <span class="nf">_join_bucket_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bucket_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-691"><a href="#S3Bucket-691"><span class="linenos"> 691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-692"><a href="#S3Bucket-692"><span class="linenos"> 692</span></a><span class="sd">        Joins the base bucket folder to the bucket path.</span>
</span><span id="S3Bucket-693"><a href="#S3Bucket-693"><span class="linenos"> 693</span></a><span class="sd">        NOTE: If a method reuses another method in this class, be careful to not</span>
</span><span id="S3Bucket-694"><a href="#S3Bucket-694"><span class="linenos"> 694</span></a><span class="sd">        call this  twice because it&#39;ll join the bucket folder twice.</span>
</span><span id="S3Bucket-695"><a href="#S3Bucket-695"><span class="linenos"> 695</span></a><span class="sd">        See https://github.com/PrefectHQ/prefect-aws/issues/141 for a past issue.</span>
</span><span id="S3Bucket-696"><a href="#S3Bucket-696"><span class="linenos"> 696</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-697"><a href="#S3Bucket-697"><span class="linenos"> 697</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">bucket_path</span><span class="p">:</span>
</span><span id="S3Bucket-698"><a href="#S3Bucket-698"><span class="linenos"> 698</span></a>            <span class="c1"># there&#39;s a difference between &quot;.&quot; and &quot;&quot;, at least in the tests</span>
</span><span id="S3Bucket-699"><a href="#S3Bucket-699"><span class="linenos"> 699</span></a>            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
</span><span id="S3Bucket-700"><a href="#S3Bucket-700"><span class="linenos"> 700</span></a>
</span><span id="S3Bucket-701"><a href="#S3Bucket-701"><span class="linenos"> 701</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bucket_path</span><span class="p">)</span>
</span><span id="S3Bucket-702"><a href="#S3Bucket-702"><span class="linenos"> 702</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">bucket_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span><span class="p">):</span>
</span><span id="S3Bucket-703"><a href="#S3Bucket-703"><span class="linenos"> 703</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-704"><a href="#S3Bucket-704"><span class="linenos"> 704</span></a>                <span class="sa">f</span><span class="s2">&quot;Bucket path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> is already prefixed with &quot;</span>
</span><span id="S3Bucket-705"><a href="#S3Bucket-705"><span class="linenos"> 705</span></a>                <span class="sa">f</span><span class="s2">&quot;bucket folder </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span><span class="si">!r}</span><span class="s2">; is this intentional?&quot;</span>
</span><span id="S3Bucket-706"><a href="#S3Bucket-706"><span class="linenos"> 706</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-707"><a href="#S3Bucket-707"><span class="linenos"> 707</span></a>
</span><span id="S3Bucket-708"><a href="#S3Bucket-708"><span class="linenos"> 708</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">bucket_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span> <span class="o">+</span> <span class="p">(</span>
</span><span id="S3Bucket-709"><a href="#S3Bucket-709"><span class="linenos"> 709</span></a>            <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bucket_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;/&quot;</span>
</span><span id="S3Bucket-710"><a href="#S3Bucket-710"><span class="linenos"> 710</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-711"><a href="#S3Bucket-711"><span class="linenos"> 711</span></a>
</span><span id="S3Bucket-712"><a href="#S3Bucket-712"><span class="linenos"> 712</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-713"><a href="#S3Bucket-713"><span class="linenos"> 713</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_objects</span><span class="p">(</span>
</span><span id="S3Bucket-714"><a href="#S3Bucket-714"><span class="linenos"> 714</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-715"><a href="#S3Bucket-715"><span class="linenos"> 715</span></a>        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-716"><a href="#S3Bucket-716"><span class="linenos"> 716</span></a>        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-717"><a href="#S3Bucket-717"><span class="linenos"> 717</span></a>        <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-718"><a href="#S3Bucket-718"><span class="linenos"> 718</span></a>        <span class="n">max_items</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-719"><a href="#S3Bucket-719"><span class="linenos"> 719</span></a>        <span class="n">jmespath_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-720"><a href="#S3Bucket-720"><span class="linenos"> 720</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="S3Bucket-721"><a href="#S3Bucket-721"><span class="linenos"> 721</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-722"><a href="#S3Bucket-722"><span class="linenos"> 722</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-723"><a href="#S3Bucket-723"><span class="linenos"> 723</span></a><span class="sd">            folder: Folder to list objects from.</span>
</span><span id="S3Bucket-724"><a href="#S3Bucket-724"><span class="linenos"> 724</span></a><span class="sd">            delimiter: Character used to group keys of listed objects.</span>
</span><span id="S3Bucket-725"><a href="#S3Bucket-725"><span class="linenos"> 725</span></a><span class="sd">            page_size: Number of objects to return in each request to the AWS API.</span>
</span><span id="S3Bucket-726"><a href="#S3Bucket-726"><span class="linenos"> 726</span></a><span class="sd">            max_items: Maximum number of objects that to be returned by task.</span>
</span><span id="S3Bucket-727"><a href="#S3Bucket-727"><span class="linenos"> 727</span></a><span class="sd">            jmespath_query: Query used to filter objects based on object attributes refer to</span>
</span><span id="S3Bucket-728"><a href="#S3Bucket-728"><span class="linenos"> 728</span></a><span class="sd">                the [boto3 docs](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/paginators.html#filtering-results-with-jmespath)</span>
</span><span id="S3Bucket-729"><a href="#S3Bucket-729"><span class="linenos"> 729</span></a><span class="sd">                for more information on how to construct queries.</span>
</span><span id="S3Bucket-730"><a href="#S3Bucket-730"><span class="linenos"> 730</span></a>
</span><span id="S3Bucket-731"><a href="#S3Bucket-731"><span class="linenos"> 731</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-732"><a href="#S3Bucket-732"><span class="linenos"> 732</span></a><span class="sd">            List of objects and their metadata in the bucket.</span>
</span><span id="S3Bucket-733"><a href="#S3Bucket-733"><span class="linenos"> 733</span></a>
</span><span id="S3Bucket-734"><a href="#S3Bucket-734"><span class="linenos"> 734</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-735"><a href="#S3Bucket-735"><span class="linenos"> 735</span></a><span class="sd">            List objects under the `base_folder`.</span>
</span><span id="S3Bucket-736"><a href="#S3Bucket-736"><span class="linenos"> 736</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-737"><a href="#S3Bucket-737"><span class="linenos"> 737</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-738"><a href="#S3Bucket-738"><span class="linenos"> 738</span></a>
</span><span id="S3Bucket-739"><a href="#S3Bucket-739"><span class="linenos"> 739</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-740"><a href="#S3Bucket-740"><span class="linenos"> 740</span></a><span class="sd">            s3_bucket.list_objects(&quot;base_folder&quot;)</span>
</span><span id="S3Bucket-741"><a href="#S3Bucket-741"><span class="linenos"> 741</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-742"><a href="#S3Bucket-742"><span class="linenos"> 742</span></a><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
</span><span id="S3Bucket-743"><a href="#S3Bucket-743"><span class="linenos"> 743</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="S3Bucket-744"><a href="#S3Bucket-744"><span class="linenos"> 744</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-745"><a href="#S3Bucket-745"><span class="linenos"> 745</span></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s2">&quot;list_objects_v2&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-746"><a href="#S3Bucket-746"><span class="linenos"> 746</span></a>        <span class="n">page_iterator</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
</span><span id="S3Bucket-747"><a href="#S3Bucket-747"><span class="linenos"> 747</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-748"><a href="#S3Bucket-748"><span class="linenos"> 748</span></a>            <span class="n">Prefix</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-749"><a href="#S3Bucket-749"><span class="linenos"> 749</span></a>            <span class="n">Delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
</span><span id="S3Bucket-750"><a href="#S3Bucket-750"><span class="linenos"> 750</span></a>            <span class="n">PaginationConfig</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;PageSize&quot;</span><span class="p">:</span> <span class="n">page_size</span><span class="p">,</span> <span class="s2">&quot;MaxItems&quot;</span><span class="p">:</span> <span class="n">max_items</span><span class="p">},</span>
</span><span id="S3Bucket-751"><a href="#S3Bucket-751"><span class="linenos"> 751</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-752"><a href="#S3Bucket-752"><span class="linenos"> 752</span></a>        <span class="k">if</span> <span class="n">jmespath_query</span><span class="p">:</span>
</span><span id="S3Bucket-753"><a href="#S3Bucket-753"><span class="linenos"> 753</span></a>            <span class="n">page_iterator</span> <span class="o">=</span> <span class="n">page_iterator</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jmespath_query</span><span class="si">}</span><span class="s2"> | </span><span class="se">{{</span><span class="s2">Contents: @</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-754"><a href="#S3Bucket-754"><span class="linenos"> 754</span></a>
</span><span id="S3Bucket-755"><a href="#S3Bucket-755"><span class="linenos"> 755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Listing objects in bucket </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-756"><a href="#S3Bucket-756"><span class="linenos"> 756</span></a>        <span class="n">objects</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-757"><a href="#S3Bucket-757"><span class="linenos"> 757</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_objects_sync</span><span class="p">,</span> <span class="n">page_iterator</span>
</span><span id="S3Bucket-758"><a href="#S3Bucket-758"><span class="linenos"> 758</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-759"><a href="#S3Bucket-759"><span class="linenos"> 759</span></a>        <span class="k">return</span> <span class="n">objects</span>
</span><span id="S3Bucket-760"><a href="#S3Bucket-760"><span class="linenos"> 760</span></a>
</span><span id="S3Bucket-761"><a href="#S3Bucket-761"><span class="linenos"> 761</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-762"><a href="#S3Bucket-762"><span class="linenos"> 762</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_object_to_path</span><span class="p">(</span>
</span><span id="S3Bucket-763"><a href="#S3Bucket-763"><span class="linenos"> 763</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-764"><a href="#S3Bucket-764"><span class="linenos"> 764</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket-765"><a href="#S3Bucket-765"><span class="linenos"> 765</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span>
</span><span id="S3Bucket-766"><a href="#S3Bucket-766"><span class="linenos"> 766</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-767"><a href="#S3Bucket-767"><span class="linenos"> 767</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="S3Bucket-768"><a href="#S3Bucket-768"><span class="linenos"> 768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-769"><a href="#S3Bucket-769"><span class="linenos"> 769</span></a><span class="sd">        Downloads an object from the S3 bucket to a path.</span>
</span><span id="S3Bucket-770"><a href="#S3Bucket-770"><span class="linenos"> 770</span></a>
</span><span id="S3Bucket-771"><a href="#S3Bucket-771"><span class="linenos"> 771</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-772"><a href="#S3Bucket-772"><span class="linenos"> 772</span></a><span class="sd">            from_path: The path to the object to download; this gets prefixed</span>
</span><span id="S3Bucket-773"><a href="#S3Bucket-773"><span class="linenos"> 773</span></a><span class="sd">                with the bucket_folder.</span>
</span><span id="S3Bucket-774"><a href="#S3Bucket-774"><span class="linenos"> 774</span></a><span class="sd">            to_path: The path to download the object to. If not provided, the</span>
</span><span id="S3Bucket-775"><a href="#S3Bucket-775"><span class="linenos"> 775</span></a><span class="sd">                object&#39;s name will be used.</span>
</span><span id="S3Bucket-776"><a href="#S3Bucket-776"><span class="linenos"> 776</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-777"><a href="#S3Bucket-777"><span class="linenos"> 777</span></a><span class="sd">                `Client.download_file`.</span>
</span><span id="S3Bucket-778"><a href="#S3Bucket-778"><span class="linenos"> 778</span></a>
</span><span id="S3Bucket-779"><a href="#S3Bucket-779"><span class="linenos"> 779</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-780"><a href="#S3Bucket-780"><span class="linenos"> 780</span></a><span class="sd">            The absolute path that the object was downloaded to.</span>
</span><span id="S3Bucket-781"><a href="#S3Bucket-781"><span class="linenos"> 781</span></a>
</span><span id="S3Bucket-782"><a href="#S3Bucket-782"><span class="linenos"> 782</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-783"><a href="#S3Bucket-783"><span class="linenos"> 783</span></a><span class="sd">            Download my_folder/notes.txt object to notes.txt.</span>
</span><span id="S3Bucket-784"><a href="#S3Bucket-784"><span class="linenos"> 784</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-785"><a href="#S3Bucket-785"><span class="linenos"> 785</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-786"><a href="#S3Bucket-786"><span class="linenos"> 786</span></a>
</span><span id="S3Bucket-787"><a href="#S3Bucket-787"><span class="linenos"> 787</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-788"><a href="#S3Bucket-788"><span class="linenos"> 788</span></a><span class="sd">            s3_bucket.download_object_to_path(&quot;my_folder/notes.txt&quot;, &quot;notes.txt&quot;)</span>
</span><span id="S3Bucket-789"><a href="#S3Bucket-789"><span class="linenos"> 789</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-790"><a href="#S3Bucket-790"><span class="linenos"> 790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-791"><a href="#S3Bucket-791"><span class="linenos"> 791</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-792"><a href="#S3Bucket-792"><span class="linenos"> 792</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket-793"><a href="#S3Bucket-793"><span class="linenos"> 793</span></a>
</span><span id="S3Bucket-794"><a href="#S3Bucket-794"><span class="linenos"> 794</span></a>        <span class="c1"># making path absolute, but converting back to str here</span>
</span><span id="S3Bucket-795"><a href="#S3Bucket-795"><span class="linenos"> 795</span></a>        <span class="c1"># since !r looks nicer that way and filename arg expects str</span>
</span><span id="S3Bucket-796"><a href="#S3Bucket-796"><span class="linenos"> 796</span></a>        <span class="n">to_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket-797"><a href="#S3Bucket-797"><span class="linenos"> 797</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket-798"><a href="#S3Bucket-798"><span class="linenos"> 798</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-799"><a href="#S3Bucket-799"><span class="linenos"> 799</span></a>
</span><span id="S3Bucket-800"><a href="#S3Bucket-800"><span class="linenos"> 800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="S3Bucket-801"><a href="#S3Bucket-801"><span class="linenos"> 801</span></a>            <span class="sa">f</span><span class="s2">&quot;Preparing to download object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket-802"><a href="#S3Bucket-802"><span class="linenos"> 802</span></a>            <span class="sa">f</span><span class="s2">&quot;path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-803"><a href="#S3Bucket-803"><span class="linenos"> 803</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-804"><a href="#S3Bucket-804"><span class="linenos"> 804</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-805"><a href="#S3Bucket-805"><span class="linenos"> 805</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">,</span>
</span><span id="S3Bucket-806"><a href="#S3Bucket-806"><span class="linenos"> 806</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-807"><a href="#S3Bucket-807"><span class="linenos"> 807</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">from_path</span><span class="p">,</span>
</span><span id="S3Bucket-808"><a href="#S3Bucket-808"><span class="linenos"> 808</span></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
</span><span id="S3Bucket-809"><a href="#S3Bucket-809"><span class="linenos"> 809</span></a>            <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-810"><a href="#S3Bucket-810"><span class="linenos"> 810</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-811"><a href="#S3Bucket-811"><span class="linenos"> 811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-812"><a href="#S3Bucket-812"><span class="linenos"> 812</span></a>            <span class="sa">f</span><span class="s2">&quot;Downloaded object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket-813"><a href="#S3Bucket-813"><span class="linenos"> 813</span></a>            <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-814"><a href="#S3Bucket-814"><span class="linenos"> 814</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-815"><a href="#S3Bucket-815"><span class="linenos"> 815</span></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span>
</span><span id="S3Bucket-816"><a href="#S3Bucket-816"><span class="linenos"> 816</span></a>
</span><span id="S3Bucket-817"><a href="#S3Bucket-817"><span class="linenos"> 817</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-818"><a href="#S3Bucket-818"><span class="linenos"> 818</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_object_to_file_object</span><span class="p">(</span>
</span><span id="S3Bucket-819"><a href="#S3Bucket-819"><span class="linenos"> 819</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-820"><a href="#S3Bucket-820"><span class="linenos"> 820</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket-821"><a href="#S3Bucket-821"><span class="linenos"> 821</span></a>        <span class="n">to_file_object</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span>
</span><span id="S3Bucket-822"><a href="#S3Bucket-822"><span class="linenos"> 822</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-823"><a href="#S3Bucket-823"><span class="linenos"> 823</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BinaryIO</span><span class="p">:</span>
</span><span id="S3Bucket-824"><a href="#S3Bucket-824"><span class="linenos"> 824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-825"><a href="#S3Bucket-825"><span class="linenos"> 825</span></a><span class="sd">        Downloads an object from the object storage service to a file-like object,</span>
</span><span id="S3Bucket-826"><a href="#S3Bucket-826"><span class="linenos"> 826</span></a><span class="sd">        which can be a BytesIO object or a BufferedWriter.</span>
</span><span id="S3Bucket-827"><a href="#S3Bucket-827"><span class="linenos"> 827</span></a>
</span><span id="S3Bucket-828"><a href="#S3Bucket-828"><span class="linenos"> 828</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-829"><a href="#S3Bucket-829"><span class="linenos"> 829</span></a><span class="sd">            from_path: The path to the object to download from; this gets prefixed</span>
</span><span id="S3Bucket-830"><a href="#S3Bucket-830"><span class="linenos"> 830</span></a><span class="sd">                with the bucket_folder.</span>
</span><span id="S3Bucket-831"><a href="#S3Bucket-831"><span class="linenos"> 831</span></a><span class="sd">            to_file_object: The file-like object to download the object to.</span>
</span><span id="S3Bucket-832"><a href="#S3Bucket-832"><span class="linenos"> 832</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-833"><a href="#S3Bucket-833"><span class="linenos"> 833</span></a><span class="sd">                `Client.download_fileobj`.</span>
</span><span id="S3Bucket-834"><a href="#S3Bucket-834"><span class="linenos"> 834</span></a>
</span><span id="S3Bucket-835"><a href="#S3Bucket-835"><span class="linenos"> 835</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-836"><a href="#S3Bucket-836"><span class="linenos"> 836</span></a><span class="sd">            The file-like object that the object was downloaded to.</span>
</span><span id="S3Bucket-837"><a href="#S3Bucket-837"><span class="linenos"> 837</span></a>
</span><span id="S3Bucket-838"><a href="#S3Bucket-838"><span class="linenos"> 838</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-839"><a href="#S3Bucket-839"><span class="linenos"> 839</span></a><span class="sd">            Download my_folder/notes.txt object to a BytesIO object.</span>
</span><span id="S3Bucket-840"><a href="#S3Bucket-840"><span class="linenos"> 840</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-841"><a href="#S3Bucket-841"><span class="linenos"> 841</span></a><span class="sd">            from io import BytesIO</span>
</span><span id="S3Bucket-842"><a href="#S3Bucket-842"><span class="linenos"> 842</span></a>
</span><span id="S3Bucket-843"><a href="#S3Bucket-843"><span class="linenos"> 843</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-844"><a href="#S3Bucket-844"><span class="linenos"> 844</span></a>
</span><span id="S3Bucket-845"><a href="#S3Bucket-845"><span class="linenos"> 845</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-846"><a href="#S3Bucket-846"><span class="linenos"> 846</span></a><span class="sd">            with BytesIO() as buf:</span>
</span><span id="S3Bucket-847"><a href="#S3Bucket-847"><span class="linenos"> 847</span></a><span class="sd">                s3_bucket.download_object_to_file_object(&quot;my_folder/notes.txt&quot;, buf)</span>
</span><span id="S3Bucket-848"><a href="#S3Bucket-848"><span class="linenos"> 848</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-849"><a href="#S3Bucket-849"><span class="linenos"> 849</span></a>
</span><span id="S3Bucket-850"><a href="#S3Bucket-850"><span class="linenos"> 850</span></a><span class="sd">            Download my_folder/notes.txt object to a BufferedWriter.</span>
</span><span id="S3Bucket-851"><a href="#S3Bucket-851"><span class="linenos"> 851</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-852"><a href="#S3Bucket-852"><span class="linenos"> 852</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-853"><a href="#S3Bucket-853"><span class="linenos"> 853</span></a>
</span><span id="S3Bucket-854"><a href="#S3Bucket-854"><span class="linenos"> 854</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-855"><a href="#S3Bucket-855"><span class="linenos"> 855</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;wb&quot;) as f:</span>
</span><span id="S3Bucket-856"><a href="#S3Bucket-856"><span class="linenos"> 856</span></a><span class="sd">                s3_bucket.download_object_to_file_object(&quot;my_folder/notes.txt&quot;, f)</span>
</span><span id="S3Bucket-857"><a href="#S3Bucket-857"><span class="linenos"> 857</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-858"><a href="#S3Bucket-858"><span class="linenos"> 858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-859"><a href="#S3Bucket-859"><span class="linenos"> 859</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-860"><a href="#S3Bucket-860"><span class="linenos"> 860</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket-861"><a href="#S3Bucket-861"><span class="linenos"> 861</span></a>
</span><span id="S3Bucket-862"><a href="#S3Bucket-862"><span class="linenos"> 862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="S3Bucket-863"><a href="#S3Bucket-863"><span class="linenos"> 863</span></a>            <span class="sa">f</span><span class="s2">&quot;Preparing to download object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket-864"><a href="#S3Bucket-864"><span class="linenos"> 864</span></a>            <span class="sa">f</span><span class="s2">&quot;path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> to file object.&quot;</span>
</span><span id="S3Bucket-865"><a href="#S3Bucket-865"><span class="linenos"> 865</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-866"><a href="#S3Bucket-866"><span class="linenos"> 866</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-867"><a href="#S3Bucket-867"><span class="linenos"> 867</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket-868"><a href="#S3Bucket-868"><span class="linenos"> 868</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-869"><a href="#S3Bucket-869"><span class="linenos"> 869</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-870"><a href="#S3Bucket-870"><span class="linenos"> 870</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">to_file_object</span><span class="p">,</span>
</span><span id="S3Bucket-871"><a href="#S3Bucket-871"><span class="linenos"> 871</span></a>            <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-872"><a href="#S3Bucket-872"><span class="linenos"> 872</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-873"><a href="#S3Bucket-873"><span class="linenos"> 873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-874"><a href="#S3Bucket-874"><span class="linenos"> 874</span></a>            <span class="sa">f</span><span class="s2">&quot;Downloaded object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket-875"><a href="#S3Bucket-875"><span class="linenos"> 875</span></a>            <span class="s2">&quot;to file object.&quot;</span>
</span><span id="S3Bucket-876"><a href="#S3Bucket-876"><span class="linenos"> 876</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-877"><a href="#S3Bucket-877"><span class="linenos"> 877</span></a>        <span class="k">return</span> <span class="n">to_file_object</span>
</span><span id="S3Bucket-878"><a href="#S3Bucket-878"><span class="linenos"> 878</span></a>
</span><span id="S3Bucket-879"><a href="#S3Bucket-879"><span class="linenos"> 879</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-880"><a href="#S3Bucket-880"><span class="linenos"> 880</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_folder_to_path</span><span class="p">(</span>
</span><span id="S3Bucket-881"><a href="#S3Bucket-881"><span class="linenos"> 881</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-882"><a href="#S3Bucket-882"><span class="linenos"> 882</span></a>        <span class="n">from_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket-883"><a href="#S3Bucket-883"><span class="linenos"> 883</span></a>        <span class="n">to_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-884"><a href="#S3Bucket-884"><span class="linenos"> 884</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-885"><a href="#S3Bucket-885"><span class="linenos"> 885</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="S3Bucket-886"><a href="#S3Bucket-886"><span class="linenos"> 886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-887"><a href="#S3Bucket-887"><span class="linenos"> 887</span></a><span class="sd">        Downloads objects *within* a folder (excluding the folder itself)</span>
</span><span id="S3Bucket-888"><a href="#S3Bucket-888"><span class="linenos"> 888</span></a><span class="sd">        from the S3 bucket to a folder.</span>
</span><span id="S3Bucket-889"><a href="#S3Bucket-889"><span class="linenos"> 889</span></a>
</span><span id="S3Bucket-890"><a href="#S3Bucket-890"><span class="linenos"> 890</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-891"><a href="#S3Bucket-891"><span class="linenos"> 891</span></a><span class="sd">            from_folder: The path to the folder to download from.</span>
</span><span id="S3Bucket-892"><a href="#S3Bucket-892"><span class="linenos"> 892</span></a><span class="sd">            to_folder: The path to download the folder to.</span>
</span><span id="S3Bucket-893"><a href="#S3Bucket-893"><span class="linenos"> 893</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-894"><a href="#S3Bucket-894"><span class="linenos"> 894</span></a><span class="sd">                `Client.download_file`.</span>
</span><span id="S3Bucket-895"><a href="#S3Bucket-895"><span class="linenos"> 895</span></a>
</span><span id="S3Bucket-896"><a href="#S3Bucket-896"><span class="linenos"> 896</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-897"><a href="#S3Bucket-897"><span class="linenos"> 897</span></a><span class="sd">            The absolute path that the folder was downloaded to.</span>
</span><span id="S3Bucket-898"><a href="#S3Bucket-898"><span class="linenos"> 898</span></a>
</span><span id="S3Bucket-899"><a href="#S3Bucket-899"><span class="linenos"> 899</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-900"><a href="#S3Bucket-900"><span class="linenos"> 900</span></a><span class="sd">            Download my_folder to a local folder named my_folder.</span>
</span><span id="S3Bucket-901"><a href="#S3Bucket-901"><span class="linenos"> 901</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-902"><a href="#S3Bucket-902"><span class="linenos"> 902</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-903"><a href="#S3Bucket-903"><span class="linenos"> 903</span></a>
</span><span id="S3Bucket-904"><a href="#S3Bucket-904"><span class="linenos"> 904</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-905"><a href="#S3Bucket-905"><span class="linenos"> 905</span></a><span class="sd">            s3_bucket.download_folder_to_path(&quot;my_folder&quot;, &quot;my_folder&quot;)</span>
</span><span id="S3Bucket-906"><a href="#S3Bucket-906"><span class="linenos"> 906</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-907"><a href="#S3Bucket-907"><span class="linenos"> 907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-908"><a href="#S3Bucket-908"><span class="linenos"> 908</span></a>        <span class="k">if</span> <span class="n">to_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-909"><a href="#S3Bucket-909"><span class="linenos"> 909</span></a>            <span class="n">to_folder</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="S3Bucket-910"><a href="#S3Bucket-910"><span class="linenos"> 910</span></a>        <span class="n">to_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_folder</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
</span><span id="S3Bucket-911"><a href="#S3Bucket-911"><span class="linenos"> 911</span></a>
</span><span id="S3Bucket-912"><a href="#S3Bucket-912"><span class="linenos"> 912</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-913"><a href="#S3Bucket-913"><span class="linenos"> 913</span></a>        <span class="n">objects</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket-914"><a href="#S3Bucket-914"><span class="linenos"> 914</span></a>
</span><span id="S3Bucket-915"><a href="#S3Bucket-915"><span class="linenos"> 915</span></a>        <span class="c1"># do not call self._join_bucket_folder for filter</span>
</span><span id="S3Bucket-916"><a href="#S3Bucket-916"><span class="linenos"> 916</span></a>        <span class="c1"># because it&#39;s built-in to that method already!</span>
</span><span id="S3Bucket-917"><a href="#S3Bucket-917"><span class="linenos"> 917</span></a>        <span class="c1"># however, we still need to do it because we&#39;re using relative_to</span>
</span><span id="S3Bucket-918"><a href="#S3Bucket-918"><span class="linenos"> 918</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket-919"><a href="#S3Bucket-919"><span class="linenos"> 919</span></a>
</span><span id="S3Bucket-920"><a href="#S3Bucket-920"><span class="linenos"> 920</span></a>        <span class="n">async_coros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="S3Bucket-921"><a href="#S3Bucket-921"><span class="linenos"> 921</span></a>        <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
</span><span id="S3Bucket-922"><a href="#S3Bucket-922"><span class="linenos"> 922</span></a>            <span class="n">bucket_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">object</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span>
</span><span id="S3Bucket-923"><a href="#S3Bucket-923"><span class="linenos"> 923</span></a>            <span class="c1"># this skips the actual directory itself, e.g.</span>
</span><span id="S3Bucket-924"><a href="#S3Bucket-924"><span class="linenos"> 924</span></a>            <span class="c1"># `my_folder/` will be skipped</span>
</span><span id="S3Bucket-925"><a href="#S3Bucket-925"><span class="linenos"> 925</span></a>            <span class="c1"># `my_folder/notes.txt` will be downloaded</span>
</span><span id="S3Bucket-926"><a href="#S3Bucket-926"><span class="linenos"> 926</span></a>            <span class="k">if</span> <span class="n">bucket_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket-927"><a href="#S3Bucket-927"><span class="linenos"> 927</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket-928"><a href="#S3Bucket-928"><span class="linenos"> 928</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">to_folder</span> <span class="o">/</span> <span class="n">bucket_path</span>
</span><span id="S3Bucket-929"><a href="#S3Bucket-929"><span class="linenos"> 929</span></a>            <span class="n">to_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="S3Bucket-930"><a href="#S3Bucket-930"><span class="linenos"> 930</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span>  <span class="c1"># must be string</span>
</span><span id="S3Bucket-931"><a href="#S3Bucket-931"><span class="linenos"> 931</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-932"><a href="#S3Bucket-932"><span class="linenos"> 932</span></a>                <span class="sa">f</span><span class="s2">&quot;Downloading object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path &quot;</span>
</span><span id="S3Bucket-933"><a href="#S3Bucket-933"><span class="linenos"> 933</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bucket_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-934"><a href="#S3Bucket-934"><span class="linenos"> 934</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-935"><a href="#S3Bucket-935"><span class="linenos"> 935</span></a>            <span class="n">async_coros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="S3Bucket-936"><a href="#S3Bucket-936"><span class="linenos"> 936</span></a>                <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-937"><a href="#S3Bucket-937"><span class="linenos"> 937</span></a>                    <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">,</span>
</span><span id="S3Bucket-938"><a href="#S3Bucket-938"><span class="linenos"> 938</span></a>                    <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-939"><a href="#S3Bucket-939"><span class="linenos"> 939</span></a>                    <span class="n">Key</span><span class="o">=</span><span class="nb">object</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">],</span>
</span><span id="S3Bucket-940"><a href="#S3Bucket-940"><span class="linenos"> 940</span></a>                    <span class="n">Filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
</span><span id="S3Bucket-941"><a href="#S3Bucket-941"><span class="linenos"> 941</span></a>                    <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-942"><a href="#S3Bucket-942"><span class="linenos"> 942</span></a>                <span class="p">)</span>
</span><span id="S3Bucket-943"><a href="#S3Bucket-943"><span class="linenos"> 943</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-944"><a href="#S3Bucket-944"><span class="linenos"> 944</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">async_coros</span><span class="p">)</span>
</span><span id="S3Bucket-945"><a href="#S3Bucket-945"><span class="linenos"> 945</span></a>
</span><span id="S3Bucket-946"><a href="#S3Bucket-946"><span class="linenos"> 946</span></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_folder</span><span class="p">)</span>
</span><span id="S3Bucket-947"><a href="#S3Bucket-947"><span class="linenos"> 947</span></a>
</span><span id="S3Bucket-948"><a href="#S3Bucket-948"><span class="linenos"> 948</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-949"><a href="#S3Bucket-949"><span class="linenos"> 949</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">stream_from</span><span class="p">(</span>
</span><span id="S3Bucket-950"><a href="#S3Bucket-950"><span class="linenos"> 950</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-951"><a href="#S3Bucket-951"><span class="linenos"> 951</span></a>        <span class="n">bucket</span><span class="p">:</span> <span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-952"><a href="#S3Bucket-952"><span class="linenos"> 952</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket-953"><a href="#S3Bucket-953"><span class="linenos"> 953</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-954"><a href="#S3Bucket-954"><span class="linenos"> 954</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-955"><a href="#S3Bucket-955"><span class="linenos"> 955</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-956"><a href="#S3Bucket-956"><span class="linenos"> 956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Streams an object from another bucket to this bucket. Requires the</span>
</span><span id="S3Bucket-957"><a href="#S3Bucket-957"><span class="linenos"> 957</span></a><span class="sd">        object to be downloaded and uploaded in chunks. If `self`&#39;s credentials</span>
</span><span id="S3Bucket-958"><a href="#S3Bucket-958"><span class="linenos"> 958</span></a><span class="sd">        allow for writes to the other bucket, try using `S3Bucket.copy_object`.</span>
</span><span id="S3Bucket-959"><a href="#S3Bucket-959"><span class="linenos"> 959</span></a>
</span><span id="S3Bucket-960"><a href="#S3Bucket-960"><span class="linenos"> 960</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-961"><a href="#S3Bucket-961"><span class="linenos"> 961</span></a><span class="sd">            bucket: The bucket to stream from.</span>
</span><span id="S3Bucket-962"><a href="#S3Bucket-962"><span class="linenos"> 962</span></a><span class="sd">            from_path: The path of the object to stream.</span>
</span><span id="S3Bucket-963"><a href="#S3Bucket-963"><span class="linenos"> 963</span></a><span class="sd">            to_path: The path to stream the object to. Defaults to the object&#39;s name.</span>
</span><span id="S3Bucket-964"><a href="#S3Bucket-964"><span class="linenos"> 964</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-965"><a href="#S3Bucket-965"><span class="linenos"> 965</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket-966"><a href="#S3Bucket-966"><span class="linenos"> 966</span></a>
</span><span id="S3Bucket-967"><a href="#S3Bucket-967"><span class="linenos"> 967</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-968"><a href="#S3Bucket-968"><span class="linenos"> 968</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket-969"><a href="#S3Bucket-969"><span class="linenos"> 969</span></a>
</span><span id="S3Bucket-970"><a href="#S3Bucket-970"><span class="linenos"> 970</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-971"><a href="#S3Bucket-971"><span class="linenos"> 971</span></a><span class="sd">            Stream notes.txt from your-bucket/notes.txt to my-bucket/landed/notes.txt.</span>
</span><span id="S3Bucket-972"><a href="#S3Bucket-972"><span class="linenos"> 972</span></a>
</span><span id="S3Bucket-973"><a href="#S3Bucket-973"><span class="linenos"> 973</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-974"><a href="#S3Bucket-974"><span class="linenos"> 974</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-975"><a href="#S3Bucket-975"><span class="linenos"> 975</span></a>
</span><span id="S3Bucket-976"><a href="#S3Bucket-976"><span class="linenos"> 976</span></a><span class="sd">            your_s3_bucket = S3Bucket.load(&quot;your-bucket&quot;)</span>
</span><span id="S3Bucket-977"><a href="#S3Bucket-977"><span class="linenos"> 977</span></a><span class="sd">            my_s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-978"><a href="#S3Bucket-978"><span class="linenos"> 978</span></a>
</span><span id="S3Bucket-979"><a href="#S3Bucket-979"><span class="linenos"> 979</span></a><span class="sd">            my_s3_bucket.stream_from(</span>
</span><span id="S3Bucket-980"><a href="#S3Bucket-980"><span class="linenos"> 980</span></a><span class="sd">                your_s3_bucket,</span>
</span><span id="S3Bucket-981"><a href="#S3Bucket-981"><span class="linenos"> 981</span></a><span class="sd">                &quot;notes.txt&quot;,</span>
</span><span id="S3Bucket-982"><a href="#S3Bucket-982"><span class="linenos"> 982</span></a><span class="sd">                to_path=&quot;landed/notes.txt&quot;</span>
</span><span id="S3Bucket-983"><a href="#S3Bucket-983"><span class="linenos"> 983</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-984"><a href="#S3Bucket-984"><span class="linenos"> 984</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-985"><a href="#S3Bucket-985"><span class="linenos"> 985</span></a>
</span><span id="S3Bucket-986"><a href="#S3Bucket-986"><span class="linenos"> 986</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-987"><a href="#S3Bucket-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-988"><a href="#S3Bucket-988"><span class="linenos"> 988</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket-989"><a href="#S3Bucket-989"><span class="linenos"> 989</span></a>
</span><span id="S3Bucket-990"><a href="#S3Bucket-990"><span class="linenos"> 990</span></a>        <span class="c1"># Get the source object&#39;s StreamingBody</span>
</span><span id="S3Bucket-991"><a href="#S3Bucket-991"><span class="linenos"> 991</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket-992"><a href="#S3Bucket-992"><span class="linenos"> 992</span></a>        <span class="n">from_client</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-993"><a href="#S3Bucket-993"><span class="linenos"> 993</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-994"><a href="#S3Bucket-994"><span class="linenos"> 994</span></a>            <span class="n">from_client</span><span class="o">.</span><span class="n">get_object</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">from_path</span>
</span><span id="S3Bucket-995"><a href="#S3Bucket-995"><span class="linenos"> 995</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-996"><a href="#S3Bucket-996"><span class="linenos"> 996</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">StreamingBody</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span>
</span><span id="S3Bucket-997"><a href="#S3Bucket-997"><span class="linenos"> 997</span></a>
</span><span id="S3Bucket-998"><a href="#S3Bucket-998"><span class="linenos"> 998</span></a>        <span class="c1"># Upload the StreamingBody to this bucket</span>
</span><span id="S3Bucket-999"><a href="#S3Bucket-999"><span class="linenos"> 999</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket-1000"><a href="#S3Bucket-1000"><span class="linenos">1000</span></a>        <span class="n">to_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1001"><a href="#S3Bucket-1001"><span class="linenos">1001</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-1002"><a href="#S3Bucket-1002"><span class="linenos">1002</span></a>            <span class="n">to_client</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket-1003"><a href="#S3Bucket-1003"><span class="linenos">1003</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
</span><span id="S3Bucket-1004"><a href="#S3Bucket-1004"><span class="linenos">1004</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1005"><a href="#S3Bucket-1005"><span class="linenos">1005</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-1006"><a href="#S3Bucket-1006"><span class="linenos">1006</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1007"><a href="#S3Bucket-1007"><span class="linenos">1007</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1008"><a href="#S3Bucket-1008"><span class="linenos">1008</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1009"><a href="#S3Bucket-1009"><span class="linenos">1009</span></a>            <span class="sa">f</span><span class="s2">&quot;Streamed s3://</span><span class="si">{</span><span class="n">bucket</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">from_path</span><span class="si">}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket-1010"><a href="#S3Bucket-1010"><span class="linenos">1010</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-1011"><a href="#S3Bucket-1011"><span class="linenos">1011</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1012"><a href="#S3Bucket-1012"><span class="linenos">1012</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span><span id="S3Bucket-1013"><a href="#S3Bucket-1013"><span class="linenos">1013</span></a>
</span><span id="S3Bucket-1014"><a href="#S3Bucket-1014"><span class="linenos">1014</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-1015"><a href="#S3Bucket-1015"><span class="linenos">1015</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_path</span><span class="p">(</span>
</span><span id="S3Bucket-1016"><a href="#S3Bucket-1016"><span class="linenos">1016</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-1017"><a href="#S3Bucket-1017"><span class="linenos">1017</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1018"><a href="#S3Bucket-1018"><span class="linenos">1018</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-1019"><a href="#S3Bucket-1019"><span class="linenos">1019</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-1020"><a href="#S3Bucket-1020"><span class="linenos">1020</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-1021"><a href="#S3Bucket-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-1022"><a href="#S3Bucket-1022"><span class="linenos">1022</span></a><span class="sd">        Uploads an object from a path to the S3 bucket.</span>
</span><span id="S3Bucket-1023"><a href="#S3Bucket-1023"><span class="linenos">1023</span></a>
</span><span id="S3Bucket-1024"><a href="#S3Bucket-1024"><span class="linenos">1024</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-1025"><a href="#S3Bucket-1025"><span class="linenos">1025</span></a><span class="sd">            from_path: The path to the file to upload from.</span>
</span><span id="S3Bucket-1026"><a href="#S3Bucket-1026"><span class="linenos">1026</span></a><span class="sd">            to_path: The path to upload the file to.</span>
</span><span id="S3Bucket-1027"><a href="#S3Bucket-1027"><span class="linenos">1027</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to `Client.upload`.</span>
</span><span id="S3Bucket-1028"><a href="#S3Bucket-1028"><span class="linenos">1028</span></a>
</span><span id="S3Bucket-1029"><a href="#S3Bucket-1029"><span class="linenos">1029</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-1030"><a href="#S3Bucket-1030"><span class="linenos">1030</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket-1031"><a href="#S3Bucket-1031"><span class="linenos">1031</span></a>
</span><span id="S3Bucket-1032"><a href="#S3Bucket-1032"><span class="linenos">1032</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-1033"><a href="#S3Bucket-1033"><span class="linenos">1033</span></a><span class="sd">            Upload notes.txt to my_folder/notes.txt.</span>
</span><span id="S3Bucket-1034"><a href="#S3Bucket-1034"><span class="linenos">1034</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1035"><a href="#S3Bucket-1035"><span class="linenos">1035</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1036"><a href="#S3Bucket-1036"><span class="linenos">1036</span></a>
</span><span id="S3Bucket-1037"><a href="#S3Bucket-1037"><span class="linenos">1037</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1038"><a href="#S3Bucket-1038"><span class="linenos">1038</span></a><span class="sd">            s3_bucket.upload_from_path(&quot;notes.txt&quot;, &quot;my_folder/notes.txt&quot;)</span>
</span><span id="S3Bucket-1039"><a href="#S3Bucket-1039"><span class="linenos">1039</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1040"><a href="#S3Bucket-1040"><span class="linenos">1040</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-1041"><a href="#S3Bucket-1041"><span class="linenos">1041</span></a>        <span class="n">from_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket-1042"><a href="#S3Bucket-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket-1043"><a href="#S3Bucket-1043"><span class="linenos">1043</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket-1044"><a href="#S3Bucket-1044"><span class="linenos">1044</span></a>
</span><span id="S3Bucket-1045"><a href="#S3Bucket-1045"><span class="linenos">1045</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket-1046"><a href="#S3Bucket-1046"><span class="linenos">1046</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1047"><a href="#S3Bucket-1047"><span class="linenos">1047</span></a>
</span><span id="S3Bucket-1048"><a href="#S3Bucket-1048"><span class="linenos">1048</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-1049"><a href="#S3Bucket-1049"><span class="linenos">1049</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">,</span>
</span><span id="S3Bucket-1050"><a href="#S3Bucket-1050"><span class="linenos">1050</span></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">from_path</span><span class="p">,</span>
</span><span id="S3Bucket-1051"><a href="#S3Bucket-1051"><span class="linenos">1051</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1052"><a href="#S3Bucket-1052"><span class="linenos">1052</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-1053"><a href="#S3Bucket-1053"><span class="linenos">1053</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1054"><a href="#S3Bucket-1054"><span class="linenos">1054</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1055"><a href="#S3Bucket-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1056"><a href="#S3Bucket-1056"><span class="linenos">1056</span></a>            <span class="sa">f</span><span class="s2">&quot;Uploaded from </span><span class="si">{</span><span class="n">from_path</span><span class="si">!r}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket-1057"><a href="#S3Bucket-1057"><span class="linenos">1057</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-1058"><a href="#S3Bucket-1058"><span class="linenos">1058</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1059"><a href="#S3Bucket-1059"><span class="linenos">1059</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span><span id="S3Bucket-1060"><a href="#S3Bucket-1060"><span class="linenos">1060</span></a>
</span><span id="S3Bucket-1061"><a href="#S3Bucket-1061"><span class="linenos">1061</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-1062"><a href="#S3Bucket-1062"><span class="linenos">1062</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_file_object</span><span class="p">(</span>
</span><span id="S3Bucket-1063"><a href="#S3Bucket-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">from_file_object</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">to_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="S3Bucket-1064"><a href="#S3Bucket-1064"><span class="linenos">1064</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-1065"><a href="#S3Bucket-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-1066"><a href="#S3Bucket-1066"><span class="linenos">1066</span></a><span class="sd">        Uploads an object to the S3 bucket from a file-like object,</span>
</span><span id="S3Bucket-1067"><a href="#S3Bucket-1067"><span class="linenos">1067</span></a><span class="sd">        which can be a BytesIO object or a BufferedReader.</span>
</span><span id="S3Bucket-1068"><a href="#S3Bucket-1068"><span class="linenos">1068</span></a>
</span><span id="S3Bucket-1069"><a href="#S3Bucket-1069"><span class="linenos">1069</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-1070"><a href="#S3Bucket-1070"><span class="linenos">1070</span></a><span class="sd">            from_file_object: The file-like object to upload from.</span>
</span><span id="S3Bucket-1071"><a href="#S3Bucket-1071"><span class="linenos">1071</span></a><span class="sd">            to_path: The path to upload the object to.</span>
</span><span id="S3Bucket-1072"><a href="#S3Bucket-1072"><span class="linenos">1072</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-1073"><a href="#S3Bucket-1073"><span class="linenos">1073</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket-1074"><a href="#S3Bucket-1074"><span class="linenos">1074</span></a>
</span><span id="S3Bucket-1075"><a href="#S3Bucket-1075"><span class="linenos">1075</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-1076"><a href="#S3Bucket-1076"><span class="linenos">1076</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket-1077"><a href="#S3Bucket-1077"><span class="linenos">1077</span></a>
</span><span id="S3Bucket-1078"><a href="#S3Bucket-1078"><span class="linenos">1078</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-1079"><a href="#S3Bucket-1079"><span class="linenos">1079</span></a><span class="sd">            Upload BytesIO object to my_folder/notes.txt.</span>
</span><span id="S3Bucket-1080"><a href="#S3Bucket-1080"><span class="linenos">1080</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1081"><a href="#S3Bucket-1081"><span class="linenos">1081</span></a><span class="sd">            from io import BytesIO</span>
</span><span id="S3Bucket-1082"><a href="#S3Bucket-1082"><span class="linenos">1082</span></a>
</span><span id="S3Bucket-1083"><a href="#S3Bucket-1083"><span class="linenos">1083</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1084"><a href="#S3Bucket-1084"><span class="linenos">1084</span></a>
</span><span id="S3Bucket-1085"><a href="#S3Bucket-1085"><span class="linenos">1085</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1086"><a href="#S3Bucket-1086"><span class="linenos">1086</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;rb&quot;) as f:</span>
</span><span id="S3Bucket-1087"><a href="#S3Bucket-1087"><span class="linenos">1087</span></a><span class="sd">                s3_bucket.upload_from_file_object(f, &quot;my_folder/notes.txt&quot;)</span>
</span><span id="S3Bucket-1088"><a href="#S3Bucket-1088"><span class="linenos">1088</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1089"><a href="#S3Bucket-1089"><span class="linenos">1089</span></a>
</span><span id="S3Bucket-1090"><a href="#S3Bucket-1090"><span class="linenos">1090</span></a><span class="sd">            Upload BufferedReader object to my_folder/notes.txt.</span>
</span><span id="S3Bucket-1091"><a href="#S3Bucket-1091"><span class="linenos">1091</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1092"><a href="#S3Bucket-1092"><span class="linenos">1092</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1093"><a href="#S3Bucket-1093"><span class="linenos">1093</span></a>
</span><span id="S3Bucket-1094"><a href="#S3Bucket-1094"><span class="linenos">1094</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1095"><a href="#S3Bucket-1095"><span class="linenos">1095</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;rb&quot;) as f:</span>
</span><span id="S3Bucket-1096"><a href="#S3Bucket-1096"><span class="linenos">1096</span></a><span class="sd">                s3_bucket.upload_from_file_object(</span>
</span><span id="S3Bucket-1097"><a href="#S3Bucket-1097"><span class="linenos">1097</span></a><span class="sd">                    f, &quot;my_folder/notes.txt&quot;</span>
</span><span id="S3Bucket-1098"><a href="#S3Bucket-1098"><span class="linenos">1098</span></a><span class="sd">                )</span>
</span><span id="S3Bucket-1099"><a href="#S3Bucket-1099"><span class="linenos">1099</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1100"><a href="#S3Bucket-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-1101"><a href="#S3Bucket-1101"><span class="linenos">1101</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket-1102"><a href="#S3Bucket-1102"><span class="linenos">1102</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1103"><a href="#S3Bucket-1103"><span class="linenos">1103</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-1104"><a href="#S3Bucket-1104"><span class="linenos">1104</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket-1105"><a href="#S3Bucket-1105"><span class="linenos">1105</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">from_file_object</span><span class="p">,</span>
</span><span id="S3Bucket-1106"><a href="#S3Bucket-1106"><span class="linenos">1106</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1107"><a href="#S3Bucket-1107"><span class="linenos">1107</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-1108"><a href="#S3Bucket-1108"><span class="linenos">1108</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1109"><a href="#S3Bucket-1109"><span class="linenos">1109</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1110"><a href="#S3Bucket-1110"><span class="linenos">1110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1111"><a href="#S3Bucket-1111"><span class="linenos">1111</span></a>            <span class="s2">&quot;Uploaded from file object to the bucket &quot;</span>
</span><span id="S3Bucket-1112"><a href="#S3Bucket-1112"><span class="linenos">1112</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-1113"><a href="#S3Bucket-1113"><span class="linenos">1113</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1114"><a href="#S3Bucket-1114"><span class="linenos">1114</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span><span id="S3Bucket-1115"><a href="#S3Bucket-1115"><span class="linenos">1115</span></a>
</span><span id="S3Bucket-1116"><a href="#S3Bucket-1116"><span class="linenos">1116</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-1117"><a href="#S3Bucket-1117"><span class="linenos">1117</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_folder</span><span class="p">(</span>
</span><span id="S3Bucket-1118"><a href="#S3Bucket-1118"><span class="linenos">1118</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-1119"><a href="#S3Bucket-1119"><span class="linenos">1119</span></a>        <span class="n">from_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1120"><a href="#S3Bucket-1120"><span class="linenos">1120</span></a>        <span class="n">to_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-1121"><a href="#S3Bucket-1121"><span class="linenos">1121</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket-1122"><a href="#S3Bucket-1122"><span class="linenos">1122</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-1123"><a href="#S3Bucket-1123"><span class="linenos">1123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket-1124"><a href="#S3Bucket-1124"><span class="linenos">1124</span></a><span class="sd">        Uploads files *within* a folder (excluding the folder itself)</span>
</span><span id="S3Bucket-1125"><a href="#S3Bucket-1125"><span class="linenos">1125</span></a><span class="sd">        to the object storage service folder.</span>
</span><span id="S3Bucket-1126"><a href="#S3Bucket-1126"><span class="linenos">1126</span></a>
</span><span id="S3Bucket-1127"><a href="#S3Bucket-1127"><span class="linenos">1127</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-1128"><a href="#S3Bucket-1128"><span class="linenos">1128</span></a><span class="sd">            from_folder: The path to the folder to upload from.</span>
</span><span id="S3Bucket-1129"><a href="#S3Bucket-1129"><span class="linenos">1129</span></a><span class="sd">            to_folder: The path to upload the folder to.</span>
</span><span id="S3Bucket-1130"><a href="#S3Bucket-1130"><span class="linenos">1130</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-1131"><a href="#S3Bucket-1131"><span class="linenos">1131</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket-1132"><a href="#S3Bucket-1132"><span class="linenos">1132</span></a>
</span><span id="S3Bucket-1133"><a href="#S3Bucket-1133"><span class="linenos">1133</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-1134"><a href="#S3Bucket-1134"><span class="linenos">1134</span></a><span class="sd">            The path that the folder was uploaded to.</span>
</span><span id="S3Bucket-1135"><a href="#S3Bucket-1135"><span class="linenos">1135</span></a>
</span><span id="S3Bucket-1136"><a href="#S3Bucket-1136"><span class="linenos">1136</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-1137"><a href="#S3Bucket-1137"><span class="linenos">1137</span></a><span class="sd">            Upload contents from my_folder to new_folder.</span>
</span><span id="S3Bucket-1138"><a href="#S3Bucket-1138"><span class="linenos">1138</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1139"><a href="#S3Bucket-1139"><span class="linenos">1139</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1140"><a href="#S3Bucket-1140"><span class="linenos">1140</span></a>
</span><span id="S3Bucket-1141"><a href="#S3Bucket-1141"><span class="linenos">1141</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1142"><a href="#S3Bucket-1142"><span class="linenos">1142</span></a><span class="sd">            s3_bucket.upload_from_folder(&quot;my_folder&quot;, &quot;new_folder&quot;)</span>
</span><span id="S3Bucket-1143"><a href="#S3Bucket-1143"><span class="linenos">1143</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1144"><a href="#S3Bucket-1144"><span class="linenos">1144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-1145"><a href="#S3Bucket-1145"><span class="linenos">1145</span></a>        <span class="n">from_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket-1146"><a href="#S3Bucket-1146"><span class="linenos">1146</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_folder</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-1147"><a href="#S3Bucket-1147"><span class="linenos">1147</span></a>
</span><span id="S3Bucket-1148"><a href="#S3Bucket-1148"><span class="linenos">1148</span></a>        <span class="n">num_uploaded</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="S3Bucket-1149"><a href="#S3Bucket-1149"><span class="linenos">1149</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1150"><a href="#S3Bucket-1150"><span class="linenos">1150</span></a>
</span><span id="S3Bucket-1151"><a href="#S3Bucket-1151"><span class="linenos">1151</span></a>        <span class="n">async_coros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="S3Bucket-1152"><a href="#S3Bucket-1152"><span class="linenos">1152</span></a>        <span class="k">for</span> <span class="n">from_path</span> <span class="ow">in</span> <span class="n">from_folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">):</span>
</span><span id="S3Bucket-1153"><a href="#S3Bucket-1153"><span class="linenos">1153</span></a>            <span class="c1"># this skips the actual directory itself, e.g.</span>
</span><span id="S3Bucket-1154"><a href="#S3Bucket-1154"><span class="linenos">1154</span></a>            <span class="c1"># `my_folder/` will be skipped</span>
</span><span id="S3Bucket-1155"><a href="#S3Bucket-1155"><span class="linenos">1155</span></a>            <span class="c1"># `my_folder/notes.txt` will be uploaded</span>
</span><span id="S3Bucket-1156"><a href="#S3Bucket-1156"><span class="linenos">1156</span></a>            <span class="k">if</span> <span class="n">from_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket-1157"><a href="#S3Bucket-1157"><span class="linenos">1157</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket-1158"><a href="#S3Bucket-1158"><span class="linenos">1158</span></a>            <span class="n">bucket_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="S3Bucket-1159"><a href="#S3Bucket-1159"><span class="linenos">1159</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">from_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket-1160"><a href="#S3Bucket-1160"><span class="linenos">1160</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket-1161"><a href="#S3Bucket-1161"><span class="linenos">1161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1162"><a href="#S3Bucket-1162"><span class="linenos">1162</span></a>                <span class="sa">f</span><span class="s2">&quot;Uploading from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket-1163"><a href="#S3Bucket-1163"><span class="linenos">1163</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket-1164"><a href="#S3Bucket-1164"><span class="linenos">1164</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-1165"><a href="#S3Bucket-1165"><span class="linenos">1165</span></a>            <span class="n">async_coros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="S3Bucket-1166"><a href="#S3Bucket-1166"><span class="linenos">1166</span></a>                <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket-1167"><a href="#S3Bucket-1167"><span class="linenos">1167</span></a>                    <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">,</span>
</span><span id="S3Bucket-1168"><a href="#S3Bucket-1168"><span class="linenos">1168</span></a>                    <span class="n">Filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">from_path</span><span class="p">),</span>
</span><span id="S3Bucket-1169"><a href="#S3Bucket-1169"><span class="linenos">1169</span></a>                    <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1170"><a href="#S3Bucket-1170"><span class="linenos">1170</span></a>                    <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket-1171"><a href="#S3Bucket-1171"><span class="linenos">1171</span></a>                    <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1172"><a href="#S3Bucket-1172"><span class="linenos">1172</span></a>                <span class="p">)</span>
</span><span id="S3Bucket-1173"><a href="#S3Bucket-1173"><span class="linenos">1173</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-1174"><a href="#S3Bucket-1174"><span class="linenos">1174</span></a>            <span class="n">num_uploaded</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="S3Bucket-1175"><a href="#S3Bucket-1175"><span class="linenos">1175</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">async_coros</span><span class="p">)</span>
</span><span id="S3Bucket-1176"><a href="#S3Bucket-1176"><span class="linenos">1176</span></a>
</span><span id="S3Bucket-1177"><a href="#S3Bucket-1177"><span class="linenos">1177</span></a>        <span class="k">if</span> <span class="n">num_uploaded</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="S3Bucket-1178"><a href="#S3Bucket-1178"><span class="linenos">1178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files were uploaded from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="S3Bucket-1179"><a href="#S3Bucket-1179"><span class="linenos">1179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket-1180"><a href="#S3Bucket-1180"><span class="linenos">1180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1181"><a href="#S3Bucket-1181"><span class="linenos">1181</span></a>                <span class="sa">f</span><span class="s2">&quot;Uploaded </span><span class="si">{</span><span class="n">num_uploaded</span><span class="si">}</span><span class="s2"> files from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> to &quot;</span>
</span><span id="S3Bucket-1182"><a href="#S3Bucket-1182"><span class="linenos">1182</span></a>                <span class="sa">f</span><span class="s2">&quot;the bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket-1183"><a href="#S3Bucket-1183"><span class="linenos">1183</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-1184"><a href="#S3Bucket-1184"><span class="linenos">1184</span></a>
</span><span id="S3Bucket-1185"><a href="#S3Bucket-1185"><span class="linenos">1185</span></a>        <span class="k">return</span> <span class="n">to_folder</span>
</span><span id="S3Bucket-1186"><a href="#S3Bucket-1186"><span class="linenos">1186</span></a>
</span><span id="S3Bucket-1187"><a href="#S3Bucket-1187"><span class="linenos">1187</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-1188"><a href="#S3Bucket-1188"><span class="linenos">1188</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span>
</span><span id="S3Bucket-1189"><a href="#S3Bucket-1189"><span class="linenos">1189</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-1190"><a href="#S3Bucket-1190"><span class="linenos">1190</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1191"><a href="#S3Bucket-1191"><span class="linenos">1191</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1192"><a href="#S3Bucket-1192"><span class="linenos">1192</span></a>        <span class="n">to_bucket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-1193"><a href="#S3Bucket-1193"><span class="linenos">1193</span></a>        <span class="o">**</span><span class="n">copy_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1194"><a href="#S3Bucket-1194"><span class="linenos">1194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-1195"><a href="#S3Bucket-1195"><span class="linenos">1195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses S3&#39;s internal</span>
</span><span id="S3Bucket-1196"><a href="#S3Bucket-1196"><span class="linenos">1196</span></a><span class="sd">        [CopyObject](https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html)</span>
</span><span id="S3Bucket-1197"><a href="#S3Bucket-1197"><span class="linenos">1197</span></a><span class="sd">        to copy objects within or between buckets. To copy objects between buckets,</span>
</span><span id="S3Bucket-1198"><a href="#S3Bucket-1198"><span class="linenos">1198</span></a><span class="sd">        `self`&#39;s credentials must have permission to read the source object and write</span>
</span><span id="S3Bucket-1199"><a href="#S3Bucket-1199"><span class="linenos">1199</span></a><span class="sd">        to the target object. If the credentials do not have those permissions, try</span>
</span><span id="S3Bucket-1200"><a href="#S3Bucket-1200"><span class="linenos">1200</span></a><span class="sd">        using `S3Bucket.stream_from`.</span>
</span><span id="S3Bucket-1201"><a href="#S3Bucket-1201"><span class="linenos">1201</span></a>
</span><span id="S3Bucket-1202"><a href="#S3Bucket-1202"><span class="linenos">1202</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-1203"><a href="#S3Bucket-1203"><span class="linenos">1203</span></a><span class="sd">            from_path: The path of the object to copy.</span>
</span><span id="S3Bucket-1204"><a href="#S3Bucket-1204"><span class="linenos">1204</span></a><span class="sd">            to_path: The path to copy the object to.</span>
</span><span id="S3Bucket-1205"><a href="#S3Bucket-1205"><span class="linenos">1205</span></a><span class="sd">            to_bucket: The bucket to copy to. Defaults to the current bucket.</span>
</span><span id="S3Bucket-1206"><a href="#S3Bucket-1206"><span class="linenos">1206</span></a><span class="sd">            **copy_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket-1207"><a href="#S3Bucket-1207"><span class="linenos">1207</span></a><span class="sd">                `S3Client.copy_object`.</span>
</span><span id="S3Bucket-1208"><a href="#S3Bucket-1208"><span class="linenos">1208</span></a>
</span><span id="S3Bucket-1209"><a href="#S3Bucket-1209"><span class="linenos">1209</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-1210"><a href="#S3Bucket-1210"><span class="linenos">1210</span></a><span class="sd">            The path that the object was copied to. Excludes the bucket name.</span>
</span><span id="S3Bucket-1211"><a href="#S3Bucket-1211"><span class="linenos">1211</span></a>
</span><span id="S3Bucket-1212"><a href="#S3Bucket-1212"><span class="linenos">1212</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-1213"><a href="#S3Bucket-1213"><span class="linenos">1213</span></a>
</span><span id="S3Bucket-1214"><a href="#S3Bucket-1214"><span class="linenos">1214</span></a><span class="sd">            Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.</span>
</span><span id="S3Bucket-1215"><a href="#S3Bucket-1215"><span class="linenos">1215</span></a>
</span><span id="S3Bucket-1216"><a href="#S3Bucket-1216"><span class="linenos">1216</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1217"><a href="#S3Bucket-1217"><span class="linenos">1217</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1218"><a href="#S3Bucket-1218"><span class="linenos">1218</span></a>
</span><span id="S3Bucket-1219"><a href="#S3Bucket-1219"><span class="linenos">1219</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1220"><a href="#S3Bucket-1220"><span class="linenos">1220</span></a><span class="sd">            s3_bucket.copy_object(&quot;my_folder/notes.txt&quot;, &quot;my_folder/notes_copy.txt&quot;)</span>
</span><span id="S3Bucket-1221"><a href="#S3Bucket-1221"><span class="linenos">1221</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1222"><a href="#S3Bucket-1222"><span class="linenos">1222</span></a>
</span><span id="S3Bucket-1223"><a href="#S3Bucket-1223"><span class="linenos">1223</span></a><span class="sd">            Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in</span>
</span><span id="S3Bucket-1224"><a href="#S3Bucket-1224"><span class="linenos">1224</span></a><span class="sd">            another bucket.</span>
</span><span id="S3Bucket-1225"><a href="#S3Bucket-1225"><span class="linenos">1225</span></a>
</span><span id="S3Bucket-1226"><a href="#S3Bucket-1226"><span class="linenos">1226</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1227"><a href="#S3Bucket-1227"><span class="linenos">1227</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1228"><a href="#S3Bucket-1228"><span class="linenos">1228</span></a>
</span><span id="S3Bucket-1229"><a href="#S3Bucket-1229"><span class="linenos">1229</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1230"><a href="#S3Bucket-1230"><span class="linenos">1230</span></a><span class="sd">            s3_bucket.copy_object(</span>
</span><span id="S3Bucket-1231"><a href="#S3Bucket-1231"><span class="linenos">1231</span></a><span class="sd">                &quot;my_folder/notes.txt&quot;,</span>
</span><span id="S3Bucket-1232"><a href="#S3Bucket-1232"><span class="linenos">1232</span></a><span class="sd">                &quot;my_folder/notes_copy.txt&quot;,</span>
</span><span id="S3Bucket-1233"><a href="#S3Bucket-1233"><span class="linenos">1233</span></a><span class="sd">                to_bucket=&quot;other-bucket&quot;</span>
</span><span id="S3Bucket-1234"><a href="#S3Bucket-1234"><span class="linenos">1234</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-1235"><a href="#S3Bucket-1235"><span class="linenos">1235</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1236"><a href="#S3Bucket-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-1237"><a href="#S3Bucket-1237"><span class="linenos">1237</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1238"><a href="#S3Bucket-1238"><span class="linenos">1238</span></a>
</span><span id="S3Bucket-1239"><a href="#S3Bucket-1239"><span class="linenos">1239</span></a>        <span class="n">source_bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket-1240"><a href="#S3Bucket-1240"><span class="linenos">1240</span></a>        <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket-1241"><a href="#S3Bucket-1241"><span class="linenos">1241</span></a>
</span><span id="S3Bucket-1242"><a href="#S3Bucket-1242"><span class="linenos">1242</span></a>        <span class="c1"># Default to copying within the same bucket</span>
</span><span id="S3Bucket-1243"><a href="#S3Bucket-1243"><span class="linenos">1243</span></a>        <span class="n">to_bucket</span> <span class="o">=</span> <span class="n">to_bucket</span> <span class="ow">or</span> <span class="bp">self</span>
</span><span id="S3Bucket-1244"><a href="#S3Bucket-1244"><span class="linenos">1244</span></a>
</span><span id="S3Bucket-1245"><a href="#S3Bucket-1245"><span class="linenos">1245</span></a>        <span class="n">target_bucket_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket-1246"><a href="#S3Bucket-1246"><span class="linenos">1246</span></a>        <span class="n">target_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket-1247"><a href="#S3Bucket-1247"><span class="linenos">1247</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="n">S3Bucket</span><span class="p">):</span>
</span><span id="S3Bucket-1248"><a href="#S3Bucket-1248"><span class="linenos">1248</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket-1249"><a href="#S3Bucket-1249"><span class="linenos">1249</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket-1250"><a href="#S3Bucket-1250"><span class="linenos">1250</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="S3Bucket-1251"><a href="#S3Bucket-1251"><span class="linenos">1251</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span>
</span><span id="S3Bucket-1252"><a href="#S3Bucket-1252"><span class="linenos">1252</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket-1253"><a href="#S3Bucket-1253"><span class="linenos">1253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket-1254"><a href="#S3Bucket-1254"><span class="linenos">1254</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="S3Bucket-1255"><a href="#S3Bucket-1255"><span class="linenos">1255</span></a>                <span class="sa">f</span><span class="s2">&quot;to_bucket must be a string or S3Bucket, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket-1256"><a href="#S3Bucket-1256"><span class="linenos">1256</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-1257"><a href="#S3Bucket-1257"><span class="linenos">1257</span></a>
</span><span id="S3Bucket-1258"><a href="#S3Bucket-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1259"><a href="#S3Bucket-1259"><span class="linenos">1259</span></a>            <span class="s2">&quot;Copying object from bucket </span><span class="si">%s</span><span class="s2"> with key </span><span class="si">%s</span><span class="s2"> to bucket </span><span class="si">%s</span><span class="s2"> with key </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-1260"><a href="#S3Bucket-1260"><span class="linenos">1260</span></a>            <span class="n">source_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1261"><a href="#S3Bucket-1261"><span class="linenos">1261</span></a>            <span class="n">source_path</span><span class="p">,</span>
</span><span id="S3Bucket-1262"><a href="#S3Bucket-1262"><span class="linenos">1262</span></a>            <span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1263"><a href="#S3Bucket-1263"><span class="linenos">1263</span></a>            <span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket-1264"><a href="#S3Bucket-1264"><span class="linenos">1264</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1265"><a href="#S3Bucket-1265"><span class="linenos">1265</span></a>
</span><span id="S3Bucket-1266"><a href="#S3Bucket-1266"><span class="linenos">1266</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
</span><span id="S3Bucket-1267"><a href="#S3Bucket-1267"><span class="linenos">1267</span></a>            <span class="n">CopySource</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">source_bucket_name</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">source_path</span><span class="p">},</span>
</span><span id="S3Bucket-1268"><a href="#S3Bucket-1268"><span class="linenos">1268</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1269"><a href="#S3Bucket-1269"><span class="linenos">1269</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket-1270"><a href="#S3Bucket-1270"><span class="linenos">1270</span></a>            <span class="o">**</span><span class="n">copy_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket-1271"><a href="#S3Bucket-1271"><span class="linenos">1271</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1272"><a href="#S3Bucket-1272"><span class="linenos">1272</span></a>
</span><span id="S3Bucket-1273"><a href="#S3Bucket-1273"><span class="linenos">1273</span></a>        <span class="k">return</span> <span class="n">target_path</span>
</span><span id="S3Bucket-1274"><a href="#S3Bucket-1274"><span class="linenos">1274</span></a>
</span><span id="S3Bucket-1275"><a href="#S3Bucket-1275"><span class="linenos">1275</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket-1276"><a href="#S3Bucket-1276"><span class="linenos">1276</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_object</span><span class="p">(</span>
</span><span id="S3Bucket-1277"><a href="#S3Bucket-1277"><span class="linenos">1277</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket-1278"><a href="#S3Bucket-1278"><span class="linenos">1278</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1279"><a href="#S3Bucket-1279"><span class="linenos">1279</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket-1280"><a href="#S3Bucket-1280"><span class="linenos">1280</span></a>        <span class="n">to_bucket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket-1281"><a href="#S3Bucket-1281"><span class="linenos">1281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket-1282"><a href="#S3Bucket-1282"><span class="linenos">1282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses S3&#39;s internal CopyObject and DeleteObject to move objects within or</span>
</span><span id="S3Bucket-1283"><a href="#S3Bucket-1283"><span class="linenos">1283</span></a><span class="sd">        between buckets. To move objects between buckets, `self`&#39;s credentials must</span>
</span><span id="S3Bucket-1284"><a href="#S3Bucket-1284"><span class="linenos">1284</span></a><span class="sd">        have permission to read and delete the source object and write to the target</span>
</span><span id="S3Bucket-1285"><a href="#S3Bucket-1285"><span class="linenos">1285</span></a><span class="sd">        object. If the credentials do not have those permissions, this method will</span>
</span><span id="S3Bucket-1286"><a href="#S3Bucket-1286"><span class="linenos">1286</span></a><span class="sd">        raise an error. If the credentials have permission to read the source object</span>
</span><span id="S3Bucket-1287"><a href="#S3Bucket-1287"><span class="linenos">1287</span></a><span class="sd">        but not delete it, the object will be copied but not deleted.</span>
</span><span id="S3Bucket-1288"><a href="#S3Bucket-1288"><span class="linenos">1288</span></a>
</span><span id="S3Bucket-1289"><a href="#S3Bucket-1289"><span class="linenos">1289</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket-1290"><a href="#S3Bucket-1290"><span class="linenos">1290</span></a><span class="sd">            from_path: The path of the object to move.</span>
</span><span id="S3Bucket-1291"><a href="#S3Bucket-1291"><span class="linenos">1291</span></a><span class="sd">            to_path: The path to move the object to.</span>
</span><span id="S3Bucket-1292"><a href="#S3Bucket-1292"><span class="linenos">1292</span></a><span class="sd">            to_bucket: The bucket to move to. Defaults to the current bucket.</span>
</span><span id="S3Bucket-1293"><a href="#S3Bucket-1293"><span class="linenos">1293</span></a>
</span><span id="S3Bucket-1294"><a href="#S3Bucket-1294"><span class="linenos">1294</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket-1295"><a href="#S3Bucket-1295"><span class="linenos">1295</span></a><span class="sd">            The path that the object was moved to. Excludes the bucket name.</span>
</span><span id="S3Bucket-1296"><a href="#S3Bucket-1296"><span class="linenos">1296</span></a>
</span><span id="S3Bucket-1297"><a href="#S3Bucket-1297"><span class="linenos">1297</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket-1298"><a href="#S3Bucket-1298"><span class="linenos">1298</span></a>
</span><span id="S3Bucket-1299"><a href="#S3Bucket-1299"><span class="linenos">1299</span></a><span class="sd">            Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.</span>
</span><span id="S3Bucket-1300"><a href="#S3Bucket-1300"><span class="linenos">1300</span></a>
</span><span id="S3Bucket-1301"><a href="#S3Bucket-1301"><span class="linenos">1301</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1302"><a href="#S3Bucket-1302"><span class="linenos">1302</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1303"><a href="#S3Bucket-1303"><span class="linenos">1303</span></a>
</span><span id="S3Bucket-1304"><a href="#S3Bucket-1304"><span class="linenos">1304</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1305"><a href="#S3Bucket-1305"><span class="linenos">1305</span></a><span class="sd">            s3_bucket.move_object(&quot;my_folder/notes.txt&quot;, &quot;my_folder/notes_copy.txt&quot;)</span>
</span><span id="S3Bucket-1306"><a href="#S3Bucket-1306"><span class="linenos">1306</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1307"><a href="#S3Bucket-1307"><span class="linenos">1307</span></a>
</span><span id="S3Bucket-1308"><a href="#S3Bucket-1308"><span class="linenos">1308</span></a><span class="sd">            Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in</span>
</span><span id="S3Bucket-1309"><a href="#S3Bucket-1309"><span class="linenos">1309</span></a><span class="sd">            another bucket.</span>
</span><span id="S3Bucket-1310"><a href="#S3Bucket-1310"><span class="linenos">1310</span></a>
</span><span id="S3Bucket-1311"><a href="#S3Bucket-1311"><span class="linenos">1311</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket-1312"><a href="#S3Bucket-1312"><span class="linenos">1312</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket-1313"><a href="#S3Bucket-1313"><span class="linenos">1313</span></a>
</span><span id="S3Bucket-1314"><a href="#S3Bucket-1314"><span class="linenos">1314</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket-1315"><a href="#S3Bucket-1315"><span class="linenos">1315</span></a><span class="sd">            s3_bucket.move_object(</span>
</span><span id="S3Bucket-1316"><a href="#S3Bucket-1316"><span class="linenos">1316</span></a><span class="sd">                &quot;my_folder/notes.txt&quot;,</span>
</span><span id="S3Bucket-1317"><a href="#S3Bucket-1317"><span class="linenos">1317</span></a><span class="sd">                &quot;my_folder/notes_copy.txt&quot;,</span>
</span><span id="S3Bucket-1318"><a href="#S3Bucket-1318"><span class="linenos">1318</span></a><span class="sd">                to_bucket=&quot;other-bucket&quot;</span>
</span><span id="S3Bucket-1319"><a href="#S3Bucket-1319"><span class="linenos">1319</span></a><span class="sd">            )</span>
</span><span id="S3Bucket-1320"><a href="#S3Bucket-1320"><span class="linenos">1320</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket-1321"><a href="#S3Bucket-1321"><span class="linenos">1321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket-1322"><a href="#S3Bucket-1322"><span class="linenos">1322</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket-1323"><a href="#S3Bucket-1323"><span class="linenos">1323</span></a>
</span><span id="S3Bucket-1324"><a href="#S3Bucket-1324"><span class="linenos">1324</span></a>        <span class="n">source_bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket-1325"><a href="#S3Bucket-1325"><span class="linenos">1325</span></a>        <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket-1326"><a href="#S3Bucket-1326"><span class="linenos">1326</span></a>
</span><span id="S3Bucket-1327"><a href="#S3Bucket-1327"><span class="linenos">1327</span></a>        <span class="c1"># Default to moving within the same bucket</span>
</span><span id="S3Bucket-1328"><a href="#S3Bucket-1328"><span class="linenos">1328</span></a>        <span class="n">to_bucket</span> <span class="o">=</span> <span class="n">to_bucket</span> <span class="ow">or</span> <span class="bp">self</span>
</span><span id="S3Bucket-1329"><a href="#S3Bucket-1329"><span class="linenos">1329</span></a>
</span><span id="S3Bucket-1330"><a href="#S3Bucket-1330"><span class="linenos">1330</span></a>        <span class="n">target_bucket_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket-1331"><a href="#S3Bucket-1331"><span class="linenos">1331</span></a>        <span class="n">target_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket-1332"><a href="#S3Bucket-1332"><span class="linenos">1332</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="n">S3Bucket</span><span class="p">):</span>
</span><span id="S3Bucket-1333"><a href="#S3Bucket-1333"><span class="linenos">1333</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket-1334"><a href="#S3Bucket-1334"><span class="linenos">1334</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket-1335"><a href="#S3Bucket-1335"><span class="linenos">1335</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="S3Bucket-1336"><a href="#S3Bucket-1336"><span class="linenos">1336</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span>
</span><span id="S3Bucket-1337"><a href="#S3Bucket-1337"><span class="linenos">1337</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket-1338"><a href="#S3Bucket-1338"><span class="linenos">1338</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket-1339"><a href="#S3Bucket-1339"><span class="linenos">1339</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="S3Bucket-1340"><a href="#S3Bucket-1340"><span class="linenos">1340</span></a>                <span class="sa">f</span><span class="s2">&quot;to_bucket must be a string or S3Bucket, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket-1341"><a href="#S3Bucket-1341"><span class="linenos">1341</span></a>            <span class="p">)</span>
</span><span id="S3Bucket-1342"><a href="#S3Bucket-1342"><span class="linenos">1342</span></a>
</span><span id="S3Bucket-1343"><a href="#S3Bucket-1343"><span class="linenos">1343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket-1344"><a href="#S3Bucket-1344"><span class="linenos">1344</span></a>            <span class="s2">&quot;Moving object from s3://</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2"> to s3://</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="S3Bucket-1345"><a href="#S3Bucket-1345"><span class="linenos">1345</span></a>            <span class="n">source_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1346"><a href="#S3Bucket-1346"><span class="linenos">1346</span></a>            <span class="n">source_path</span><span class="p">,</span>
</span><span id="S3Bucket-1347"><a href="#S3Bucket-1347"><span class="linenos">1347</span></a>            <span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1348"><a href="#S3Bucket-1348"><span class="linenos">1348</span></a>            <span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket-1349"><a href="#S3Bucket-1349"><span class="linenos">1349</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1350"><a href="#S3Bucket-1350"><span class="linenos">1350</span></a>
</span><span id="S3Bucket-1351"><a href="#S3Bucket-1351"><span class="linenos">1351</span></a>        <span class="c1"># If invalid, should error and prevent next operation</span>
</span><span id="S3Bucket-1352"><a href="#S3Bucket-1352"><span class="linenos">1352</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="S3Bucket-1353"><a href="#S3Bucket-1353"><span class="linenos">1353</span></a>            <span class="n">CopySource</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">source_bucket_name</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">source_path</span><span class="p">},</span>
</span><span id="S3Bucket-1354"><a href="#S3Bucket-1354"><span class="linenos">1354</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket-1355"><a href="#S3Bucket-1355"><span class="linenos">1355</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket-1356"><a href="#S3Bucket-1356"><span class="linenos">1356</span></a>        <span class="p">)</span>
</span><span id="S3Bucket-1357"><a href="#S3Bucket-1357"><span class="linenos">1357</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">source_bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="S3Bucket-1358"><a href="#S3Bucket-1358"><span class="linenos">1358</span></a>        <span class="k">return</span> <span class="n">target_path</span>
</span></pre></div>


            <div class="docstring"><p>Block used to store data using AWS S3 or S3-compatible object storage like MinIO.</p>

<p>Attributes:
    bucket_name: Name of your bucket.
    credentials: A block containing your credentials to AWS or MinIO.
    bucket_folder: A default path to a folder within the S3 bucket to use
        for reading and writing objects.</p>
</div>


                            <div id="S3Bucket.bucket_name" class="classattr">
                                <div class="attr variable">
            <span class="name">bucket_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#S3Bucket.bucket_name"></a>
    
    

                            </div>
                            <div id="S3Bucket.credentials" class="classattr">
                                <div class="attr variable">
            <span class="name">credentials</span><span class="annotation">: Union[<a href="#MinIOCredentials">MinIOCredentials</a>, <a href="#AwsCredentials">AwsCredentials</a>]</span>

        
    </div>
    <a class="headerlink" href="#S3Bucket.credentials"></a>
    
    

                            </div>
                            <div id="S3Bucket.bucket_folder" class="classattr">
                                <div class="attr variable">
            <span class="name">bucket_folder</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#S3Bucket.bucket_folder"></a>
    
    

                            </div>
                            <div id="S3Bucket.basepath" class="classattr">
                                        <input id="S3Bucket.basepath-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">basepath</span><span class="annotation">: str</span>

                <label class="view-source-button" for="S3Bucket.basepath-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.basepath"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.basepath-431"><a href="#S3Bucket.basepath-431"><span class="linenos">431</span></a>    <span class="nd">@property</span>
</span><span id="S3Bucket.basepath-432"><a href="#S3Bucket.basepath-432"><span class="linenos">432</span></a>    <span class="k">def</span> <span class="nf">basepath</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.basepath-433"><a href="#S3Bucket.basepath-433"><span class="linenos">433</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.basepath-434"><a href="#S3Bucket.basepath-434"><span class="linenos">434</span></a><span class="sd">        The base path of the S3 bucket.</span>
</span><span id="S3Bucket.basepath-435"><a href="#S3Bucket.basepath-435"><span class="linenos">435</span></a>
</span><span id="S3Bucket.basepath-436"><a href="#S3Bucket.basepath-436"><span class="linenos">436</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.basepath-437"><a href="#S3Bucket.basepath-437"><span class="linenos">437</span></a><span class="sd">            str: The base path of the S3 bucket.</span>
</span><span id="S3Bucket.basepath-438"><a href="#S3Bucket.basepath-438"><span class="linenos">438</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.basepath-439"><a href="#S3Bucket.basepath-439"><span class="linenos">439</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span>
</span></pre></div>


            <div class="docstring"><p>The base path of the S3 bucket.</p>

<p>Returns:
    str: The base path of the S3 bucket.</p>
</div>


                            </div>
                            <div id="S3Bucket.get_directory" class="classattr">
                                        <input id="S3Bucket.get_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">get_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.get_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.get_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.get_directory-485"><a href="#S3Bucket.get_directory-485"><span class="linenos">485</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.get_directory-486"><a href="#S3Bucket.get_directory-486"><span class="linenos">486</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_directory</span><span class="p">(</span>
</span><span id="S3Bucket.get_directory-487"><a href="#S3Bucket.get_directory-487"><span class="linenos">487</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">from_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="S3Bucket.get_directory-488"><a href="#S3Bucket.get_directory-488"><span class="linenos">488</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.get_directory-489"><a href="#S3Bucket.get_directory-489"><span class="linenos">489</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.get_directory-490"><a href="#S3Bucket.get_directory-490"><span class="linenos">490</span></a><span class="sd">        Copies a folder from the configured S3 bucket to a local directory.</span>
</span><span id="S3Bucket.get_directory-491"><a href="#S3Bucket.get_directory-491"><span class="linenos">491</span></a>
</span><span id="S3Bucket.get_directory-492"><a href="#S3Bucket.get_directory-492"><span class="linenos">492</span></a><span class="sd">        Defaults to copying the entire contents of the block&#39;s basepath to the current</span>
</span><span id="S3Bucket.get_directory-493"><a href="#S3Bucket.get_directory-493"><span class="linenos">493</span></a><span class="sd">        working directory.</span>
</span><span id="S3Bucket.get_directory-494"><a href="#S3Bucket.get_directory-494"><span class="linenos">494</span></a>
</span><span id="S3Bucket.get_directory-495"><a href="#S3Bucket.get_directory-495"><span class="linenos">495</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.get_directory-496"><a href="#S3Bucket.get_directory-496"><span class="linenos">496</span></a><span class="sd">            from_path: Path in S3 bucket to download from. Defaults to the block&#39;s</span>
</span><span id="S3Bucket.get_directory-497"><a href="#S3Bucket.get_directory-497"><span class="linenos">497</span></a><span class="sd">                configured basepath.</span>
</span><span id="S3Bucket.get_directory-498"><a href="#S3Bucket.get_directory-498"><span class="linenos">498</span></a><span class="sd">            local_path: Local path to download S3 contents to. Defaults to the current</span>
</span><span id="S3Bucket.get_directory-499"><a href="#S3Bucket.get_directory-499"><span class="linenos">499</span></a><span class="sd">                working directory.</span>
</span><span id="S3Bucket.get_directory-500"><a href="#S3Bucket.get_directory-500"><span class="linenos">500</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.get_directory-501"><a href="#S3Bucket.get_directory-501"><span class="linenos">501</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_folder</span>
</span><span id="S3Bucket.get_directory-502"><a href="#S3Bucket.get_directory-502"><span class="linenos">502</span></a>        <span class="k">if</span> <span class="n">from_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.get_directory-503"><a href="#S3Bucket.get_directory-503"><span class="linenos">503</span></a>            <span class="n">from_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="k">if</span> <span class="n">bucket_folder</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="S3Bucket.get_directory-504"><a href="#S3Bucket.get_directory-504"><span class="linenos">504</span></a>
</span><span id="S3Bucket.get_directory-505"><a href="#S3Bucket.get_directory-505"><span class="linenos">505</span></a>        <span class="k">if</span> <span class="n">local_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.get_directory-506"><a href="#S3Bucket.get_directory-506"><span class="linenos">506</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket.get_directory-507"><a href="#S3Bucket.get_directory-507"><span class="linenos">507</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket.get_directory-508"><a href="#S3Bucket.get_directory-508"><span class="linenos">508</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">())</span>
</span><span id="S3Bucket.get_directory-509"><a href="#S3Bucket.get_directory-509"><span class="linenos">509</span></a>
</span><span id="S3Bucket.get_directory-510"><a href="#S3Bucket.get_directory-510"><span class="linenos">510</span></a>        <span class="n">bucket</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_bucket_resource</span><span class="p">()</span>
</span><span id="S3Bucket.get_directory-511"><a href="#S3Bucket.get_directory-511"><span class="linenos">511</span></a>        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">bucket</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Prefix</span><span class="o">=</span><span class="n">from_path</span><span class="p">):</span>
</span><span id="S3Bucket.get_directory-512"><a href="#S3Bucket.get_directory-512"><span class="linenos">512</span></a>            <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;/&quot;</span><span class="p">:</span>
</span><span id="S3Bucket.get_directory-513"><a href="#S3Bucket.get_directory-513"><span class="linenos">513</span></a>                <span class="c1"># object is a folder and will be created if it contains any objects</span>
</span><span id="S3Bucket.get_directory-514"><a href="#S3Bucket.get_directory-514"><span class="linenos">514</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket.get_directory-515"><a href="#S3Bucket.get_directory-515"><span class="linenos">515</span></a>            <span class="n">target</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="S3Bucket.get_directory-516"><a href="#S3Bucket.get_directory-516"><span class="linenos">516</span></a>                <span class="n">local_path</span><span class="p">,</span>
</span><span id="S3Bucket.get_directory-517"><a href="#S3Bucket.get_directory-517"><span class="linenos">517</span></a>                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">from_path</span><span class="p">),</span>
</span><span id="S3Bucket.get_directory-518"><a href="#S3Bucket.get_directory-518"><span class="linenos">518</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.get_directory-519"><a href="#S3Bucket.get_directory-519"><span class="linenos">519</span></a>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="S3Bucket.get_directory-520"><a href="#S3Bucket.get_directory-520"><span class="linenos">520</span></a>            <span class="n">bucket</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">key</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Copies a folder from the configured S3 bucket to a local directory.</p>

<p>Defaults to copying the entire contents of the block's basepath to the current
working directory.</p>

<p>Args:
    from_path: Path in S3 bucket to download from. Defaults to the block's
        configured basepath.
    local_path: Local path to download S3 contents to. Defaults to the current
        working directory.</p>
</div>


                            </div>
                            <div id="S3Bucket.put_directory" class="classattr">
                                        <input id="S3Bucket.put_directory-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">put_directory</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ignore_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">int</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.put_directory-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.put_directory"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.put_directory-522"><a href="#S3Bucket.put_directory-522"><span class="linenos">522</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.put_directory-523"><a href="#S3Bucket.put_directory-523"><span class="linenos">523</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">put_directory</span><span class="p">(</span>
</span><span id="S3Bucket.put_directory-524"><a href="#S3Bucket.put_directory-524"><span class="linenos">524</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.put_directory-525"><a href="#S3Bucket.put_directory-525"><span class="linenos">525</span></a>        <span class="n">local_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.put_directory-526"><a href="#S3Bucket.put_directory-526"><span class="linenos">526</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.put_directory-527"><a href="#S3Bucket.put_directory-527"><span class="linenos">527</span></a>        <span class="n">ignore_file</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.put_directory-528"><a href="#S3Bucket.put_directory-528"><span class="linenos">528</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="S3Bucket.put_directory-529"><a href="#S3Bucket.put_directory-529"><span class="linenos">529</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.put_directory-530"><a href="#S3Bucket.put_directory-530"><span class="linenos">530</span></a><span class="sd">        Uploads a directory from a given local path to the configured S3 bucket in a</span>
</span><span id="S3Bucket.put_directory-531"><a href="#S3Bucket.put_directory-531"><span class="linenos">531</span></a><span class="sd">        given folder.</span>
</span><span id="S3Bucket.put_directory-532"><a href="#S3Bucket.put_directory-532"><span class="linenos">532</span></a>
</span><span id="S3Bucket.put_directory-533"><a href="#S3Bucket.put_directory-533"><span class="linenos">533</span></a><span class="sd">        Defaults to uploading the entire contents the current working directory to the</span>
</span><span id="S3Bucket.put_directory-534"><a href="#S3Bucket.put_directory-534"><span class="linenos">534</span></a><span class="sd">        block&#39;s basepath.</span>
</span><span id="S3Bucket.put_directory-535"><a href="#S3Bucket.put_directory-535"><span class="linenos">535</span></a>
</span><span id="S3Bucket.put_directory-536"><a href="#S3Bucket.put_directory-536"><span class="linenos">536</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.put_directory-537"><a href="#S3Bucket.put_directory-537"><span class="linenos">537</span></a><span class="sd">            local_path: Path to local directory to upload from.</span>
</span><span id="S3Bucket.put_directory-538"><a href="#S3Bucket.put_directory-538"><span class="linenos">538</span></a><span class="sd">            to_path: Path in S3 bucket to upload to. Defaults to block&#39;s configured</span>
</span><span id="S3Bucket.put_directory-539"><a href="#S3Bucket.put_directory-539"><span class="linenos">539</span></a><span class="sd">                basepath.</span>
</span><span id="S3Bucket.put_directory-540"><a href="#S3Bucket.put_directory-540"><span class="linenos">540</span></a><span class="sd">            ignore_file: Path to file containing gitignore style expressions for</span>
</span><span id="S3Bucket.put_directory-541"><a href="#S3Bucket.put_directory-541"><span class="linenos">541</span></a><span class="sd">                filepaths to ignore.</span>
</span><span id="S3Bucket.put_directory-542"><a href="#S3Bucket.put_directory-542"><span class="linenos">542</span></a>
</span><span id="S3Bucket.put_directory-543"><a href="#S3Bucket.put_directory-543"><span class="linenos">543</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.put_directory-544"><a href="#S3Bucket.put_directory-544"><span class="linenos">544</span></a>        <span class="n">to_path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">to_path</span>
</span><span id="S3Bucket.put_directory-545"><a href="#S3Bucket.put_directory-545"><span class="linenos">545</span></a>
</span><span id="S3Bucket.put_directory-546"><a href="#S3Bucket.put_directory-546"><span class="linenos">546</span></a>        <span class="k">if</span> <span class="n">local_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.put_directory-547"><a href="#S3Bucket.put_directory-547"><span class="linenos">547</span></a>            <span class="n">local_path</span> <span class="o">=</span> <span class="s2">&quot;.&quot;</span>
</span><span id="S3Bucket.put_directory-548"><a href="#S3Bucket.put_directory-548"><span class="linenos">548</span></a>
</span><span id="S3Bucket.put_directory-549"><a href="#S3Bucket.put_directory-549"><span class="linenos">549</span></a>        <span class="n">included_files</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="S3Bucket.put_directory-550"><a href="#S3Bucket.put_directory-550"><span class="linenos">550</span></a>        <span class="k">if</span> <span class="n">ignore_file</span><span class="p">:</span>
</span><span id="S3Bucket.put_directory-551"><a href="#S3Bucket.put_directory-551"><span class="linenos">551</span></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">ignore_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="S3Bucket.put_directory-552"><a href="#S3Bucket.put_directory-552"><span class="linenos">552</span></a>                <span class="n">ignore_patterns</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span id="S3Bucket.put_directory-553"><a href="#S3Bucket.put_directory-553"><span class="linenos">553</span></a>
</span><span id="S3Bucket.put_directory-554"><a href="#S3Bucket.put_directory-554"><span class="linenos">554</span></a>            <span class="n">included_files</span> <span class="o">=</span> <span class="n">filter_files</span><span class="p">(</span><span class="n">local_path</span><span class="p">,</span> <span class="n">ignore_patterns</span><span class="p">)</span>
</span><span id="S3Bucket.put_directory-555"><a href="#S3Bucket.put_directory-555"><span class="linenos">555</span></a>
</span><span id="S3Bucket.put_directory-556"><a href="#S3Bucket.put_directory-556"><span class="linenos">556</span></a>        <span class="n">uploaded_file_count</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="S3Bucket.put_directory-557"><a href="#S3Bucket.put_directory-557"><span class="linenos">557</span></a>        <span class="k">for</span> <span class="n">local_file_path</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
</span><span id="S3Bucket.put_directory-558"><a href="#S3Bucket.put_directory-558"><span class="linenos">558</span></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="S3Bucket.put_directory-559"><a href="#S3Bucket.put_directory-559"><span class="linenos">559</span></a>                <span class="n">included_files</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="S3Bucket.put_directory-560"><a href="#S3Bucket.put_directory-560"><span class="linenos">560</span></a>                <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">local_file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">local_path</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">included_files</span>
</span><span id="S3Bucket.put_directory-561"><a href="#S3Bucket.put_directory-561"><span class="linenos">561</span></a>            <span class="p">):</span>
</span><span id="S3Bucket.put_directory-562"><a href="#S3Bucket.put_directory-562"><span class="linenos">562</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket.put_directory-563"><a href="#S3Bucket.put_directory-563"><span class="linenos">563</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">local_file_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket.put_directory-564"><a href="#S3Bucket.put_directory-564"><span class="linenos">564</span></a>                <span class="n">remote_file_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span> <span class="o">/</span> <span class="n">local_file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span>
</span><span id="S3Bucket.put_directory-565"><a href="#S3Bucket.put_directory-565"><span class="linenos">565</span></a>                    <span class="n">local_path</span>
</span><span id="S3Bucket.put_directory-566"><a href="#S3Bucket.put_directory-566"><span class="linenos">566</span></a>                <span class="p">)</span>
</span><span id="S3Bucket.put_directory-567"><a href="#S3Bucket.put_directory-567"><span class="linenos">567</span></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_file_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">local_file</span><span class="p">:</span>
</span><span id="S3Bucket.put_directory-568"><a href="#S3Bucket.put_directory-568"><span class="linenos">568</span></a>                    <span class="n">local_file_content</span> <span class="o">=</span> <span class="n">local_file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="S3Bucket.put_directory-569"><a href="#S3Bucket.put_directory-569"><span class="linenos">569</span></a>
</span><span id="S3Bucket.put_directory-570"><a href="#S3Bucket.put_directory-570"><span class="linenos">570</span></a>                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_path</span><span class="p">(</span>
</span><span id="S3Bucket.put_directory-571"><a href="#S3Bucket.put_directory-571"><span class="linenos">571</span></a>                    <span class="n">remote_file_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">(),</span> <span class="n">content</span><span class="o">=</span><span class="n">local_file_content</span>
</span><span id="S3Bucket.put_directory-572"><a href="#S3Bucket.put_directory-572"><span class="linenos">572</span></a>                <span class="p">)</span>
</span><span id="S3Bucket.put_directory-573"><a href="#S3Bucket.put_directory-573"><span class="linenos">573</span></a>                <span class="n">uploaded_file_count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="S3Bucket.put_directory-574"><a href="#S3Bucket.put_directory-574"><span class="linenos">574</span></a>
</span><span id="S3Bucket.put_directory-575"><a href="#S3Bucket.put_directory-575"><span class="linenos">575</span></a>        <span class="k">return</span> <span class="n">uploaded_file_count</span>
</span></pre></div>


            <div class="docstring"><p>Uploads a directory from a given local path to the configured S3 bucket in a
given folder.</p>

<p>Defaults to uploading the entire contents the current working directory to the
block's basepath.</p>

<p>Args:
    local_path: Path to local directory to upload from.
    to_path: Path in S3 bucket to upload to. Defaults to block's configured
        basepath.
    ignore_file: Path to file containing gitignore style expressions for
        filepaths to ignore.</p>
</div>


                            </div>
                            <div id="S3Bucket.read_path" class="classattr">
                                        <input id="S3Bucket.read_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">read_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.read_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.read_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.read_path-577"><a href="#S3Bucket.read_path-577"><span class="linenos">577</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.read_path-578"><a href="#S3Bucket.read_path-578"><span class="linenos">578</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">read_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="S3Bucket.read_path-579"><a href="#S3Bucket.read_path-579"><span class="linenos">579</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.read_path-580"><a href="#S3Bucket.read_path-580"><span class="linenos">580</span></a><span class="sd">        Read specified path from S3 and return contents. Provide the entire</span>
</span><span id="S3Bucket.read_path-581"><a href="#S3Bucket.read_path-581"><span class="linenos">581</span></a><span class="sd">        path to the key in S3.</span>
</span><span id="S3Bucket.read_path-582"><a href="#S3Bucket.read_path-582"><span class="linenos">582</span></a>
</span><span id="S3Bucket.read_path-583"><a href="#S3Bucket.read_path-583"><span class="linenos">583</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.read_path-584"><a href="#S3Bucket.read_path-584"><span class="linenos">584</span></a><span class="sd">            path: Entire path to (and including) the key.</span>
</span><span id="S3Bucket.read_path-585"><a href="#S3Bucket.read_path-585"><span class="linenos">585</span></a>
</span><span id="S3Bucket.read_path-586"><a href="#S3Bucket.read_path-586"><span class="linenos">586</span></a><span class="sd">        Example:</span>
</span><span id="S3Bucket.read_path-587"><a href="#S3Bucket.read_path-587"><span class="linenos">587</span></a><span class="sd">            Read &quot;subfolder/file1&quot; contents from an S3 bucket named &quot;bucket&quot;:</span>
</span><span id="S3Bucket.read_path-588"><a href="#S3Bucket.read_path-588"><span class="linenos">588</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.read_path-589"><a href="#S3Bucket.read_path-589"><span class="linenos">589</span></a><span class="sd">            from prefect_aws import AwsCredentials</span>
</span><span id="S3Bucket.read_path-590"><a href="#S3Bucket.read_path-590"><span class="linenos">590</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.read_path-591"><a href="#S3Bucket.read_path-591"><span class="linenos">591</span></a>
</span><span id="S3Bucket.read_path-592"><a href="#S3Bucket.read_path-592"><span class="linenos">592</span></a><span class="sd">            aws_creds = AwsCredentials(</span>
</span><span id="S3Bucket.read_path-593"><a href="#S3Bucket.read_path-593"><span class="linenos">593</span></a><span class="sd">                aws_access_key_id=AWS_ACCESS_KEY_ID,</span>
</span><span id="S3Bucket.read_path-594"><a href="#S3Bucket.read_path-594"><span class="linenos">594</span></a><span class="sd">                aws_secret_access_key=AWS_SECRET_ACCESS_KEY</span>
</span><span id="S3Bucket.read_path-595"><a href="#S3Bucket.read_path-595"><span class="linenos">595</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.read_path-596"><a href="#S3Bucket.read_path-596"><span class="linenos">596</span></a>
</span><span id="S3Bucket.read_path-597"><a href="#S3Bucket.read_path-597"><span class="linenos">597</span></a><span class="sd">            s3_bucket_block = S3Bucket(</span>
</span><span id="S3Bucket.read_path-598"><a href="#S3Bucket.read_path-598"><span class="linenos">598</span></a><span class="sd">                bucket_name=&quot;bucket&quot;,</span>
</span><span id="S3Bucket.read_path-599"><a href="#S3Bucket.read_path-599"><span class="linenos">599</span></a><span class="sd">                credentials=aws_creds,</span>
</span><span id="S3Bucket.read_path-600"><a href="#S3Bucket.read_path-600"><span class="linenos">600</span></a><span class="sd">                bucket_folder=&quot;subfolder&quot;</span>
</span><span id="S3Bucket.read_path-601"><a href="#S3Bucket.read_path-601"><span class="linenos">601</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.read_path-602"><a href="#S3Bucket.read_path-602"><span class="linenos">602</span></a>
</span><span id="S3Bucket.read_path-603"><a href="#S3Bucket.read_path-603"><span class="linenos">603</span></a><span class="sd">            key_contents = s3_bucket_block.read_path(path=&quot;subfolder/file1&quot;)</span>
</span><span id="S3Bucket.read_path-604"><a href="#S3Bucket.read_path-604"><span class="linenos">604</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.read_path-605"><a href="#S3Bucket.read_path-605"><span class="linenos">605</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.read_path-606"><a href="#S3Bucket.read_path-606"><span class="linenos">606</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="S3Bucket.read_path-607"><a href="#S3Bucket.read_path-607"><span class="linenos">607</span></a>
</span><span id="S3Bucket.read_path-608"><a href="#S3Bucket.read_path-608"><span class="linenos">608</span></a>        <span class="k">return</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_sync</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Read specified path from S3 and return contents. Provide the entire
path to the key in S3.</p>

<p>Args:
    path: Entire path to (and including) the key.</p>

<p>Example:
    Read "subfolder/file1" contents from an S3 bucket named "bucket":
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws</span> <span class="kn">import</span> <span class="n">AwsCredentials</span>
    <span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">aws_creds</span> <span class="o">=</span> <span class="n">AwsCredentials</span><span class="p">(</span>
        <span class="n">aws_access_key_id</span><span class="o">=</span><span class="n">AWS_ACCESS_KEY_ID</span><span class="p">,</span>
        <span class="n">aws_secret_access_key</span><span class="o">=</span><span class="n">AWS_SECRET_ACCESS_KEY</span>
    <span class="p">)</span>
 <br />
    <span class="n">s3_bucket_block</span> <span class="o">=</span> <span class="n">S3Bucket</span><span class="p">(</span>
        <span class="n">bucket_name</span><span class="o">=</span><span class="s2">&quot;bucket&quot;</span><span class="p">,</span>
        <span class="n">credentials</span><span class="o">=</span><span class="n">aws_creds</span><span class="p">,</span>
        <span class="n">bucket_folder</span><span class="o">=</span><span class="s2">&quot;subfolder&quot;</span>
    <span class="p">)</span>
 <br />
    <span class="n">key_contents</span> <span class="o">=</span> <span class="n">s3_bucket_block</span><span class="o">.</span><span class="n">read_path</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;subfolder/file1&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.write_path" class="classattr">
                                        <input id="S3Bucket.write_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">write_path</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">path</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.write_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.write_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.write_path-624"><a href="#S3Bucket.write_path-624"><span class="linenos">624</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.write_path-625"><a href="#S3Bucket.write_path-625"><span class="linenos">625</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">write_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.write_path-626"><a href="#S3Bucket.write_path-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.write_path-627"><a href="#S3Bucket.write_path-627"><span class="linenos">627</span></a><span class="sd">        Writes to an S3 bucket.</span>
</span><span id="S3Bucket.write_path-628"><a href="#S3Bucket.write_path-628"><span class="linenos">628</span></a>
</span><span id="S3Bucket.write_path-629"><a href="#S3Bucket.write_path-629"><span class="linenos">629</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.write_path-630"><a href="#S3Bucket.write_path-630"><span class="linenos">630</span></a>
</span><span id="S3Bucket.write_path-631"><a href="#S3Bucket.write_path-631"><span class="linenos">631</span></a><span class="sd">            path: The key name. Each object in your bucket has a unique</span>
</span><span id="S3Bucket.write_path-632"><a href="#S3Bucket.write_path-632"><span class="linenos">632</span></a><span class="sd">                key (or key name).</span>
</span><span id="S3Bucket.write_path-633"><a href="#S3Bucket.write_path-633"><span class="linenos">633</span></a><span class="sd">            content: What you are uploading to S3.</span>
</span><span id="S3Bucket.write_path-634"><a href="#S3Bucket.write_path-634"><span class="linenos">634</span></a>
</span><span id="S3Bucket.write_path-635"><a href="#S3Bucket.write_path-635"><span class="linenos">635</span></a><span class="sd">        Example:</span>
</span><span id="S3Bucket.write_path-636"><a href="#S3Bucket.write_path-636"><span class="linenos">636</span></a>
</span><span id="S3Bucket.write_path-637"><a href="#S3Bucket.write_path-637"><span class="linenos">637</span></a><span class="sd">            Write data to the path `dogs/small_dogs/havanese` in an S3 Bucket:</span>
</span><span id="S3Bucket.write_path-638"><a href="#S3Bucket.write_path-638"><span class="linenos">638</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.write_path-639"><a href="#S3Bucket.write_path-639"><span class="linenos">639</span></a><span class="sd">            from prefect_aws import MinioCredentials</span>
</span><span id="S3Bucket.write_path-640"><a href="#S3Bucket.write_path-640"><span class="linenos">640</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.write_path-641"><a href="#S3Bucket.write_path-641"><span class="linenos">641</span></a>
</span><span id="S3Bucket.write_path-642"><a href="#S3Bucket.write_path-642"><span class="linenos">642</span></a><span class="sd">            minio_creds = MinIOCredentials(</span>
</span><span id="S3Bucket.write_path-643"><a href="#S3Bucket.write_path-643"><span class="linenos">643</span></a><span class="sd">                minio_root_user = &quot;minioadmin&quot;,</span>
</span><span id="S3Bucket.write_path-644"><a href="#S3Bucket.write_path-644"><span class="linenos">644</span></a><span class="sd">                minio_root_password = &quot;minioadmin&quot;,</span>
</span><span id="S3Bucket.write_path-645"><a href="#S3Bucket.write_path-645"><span class="linenos">645</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.write_path-646"><a href="#S3Bucket.write_path-646"><span class="linenos">646</span></a>
</span><span id="S3Bucket.write_path-647"><a href="#S3Bucket.write_path-647"><span class="linenos">647</span></a><span class="sd">            s3_bucket_block = S3Bucket(</span>
</span><span id="S3Bucket.write_path-648"><a href="#S3Bucket.write_path-648"><span class="linenos">648</span></a><span class="sd">                bucket_name=&quot;bucket&quot;,</span>
</span><span id="S3Bucket.write_path-649"><a href="#S3Bucket.write_path-649"><span class="linenos">649</span></a><span class="sd">                minio_credentials=minio_creds,</span>
</span><span id="S3Bucket.write_path-650"><a href="#S3Bucket.write_path-650"><span class="linenos">650</span></a><span class="sd">                bucket_folder=&quot;dogs/smalldogs&quot;,</span>
</span><span id="S3Bucket.write_path-651"><a href="#S3Bucket.write_path-651"><span class="linenos">651</span></a><span class="sd">                endpoint_url=&quot;http://localhost:9000&quot;,</span>
</span><span id="S3Bucket.write_path-652"><a href="#S3Bucket.write_path-652"><span class="linenos">652</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.write_path-653"><a href="#S3Bucket.write_path-653"><span class="linenos">653</span></a><span class="sd">            s3_havanese_path = s3_bucket_block.write_path(path=&quot;havanese&quot;, content=data)</span>
</span><span id="S3Bucket.write_path-654"><a href="#S3Bucket.write_path-654"><span class="linenos">654</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.write_path-655"><a href="#S3Bucket.write_path-655"><span class="linenos">655</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.write_path-656"><a href="#S3Bucket.write_path-656"><span class="linenos">656</span></a>
</span><span id="S3Bucket.write_path-657"><a href="#S3Bucket.write_path-657"><span class="linenos">657</span></a>        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="S3Bucket.write_path-658"><a href="#S3Bucket.write_path-658"><span class="linenos">658</span></a>
</span><span id="S3Bucket.write_path-659"><a href="#S3Bucket.write_path-659"><span class="linenos">659</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_write_sync</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
</span><span id="S3Bucket.write_path-660"><a href="#S3Bucket.write_path-660"><span class="linenos">660</span></a>
</span><span id="S3Bucket.write_path-661"><a href="#S3Bucket.write_path-661"><span class="linenos">661</span></a>        <span class="k">return</span> <span class="n">path</span>
</span></pre></div>


            <div class="docstring"><p>Writes to an S3 bucket.</p>

<p>Args:</p>

<pre><code>path: The key name. Each object in your bucket has a unique
    key (or key name).
content: What you are uploading to S3.
</code></pre>

<p>Example:</p>

<pre><code>Write data to the path `dogs/small_dogs/havanese` in an S3 Bucket:
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;MinioCredentials&lt;/span&gt;
&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;minio_creds&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;MinIOCredentials&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;minio_root_user&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;minioadmin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;minio_root_password&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;minioadmin&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket_block&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="n"&gt;bucket_name&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;minio_credentials&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;minio_creds&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;bucket_folder&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;dogs/smalldogs&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;endpoint_url&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;http://localhost:9000&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s3_havanese_path&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;s3_bucket_block&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;write_path&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="n"&gt;path&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;havanese&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;content&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="n"&gt;data&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
</div>


                            </div>
                            <div id="S3Bucket.list_objects" class="classattr">
                                        <input id="S3Bucket.list_objects-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">list_objects</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>,</span><span class="param">	<span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_items</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">jmespath_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.list_objects-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.list_objects"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.list_objects-712"><a href="#S3Bucket.list_objects-712"><span class="linenos">712</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.list_objects-713"><a href="#S3Bucket.list_objects-713"><span class="linenos">713</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">list_objects</span><span class="p">(</span>
</span><span id="S3Bucket.list_objects-714"><a href="#S3Bucket.list_objects-714"><span class="linenos">714</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-715"><a href="#S3Bucket.list_objects-715"><span class="linenos">715</span></a>        <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-716"><a href="#S3Bucket.list_objects-716"><span class="linenos">716</span></a>        <span class="n">delimiter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-717"><a href="#S3Bucket.list_objects-717"><span class="linenos">717</span></a>        <span class="n">page_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-718"><a href="#S3Bucket.list_objects-718"><span class="linenos">718</span></a>        <span class="n">max_items</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-719"><a href="#S3Bucket.list_objects-719"><span class="linenos">719</span></a>        <span class="n">jmespath_query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-720"><a href="#S3Bucket.list_objects-720"><span class="linenos">720</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
</span><span id="S3Bucket.list_objects-721"><a href="#S3Bucket.list_objects-721"><span class="linenos">721</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.list_objects-722"><a href="#S3Bucket.list_objects-722"><span class="linenos">722</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.list_objects-723"><a href="#S3Bucket.list_objects-723"><span class="linenos">723</span></a><span class="sd">            folder: Folder to list objects from.</span>
</span><span id="S3Bucket.list_objects-724"><a href="#S3Bucket.list_objects-724"><span class="linenos">724</span></a><span class="sd">            delimiter: Character used to group keys of listed objects.</span>
</span><span id="S3Bucket.list_objects-725"><a href="#S3Bucket.list_objects-725"><span class="linenos">725</span></a><span class="sd">            page_size: Number of objects to return in each request to the AWS API.</span>
</span><span id="S3Bucket.list_objects-726"><a href="#S3Bucket.list_objects-726"><span class="linenos">726</span></a><span class="sd">            max_items: Maximum number of objects that to be returned by task.</span>
</span><span id="S3Bucket.list_objects-727"><a href="#S3Bucket.list_objects-727"><span class="linenos">727</span></a><span class="sd">            jmespath_query: Query used to filter objects based on object attributes refer to</span>
</span><span id="S3Bucket.list_objects-728"><a href="#S3Bucket.list_objects-728"><span class="linenos">728</span></a><span class="sd">                the [boto3 docs](https://boto3.amazonaws.com/v1/documentation/api/latest/guide/paginators.html#filtering-results-with-jmespath)</span>
</span><span id="S3Bucket.list_objects-729"><a href="#S3Bucket.list_objects-729"><span class="linenos">729</span></a><span class="sd">                for more information on how to construct queries.</span>
</span><span id="S3Bucket.list_objects-730"><a href="#S3Bucket.list_objects-730"><span class="linenos">730</span></a>
</span><span id="S3Bucket.list_objects-731"><a href="#S3Bucket.list_objects-731"><span class="linenos">731</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.list_objects-732"><a href="#S3Bucket.list_objects-732"><span class="linenos">732</span></a><span class="sd">            List of objects and their metadata in the bucket.</span>
</span><span id="S3Bucket.list_objects-733"><a href="#S3Bucket.list_objects-733"><span class="linenos">733</span></a>
</span><span id="S3Bucket.list_objects-734"><a href="#S3Bucket.list_objects-734"><span class="linenos">734</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.list_objects-735"><a href="#S3Bucket.list_objects-735"><span class="linenos">735</span></a><span class="sd">            List objects under the `base_folder`.</span>
</span><span id="S3Bucket.list_objects-736"><a href="#S3Bucket.list_objects-736"><span class="linenos">736</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.list_objects-737"><a href="#S3Bucket.list_objects-737"><span class="linenos">737</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.list_objects-738"><a href="#S3Bucket.list_objects-738"><span class="linenos">738</span></a>
</span><span id="S3Bucket.list_objects-739"><a href="#S3Bucket.list_objects-739"><span class="linenos">739</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.list_objects-740"><a href="#S3Bucket.list_objects-740"><span class="linenos">740</span></a><span class="sd">            s3_bucket.list_objects(&quot;base_folder&quot;)</span>
</span><span id="S3Bucket.list_objects-741"><a href="#S3Bucket.list_objects-741"><span class="linenos">741</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.list_objects-742"><a href="#S3Bucket.list_objects-742"><span class="linenos">742</span></a><span class="sd">        &quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>
</span><span id="S3Bucket.list_objects-743"><a href="#S3Bucket.list_objects-743"><span class="linenos">743</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
</span><span id="S3Bucket.list_objects-744"><a href="#S3Bucket.list_objects-744"><span class="linenos">744</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.list_objects-745"><a href="#S3Bucket.list_objects-745"><span class="linenos">745</span></a>        <span class="n">paginator</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_paginator</span><span class="p">(</span><span class="s2">&quot;list_objects_v2&quot;</span><span class="p">)</span>
</span><span id="S3Bucket.list_objects-746"><a href="#S3Bucket.list_objects-746"><span class="linenos">746</span></a>        <span class="n">page_iterator</span> <span class="o">=</span> <span class="n">paginator</span><span class="o">.</span><span class="n">paginate</span><span class="p">(</span>
</span><span id="S3Bucket.list_objects-747"><a href="#S3Bucket.list_objects-747"><span class="linenos">747</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-748"><a href="#S3Bucket.list_objects-748"><span class="linenos">748</span></a>            <span class="n">Prefix</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-749"><a href="#S3Bucket.list_objects-749"><span class="linenos">749</span></a>            <span class="n">Delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
</span><span id="S3Bucket.list_objects-750"><a href="#S3Bucket.list_objects-750"><span class="linenos">750</span></a>            <span class="n">PaginationConfig</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;PageSize&quot;</span><span class="p">:</span> <span class="n">page_size</span><span class="p">,</span> <span class="s2">&quot;MaxItems&quot;</span><span class="p">:</span> <span class="n">max_items</span><span class="p">},</span>
</span><span id="S3Bucket.list_objects-751"><a href="#S3Bucket.list_objects-751"><span class="linenos">751</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.list_objects-752"><a href="#S3Bucket.list_objects-752"><span class="linenos">752</span></a>        <span class="k">if</span> <span class="n">jmespath_query</span><span class="p">:</span>
</span><span id="S3Bucket.list_objects-753"><a href="#S3Bucket.list_objects-753"><span class="linenos">753</span></a>            <span class="n">page_iterator</span> <span class="o">=</span> <span class="n">page_iterator</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">jmespath_query</span><span class="si">}</span><span class="s2"> | </span><span class="se">{{</span><span class="s2">Contents: @</span><span class="se">}}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="S3Bucket.list_objects-754"><a href="#S3Bucket.list_objects-754"><span class="linenos">754</span></a>
</span><span id="S3Bucket.list_objects-755"><a href="#S3Bucket.list_objects-755"><span class="linenos">755</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Listing objects in bucket </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="S3Bucket.list_objects-756"><a href="#S3Bucket.list_objects-756"><span class="linenos">756</span></a>        <span class="n">objects</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.list_objects-757"><a href="#S3Bucket.list_objects-757"><span class="linenos">757</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_list_objects_sync</span><span class="p">,</span> <span class="n">page_iterator</span>
</span><span id="S3Bucket.list_objects-758"><a href="#S3Bucket.list_objects-758"><span class="linenos">758</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.list_objects-759"><a href="#S3Bucket.list_objects-759"><span class="linenos">759</span></a>        <span class="k">return</span> <span class="n">objects</span>
</span></pre></div>


            <div class="docstring"><p>Args:
    folder: Folder to list objects from.
    delimiter: Character used to group keys of listed objects.
    page_size: Number of objects to return in each request to the AWS API.
    max_items: Maximum number of objects that to be returned by task.
    jmespath_query: Query used to filter objects based on object attributes refer to
        the <a href="https://boto3.amazonaws.com/v1/documentation/api/latest/guide/paginators.html#filtering-results-with-jmespath">boto3 docs</a>
        for more information on how to construct queries.</p>

<p>Returns:
    List of objects and their metadata in the bucket.</p>

<p>Examples:
    List objects under the <code>base_folder</code>.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="n">s3_bucket</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="s2">&quot;base_folder&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.download_object_to_path" class="classattr">
                                        <input id="S3Bucket.download_object_to_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">download_object_to_path</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span>,</span><span class="param">	<span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.download_object_to_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.download_object_to_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.download_object_to_path-761"><a href="#S3Bucket.download_object_to_path-761"><span class="linenos">761</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.download_object_to_path-762"><a href="#S3Bucket.download_object_to_path-762"><span class="linenos">762</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_object_to_path</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_path-763"><a href="#S3Bucket.download_object_to_path-763"><span class="linenos">763</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-764"><a href="#S3Bucket.download_object_to_path-764"><span class="linenos">764</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-765"><a href="#S3Bucket.download_object_to_path-765"><span class="linenos">765</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]],</span>
</span><span id="S3Bucket.download_object_to_path-766"><a href="#S3Bucket.download_object_to_path-766"><span class="linenos">766</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.download_object_to_path-767"><a href="#S3Bucket.download_object_to_path-767"><span class="linenos">767</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="S3Bucket.download_object_to_path-768"><a href="#S3Bucket.download_object_to_path-768"><span class="linenos">768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_object_to_path-769"><a href="#S3Bucket.download_object_to_path-769"><span class="linenos">769</span></a><span class="sd">        Downloads an object from the S3 bucket to a path.</span>
</span><span id="S3Bucket.download_object_to_path-770"><a href="#S3Bucket.download_object_to_path-770"><span class="linenos">770</span></a>
</span><span id="S3Bucket.download_object_to_path-771"><a href="#S3Bucket.download_object_to_path-771"><span class="linenos">771</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.download_object_to_path-772"><a href="#S3Bucket.download_object_to_path-772"><span class="linenos">772</span></a><span class="sd">            from_path: The path to the object to download; this gets prefixed</span>
</span><span id="S3Bucket.download_object_to_path-773"><a href="#S3Bucket.download_object_to_path-773"><span class="linenos">773</span></a><span class="sd">                with the bucket_folder.</span>
</span><span id="S3Bucket.download_object_to_path-774"><a href="#S3Bucket.download_object_to_path-774"><span class="linenos">774</span></a><span class="sd">            to_path: The path to download the object to. If not provided, the</span>
</span><span id="S3Bucket.download_object_to_path-775"><a href="#S3Bucket.download_object_to_path-775"><span class="linenos">775</span></a><span class="sd">                object&#39;s name will be used.</span>
</span><span id="S3Bucket.download_object_to_path-776"><a href="#S3Bucket.download_object_to_path-776"><span class="linenos">776</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.download_object_to_path-777"><a href="#S3Bucket.download_object_to_path-777"><span class="linenos">777</span></a><span class="sd">                `Client.download_file`.</span>
</span><span id="S3Bucket.download_object_to_path-778"><a href="#S3Bucket.download_object_to_path-778"><span class="linenos">778</span></a>
</span><span id="S3Bucket.download_object_to_path-779"><a href="#S3Bucket.download_object_to_path-779"><span class="linenos">779</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.download_object_to_path-780"><a href="#S3Bucket.download_object_to_path-780"><span class="linenos">780</span></a><span class="sd">            The absolute path that the object was downloaded to.</span>
</span><span id="S3Bucket.download_object_to_path-781"><a href="#S3Bucket.download_object_to_path-781"><span class="linenos">781</span></a>
</span><span id="S3Bucket.download_object_to_path-782"><a href="#S3Bucket.download_object_to_path-782"><span class="linenos">782</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.download_object_to_path-783"><a href="#S3Bucket.download_object_to_path-783"><span class="linenos">783</span></a><span class="sd">            Download my_folder/notes.txt object to notes.txt.</span>
</span><span id="S3Bucket.download_object_to_path-784"><a href="#S3Bucket.download_object_to_path-784"><span class="linenos">784</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.download_object_to_path-785"><a href="#S3Bucket.download_object_to_path-785"><span class="linenos">785</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.download_object_to_path-786"><a href="#S3Bucket.download_object_to_path-786"><span class="linenos">786</span></a>
</span><span id="S3Bucket.download_object_to_path-787"><a href="#S3Bucket.download_object_to_path-787"><span class="linenos">787</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.download_object_to_path-788"><a href="#S3Bucket.download_object_to_path-788"><span class="linenos">788</span></a><span class="sd">            s3_bucket.download_object_to_path(&quot;my_folder/notes.txt&quot;, &quot;notes.txt&quot;)</span>
</span><span id="S3Bucket.download_object_to_path-789"><a href="#S3Bucket.download_object_to_path-789"><span class="linenos">789</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.download_object_to_path-790"><a href="#S3Bucket.download_object_to_path-790"><span class="linenos">790</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_object_to_path-791"><a href="#S3Bucket.download_object_to_path-791"><span class="linenos">791</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.download_object_to_path-792"><a href="#S3Bucket.download_object_to_path-792"><span class="linenos">792</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket.download_object_to_path-793"><a href="#S3Bucket.download_object_to_path-793"><span class="linenos">793</span></a>
</span><span id="S3Bucket.download_object_to_path-794"><a href="#S3Bucket.download_object_to_path-794"><span class="linenos">794</span></a>        <span class="c1"># making path absolute, but converting back to str here</span>
</span><span id="S3Bucket.download_object_to_path-795"><a href="#S3Bucket.download_object_to_path-795"><span class="linenos">795</span></a>        <span class="c1"># since !r looks nicer that way and filename arg expects str</span>
</span><span id="S3Bucket.download_object_to_path-796"><a href="#S3Bucket.download_object_to_path-796"><span class="linenos">796</span></a>        <span class="n">to_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket.download_object_to_path-797"><a href="#S3Bucket.download_object_to_path-797"><span class="linenos">797</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket.download_object_to_path-798"><a href="#S3Bucket.download_object_to_path-798"><span class="linenos">798</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.download_object_to_path-799"><a href="#S3Bucket.download_object_to_path-799"><span class="linenos">799</span></a>
</span><span id="S3Bucket.download_object_to_path-800"><a href="#S3Bucket.download_object_to_path-800"><span class="linenos">800</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_path-801"><a href="#S3Bucket.download_object_to_path-801"><span class="linenos">801</span></a>            <span class="sa">f</span><span class="s2">&quot;Preparing to download object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket.download_object_to_path-802"><a href="#S3Bucket.download_object_to_path-802"><span class="linenos">802</span></a>            <span class="sa">f</span><span class="s2">&quot;path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.download_object_to_path-803"><a href="#S3Bucket.download_object_to_path-803"><span class="linenos">803</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_path-804"><a href="#S3Bucket.download_object_to_path-804"><span class="linenos">804</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_path-805"><a href="#S3Bucket.download_object_to_path-805"><span class="linenos">805</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-806"><a href="#S3Bucket.download_object_to_path-806"><span class="linenos">806</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-807"><a href="#S3Bucket.download_object_to_path-807"><span class="linenos">807</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">from_path</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-808"><a href="#S3Bucket.download_object_to_path-808"><span class="linenos">808</span></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-809"><a href="#S3Bucket.download_object_to_path-809"><span class="linenos">809</span></a>            <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_path-810"><a href="#S3Bucket.download_object_to_path-810"><span class="linenos">810</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_path-811"><a href="#S3Bucket.download_object_to_path-811"><span class="linenos">811</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_path-812"><a href="#S3Bucket.download_object_to_path-812"><span class="linenos">812</span></a>            <span class="sa">f</span><span class="s2">&quot;Downloaded object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket.download_object_to_path-813"><a href="#S3Bucket.download_object_to_path-813"><span class="linenos">813</span></a>            <span class="sa">f</span><span class="s2">&quot;to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.download_object_to_path-814"><a href="#S3Bucket.download_object_to_path-814"><span class="linenos">814</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_path-815"><a href="#S3Bucket.download_object_to_path-815"><span class="linenos">815</span></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Downloads an object from the S3 bucket to a path.</p>

<p>Args:
    from_path: The path to the object to download; this gets prefixed
        with the bucket_folder.
    to_path: The path to download the object to. If not provided, the
        object's name will be used.
    **download_kwargs: Additional keyword arguments to pass to
        <code>Client.download_file</code>.</p>

<p>Returns:
    The absolute path that the object was downloaded to.</p>

<p>Examples:
    Download my_folder/notes.txt object to notes.txt.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="n">s3_bucket</span><span class="o">.</span><span class="n">download_object_to_path</span><span class="p">(</span><span class="s2">&quot;my_folder/notes.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;notes.txt&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.download_object_to_file_object" class="classattr">
                                        <input id="S3Bucket.download_object_to_file_object-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">download_object_to_file_object</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	to_file_object: &lt;class &#x27;BinaryIO&#x27;&gt;,</span><span class="param">	<span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> &lt;class &#x27;BinaryIO&#x27;&gt;:</span></span>

                <label class="view-source-button" for="S3Bucket.download_object_to_file_object-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.download_object_to_file_object"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.download_object_to_file_object-817"><a href="#S3Bucket.download_object_to_file_object-817"><span class="linenos">817</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.download_object_to_file_object-818"><a href="#S3Bucket.download_object_to_file_object-818"><span class="linenos">818</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_object_to_file_object</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_file_object-819"><a href="#S3Bucket.download_object_to_file_object-819"><span class="linenos">819</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-820"><a href="#S3Bucket.download_object_to_file_object-820"><span class="linenos">820</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-821"><a href="#S3Bucket.download_object_to_file_object-821"><span class="linenos">821</span></a>        <span class="n">to_file_object</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-822"><a href="#S3Bucket.download_object_to_file_object-822"><span class="linenos">822</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.download_object_to_file_object-823"><a href="#S3Bucket.download_object_to_file_object-823"><span class="linenos">823</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BinaryIO</span><span class="p">:</span>
</span><span id="S3Bucket.download_object_to_file_object-824"><a href="#S3Bucket.download_object_to_file_object-824"><span class="linenos">824</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-825"><a href="#S3Bucket.download_object_to_file_object-825"><span class="linenos">825</span></a><span class="sd">        Downloads an object from the object storage service to a file-like object,</span>
</span><span id="S3Bucket.download_object_to_file_object-826"><a href="#S3Bucket.download_object_to_file_object-826"><span class="linenos">826</span></a><span class="sd">        which can be a BytesIO object or a BufferedWriter.</span>
</span><span id="S3Bucket.download_object_to_file_object-827"><a href="#S3Bucket.download_object_to_file_object-827"><span class="linenos">827</span></a>
</span><span id="S3Bucket.download_object_to_file_object-828"><a href="#S3Bucket.download_object_to_file_object-828"><span class="linenos">828</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.download_object_to_file_object-829"><a href="#S3Bucket.download_object_to_file_object-829"><span class="linenos">829</span></a><span class="sd">            from_path: The path to the object to download from; this gets prefixed</span>
</span><span id="S3Bucket.download_object_to_file_object-830"><a href="#S3Bucket.download_object_to_file_object-830"><span class="linenos">830</span></a><span class="sd">                with the bucket_folder.</span>
</span><span id="S3Bucket.download_object_to_file_object-831"><a href="#S3Bucket.download_object_to_file_object-831"><span class="linenos">831</span></a><span class="sd">            to_file_object: The file-like object to download the object to.</span>
</span><span id="S3Bucket.download_object_to_file_object-832"><a href="#S3Bucket.download_object_to_file_object-832"><span class="linenos">832</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.download_object_to_file_object-833"><a href="#S3Bucket.download_object_to_file_object-833"><span class="linenos">833</span></a><span class="sd">                `Client.download_fileobj`.</span>
</span><span id="S3Bucket.download_object_to_file_object-834"><a href="#S3Bucket.download_object_to_file_object-834"><span class="linenos">834</span></a>
</span><span id="S3Bucket.download_object_to_file_object-835"><a href="#S3Bucket.download_object_to_file_object-835"><span class="linenos">835</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.download_object_to_file_object-836"><a href="#S3Bucket.download_object_to_file_object-836"><span class="linenos">836</span></a><span class="sd">            The file-like object that the object was downloaded to.</span>
</span><span id="S3Bucket.download_object_to_file_object-837"><a href="#S3Bucket.download_object_to_file_object-837"><span class="linenos">837</span></a>
</span><span id="S3Bucket.download_object_to_file_object-838"><a href="#S3Bucket.download_object_to_file_object-838"><span class="linenos">838</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.download_object_to_file_object-839"><a href="#S3Bucket.download_object_to_file_object-839"><span class="linenos">839</span></a><span class="sd">            Download my_folder/notes.txt object to a BytesIO object.</span>
</span><span id="S3Bucket.download_object_to_file_object-840"><a href="#S3Bucket.download_object_to_file_object-840"><span class="linenos">840</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.download_object_to_file_object-841"><a href="#S3Bucket.download_object_to_file_object-841"><span class="linenos">841</span></a><span class="sd">            from io import BytesIO</span>
</span><span id="S3Bucket.download_object_to_file_object-842"><a href="#S3Bucket.download_object_to_file_object-842"><span class="linenos">842</span></a>
</span><span id="S3Bucket.download_object_to_file_object-843"><a href="#S3Bucket.download_object_to_file_object-843"><span class="linenos">843</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.download_object_to_file_object-844"><a href="#S3Bucket.download_object_to_file_object-844"><span class="linenos">844</span></a>
</span><span id="S3Bucket.download_object_to_file_object-845"><a href="#S3Bucket.download_object_to_file_object-845"><span class="linenos">845</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.download_object_to_file_object-846"><a href="#S3Bucket.download_object_to_file_object-846"><span class="linenos">846</span></a><span class="sd">            with BytesIO() as buf:</span>
</span><span id="S3Bucket.download_object_to_file_object-847"><a href="#S3Bucket.download_object_to_file_object-847"><span class="linenos">847</span></a><span class="sd">                s3_bucket.download_object_to_file_object(&quot;my_folder/notes.txt&quot;, buf)</span>
</span><span id="S3Bucket.download_object_to_file_object-848"><a href="#S3Bucket.download_object_to_file_object-848"><span class="linenos">848</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.download_object_to_file_object-849"><a href="#S3Bucket.download_object_to_file_object-849"><span class="linenos">849</span></a>
</span><span id="S3Bucket.download_object_to_file_object-850"><a href="#S3Bucket.download_object_to_file_object-850"><span class="linenos">850</span></a><span class="sd">            Download my_folder/notes.txt object to a BufferedWriter.</span>
</span><span id="S3Bucket.download_object_to_file_object-851"><a href="#S3Bucket.download_object_to_file_object-851"><span class="linenos">851</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.download_object_to_file_object-852"><a href="#S3Bucket.download_object_to_file_object-852"><span class="linenos">852</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.download_object_to_file_object-853"><a href="#S3Bucket.download_object_to_file_object-853"><span class="linenos">853</span></a>
</span><span id="S3Bucket.download_object_to_file_object-854"><a href="#S3Bucket.download_object_to_file_object-854"><span class="linenos">854</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.download_object_to_file_object-855"><a href="#S3Bucket.download_object_to_file_object-855"><span class="linenos">855</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;wb&quot;) as f:</span>
</span><span id="S3Bucket.download_object_to_file_object-856"><a href="#S3Bucket.download_object_to_file_object-856"><span class="linenos">856</span></a><span class="sd">                s3_bucket.download_object_to_file_object(&quot;my_folder/notes.txt&quot;, f)</span>
</span><span id="S3Bucket.download_object_to_file_object-857"><a href="#S3Bucket.download_object_to_file_object-857"><span class="linenos">857</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.download_object_to_file_object-858"><a href="#S3Bucket.download_object_to_file_object-858"><span class="linenos">858</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-859"><a href="#S3Bucket.download_object_to_file_object-859"><span class="linenos">859</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.download_object_to_file_object-860"><a href="#S3Bucket.download_object_to_file_object-860"><span class="linenos">860</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket.download_object_to_file_object-861"><a href="#S3Bucket.download_object_to_file_object-861"><span class="linenos">861</span></a>
</span><span id="S3Bucket.download_object_to_file_object-862"><a href="#S3Bucket.download_object_to_file_object-862"><span class="linenos">862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_file_object-863"><a href="#S3Bucket.download_object_to_file_object-863"><span class="linenos">863</span></a>            <span class="sa">f</span><span class="s2">&quot;Preparing to download object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-864"><a href="#S3Bucket.download_object_to_file_object-864"><span class="linenos">864</span></a>            <span class="sa">f</span><span class="s2">&quot;path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> to file object.&quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-865"><a href="#S3Bucket.download_object_to_file_object-865"><span class="linenos">865</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_file_object-866"><a href="#S3Bucket.download_object_to_file_object-866"><span class="linenos">866</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_file_object-867"><a href="#S3Bucket.download_object_to_file_object-867"><span class="linenos">867</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">download_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-868"><a href="#S3Bucket.download_object_to_file_object-868"><span class="linenos">868</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-869"><a href="#S3Bucket.download_object_to_file_object-869"><span class="linenos">869</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-870"><a href="#S3Bucket.download_object_to_file_object-870"><span class="linenos">870</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">to_file_object</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-871"><a href="#S3Bucket.download_object_to_file_object-871"><span class="linenos">871</span></a>            <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.download_object_to_file_object-872"><a href="#S3Bucket.download_object_to_file_object-872"><span class="linenos">872</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_file_object-873"><a href="#S3Bucket.download_object_to_file_object-873"><span class="linenos">873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.download_object_to_file_object-874"><a href="#S3Bucket.download_object_to_file_object-874"><span class="linenos">874</span></a>            <span class="sa">f</span><span class="s2">&quot;Downloaded object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-875"><a href="#S3Bucket.download_object_to_file_object-875"><span class="linenos">875</span></a>            <span class="s2">&quot;to file object.&quot;</span>
</span><span id="S3Bucket.download_object_to_file_object-876"><a href="#S3Bucket.download_object_to_file_object-876"><span class="linenos">876</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.download_object_to_file_object-877"><a href="#S3Bucket.download_object_to_file_object-877"><span class="linenos">877</span></a>        <span class="k">return</span> <span class="n">to_file_object</span>
</span></pre></div>


            <div class="docstring"><p>Downloads an object from the object storage service to a file-like object,
which can be a BytesIO object or a BufferedWriter.</p>

<p>Args:
    from_path: The path to the object to download from; this gets prefixed
        with the bucket_folder.
    to_file_object: The file-like object to download the object to.
    **download_kwargs: Additional keyword arguments to pass to
        <code>Client.download_fileobj</code>.</p>

<p>Returns:
    The file-like object that the object was downloaded to.</p>

<p>Examples:
    Download my_folder/notes.txt object to a BytesIO object.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
 <br />
    <span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">BytesIO</span><span class="p">()</span> <span class="k">as</span> <span class="n">buf</span><span class="p">:</span>
        <span class="n">s3_bucket</span><span class="o">.</span><span class="n">download_object_to_file_object</span><span class="p">(</span><span class="s2">&quot;my_folder/notes.txt&quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
    </code></pre>
    </div></p>

<pre><code>Download my_folder/notes.txt object to a BufferedWriter.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;wb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;download_object_to_file_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
</div>


                            </div>
                            <div id="S3Bucket.download_folder_to_path" class="classattr">
                                        <input id="S3Bucket.download_folder_to_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">download_folder_to_path</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_folder</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">to_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.download_folder_to_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.download_folder_to_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.download_folder_to_path-879"><a href="#S3Bucket.download_folder_to_path-879"><span class="linenos">879</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.download_folder_to_path-880"><a href="#S3Bucket.download_folder_to_path-880"><span class="linenos">880</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">download_folder_to_path</span><span class="p">(</span>
</span><span id="S3Bucket.download_folder_to_path-881"><a href="#S3Bucket.download_folder_to_path-881"><span class="linenos">881</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-882"><a href="#S3Bucket.download_folder_to_path-882"><span class="linenos">882</span></a>        <span class="n">from_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-883"><a href="#S3Bucket.download_folder_to_path-883"><span class="linenos">883</span></a>        <span class="n">to_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-884"><a href="#S3Bucket.download_folder_to_path-884"><span class="linenos">884</span></a>        <span class="o">**</span><span class="n">download_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.download_folder_to_path-885"><a href="#S3Bucket.download_folder_to_path-885"><span class="linenos">885</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
</span><span id="S3Bucket.download_folder_to_path-886"><a href="#S3Bucket.download_folder_to_path-886"><span class="linenos">886</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_folder_to_path-887"><a href="#S3Bucket.download_folder_to_path-887"><span class="linenos">887</span></a><span class="sd">        Downloads objects *within* a folder (excluding the folder itself)</span>
</span><span id="S3Bucket.download_folder_to_path-888"><a href="#S3Bucket.download_folder_to_path-888"><span class="linenos">888</span></a><span class="sd">        from the S3 bucket to a folder.</span>
</span><span id="S3Bucket.download_folder_to_path-889"><a href="#S3Bucket.download_folder_to_path-889"><span class="linenos">889</span></a>
</span><span id="S3Bucket.download_folder_to_path-890"><a href="#S3Bucket.download_folder_to_path-890"><span class="linenos">890</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.download_folder_to_path-891"><a href="#S3Bucket.download_folder_to_path-891"><span class="linenos">891</span></a><span class="sd">            from_folder: The path to the folder to download from.</span>
</span><span id="S3Bucket.download_folder_to_path-892"><a href="#S3Bucket.download_folder_to_path-892"><span class="linenos">892</span></a><span class="sd">            to_folder: The path to download the folder to.</span>
</span><span id="S3Bucket.download_folder_to_path-893"><a href="#S3Bucket.download_folder_to_path-893"><span class="linenos">893</span></a><span class="sd">            **download_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.download_folder_to_path-894"><a href="#S3Bucket.download_folder_to_path-894"><span class="linenos">894</span></a><span class="sd">                `Client.download_file`.</span>
</span><span id="S3Bucket.download_folder_to_path-895"><a href="#S3Bucket.download_folder_to_path-895"><span class="linenos">895</span></a>
</span><span id="S3Bucket.download_folder_to_path-896"><a href="#S3Bucket.download_folder_to_path-896"><span class="linenos">896</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.download_folder_to_path-897"><a href="#S3Bucket.download_folder_to_path-897"><span class="linenos">897</span></a><span class="sd">            The absolute path that the folder was downloaded to.</span>
</span><span id="S3Bucket.download_folder_to_path-898"><a href="#S3Bucket.download_folder_to_path-898"><span class="linenos">898</span></a>
</span><span id="S3Bucket.download_folder_to_path-899"><a href="#S3Bucket.download_folder_to_path-899"><span class="linenos">899</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.download_folder_to_path-900"><a href="#S3Bucket.download_folder_to_path-900"><span class="linenos">900</span></a><span class="sd">            Download my_folder to a local folder named my_folder.</span>
</span><span id="S3Bucket.download_folder_to_path-901"><a href="#S3Bucket.download_folder_to_path-901"><span class="linenos">901</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.download_folder_to_path-902"><a href="#S3Bucket.download_folder_to_path-902"><span class="linenos">902</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.download_folder_to_path-903"><a href="#S3Bucket.download_folder_to_path-903"><span class="linenos">903</span></a>
</span><span id="S3Bucket.download_folder_to_path-904"><a href="#S3Bucket.download_folder_to_path-904"><span class="linenos">904</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.download_folder_to_path-905"><a href="#S3Bucket.download_folder_to_path-905"><span class="linenos">905</span></a><span class="sd">            s3_bucket.download_folder_to_path(&quot;my_folder&quot;, &quot;my_folder&quot;)</span>
</span><span id="S3Bucket.download_folder_to_path-906"><a href="#S3Bucket.download_folder_to_path-906"><span class="linenos">906</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.download_folder_to_path-907"><a href="#S3Bucket.download_folder_to_path-907"><span class="linenos">907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.download_folder_to_path-908"><a href="#S3Bucket.download_folder_to_path-908"><span class="linenos">908</span></a>        <span class="k">if</span> <span class="n">to_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.download_folder_to_path-909"><a href="#S3Bucket.download_folder_to_path-909"><span class="linenos">909</span></a>            <span class="n">to_folder</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="S3Bucket.download_folder_to_path-910"><a href="#S3Bucket.download_folder_to_path-910"><span class="linenos">910</span></a>        <span class="n">to_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_folder</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">()</span>
</span><span id="S3Bucket.download_folder_to_path-911"><a href="#S3Bucket.download_folder_to_path-911"><span class="linenos">911</span></a>
</span><span id="S3Bucket.download_folder_to_path-912"><a href="#S3Bucket.download_folder_to_path-912"><span class="linenos">912</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.download_folder_to_path-913"><a href="#S3Bucket.download_folder_to_path-913"><span class="linenos">913</span></a>        <span class="n">objects</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_objects</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-914"><a href="#S3Bucket.download_folder_to_path-914"><span class="linenos">914</span></a>
</span><span id="S3Bucket.download_folder_to_path-915"><a href="#S3Bucket.download_folder_to_path-915"><span class="linenos">915</span></a>        <span class="c1"># do not call self._join_bucket_folder for filter</span>
</span><span id="S3Bucket.download_folder_to_path-916"><a href="#S3Bucket.download_folder_to_path-916"><span class="linenos">916</span></a>        <span class="c1"># because it&#39;s built-in to that method already!</span>
</span><span id="S3Bucket.download_folder_to_path-917"><a href="#S3Bucket.download_folder_to_path-917"><span class="linenos">917</span></a>        <span class="c1"># however, we still need to do it because we&#39;re using relative_to</span>
</span><span id="S3Bucket.download_folder_to_path-918"><a href="#S3Bucket.download_folder_to_path-918"><span class="linenos">918</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-919"><a href="#S3Bucket.download_folder_to_path-919"><span class="linenos">919</span></a>
</span><span id="S3Bucket.download_folder_to_path-920"><a href="#S3Bucket.download_folder_to_path-920"><span class="linenos">920</span></a>        <span class="n">async_coros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="S3Bucket.download_folder_to_path-921"><a href="#S3Bucket.download_folder_to_path-921"><span class="linenos">921</span></a>        <span class="k">for</span> <span class="nb">object</span> <span class="ow">in</span> <span class="n">objects</span><span class="p">:</span>
</span><span id="S3Bucket.download_folder_to_path-922"><a href="#S3Bucket.download_folder_to_path-922"><span class="linenos">922</span></a>            <span class="n">bucket_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">object</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-923"><a href="#S3Bucket.download_folder_to_path-923"><span class="linenos">923</span></a>            <span class="c1"># this skips the actual directory itself, e.g.</span>
</span><span id="S3Bucket.download_folder_to_path-924"><a href="#S3Bucket.download_folder_to_path-924"><span class="linenos">924</span></a>            <span class="c1"># `my_folder/` will be skipped</span>
</span><span id="S3Bucket.download_folder_to_path-925"><a href="#S3Bucket.download_folder_to_path-925"><span class="linenos">925</span></a>            <span class="c1"># `my_folder/notes.txt` will be downloaded</span>
</span><span id="S3Bucket.download_folder_to_path-926"><a href="#S3Bucket.download_folder_to_path-926"><span class="linenos">926</span></a>            <span class="k">if</span> <span class="n">bucket_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket.download_folder_to_path-927"><a href="#S3Bucket.download_folder_to_path-927"><span class="linenos">927</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket.download_folder_to_path-928"><a href="#S3Bucket.download_folder_to_path-928"><span class="linenos">928</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">to_folder</span> <span class="o">/</span> <span class="n">bucket_path</span>
</span><span id="S3Bucket.download_folder_to_path-929"><a href="#S3Bucket.download_folder_to_path-929"><span class="linenos">929</span></a>            <span class="n">to_path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-930"><a href="#S3Bucket.download_folder_to_path-930"><span class="linenos">930</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span>  <span class="c1"># must be string</span>
</span><span id="S3Bucket.download_folder_to_path-931"><a href="#S3Bucket.download_folder_to_path-931"><span class="linenos">931</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.download_folder_to_path-932"><a href="#S3Bucket.download_folder_to_path-932"><span class="linenos">932</span></a>                <span class="sa">f</span><span class="s2">&quot;Downloading object from bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path &quot;</span>
</span><span id="S3Bucket.download_folder_to_path-933"><a href="#S3Bucket.download_folder_to_path-933"><span class="linenos">933</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bucket_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span><span class="si">!r}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.download_folder_to_path-934"><a href="#S3Bucket.download_folder_to_path-934"><span class="linenos">934</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-935"><a href="#S3Bucket.download_folder_to_path-935"><span class="linenos">935</span></a>            <span class="n">async_coros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="S3Bucket.download_folder_to_path-936"><a href="#S3Bucket.download_folder_to_path-936"><span class="linenos">936</span></a>                <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.download_folder_to_path-937"><a href="#S3Bucket.download_folder_to_path-937"><span class="linenos">937</span></a>                    <span class="n">client</span><span class="o">.</span><span class="n">download_file</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-938"><a href="#S3Bucket.download_folder_to_path-938"><span class="linenos">938</span></a>                    <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-939"><a href="#S3Bucket.download_folder_to_path-939"><span class="linenos">939</span></a>                    <span class="n">Key</span><span class="o">=</span><span class="nb">object</span><span class="p">[</span><span class="s2">&quot;Key&quot;</span><span class="p">],</span>
</span><span id="S3Bucket.download_folder_to_path-940"><a href="#S3Bucket.download_folder_to_path-940"><span class="linenos">940</span></a>                    <span class="n">Filename</span><span class="o">=</span><span class="n">to_path</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-941"><a href="#S3Bucket.download_folder_to_path-941"><span class="linenos">941</span></a>                    <span class="o">**</span><span class="n">download_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.download_folder_to_path-942"><a href="#S3Bucket.download_folder_to_path-942"><span class="linenos">942</span></a>                <span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-943"><a href="#S3Bucket.download_folder_to_path-943"><span class="linenos">943</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-944"><a href="#S3Bucket.download_folder_to_path-944"><span class="linenos">944</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">async_coros</span><span class="p">)</span>
</span><span id="S3Bucket.download_folder_to_path-945"><a href="#S3Bucket.download_folder_to_path-945"><span class="linenos">945</span></a>
</span><span id="S3Bucket.download_folder_to_path-946"><a href="#S3Bucket.download_folder_to_path-946"><span class="linenos">946</span></a>        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_folder</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Downloads objects <em>within</em> a folder (excluding the folder itself)
from the S3 bucket to a folder.</p>

<p>Args:
    from_folder: The path to the folder to download from.
    to_folder: The path to download the folder to.
    **download_kwargs: Additional keyword arguments to pass to
        <code>Client.download_file</code>.</p>

<p>Returns:
    The absolute path that the folder was downloaded to.</p>

<p>Examples:
    Download my_folder to a local folder named my_folder.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="n">s3_bucket</span><span class="o">.</span><span class="n">download_folder_to_path</span><span class="p">(</span><span class="s2">&quot;my_folder&quot;</span><span class="p">,</span> <span class="s2">&quot;my_folder&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.stream_from" class="classattr">
                                        <input id="S3Bucket.stream_from-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">stream_from</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">bucket</span><span class="p">:</span> <span class="n"><a href="#S3Bucket">S3Bucket</a></span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.stream_from-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.stream_from"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.stream_from-948"><a href="#S3Bucket.stream_from-948"><span class="linenos"> 948</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.stream_from-949"><a href="#S3Bucket.stream_from-949"><span class="linenos"> 949</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">stream_from</span><span class="p">(</span>
</span><span id="S3Bucket.stream_from-950"><a href="#S3Bucket.stream_from-950"><span class="linenos"> 950</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-951"><a href="#S3Bucket.stream_from-951"><span class="linenos"> 951</span></a>        <span class="n">bucket</span><span class="p">:</span> <span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-952"><a href="#S3Bucket.stream_from-952"><span class="linenos"> 952</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-953"><a href="#S3Bucket.stream_from-953"><span class="linenos"> 953</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-954"><a href="#S3Bucket.stream_from-954"><span class="linenos"> 954</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.stream_from-955"><a href="#S3Bucket.stream_from-955"><span class="linenos"> 955</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.stream_from-956"><a href="#S3Bucket.stream_from-956"><span class="linenos"> 956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Streams an object from another bucket to this bucket. Requires the</span>
</span><span id="S3Bucket.stream_from-957"><a href="#S3Bucket.stream_from-957"><span class="linenos"> 957</span></a><span class="sd">        object to be downloaded and uploaded in chunks. If `self`&#39;s credentials</span>
</span><span id="S3Bucket.stream_from-958"><a href="#S3Bucket.stream_from-958"><span class="linenos"> 958</span></a><span class="sd">        allow for writes to the other bucket, try using `S3Bucket.copy_object`.</span>
</span><span id="S3Bucket.stream_from-959"><a href="#S3Bucket.stream_from-959"><span class="linenos"> 959</span></a>
</span><span id="S3Bucket.stream_from-960"><a href="#S3Bucket.stream_from-960"><span class="linenos"> 960</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.stream_from-961"><a href="#S3Bucket.stream_from-961"><span class="linenos"> 961</span></a><span class="sd">            bucket: The bucket to stream from.</span>
</span><span id="S3Bucket.stream_from-962"><a href="#S3Bucket.stream_from-962"><span class="linenos"> 962</span></a><span class="sd">            from_path: The path of the object to stream.</span>
</span><span id="S3Bucket.stream_from-963"><a href="#S3Bucket.stream_from-963"><span class="linenos"> 963</span></a><span class="sd">            to_path: The path to stream the object to. Defaults to the object&#39;s name.</span>
</span><span id="S3Bucket.stream_from-964"><a href="#S3Bucket.stream_from-964"><span class="linenos"> 964</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.stream_from-965"><a href="#S3Bucket.stream_from-965"><span class="linenos"> 965</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket.stream_from-966"><a href="#S3Bucket.stream_from-966"><span class="linenos"> 966</span></a>
</span><span id="S3Bucket.stream_from-967"><a href="#S3Bucket.stream_from-967"><span class="linenos"> 967</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.stream_from-968"><a href="#S3Bucket.stream_from-968"><span class="linenos"> 968</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket.stream_from-969"><a href="#S3Bucket.stream_from-969"><span class="linenos"> 969</span></a>
</span><span id="S3Bucket.stream_from-970"><a href="#S3Bucket.stream_from-970"><span class="linenos"> 970</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.stream_from-971"><a href="#S3Bucket.stream_from-971"><span class="linenos"> 971</span></a><span class="sd">            Stream notes.txt from your-bucket/notes.txt to my-bucket/landed/notes.txt.</span>
</span><span id="S3Bucket.stream_from-972"><a href="#S3Bucket.stream_from-972"><span class="linenos"> 972</span></a>
</span><span id="S3Bucket.stream_from-973"><a href="#S3Bucket.stream_from-973"><span class="linenos"> 973</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.stream_from-974"><a href="#S3Bucket.stream_from-974"><span class="linenos"> 974</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.stream_from-975"><a href="#S3Bucket.stream_from-975"><span class="linenos"> 975</span></a>
</span><span id="S3Bucket.stream_from-976"><a href="#S3Bucket.stream_from-976"><span class="linenos"> 976</span></a><span class="sd">            your_s3_bucket = S3Bucket.load(&quot;your-bucket&quot;)</span>
</span><span id="S3Bucket.stream_from-977"><a href="#S3Bucket.stream_from-977"><span class="linenos"> 977</span></a><span class="sd">            my_s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.stream_from-978"><a href="#S3Bucket.stream_from-978"><span class="linenos"> 978</span></a>
</span><span id="S3Bucket.stream_from-979"><a href="#S3Bucket.stream_from-979"><span class="linenos"> 979</span></a><span class="sd">            my_s3_bucket.stream_from(</span>
</span><span id="S3Bucket.stream_from-980"><a href="#S3Bucket.stream_from-980"><span class="linenos"> 980</span></a><span class="sd">                your_s3_bucket,</span>
</span><span id="S3Bucket.stream_from-981"><a href="#S3Bucket.stream_from-981"><span class="linenos"> 981</span></a><span class="sd">                &quot;notes.txt&quot;,</span>
</span><span id="S3Bucket.stream_from-982"><a href="#S3Bucket.stream_from-982"><span class="linenos"> 982</span></a><span class="sd">                to_path=&quot;landed/notes.txt&quot;</span>
</span><span id="S3Bucket.stream_from-983"><a href="#S3Bucket.stream_from-983"><span class="linenos"> 983</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.stream_from-984"><a href="#S3Bucket.stream_from-984"><span class="linenos"> 984</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.stream_from-985"><a href="#S3Bucket.stream_from-985"><span class="linenos"> 985</span></a>
</span><span id="S3Bucket.stream_from-986"><a href="#S3Bucket.stream_from-986"><span class="linenos"> 986</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.stream_from-987"><a href="#S3Bucket.stream_from-987"><span class="linenos"> 987</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.stream_from-988"><a href="#S3Bucket.stream_from-988"><span class="linenos"> 988</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket.stream_from-989"><a href="#S3Bucket.stream_from-989"><span class="linenos"> 989</span></a>
</span><span id="S3Bucket.stream_from-990"><a href="#S3Bucket.stream_from-990"><span class="linenos"> 990</span></a>        <span class="c1"># Get the source object&#39;s StreamingBody</span>
</span><span id="S3Bucket.stream_from-991"><a href="#S3Bucket.stream_from-991"><span class="linenos"> 991</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span>
</span><span id="S3Bucket.stream_from-992"><a href="#S3Bucket.stream_from-992"><span class="linenos"> 992</span></a>        <span class="n">from_client</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.stream_from-993"><a href="#S3Bucket.stream_from-993"><span class="linenos"> 993</span></a>        <span class="n">obj</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.stream_from-994"><a href="#S3Bucket.stream_from-994"><span class="linenos"> 994</span></a>            <span class="n">from_client</span><span class="o">.</span><span class="n">get_object</span><span class="p">,</span> <span class="n">Bucket</span><span class="o">=</span><span class="n">bucket</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">from_path</span>
</span><span id="S3Bucket.stream_from-995"><a href="#S3Bucket.stream_from-995"><span class="linenos"> 995</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.stream_from-996"><a href="#S3Bucket.stream_from-996"><span class="linenos"> 996</span></a>        <span class="n">body</span><span class="p">:</span> <span class="n">StreamingBody</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;Body&quot;</span><span class="p">]</span>
</span><span id="S3Bucket.stream_from-997"><a href="#S3Bucket.stream_from-997"><span class="linenos"> 997</span></a>
</span><span id="S3Bucket.stream_from-998"><a href="#S3Bucket.stream_from-998"><span class="linenos"> 998</span></a>        <span class="c1"># Upload the StreamingBody to this bucket</span>
</span><span id="S3Bucket.stream_from-999"><a href="#S3Bucket.stream_from-999"><span class="linenos"> 999</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket.stream_from-1000"><a href="#S3Bucket.stream_from-1000"><span class="linenos">1000</span></a>        <span class="n">to_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.stream_from-1001"><a href="#S3Bucket.stream_from-1001"><span class="linenos">1001</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.stream_from-1002"><a href="#S3Bucket.stream_from-1002"><span class="linenos">1002</span></a>            <span class="n">to_client</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-1003"><a href="#S3Bucket.stream_from-1003"><span class="linenos">1003</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">body</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-1004"><a href="#S3Bucket.stream_from-1004"><span class="linenos">1004</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-1005"><a href="#S3Bucket.stream_from-1005"><span class="linenos">1005</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-1006"><a href="#S3Bucket.stream_from-1006"><span class="linenos">1006</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.stream_from-1007"><a href="#S3Bucket.stream_from-1007"><span class="linenos">1007</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.stream_from-1008"><a href="#S3Bucket.stream_from-1008"><span class="linenos">1008</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.stream_from-1009"><a href="#S3Bucket.stream_from-1009"><span class="linenos">1009</span></a>            <span class="sa">f</span><span class="s2">&quot;Streamed s3://</span><span class="si">{</span><span class="n">bucket</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">from_path</span><span class="si">}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket.stream_from-1010"><a href="#S3Bucket.stream_from-1010"><span class="linenos">1010</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.stream_from-1011"><a href="#S3Bucket.stream_from-1011"><span class="linenos">1011</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.stream_from-1012"><a href="#S3Bucket.stream_from-1012"><span class="linenos">1012</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span></pre></div>


            <div class="docstring"><p>Streams an object from another bucket to this bucket. Requires the
object to be downloaded and uploaded in chunks. If <code>self</code>'s credentials
allow for writes to the other bucket, try using <code><a href="#S3Bucket.copy_object">S3Bucket.copy_object</a></code>.</p>

<p>Args:
    bucket: The bucket to stream from.
    from_path: The path of the object to stream.
    to_path: The path to stream the object to. Defaults to the object's name.
    **upload_kwargs: Additional keyword arguments to pass to
        <code>Client.upload_fileobj</code>.</p>

<p>Returns:
    The path that the object was uploaded to.</p>

<p>Examples:
    Stream notes.txt from your-bucket/notes.txt to my-bucket/landed/notes.txt.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">your_s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;your-bucket&quot;</span><span class="p">)</span>
    <span class="n">my_s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
 <br />
    <span class="n">my_s3_bucket</span><span class="o">.</span><span class="n">stream_from</span><span class="p">(</span>
        <span class="n">your_s3_bucket</span><span class="p">,</span>
        <span class="s2">&quot;notes.txt&quot;</span><span class="p">,</span>
        <span class="n">to_path</span><span class="o">=</span><span class="s2">&quot;landed/notes.txt&quot;</span>
    <span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.upload_from_path" class="classattr">
                                        <input id="S3Bucket.upload_from_path-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">upload_from_path</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.upload_from_path-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.upload_from_path"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.upload_from_path-1014"><a href="#S3Bucket.upload_from_path-1014"><span class="linenos">1014</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.upload_from_path-1015"><a href="#S3Bucket.upload_from_path-1015"><span class="linenos">1015</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_path</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_path-1016"><a href="#S3Bucket.upload_from_path-1016"><span class="linenos">1016</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1017"><a href="#S3Bucket.upload_from_path-1017"><span class="linenos">1017</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.upload_from_path-1018"><a href="#S3Bucket.upload_from_path-1018"><span class="linenos">1018</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1019"><a href="#S3Bucket.upload_from_path-1019"><span class="linenos">1019</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.upload_from_path-1020"><a href="#S3Bucket.upload_from_path-1020"><span class="linenos">1020</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_path-1021"><a href="#S3Bucket.upload_from_path-1021"><span class="linenos">1021</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_path-1022"><a href="#S3Bucket.upload_from_path-1022"><span class="linenos">1022</span></a><span class="sd">        Uploads an object from a path to the S3 bucket.</span>
</span><span id="S3Bucket.upload_from_path-1023"><a href="#S3Bucket.upload_from_path-1023"><span class="linenos">1023</span></a>
</span><span id="S3Bucket.upload_from_path-1024"><a href="#S3Bucket.upload_from_path-1024"><span class="linenos">1024</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.upload_from_path-1025"><a href="#S3Bucket.upload_from_path-1025"><span class="linenos">1025</span></a><span class="sd">            from_path: The path to the file to upload from.</span>
</span><span id="S3Bucket.upload_from_path-1026"><a href="#S3Bucket.upload_from_path-1026"><span class="linenos">1026</span></a><span class="sd">            to_path: The path to upload the file to.</span>
</span><span id="S3Bucket.upload_from_path-1027"><a href="#S3Bucket.upload_from_path-1027"><span class="linenos">1027</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to `Client.upload`.</span>
</span><span id="S3Bucket.upload_from_path-1028"><a href="#S3Bucket.upload_from_path-1028"><span class="linenos">1028</span></a>
</span><span id="S3Bucket.upload_from_path-1029"><a href="#S3Bucket.upload_from_path-1029"><span class="linenos">1029</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.upload_from_path-1030"><a href="#S3Bucket.upload_from_path-1030"><span class="linenos">1030</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket.upload_from_path-1031"><a href="#S3Bucket.upload_from_path-1031"><span class="linenos">1031</span></a>
</span><span id="S3Bucket.upload_from_path-1032"><a href="#S3Bucket.upload_from_path-1032"><span class="linenos">1032</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.upload_from_path-1033"><a href="#S3Bucket.upload_from_path-1033"><span class="linenos">1033</span></a><span class="sd">            Upload notes.txt to my_folder/notes.txt.</span>
</span><span id="S3Bucket.upload_from_path-1034"><a href="#S3Bucket.upload_from_path-1034"><span class="linenos">1034</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.upload_from_path-1035"><a href="#S3Bucket.upload_from_path-1035"><span class="linenos">1035</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.upload_from_path-1036"><a href="#S3Bucket.upload_from_path-1036"><span class="linenos">1036</span></a>
</span><span id="S3Bucket.upload_from_path-1037"><a href="#S3Bucket.upload_from_path-1037"><span class="linenos">1037</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.upload_from_path-1038"><a href="#S3Bucket.upload_from_path-1038"><span class="linenos">1038</span></a><span class="sd">            s3_bucket.upload_from_path(&quot;notes.txt&quot;, &quot;my_folder/notes.txt&quot;)</span>
</span><span id="S3Bucket.upload_from_path-1039"><a href="#S3Bucket.upload_from_path-1039"><span class="linenos">1039</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.upload_from_path-1040"><a href="#S3Bucket.upload_from_path-1040"><span class="linenos">1040</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_path-1041"><a href="#S3Bucket.upload_from_path-1041"><span class="linenos">1041</span></a>        <span class="n">from_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">absolute</span><span class="p">())</span>
</span><span id="S3Bucket.upload_from_path-1042"><a href="#S3Bucket.upload_from_path-1042"><span class="linenos">1042</span></a>        <span class="k">if</span> <span class="n">to_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_path-1043"><a href="#S3Bucket.upload_from_path-1043"><span class="linenos">1043</span></a>            <span class="n">to_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
</span><span id="S3Bucket.upload_from_path-1044"><a href="#S3Bucket.upload_from_path-1044"><span class="linenos">1044</span></a>
</span><span id="S3Bucket.upload_from_path-1045"><a href="#S3Bucket.upload_from_path-1045"><span class="linenos">1045</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket.upload_from_path-1046"><a href="#S3Bucket.upload_from_path-1046"><span class="linenos">1046</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.upload_from_path-1047"><a href="#S3Bucket.upload_from_path-1047"><span class="linenos">1047</span></a>
</span><span id="S3Bucket.upload_from_path-1048"><a href="#S3Bucket.upload_from_path-1048"><span class="linenos">1048</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_path-1049"><a href="#S3Bucket.upload_from_path-1049"><span class="linenos">1049</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1050"><a href="#S3Bucket.upload_from_path-1050"><span class="linenos">1050</span></a>            <span class="n">Filename</span><span class="o">=</span><span class="n">from_path</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1051"><a href="#S3Bucket.upload_from_path-1051"><span class="linenos">1051</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1052"><a href="#S3Bucket.upload_from_path-1052"><span class="linenos">1052</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1053"><a href="#S3Bucket.upload_from_path-1053"><span class="linenos">1053</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_path-1054"><a href="#S3Bucket.upload_from_path-1054"><span class="linenos">1054</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.upload_from_path-1055"><a href="#S3Bucket.upload_from_path-1055"><span class="linenos">1055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_path-1056"><a href="#S3Bucket.upload_from_path-1056"><span class="linenos">1056</span></a>            <span class="sa">f</span><span class="s2">&quot;Uploaded from </span><span class="si">{</span><span class="n">from_path</span><span class="si">!r}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket.upload_from_path-1057"><a href="#S3Bucket.upload_from_path-1057"><span class="linenos">1057</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.upload_from_path-1058"><a href="#S3Bucket.upload_from_path-1058"><span class="linenos">1058</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.upload_from_path-1059"><a href="#S3Bucket.upload_from_path-1059"><span class="linenos">1059</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span></pre></div>


            <div class="docstring"><p>Uploads an object from a path to the S3 bucket.</p>

<p>Args:
    from_path: The path to the file to upload from.
    to_path: The path to upload the file to.
    **upload_kwargs: Additional keyword arguments to pass to <code>Client.upload</code>.</p>

<p>Returns:
    The path that the object was uploaded to.</p>

<p>Examples:
    Upload notes.txt to my_folder/notes.txt.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="n">s3_bucket</span><span class="o">.</span><span class="n">upload_from_path</span><span class="p">(</span><span class="s2">&quot;notes.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;my_folder/notes.txt&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.upload_from_file_object" class="classattr">
                                        <input id="S3Bucket.upload_from_file_object-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">upload_from_file_object</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	from_file_object: &lt;class &#x27;BinaryIO&#x27;&gt;,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.upload_from_file_object-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.upload_from_file_object"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.upload_from_file_object-1061"><a href="#S3Bucket.upload_from_file_object-1061"><span class="linenos">1061</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.upload_from_file_object-1062"><a href="#S3Bucket.upload_from_file_object-1062"><span class="linenos">1062</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_file_object</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_file_object-1063"><a href="#S3Bucket.upload_from_file_object-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">from_file_object</span><span class="p">:</span> <span class="n">BinaryIO</span><span class="p">,</span> <span class="n">to_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="S3Bucket.upload_from_file_object-1064"><a href="#S3Bucket.upload_from_file_object-1064"><span class="linenos">1064</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_file_object-1065"><a href="#S3Bucket.upload_from_file_object-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_file_object-1066"><a href="#S3Bucket.upload_from_file_object-1066"><span class="linenos">1066</span></a><span class="sd">        Uploads an object to the S3 bucket from a file-like object,</span>
</span><span id="S3Bucket.upload_from_file_object-1067"><a href="#S3Bucket.upload_from_file_object-1067"><span class="linenos">1067</span></a><span class="sd">        which can be a BytesIO object or a BufferedReader.</span>
</span><span id="S3Bucket.upload_from_file_object-1068"><a href="#S3Bucket.upload_from_file_object-1068"><span class="linenos">1068</span></a>
</span><span id="S3Bucket.upload_from_file_object-1069"><a href="#S3Bucket.upload_from_file_object-1069"><span class="linenos">1069</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.upload_from_file_object-1070"><a href="#S3Bucket.upload_from_file_object-1070"><span class="linenos">1070</span></a><span class="sd">            from_file_object: The file-like object to upload from.</span>
</span><span id="S3Bucket.upload_from_file_object-1071"><a href="#S3Bucket.upload_from_file_object-1071"><span class="linenos">1071</span></a><span class="sd">            to_path: The path to upload the object to.</span>
</span><span id="S3Bucket.upload_from_file_object-1072"><a href="#S3Bucket.upload_from_file_object-1072"><span class="linenos">1072</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.upload_from_file_object-1073"><a href="#S3Bucket.upload_from_file_object-1073"><span class="linenos">1073</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket.upload_from_file_object-1074"><a href="#S3Bucket.upload_from_file_object-1074"><span class="linenos">1074</span></a>
</span><span id="S3Bucket.upload_from_file_object-1075"><a href="#S3Bucket.upload_from_file_object-1075"><span class="linenos">1075</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.upload_from_file_object-1076"><a href="#S3Bucket.upload_from_file_object-1076"><span class="linenos">1076</span></a><span class="sd">            The path that the object was uploaded to.</span>
</span><span id="S3Bucket.upload_from_file_object-1077"><a href="#S3Bucket.upload_from_file_object-1077"><span class="linenos">1077</span></a>
</span><span id="S3Bucket.upload_from_file_object-1078"><a href="#S3Bucket.upload_from_file_object-1078"><span class="linenos">1078</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.upload_from_file_object-1079"><a href="#S3Bucket.upload_from_file_object-1079"><span class="linenos">1079</span></a><span class="sd">            Upload BytesIO object to my_folder/notes.txt.</span>
</span><span id="S3Bucket.upload_from_file_object-1080"><a href="#S3Bucket.upload_from_file_object-1080"><span class="linenos">1080</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.upload_from_file_object-1081"><a href="#S3Bucket.upload_from_file_object-1081"><span class="linenos">1081</span></a><span class="sd">            from io import BytesIO</span>
</span><span id="S3Bucket.upload_from_file_object-1082"><a href="#S3Bucket.upload_from_file_object-1082"><span class="linenos">1082</span></a>
</span><span id="S3Bucket.upload_from_file_object-1083"><a href="#S3Bucket.upload_from_file_object-1083"><span class="linenos">1083</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.upload_from_file_object-1084"><a href="#S3Bucket.upload_from_file_object-1084"><span class="linenos">1084</span></a>
</span><span id="S3Bucket.upload_from_file_object-1085"><a href="#S3Bucket.upload_from_file_object-1085"><span class="linenos">1085</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.upload_from_file_object-1086"><a href="#S3Bucket.upload_from_file_object-1086"><span class="linenos">1086</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;rb&quot;) as f:</span>
</span><span id="S3Bucket.upload_from_file_object-1087"><a href="#S3Bucket.upload_from_file_object-1087"><span class="linenos">1087</span></a><span class="sd">                s3_bucket.upload_from_file_object(f, &quot;my_folder/notes.txt&quot;)</span>
</span><span id="S3Bucket.upload_from_file_object-1088"><a href="#S3Bucket.upload_from_file_object-1088"><span class="linenos">1088</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.upload_from_file_object-1089"><a href="#S3Bucket.upload_from_file_object-1089"><span class="linenos">1089</span></a>
</span><span id="S3Bucket.upload_from_file_object-1090"><a href="#S3Bucket.upload_from_file_object-1090"><span class="linenos">1090</span></a><span class="sd">            Upload BufferedReader object to my_folder/notes.txt.</span>
</span><span id="S3Bucket.upload_from_file_object-1091"><a href="#S3Bucket.upload_from_file_object-1091"><span class="linenos">1091</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.upload_from_file_object-1092"><a href="#S3Bucket.upload_from_file_object-1092"><span class="linenos">1092</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.upload_from_file_object-1093"><a href="#S3Bucket.upload_from_file_object-1093"><span class="linenos">1093</span></a>
</span><span id="S3Bucket.upload_from_file_object-1094"><a href="#S3Bucket.upload_from_file_object-1094"><span class="linenos">1094</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.upload_from_file_object-1095"><a href="#S3Bucket.upload_from_file_object-1095"><span class="linenos">1095</span></a><span class="sd">            with open(&quot;notes.txt&quot;, &quot;rb&quot;) as f:</span>
</span><span id="S3Bucket.upload_from_file_object-1096"><a href="#S3Bucket.upload_from_file_object-1096"><span class="linenos">1096</span></a><span class="sd">                s3_bucket.upload_from_file_object(</span>
</span><span id="S3Bucket.upload_from_file_object-1097"><a href="#S3Bucket.upload_from_file_object-1097"><span class="linenos">1097</span></a><span class="sd">                    f, &quot;my_folder/notes.txt&quot;</span>
</span><span id="S3Bucket.upload_from_file_object-1098"><a href="#S3Bucket.upload_from_file_object-1098"><span class="linenos">1098</span></a><span class="sd">                )</span>
</span><span id="S3Bucket.upload_from_file_object-1099"><a href="#S3Bucket.upload_from_file_object-1099"><span class="linenos">1099</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.upload_from_file_object-1100"><a href="#S3Bucket.upload_from_file_object-1100"><span class="linenos">1100</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_file_object-1101"><a href="#S3Bucket.upload_from_file_object-1101"><span class="linenos">1101</span></a>        <span class="n">bucket_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_path</span><span class="p">))</span>
</span><span id="S3Bucket.upload_from_file_object-1102"><a href="#S3Bucket.upload_from_file_object-1102"><span class="linenos">1102</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.upload_from_file_object-1103"><a href="#S3Bucket.upload_from_file_object-1103"><span class="linenos">1103</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_file_object-1104"><a href="#S3Bucket.upload_from_file_object-1104"><span class="linenos">1104</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">upload_fileobj</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_file_object-1105"><a href="#S3Bucket.upload_from_file_object-1105"><span class="linenos">1105</span></a>            <span class="n">Fileobj</span><span class="o">=</span><span class="n">from_file_object</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_file_object-1106"><a href="#S3Bucket.upload_from_file_object-1106"><span class="linenos">1106</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_file_object-1107"><a href="#S3Bucket.upload_from_file_object-1107"><span class="linenos">1107</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_file_object-1108"><a href="#S3Bucket.upload_from_file_object-1108"><span class="linenos">1108</span></a>            <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_file_object-1109"><a href="#S3Bucket.upload_from_file_object-1109"><span class="linenos">1109</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.upload_from_file_object-1110"><a href="#S3Bucket.upload_from_file_object-1110"><span class="linenos">1110</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_file_object-1111"><a href="#S3Bucket.upload_from_file_object-1111"><span class="linenos">1111</span></a>            <span class="s2">&quot;Uploaded from file object to the bucket &quot;</span>
</span><span id="S3Bucket.upload_from_file_object-1112"><a href="#S3Bucket.upload_from_file_object-1112"><span class="linenos">1112</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.upload_from_file_object-1113"><a href="#S3Bucket.upload_from_file_object-1113"><span class="linenos">1113</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.upload_from_file_object-1114"><a href="#S3Bucket.upload_from_file_object-1114"><span class="linenos">1114</span></a>        <span class="k">return</span> <span class="n">bucket_path</span>
</span></pre></div>


            <div class="docstring"><p>Uploads an object to the S3 bucket from a file-like object,
which can be a BytesIO object or a BufferedReader.</p>

<p>Args:
    from_file_object: The file-like object to upload from.
    to_path: The path to upload the object to.
    **upload_kwargs: Additional keyword arguments to pass to
        <code>Client.upload_fileobj</code>.</p>

<p>Returns:
    The path that the object was uploaded to.</p>

<p>Examples:
    Upload BytesIO object to my_folder/notes.txt.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">BytesIO</span>
 <br />
    <span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;notes.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">s3_bucket</span><span class="o">.</span><span class="n">upload_from_file_object</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;my_folder/notes.txt&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>

<pre><code>Upload BufferedReader object to my_folder/notes.txt.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="k"&gt;with&lt;/span&gt; &lt;span class="nb"&gt;open&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;rb&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt; &lt;span class="k"&gt;as&lt;/span&gt; &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
    &lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;upload_from_file_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
        &lt;span class="n"&gt;f&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;
    &lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
</div>


                            </div>
                            <div id="S3Bucket.upload_from_folder" class="classattr">
                                        <input id="S3Bucket.upload_from_folder-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">upload_from_folder</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.upload_from_folder-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.upload_from_folder"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.upload_from_folder-1116"><a href="#S3Bucket.upload_from_folder-1116"><span class="linenos">1116</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.upload_from_folder-1117"><a href="#S3Bucket.upload_from_folder-1117"><span class="linenos">1117</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">upload_from_folder</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1118"><a href="#S3Bucket.upload_from_folder-1118"><span class="linenos">1118</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1119"><a href="#S3Bucket.upload_from_folder-1119"><span class="linenos">1119</span></a>        <span class="n">from_folder</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.upload_from_folder-1120"><a href="#S3Bucket.upload_from_folder-1120"><span class="linenos">1120</span></a>        <span class="n">to_folder</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1121"><a href="#S3Bucket.upload_from_folder-1121"><span class="linenos">1121</span></a>        <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="S3Bucket.upload_from_folder-1122"><a href="#S3Bucket.upload_from_folder-1122"><span class="linenos">1122</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_folder-1123"><a href="#S3Bucket.upload_from_folder-1123"><span class="linenos">1123</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_folder-1124"><a href="#S3Bucket.upload_from_folder-1124"><span class="linenos">1124</span></a><span class="sd">        Uploads files *within* a folder (excluding the folder itself)</span>
</span><span id="S3Bucket.upload_from_folder-1125"><a href="#S3Bucket.upload_from_folder-1125"><span class="linenos">1125</span></a><span class="sd">        to the object storage service folder.</span>
</span><span id="S3Bucket.upload_from_folder-1126"><a href="#S3Bucket.upload_from_folder-1126"><span class="linenos">1126</span></a>
</span><span id="S3Bucket.upload_from_folder-1127"><a href="#S3Bucket.upload_from_folder-1127"><span class="linenos">1127</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.upload_from_folder-1128"><a href="#S3Bucket.upload_from_folder-1128"><span class="linenos">1128</span></a><span class="sd">            from_folder: The path to the folder to upload from.</span>
</span><span id="S3Bucket.upload_from_folder-1129"><a href="#S3Bucket.upload_from_folder-1129"><span class="linenos">1129</span></a><span class="sd">            to_folder: The path to upload the folder to.</span>
</span><span id="S3Bucket.upload_from_folder-1130"><a href="#S3Bucket.upload_from_folder-1130"><span class="linenos">1130</span></a><span class="sd">            **upload_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.upload_from_folder-1131"><a href="#S3Bucket.upload_from_folder-1131"><span class="linenos">1131</span></a><span class="sd">                `Client.upload_fileobj`.</span>
</span><span id="S3Bucket.upload_from_folder-1132"><a href="#S3Bucket.upload_from_folder-1132"><span class="linenos">1132</span></a>
</span><span id="S3Bucket.upload_from_folder-1133"><a href="#S3Bucket.upload_from_folder-1133"><span class="linenos">1133</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.upload_from_folder-1134"><a href="#S3Bucket.upload_from_folder-1134"><span class="linenos">1134</span></a><span class="sd">            The path that the folder was uploaded to.</span>
</span><span id="S3Bucket.upload_from_folder-1135"><a href="#S3Bucket.upload_from_folder-1135"><span class="linenos">1135</span></a>
</span><span id="S3Bucket.upload_from_folder-1136"><a href="#S3Bucket.upload_from_folder-1136"><span class="linenos">1136</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.upload_from_folder-1137"><a href="#S3Bucket.upload_from_folder-1137"><span class="linenos">1137</span></a><span class="sd">            Upload contents from my_folder to new_folder.</span>
</span><span id="S3Bucket.upload_from_folder-1138"><a href="#S3Bucket.upload_from_folder-1138"><span class="linenos">1138</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.upload_from_folder-1139"><a href="#S3Bucket.upload_from_folder-1139"><span class="linenos">1139</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.upload_from_folder-1140"><a href="#S3Bucket.upload_from_folder-1140"><span class="linenos">1140</span></a>
</span><span id="S3Bucket.upload_from_folder-1141"><a href="#S3Bucket.upload_from_folder-1141"><span class="linenos">1141</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.upload_from_folder-1142"><a href="#S3Bucket.upload_from_folder-1142"><span class="linenos">1142</span></a><span class="sd">            s3_bucket.upload_from_folder(&quot;my_folder&quot;, &quot;new_folder&quot;)</span>
</span><span id="S3Bucket.upload_from_folder-1143"><a href="#S3Bucket.upload_from_folder-1143"><span class="linenos">1143</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.upload_from_folder-1144"><a href="#S3Bucket.upload_from_folder-1144"><span class="linenos">1144</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.upload_from_folder-1145"><a href="#S3Bucket.upload_from_folder-1145"><span class="linenos">1145</span></a>        <span class="n">from_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1146"><a href="#S3Bucket.upload_from_folder-1146"><span class="linenos">1146</span></a>        <span class="n">bucket_folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_join_bucket_folder</span><span class="p">(</span><span class="n">to_folder</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1147"><a href="#S3Bucket.upload_from_folder-1147"><span class="linenos">1147</span></a>
</span><span id="S3Bucket.upload_from_folder-1148"><a href="#S3Bucket.upload_from_folder-1148"><span class="linenos">1148</span></a>        <span class="n">num_uploaded</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="S3Bucket.upload_from_folder-1149"><a href="#S3Bucket.upload_from_folder-1149"><span class="linenos">1149</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.upload_from_folder-1150"><a href="#S3Bucket.upload_from_folder-1150"><span class="linenos">1150</span></a>
</span><span id="S3Bucket.upload_from_folder-1151"><a href="#S3Bucket.upload_from_folder-1151"><span class="linenos">1151</span></a>        <span class="n">async_coros</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="S3Bucket.upload_from_folder-1152"><a href="#S3Bucket.upload_from_folder-1152"><span class="linenos">1152</span></a>        <span class="k">for</span> <span class="n">from_path</span> <span class="ow">in</span> <span class="n">from_folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;**/*&quot;</span><span class="p">):</span>
</span><span id="S3Bucket.upload_from_folder-1153"><a href="#S3Bucket.upload_from_folder-1153"><span class="linenos">1153</span></a>            <span class="c1"># this skips the actual directory itself, e.g.</span>
</span><span id="S3Bucket.upload_from_folder-1154"><a href="#S3Bucket.upload_from_folder-1154"><span class="linenos">1154</span></a>            <span class="c1"># `my_folder/` will be skipped</span>
</span><span id="S3Bucket.upload_from_folder-1155"><a href="#S3Bucket.upload_from_folder-1155"><span class="linenos">1155</span></a>            <span class="c1"># `my_folder/notes.txt` will be uploaded</span>
</span><span id="S3Bucket.upload_from_folder-1156"><a href="#S3Bucket.upload_from_folder-1156"><span class="linenos">1156</span></a>            <span class="k">if</span> <span class="n">from_path</span><span class="o">.</span><span class="n">is_dir</span><span class="p">():</span>
</span><span id="S3Bucket.upload_from_folder-1157"><a href="#S3Bucket.upload_from_folder-1157"><span class="linenos">1157</span></a>                <span class="k">continue</span>
</span><span id="S3Bucket.upload_from_folder-1158"><a href="#S3Bucket.upload_from_folder-1158"><span class="linenos">1158</span></a>            <span class="n">bucket_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1159"><a href="#S3Bucket.upload_from_folder-1159"><span class="linenos">1159</span></a>                <span class="n">Path</span><span class="p">(</span><span class="n">bucket_folder</span><span class="p">)</span> <span class="o">/</span> <span class="n">from_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1160"><a href="#S3Bucket.upload_from_folder-1160"><span class="linenos">1160</span></a>            <span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket.upload_from_folder-1161"><a href="#S3Bucket.upload_from_folder-1161"><span class="linenos">1161</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1162"><a href="#S3Bucket.upload_from_folder-1162"><span class="linenos">1162</span></a>                <span class="sa">f</span><span class="s2">&quot;Uploading from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> to the bucket &quot;</span>
</span><span id="S3Bucket.upload_from_folder-1163"><a href="#S3Bucket.upload_from_folder-1163"><span class="linenos">1163</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="S3Bucket.upload_from_folder-1164"><a href="#S3Bucket.upload_from_folder-1164"><span class="linenos">1164</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1165"><a href="#S3Bucket.upload_from_folder-1165"><span class="linenos">1165</span></a>            <span class="n">async_coros</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1166"><a href="#S3Bucket.upload_from_folder-1166"><span class="linenos">1166</span></a>                <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1167"><a href="#S3Bucket.upload_from_folder-1167"><span class="linenos">1167</span></a>                    <span class="n">client</span><span class="o">.</span><span class="n">upload_file</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1168"><a href="#S3Bucket.upload_from_folder-1168"><span class="linenos">1168</span></a>                    <span class="n">Filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">from_path</span><span class="p">),</span>
</span><span id="S3Bucket.upload_from_folder-1169"><a href="#S3Bucket.upload_from_folder-1169"><span class="linenos">1169</span></a>                    <span class="n">Bucket</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1170"><a href="#S3Bucket.upload_from_folder-1170"><span class="linenos">1170</span></a>                    <span class="n">Key</span><span class="o">=</span><span class="n">bucket_path</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1171"><a href="#S3Bucket.upload_from_folder-1171"><span class="linenos">1171</span></a>                    <span class="o">**</span><span class="n">upload_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.upload_from_folder-1172"><a href="#S3Bucket.upload_from_folder-1172"><span class="linenos">1172</span></a>                <span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1173"><a href="#S3Bucket.upload_from_folder-1173"><span class="linenos">1173</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1174"><a href="#S3Bucket.upload_from_folder-1174"><span class="linenos">1174</span></a>            <span class="n">num_uploaded</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="S3Bucket.upload_from_folder-1175"><a href="#S3Bucket.upload_from_folder-1175"><span class="linenos">1175</span></a>        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">async_coros</span><span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1176"><a href="#S3Bucket.upload_from_folder-1176"><span class="linenos">1176</span></a>
</span><span id="S3Bucket.upload_from_folder-1177"><a href="#S3Bucket.upload_from_folder-1177"><span class="linenos">1177</span></a>        <span class="k">if</span> <span class="n">num_uploaded</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_folder-1178"><a href="#S3Bucket.upload_from_folder-1178"><span class="linenos">1178</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No files were uploaded from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1179"><a href="#S3Bucket.upload_from_folder-1179"><span class="linenos">1179</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket.upload_from_folder-1180"><a href="#S3Bucket.upload_from_folder-1180"><span class="linenos">1180</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.upload_from_folder-1181"><a href="#S3Bucket.upload_from_folder-1181"><span class="linenos">1181</span></a>                <span class="sa">f</span><span class="s2">&quot;Uploaded </span><span class="si">{</span><span class="n">num_uploaded</span><span class="si">}</span><span class="s2"> files from </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">from_folder</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> to &quot;</span>
</span><span id="S3Bucket.upload_from_folder-1182"><a href="#S3Bucket.upload_from_folder-1182"><span class="linenos">1182</span></a>                <span class="sa">f</span><span class="s2">&quot;the bucket </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span><span class="si">!r}</span><span class="s2"> path </span><span class="si">{</span><span class="n">bucket_path</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket.upload_from_folder-1183"><a href="#S3Bucket.upload_from_folder-1183"><span class="linenos">1183</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.upload_from_folder-1184"><a href="#S3Bucket.upload_from_folder-1184"><span class="linenos">1184</span></a>
</span><span id="S3Bucket.upload_from_folder-1185"><a href="#S3Bucket.upload_from_folder-1185"><span class="linenos">1185</span></a>        <span class="k">return</span> <span class="n">to_folder</span>
</span></pre></div>


            <div class="docstring"><p>Uploads files <em>within</em> a folder (excluding the folder itself)
to the object storage service folder.</p>

<p>Args:
    from_folder: The path to the folder to upload from.
    to_folder: The path to upload the folder to.
    **upload_kwargs: Additional keyword arguments to pass to
        <code>Client.upload_fileobj</code>.</p>

<p>Returns:
    The path that the folder was uploaded to.</p>

<p>Examples:
    Upload contents from my_folder to new_folder.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="kn">from</span> <span class="nn">prefect_aws.s3</span> <span class="kn">import</span> <span class="n">S3Bucket</span>
 <br />
    <span class="n">s3_bucket</span> <span class="o">=</span> <span class="n"><a href="#S3Bucket.load">S3Bucket.load</a></span><span class="p">(</span><span class="s2">&quot;my-bucket&quot;</span><span class="p">)</span>
    <span class="n">s3_bucket</span><span class="o">.</span><span class="n">upload_from_folder</span><span class="p">(</span><span class="s2">&quot;my_folder&quot;</span><span class="p">,</span> <span class="s2">&quot;new_folder&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="S3Bucket.copy_object" class="classattr">
                                        <input id="S3Bucket.copy_object-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">copy_object</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_bucket</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#S3Bucket">S3Bucket</a></span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">copy_kwargs</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.copy_object-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.copy_object"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.copy_object-1187"><a href="#S3Bucket.copy_object-1187"><span class="linenos">1187</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.copy_object-1188"><a href="#S3Bucket.copy_object-1188"><span class="linenos">1188</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">copy_object</span><span class="p">(</span>
</span><span id="S3Bucket.copy_object-1189"><a href="#S3Bucket.copy_object-1189"><span class="linenos">1189</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1190"><a href="#S3Bucket.copy_object-1190"><span class="linenos">1190</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.copy_object-1191"><a href="#S3Bucket.copy_object-1191"><span class="linenos">1191</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.copy_object-1192"><a href="#S3Bucket.copy_object-1192"><span class="linenos">1192</span></a>        <span class="n">to_bucket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1193"><a href="#S3Bucket.copy_object-1193"><span class="linenos">1193</span></a>        <span class="o">**</span><span class="n">copy_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1194"><a href="#S3Bucket.copy_object-1194"><span class="linenos">1194</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.copy_object-1195"><a href="#S3Bucket.copy_object-1195"><span class="linenos">1195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses S3&#39;s internal</span>
</span><span id="S3Bucket.copy_object-1196"><a href="#S3Bucket.copy_object-1196"><span class="linenos">1196</span></a><span class="sd">        [CopyObject](https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html)</span>
</span><span id="S3Bucket.copy_object-1197"><a href="#S3Bucket.copy_object-1197"><span class="linenos">1197</span></a><span class="sd">        to copy objects within or between buckets. To copy objects between buckets,</span>
</span><span id="S3Bucket.copy_object-1198"><a href="#S3Bucket.copy_object-1198"><span class="linenos">1198</span></a><span class="sd">        `self`&#39;s credentials must have permission to read the source object and write</span>
</span><span id="S3Bucket.copy_object-1199"><a href="#S3Bucket.copy_object-1199"><span class="linenos">1199</span></a><span class="sd">        to the target object. If the credentials do not have those permissions, try</span>
</span><span id="S3Bucket.copy_object-1200"><a href="#S3Bucket.copy_object-1200"><span class="linenos">1200</span></a><span class="sd">        using `S3Bucket.stream_from`.</span>
</span><span id="S3Bucket.copy_object-1201"><a href="#S3Bucket.copy_object-1201"><span class="linenos">1201</span></a>
</span><span id="S3Bucket.copy_object-1202"><a href="#S3Bucket.copy_object-1202"><span class="linenos">1202</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.copy_object-1203"><a href="#S3Bucket.copy_object-1203"><span class="linenos">1203</span></a><span class="sd">            from_path: The path of the object to copy.</span>
</span><span id="S3Bucket.copy_object-1204"><a href="#S3Bucket.copy_object-1204"><span class="linenos">1204</span></a><span class="sd">            to_path: The path to copy the object to.</span>
</span><span id="S3Bucket.copy_object-1205"><a href="#S3Bucket.copy_object-1205"><span class="linenos">1205</span></a><span class="sd">            to_bucket: The bucket to copy to. Defaults to the current bucket.</span>
</span><span id="S3Bucket.copy_object-1206"><a href="#S3Bucket.copy_object-1206"><span class="linenos">1206</span></a><span class="sd">            **copy_kwargs: Additional keyword arguments to pass to</span>
</span><span id="S3Bucket.copy_object-1207"><a href="#S3Bucket.copy_object-1207"><span class="linenos">1207</span></a><span class="sd">                `S3Client.copy_object`.</span>
</span><span id="S3Bucket.copy_object-1208"><a href="#S3Bucket.copy_object-1208"><span class="linenos">1208</span></a>
</span><span id="S3Bucket.copy_object-1209"><a href="#S3Bucket.copy_object-1209"><span class="linenos">1209</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.copy_object-1210"><a href="#S3Bucket.copy_object-1210"><span class="linenos">1210</span></a><span class="sd">            The path that the object was copied to. Excludes the bucket name.</span>
</span><span id="S3Bucket.copy_object-1211"><a href="#S3Bucket.copy_object-1211"><span class="linenos">1211</span></a>
</span><span id="S3Bucket.copy_object-1212"><a href="#S3Bucket.copy_object-1212"><span class="linenos">1212</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.copy_object-1213"><a href="#S3Bucket.copy_object-1213"><span class="linenos">1213</span></a>
</span><span id="S3Bucket.copy_object-1214"><a href="#S3Bucket.copy_object-1214"><span class="linenos">1214</span></a><span class="sd">            Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.</span>
</span><span id="S3Bucket.copy_object-1215"><a href="#S3Bucket.copy_object-1215"><span class="linenos">1215</span></a>
</span><span id="S3Bucket.copy_object-1216"><a href="#S3Bucket.copy_object-1216"><span class="linenos">1216</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.copy_object-1217"><a href="#S3Bucket.copy_object-1217"><span class="linenos">1217</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.copy_object-1218"><a href="#S3Bucket.copy_object-1218"><span class="linenos">1218</span></a>
</span><span id="S3Bucket.copy_object-1219"><a href="#S3Bucket.copy_object-1219"><span class="linenos">1219</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.copy_object-1220"><a href="#S3Bucket.copy_object-1220"><span class="linenos">1220</span></a><span class="sd">            s3_bucket.copy_object(&quot;my_folder/notes.txt&quot;, &quot;my_folder/notes_copy.txt&quot;)</span>
</span><span id="S3Bucket.copy_object-1221"><a href="#S3Bucket.copy_object-1221"><span class="linenos">1221</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.copy_object-1222"><a href="#S3Bucket.copy_object-1222"><span class="linenos">1222</span></a>
</span><span id="S3Bucket.copy_object-1223"><a href="#S3Bucket.copy_object-1223"><span class="linenos">1223</span></a><span class="sd">            Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in</span>
</span><span id="S3Bucket.copy_object-1224"><a href="#S3Bucket.copy_object-1224"><span class="linenos">1224</span></a><span class="sd">            another bucket.</span>
</span><span id="S3Bucket.copy_object-1225"><a href="#S3Bucket.copy_object-1225"><span class="linenos">1225</span></a>
</span><span id="S3Bucket.copy_object-1226"><a href="#S3Bucket.copy_object-1226"><span class="linenos">1226</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.copy_object-1227"><a href="#S3Bucket.copy_object-1227"><span class="linenos">1227</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.copy_object-1228"><a href="#S3Bucket.copy_object-1228"><span class="linenos">1228</span></a>
</span><span id="S3Bucket.copy_object-1229"><a href="#S3Bucket.copy_object-1229"><span class="linenos">1229</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.copy_object-1230"><a href="#S3Bucket.copy_object-1230"><span class="linenos">1230</span></a><span class="sd">            s3_bucket.copy_object(</span>
</span><span id="S3Bucket.copy_object-1231"><a href="#S3Bucket.copy_object-1231"><span class="linenos">1231</span></a><span class="sd">                &quot;my_folder/notes.txt&quot;,</span>
</span><span id="S3Bucket.copy_object-1232"><a href="#S3Bucket.copy_object-1232"><span class="linenos">1232</span></a><span class="sd">                &quot;my_folder/notes_copy.txt&quot;,</span>
</span><span id="S3Bucket.copy_object-1233"><a href="#S3Bucket.copy_object-1233"><span class="linenos">1233</span></a><span class="sd">                to_bucket=&quot;other-bucket&quot;</span>
</span><span id="S3Bucket.copy_object-1234"><a href="#S3Bucket.copy_object-1234"><span class="linenos">1234</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.copy_object-1235"><a href="#S3Bucket.copy_object-1235"><span class="linenos">1235</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.copy_object-1236"><a href="#S3Bucket.copy_object-1236"><span class="linenos">1236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.copy_object-1237"><a href="#S3Bucket.copy_object-1237"><span class="linenos">1237</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.copy_object-1238"><a href="#S3Bucket.copy_object-1238"><span class="linenos">1238</span></a>
</span><span id="S3Bucket.copy_object-1239"><a href="#S3Bucket.copy_object-1239"><span class="linenos">1239</span></a>        <span class="n">source_bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket.copy_object-1240"><a href="#S3Bucket.copy_object-1240"><span class="linenos">1240</span></a>        <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket.copy_object-1241"><a href="#S3Bucket.copy_object-1241"><span class="linenos">1241</span></a>
</span><span id="S3Bucket.copy_object-1242"><a href="#S3Bucket.copy_object-1242"><span class="linenos">1242</span></a>        <span class="c1"># Default to copying within the same bucket</span>
</span><span id="S3Bucket.copy_object-1243"><a href="#S3Bucket.copy_object-1243"><span class="linenos">1243</span></a>        <span class="n">to_bucket</span> <span class="o">=</span> <span class="n">to_bucket</span> <span class="ow">or</span> <span class="bp">self</span>
</span><span id="S3Bucket.copy_object-1244"><a href="#S3Bucket.copy_object-1244"><span class="linenos">1244</span></a>
</span><span id="S3Bucket.copy_object-1245"><a href="#S3Bucket.copy_object-1245"><span class="linenos">1245</span></a>        <span class="n">target_bucket_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket.copy_object-1246"><a href="#S3Bucket.copy_object-1246"><span class="linenos">1246</span></a>        <span class="n">target_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket.copy_object-1247"><a href="#S3Bucket.copy_object-1247"><span class="linenos">1247</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="n">S3Bucket</span><span class="p">):</span>
</span><span id="S3Bucket.copy_object-1248"><a href="#S3Bucket.copy_object-1248"><span class="linenos">1248</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket.copy_object-1249"><a href="#S3Bucket.copy_object-1249"><span class="linenos">1249</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket.copy_object-1250"><a href="#S3Bucket.copy_object-1250"><span class="linenos">1250</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="S3Bucket.copy_object-1251"><a href="#S3Bucket.copy_object-1251"><span class="linenos">1251</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span>
</span><span id="S3Bucket.copy_object-1252"><a href="#S3Bucket.copy_object-1252"><span class="linenos">1252</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket.copy_object-1253"><a href="#S3Bucket.copy_object-1253"><span class="linenos">1253</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket.copy_object-1254"><a href="#S3Bucket.copy_object-1254"><span class="linenos">1254</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="S3Bucket.copy_object-1255"><a href="#S3Bucket.copy_object-1255"><span class="linenos">1255</span></a>                <span class="sa">f</span><span class="s2">&quot;to_bucket must be a string or S3Bucket, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket.copy_object-1256"><a href="#S3Bucket.copy_object-1256"><span class="linenos">1256</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.copy_object-1257"><a href="#S3Bucket.copy_object-1257"><span class="linenos">1257</span></a>
</span><span id="S3Bucket.copy_object-1258"><a href="#S3Bucket.copy_object-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.copy_object-1259"><a href="#S3Bucket.copy_object-1259"><span class="linenos">1259</span></a>            <span class="s2">&quot;Copying object from bucket </span><span class="si">%s</span><span class="s2"> with key </span><span class="si">%s</span><span class="s2"> to bucket </span><span class="si">%s</span><span class="s2"> with key </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1260"><a href="#S3Bucket.copy_object-1260"><span class="linenos">1260</span></a>            <span class="n">source_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1261"><a href="#S3Bucket.copy_object-1261"><span class="linenos">1261</span></a>            <span class="n">source_path</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1262"><a href="#S3Bucket.copy_object-1262"><span class="linenos">1262</span></a>            <span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1263"><a href="#S3Bucket.copy_object-1263"><span class="linenos">1263</span></a>            <span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1264"><a href="#S3Bucket.copy_object-1264"><span class="linenos">1264</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.copy_object-1265"><a href="#S3Bucket.copy_object-1265"><span class="linenos">1265</span></a>
</span><span id="S3Bucket.copy_object-1266"><a href="#S3Bucket.copy_object-1266"><span class="linenos">1266</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">copy_object</span><span class="p">(</span>
</span><span id="S3Bucket.copy_object-1267"><a href="#S3Bucket.copy_object-1267"><span class="linenos">1267</span></a>            <span class="n">CopySource</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">source_bucket_name</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">source_path</span><span class="p">},</span>
</span><span id="S3Bucket.copy_object-1268"><a href="#S3Bucket.copy_object-1268"><span class="linenos">1268</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1269"><a href="#S3Bucket.copy_object-1269"><span class="linenos">1269</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1270"><a href="#S3Bucket.copy_object-1270"><span class="linenos">1270</span></a>            <span class="o">**</span><span class="n">copy_kwargs</span><span class="p">,</span>
</span><span id="S3Bucket.copy_object-1271"><a href="#S3Bucket.copy_object-1271"><span class="linenos">1271</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.copy_object-1272"><a href="#S3Bucket.copy_object-1272"><span class="linenos">1272</span></a>
</span><span id="S3Bucket.copy_object-1273"><a href="#S3Bucket.copy_object-1273"><span class="linenos">1273</span></a>        <span class="k">return</span> <span class="n">target_path</span>
</span></pre></div>


            <div class="docstring"><p>Uses S3's internal
<a href="https://docs.aws.amazon.com/AmazonS3/latest/API/API_CopyObject.html">CopyObject</a>
to copy objects within or between buckets. To copy objects between buckets,
<code>self</code>'s credentials must have permission to read the source object and write
to the target object. If the credentials do not have those permissions, try
using <code><a href="#S3Bucket.stream_from">S3Bucket.stream_from</a></code>.</p>

<p>Args:
    from_path: The path of the object to copy.
    to_path: The path to copy the object to.
    to_bucket: The bucket to copy to. Defaults to the current bucket.
    **copy_kwargs: Additional keyword arguments to pass to
        <code>S3Client.copy_object</code>.</p>

<p>Returns:
    The path that the object was copied to. Excludes the bucket name.</p>

<p>Examples:</p>

<pre><code>Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;my_folder/notes_copy.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;


Copy notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in
another bucket.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;copy_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;my_folder/notes_copy.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;to_bucket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;other-bucket&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
</div>


                            </div>
                            <div id="S3Bucket.move_object" class="classattr">
                                        <input id="S3Bucket.move_object-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">move_object</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">]</span>,</span><span class="param">	<span class="n">to_bucket</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#S3Bucket">S3Bucket</a></span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="S3Bucket.move_object-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#S3Bucket.move_object"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="S3Bucket.move_object-1275"><a href="#S3Bucket.move_object-1275"><span class="linenos">1275</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="S3Bucket.move_object-1276"><a href="#S3Bucket.move_object-1276"><span class="linenos">1276</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">move_object</span><span class="p">(</span>
</span><span id="S3Bucket.move_object-1277"><a href="#S3Bucket.move_object-1277"><span class="linenos">1277</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1278"><a href="#S3Bucket.move_object-1278"><span class="linenos">1278</span></a>        <span class="n">from_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.move_object-1279"><a href="#S3Bucket.move_object-1279"><span class="linenos">1279</span></a>        <span class="n">to_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span>
</span><span id="S3Bucket.move_object-1280"><a href="#S3Bucket.move_object-1280"><span class="linenos">1280</span></a>        <span class="n">to_bucket</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="s2">&quot;S3Bucket&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1281"><a href="#S3Bucket.move_object-1281"><span class="linenos">1281</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="S3Bucket.move_object-1282"><a href="#S3Bucket.move_object-1282"><span class="linenos">1282</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Uses S3&#39;s internal CopyObject and DeleteObject to move objects within or</span>
</span><span id="S3Bucket.move_object-1283"><a href="#S3Bucket.move_object-1283"><span class="linenos">1283</span></a><span class="sd">        between buckets. To move objects between buckets, `self`&#39;s credentials must</span>
</span><span id="S3Bucket.move_object-1284"><a href="#S3Bucket.move_object-1284"><span class="linenos">1284</span></a><span class="sd">        have permission to read and delete the source object and write to the target</span>
</span><span id="S3Bucket.move_object-1285"><a href="#S3Bucket.move_object-1285"><span class="linenos">1285</span></a><span class="sd">        object. If the credentials do not have those permissions, this method will</span>
</span><span id="S3Bucket.move_object-1286"><a href="#S3Bucket.move_object-1286"><span class="linenos">1286</span></a><span class="sd">        raise an error. If the credentials have permission to read the source object</span>
</span><span id="S3Bucket.move_object-1287"><a href="#S3Bucket.move_object-1287"><span class="linenos">1287</span></a><span class="sd">        but not delete it, the object will be copied but not deleted.</span>
</span><span id="S3Bucket.move_object-1288"><a href="#S3Bucket.move_object-1288"><span class="linenos">1288</span></a>
</span><span id="S3Bucket.move_object-1289"><a href="#S3Bucket.move_object-1289"><span class="linenos">1289</span></a><span class="sd">        Args:</span>
</span><span id="S3Bucket.move_object-1290"><a href="#S3Bucket.move_object-1290"><span class="linenos">1290</span></a><span class="sd">            from_path: The path of the object to move.</span>
</span><span id="S3Bucket.move_object-1291"><a href="#S3Bucket.move_object-1291"><span class="linenos">1291</span></a><span class="sd">            to_path: The path to move the object to.</span>
</span><span id="S3Bucket.move_object-1292"><a href="#S3Bucket.move_object-1292"><span class="linenos">1292</span></a><span class="sd">            to_bucket: The bucket to move to. Defaults to the current bucket.</span>
</span><span id="S3Bucket.move_object-1293"><a href="#S3Bucket.move_object-1293"><span class="linenos">1293</span></a>
</span><span id="S3Bucket.move_object-1294"><a href="#S3Bucket.move_object-1294"><span class="linenos">1294</span></a><span class="sd">        Returns:</span>
</span><span id="S3Bucket.move_object-1295"><a href="#S3Bucket.move_object-1295"><span class="linenos">1295</span></a><span class="sd">            The path that the object was moved to. Excludes the bucket name.</span>
</span><span id="S3Bucket.move_object-1296"><a href="#S3Bucket.move_object-1296"><span class="linenos">1296</span></a>
</span><span id="S3Bucket.move_object-1297"><a href="#S3Bucket.move_object-1297"><span class="linenos">1297</span></a><span class="sd">        Examples:</span>
</span><span id="S3Bucket.move_object-1298"><a href="#S3Bucket.move_object-1298"><span class="linenos">1298</span></a>
</span><span id="S3Bucket.move_object-1299"><a href="#S3Bucket.move_object-1299"><span class="linenos">1299</span></a><span class="sd">            Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.</span>
</span><span id="S3Bucket.move_object-1300"><a href="#S3Bucket.move_object-1300"><span class="linenos">1300</span></a>
</span><span id="S3Bucket.move_object-1301"><a href="#S3Bucket.move_object-1301"><span class="linenos">1301</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.move_object-1302"><a href="#S3Bucket.move_object-1302"><span class="linenos">1302</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.move_object-1303"><a href="#S3Bucket.move_object-1303"><span class="linenos">1303</span></a>
</span><span id="S3Bucket.move_object-1304"><a href="#S3Bucket.move_object-1304"><span class="linenos">1304</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.move_object-1305"><a href="#S3Bucket.move_object-1305"><span class="linenos">1305</span></a><span class="sd">            s3_bucket.move_object(&quot;my_folder/notes.txt&quot;, &quot;my_folder/notes_copy.txt&quot;)</span>
</span><span id="S3Bucket.move_object-1306"><a href="#S3Bucket.move_object-1306"><span class="linenos">1306</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.move_object-1307"><a href="#S3Bucket.move_object-1307"><span class="linenos">1307</span></a>
</span><span id="S3Bucket.move_object-1308"><a href="#S3Bucket.move_object-1308"><span class="linenos">1308</span></a><span class="sd">            Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in</span>
</span><span id="S3Bucket.move_object-1309"><a href="#S3Bucket.move_object-1309"><span class="linenos">1309</span></a><span class="sd">            another bucket.</span>
</span><span id="S3Bucket.move_object-1310"><a href="#S3Bucket.move_object-1310"><span class="linenos">1310</span></a>
</span><span id="S3Bucket.move_object-1311"><a href="#S3Bucket.move_object-1311"><span class="linenos">1311</span></a><span class="sd">            ```python</span>
</span><span id="S3Bucket.move_object-1312"><a href="#S3Bucket.move_object-1312"><span class="linenos">1312</span></a><span class="sd">            from prefect_aws.s3 import S3Bucket</span>
</span><span id="S3Bucket.move_object-1313"><a href="#S3Bucket.move_object-1313"><span class="linenos">1313</span></a>
</span><span id="S3Bucket.move_object-1314"><a href="#S3Bucket.move_object-1314"><span class="linenos">1314</span></a><span class="sd">            s3_bucket = S3Bucket.load(&quot;my-bucket&quot;)</span>
</span><span id="S3Bucket.move_object-1315"><a href="#S3Bucket.move_object-1315"><span class="linenos">1315</span></a><span class="sd">            s3_bucket.move_object(</span>
</span><span id="S3Bucket.move_object-1316"><a href="#S3Bucket.move_object-1316"><span class="linenos">1316</span></a><span class="sd">                &quot;my_folder/notes.txt&quot;,</span>
</span><span id="S3Bucket.move_object-1317"><a href="#S3Bucket.move_object-1317"><span class="linenos">1317</span></a><span class="sd">                &quot;my_folder/notes_copy.txt&quot;,</span>
</span><span id="S3Bucket.move_object-1318"><a href="#S3Bucket.move_object-1318"><span class="linenos">1318</span></a><span class="sd">                to_bucket=&quot;other-bucket&quot;</span>
</span><span id="S3Bucket.move_object-1319"><a href="#S3Bucket.move_object-1319"><span class="linenos">1319</span></a><span class="sd">            )</span>
</span><span id="S3Bucket.move_object-1320"><a href="#S3Bucket.move_object-1320"><span class="linenos">1320</span></a><span class="sd">            ```</span>
</span><span id="S3Bucket.move_object-1321"><a href="#S3Bucket.move_object-1321"><span class="linenos">1321</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="S3Bucket.move_object-1322"><a href="#S3Bucket.move_object-1322"><span class="linenos">1322</span></a>        <span class="n">s3_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">credentials</span><span class="o">.</span><span class="n">get_s3_client</span><span class="p">()</span>
</span><span id="S3Bucket.move_object-1323"><a href="#S3Bucket.move_object-1323"><span class="linenos">1323</span></a>
</span><span id="S3Bucket.move_object-1324"><a href="#S3Bucket.move_object-1324"><span class="linenos">1324</span></a>        <span class="n">source_bucket_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket.move_object-1325"><a href="#S3Bucket.move_object-1325"><span class="linenos">1325</span></a>        <span class="n">source_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">from_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket.move_object-1326"><a href="#S3Bucket.move_object-1326"><span class="linenos">1326</span></a>
</span><span id="S3Bucket.move_object-1327"><a href="#S3Bucket.move_object-1327"><span class="linenos">1327</span></a>        <span class="c1"># Default to moving within the same bucket</span>
</span><span id="S3Bucket.move_object-1328"><a href="#S3Bucket.move_object-1328"><span class="linenos">1328</span></a>        <span class="n">to_bucket</span> <span class="o">=</span> <span class="n">to_bucket</span> <span class="ow">or</span> <span class="bp">self</span>
</span><span id="S3Bucket.move_object-1329"><a href="#S3Bucket.move_object-1329"><span class="linenos">1329</span></a>
</span><span id="S3Bucket.move_object-1330"><a href="#S3Bucket.move_object-1330"><span class="linenos">1330</span></a>        <span class="n">target_bucket_name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket.move_object-1331"><a href="#S3Bucket.move_object-1331"><span class="linenos">1331</span></a>        <span class="n">target_path</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="S3Bucket.move_object-1332"><a href="#S3Bucket.move_object-1332"><span class="linenos">1332</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="n">S3Bucket</span><span class="p">):</span>
</span><span id="S3Bucket.move_object-1333"><a href="#S3Bucket.move_object-1333"><span class="linenos">1333</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">bucket_name</span>
</span><span id="S3Bucket.move_object-1334"><a href="#S3Bucket.move_object-1334"><span class="linenos">1334</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">to_bucket</span><span class="o">.</span><span class="n">_resolve_path</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
</span><span id="S3Bucket.move_object-1335"><a href="#S3Bucket.move_object-1335"><span class="linenos">1335</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="S3Bucket.move_object-1336"><a href="#S3Bucket.move_object-1336"><span class="linenos">1336</span></a>            <span class="n">target_bucket_name</span> <span class="o">=</span> <span class="n">to_bucket</span>
</span><span id="S3Bucket.move_object-1337"><a href="#S3Bucket.move_object-1337"><span class="linenos">1337</span></a>            <span class="n">target_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">to_path</span><span class="p">)</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span>
</span><span id="S3Bucket.move_object-1338"><a href="#S3Bucket.move_object-1338"><span class="linenos">1338</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="S3Bucket.move_object-1339"><a href="#S3Bucket.move_object-1339"><span class="linenos">1339</span></a>            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span id="S3Bucket.move_object-1340"><a href="#S3Bucket.move_object-1340"><span class="linenos">1340</span></a>                <span class="sa">f</span><span class="s2">&quot;to_bucket must be a string or S3Bucket, not </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">to_bucket</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="S3Bucket.move_object-1341"><a href="#S3Bucket.move_object-1341"><span class="linenos">1341</span></a>            <span class="p">)</span>
</span><span id="S3Bucket.move_object-1342"><a href="#S3Bucket.move_object-1342"><span class="linenos">1342</span></a>
</span><span id="S3Bucket.move_object-1343"><a href="#S3Bucket.move_object-1343"><span class="linenos">1343</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="S3Bucket.move_object-1344"><a href="#S3Bucket.move_object-1344"><span class="linenos">1344</span></a>            <span class="s2">&quot;Moving object from s3://</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2"> to s3://</span><span class="si">%s</span><span class="s2">/</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1345"><a href="#S3Bucket.move_object-1345"><span class="linenos">1345</span></a>            <span class="n">source_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1346"><a href="#S3Bucket.move_object-1346"><span class="linenos">1346</span></a>            <span class="n">source_path</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1347"><a href="#S3Bucket.move_object-1347"><span class="linenos">1347</span></a>            <span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1348"><a href="#S3Bucket.move_object-1348"><span class="linenos">1348</span></a>            <span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1349"><a href="#S3Bucket.move_object-1349"><span class="linenos">1349</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.move_object-1350"><a href="#S3Bucket.move_object-1350"><span class="linenos">1350</span></a>
</span><span id="S3Bucket.move_object-1351"><a href="#S3Bucket.move_object-1351"><span class="linenos">1351</span></a>        <span class="c1"># If invalid, should error and prevent next operation</span>
</span><span id="S3Bucket.move_object-1352"><a href="#S3Bucket.move_object-1352"><span class="linenos">1352</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span>
</span><span id="S3Bucket.move_object-1353"><a href="#S3Bucket.move_object-1353"><span class="linenos">1353</span></a>            <span class="n">CopySource</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Bucket&quot;</span><span class="p">:</span> <span class="n">source_bucket_name</span><span class="p">,</span> <span class="s2">&quot;Key&quot;</span><span class="p">:</span> <span class="n">source_path</span><span class="p">},</span>
</span><span id="S3Bucket.move_object-1354"><a href="#S3Bucket.move_object-1354"><span class="linenos">1354</span></a>            <span class="n">Bucket</span><span class="o">=</span><span class="n">target_bucket_name</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1355"><a href="#S3Bucket.move_object-1355"><span class="linenos">1355</span></a>            <span class="n">Key</span><span class="o">=</span><span class="n">target_path</span><span class="p">,</span>
</span><span id="S3Bucket.move_object-1356"><a href="#S3Bucket.move_object-1356"><span class="linenos">1356</span></a>        <span class="p">)</span>
</span><span id="S3Bucket.move_object-1357"><a href="#S3Bucket.move_object-1357"><span class="linenos">1357</span></a>        <span class="n">s3_client</span><span class="o">.</span><span class="n">delete_object</span><span class="p">(</span><span class="n">Bucket</span><span class="o">=</span><span class="n">source_bucket_name</span><span class="p">,</span> <span class="n">Key</span><span class="o">=</span><span class="n">source_path</span><span class="p">)</span>
</span><span id="S3Bucket.move_object-1358"><a href="#S3Bucket.move_object-1358"><span class="linenos">1358</span></a>        <span class="k">return</span> <span class="n">target_path</span>
</span></pre></div>


            <div class="docstring"><p>Uses S3's internal CopyObject and DeleteObject to move objects within or
between buckets. To move objects between buckets, <code>self</code>'s credentials must
have permission to read and delete the source object and write to the target
object. If the credentials do not have those permissions, this method will
raise an error. If the credentials have permission to read the source object
but not delete it, the object will be copied but not deleted.</p>

<p>Args:
    from_path: The path of the object to move.
    to_path: The path to move the object to.
    to_bucket: The bucket to move to. Defaults to the current bucket.</p>

<p>Returns:
    The path that the object was moved to. Excludes the bucket name.</p>

<p>Examples:</p>

<pre><code>Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt; &lt;span class="s2"&gt;&amp;quot;my_folder/notes_copy.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;


Move notes.txt from my_folder/notes.txt to my_folder/notes_copy.txt in
another bucket.
&lt;div class="pdoc-code codehilite"&gt;
&lt;pre&gt;&lt;span&gt;&lt;/span&gt;&lt;code&gt;&lt;span class="kn"&gt;from&lt;/span&gt; &lt;span class="nn"&gt;prefect_aws.s3&lt;/span&gt; &lt;span class="kn"&gt;import&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;

&lt;span class="n"&gt;s3_bucket&lt;/span&gt; &lt;span class="o"&gt;=&lt;/span&gt; &lt;span class="n"&gt;S3Bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;load&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;my-bucket&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;)&lt;/span&gt;
&lt;span class="n"&gt;s3_bucket&lt;/span&gt;&lt;span class="o"&gt;.&lt;/span&gt;&lt;span class="n"&gt;move_object&lt;/span&gt;&lt;span class="p"&gt;(&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;my_folder/notes.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="s2"&gt;&amp;quot;my_folder/notes_copy.txt&amp;quot;&lt;/span&gt;&lt;span class="p"&gt;,&lt;/span&gt;
    &lt;span class="n"&gt;to_bucket&lt;/span&gt;&lt;span class="o"&gt;=&lt;/span&gt;&lt;span class="s2"&gt;&amp;quot;other-bucket&amp;quot;&lt;/span&gt;
&lt;span class="p"&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/div&gt;
</code></pre>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="S3Bucket.__init__" class="function">Block</dd>
                <dd id="S3Bucket.Config" class="class">Config</dd>
                <dd id="S3Bucket.block_initialization" class="function">block_initialization</dd>
                <dd id="S3Bucket.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="S3Bucket.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="S3Bucket.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="S3Bucket.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="S3Bucket.get_description" class="function">get_description</dd>
                <dd id="S3Bucket.get_code_example" class="function">get_code_example</dd>
                <dd id="S3Bucket.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="S3Bucket.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="S3Bucket.load" class="function">load</dd>
                <dd id="S3Bucket.is_block_class" class="function">is_block_class</dd>
                <dd id="S3Bucket.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="S3Bucket.save" class="function">save</dd>
                <dd id="S3Bucket.delete" class="function">delete</dd>
                <dd id="S3Bucket.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="S3Bucket.json" class="function">json</dd>
                <dd id="S3Bucket.copy" class="function">copy</dd>

            </div>
            <div><dt>prefect.blocks.abstract.ObjectStorageBlock</dt>
                                <dd id="S3Bucket.logger" class="variable">logger</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="S3Bucket.dict" class="function">dict</dd>
                <dd id="S3Bucket.parse_obj" class="function">parse_obj</dd>
                <dd id="S3Bucket.parse_raw" class="function">parse_raw</dd>
                <dd id="S3Bucket.parse_file" class="function">parse_file</dd>
                <dd id="S3Bucket.from_orm" class="function">from_orm</dd>
                <dd id="S3Bucket.construct" class="function">construct</dd>
                <dd id="S3Bucket.schema" class="function">schema</dd>
                <dd id="S3Bucket.schema_json" class="function">schema_json</dd>
                <dd id="S3Bucket.validate" class="function">validate</dd>
                <dd id="S3Bucket.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ECSTask">
                            <input id="ECSTask-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@deprecated_class(start_date=&#39;Mar 2024&#39;, help=&#39;Use the ECS worker instead. Refer to the upgrade guide for more information: https://docs.prefect.io/latest/guides/upgrade-guide-agents-to-workers/.&#39;)</div>

    <span class="def">class</span>
    <span class="name">ECSTask</span><wbr>(<span class="base">prefect.infrastructure.base.Infrastructure</span>):

                <label class="view-source-button" for="ECSTask-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask-218"><a href="#ECSTask-218"><span class="linenos"> 218</span></a><span class="nd">@deprecated_class</span><span class="p">(</span>
</span><span id="ECSTask-219"><a href="#ECSTask-219"><span class="linenos"> 219</span></a>    <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;Mar 2024&quot;</span><span class="p">,</span>
</span><span id="ECSTask-220"><a href="#ECSTask-220"><span class="linenos"> 220</span></a>    <span class="n">help</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-221"><a href="#ECSTask-221"><span class="linenos"> 221</span></a>        <span class="s2">&quot;Use the ECS worker instead.&quot;</span>
</span><span id="ECSTask-222"><a href="#ECSTask-222"><span class="linenos"> 222</span></a>        <span class="s2">&quot; Refer to the upgrade guide for more information:&quot;</span>
</span><span id="ECSTask-223"><a href="#ECSTask-223"><span class="linenos"> 223</span></a>        <span class="s2">&quot; https://docs.prefect.io/latest/guides/upgrade-guide-agents-to-workers/.&quot;</span>
</span><span id="ECSTask-224"><a href="#ECSTask-224"><span class="linenos"> 224</span></a>    <span class="p">),</span>
</span><span id="ECSTask-225"><a href="#ECSTask-225"><span class="linenos"> 225</span></a><span class="p">)</span>
</span><span id="ECSTask-226"><a href="#ECSTask-226"><span class="linenos"> 226</span></a><span class="k">class</span> <span class="nc">ECSTask</span><span class="p">(</span><span class="n">Infrastructure</span><span class="p">):</span>
</span><span id="ECSTask-227"><a href="#ECSTask-227"><span class="linenos"> 227</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-228"><a href="#ECSTask-228"><span class="linenos"> 228</span></a><span class="sd">    Run a command as an ECS task.</span>
</span><span id="ECSTask-229"><a href="#ECSTask-229"><span class="linenos"> 229</span></a>
</span><span id="ECSTask-230"><a href="#ECSTask-230"><span class="linenos"> 230</span></a><span class="sd">    Attributes:</span>
</span><span id="ECSTask-231"><a href="#ECSTask-231"><span class="linenos"> 231</span></a><span class="sd">        type: The slug for this task type with a default value of &quot;ecs-task&quot;.</span>
</span><span id="ECSTask-232"><a href="#ECSTask-232"><span class="linenos"> 232</span></a><span class="sd">        aws_credentials: The AWS credentials to use to connect to ECS with a</span>
</span><span id="ECSTask-233"><a href="#ECSTask-233"><span class="linenos"> 233</span></a><span class="sd">            default factory of AwsCredentials.</span>
</span><span id="ECSTask-234"><a href="#ECSTask-234"><span class="linenos"> 234</span></a><span class="sd">        task_definition_arn: An optional identifier for an existing task definition</span>
</span><span id="ECSTask-235"><a href="#ECSTask-235"><span class="linenos"> 235</span></a><span class="sd">            to use. If fields are set on the ECSTask that conflict with the task</span>
</span><span id="ECSTask-236"><a href="#ECSTask-236"><span class="linenos"> 236</span></a><span class="sd">            definition, a new copy will be registered with the required values.</span>
</span><span id="ECSTask-237"><a href="#ECSTask-237"><span class="linenos"> 237</span></a><span class="sd">            Cannot be used with task_definition. If not provided, Prefect will</span>
</span><span id="ECSTask-238"><a href="#ECSTask-238"><span class="linenos"> 238</span></a><span class="sd">            generate and register a minimal task definition.</span>
</span><span id="ECSTask-239"><a href="#ECSTask-239"><span class="linenos"> 239</span></a><span class="sd">        task_definition: An optional ECS task definition to use. Prefect may set</span>
</span><span id="ECSTask-240"><a href="#ECSTask-240"><span class="linenos"> 240</span></a><span class="sd">            defaults or override fields on this task definition to match other</span>
</span><span id="ECSTask-241"><a href="#ECSTask-241"><span class="linenos"> 241</span></a><span class="sd">            ECSTask fields. Cannot be used with task_definition_arn.</span>
</span><span id="ECSTask-242"><a href="#ECSTask-242"><span class="linenos"> 242</span></a><span class="sd">            If not provided, Prefect will generate and register</span>
</span><span id="ECSTask-243"><a href="#ECSTask-243"><span class="linenos"> 243</span></a><span class="sd">            a minimal task definition.</span>
</span><span id="ECSTask-244"><a href="#ECSTask-244"><span class="linenos"> 244</span></a><span class="sd">        family: An optional family for the task definition. If not provided,</span>
</span><span id="ECSTask-245"><a href="#ECSTask-245"><span class="linenos"> 245</span></a><span class="sd">            it will be inferred from the task definition. If the task definition</span>
</span><span id="ECSTask-246"><a href="#ECSTask-246"><span class="linenos"> 246</span></a><span class="sd">            does not have a family, the name will be generated. When flow and</span>
</span><span id="ECSTask-247"><a href="#ECSTask-247"><span class="linenos"> 247</span></a><span class="sd">            deployment metadata is available, the generated name will include</span>
</span><span id="ECSTask-248"><a href="#ECSTask-248"><span class="linenos"> 248</span></a><span class="sd">            their names. Values for this field will be slugified to match</span>
</span><span id="ECSTask-249"><a href="#ECSTask-249"><span class="linenos"> 249</span></a><span class="sd">            AWS character requirements.</span>
</span><span id="ECSTask-250"><a href="#ECSTask-250"><span class="linenos"> 250</span></a><span class="sd">        image: An optional image to use for the Prefect container in the task.</span>
</span><span id="ECSTask-251"><a href="#ECSTask-251"><span class="linenos"> 251</span></a><span class="sd">            If this value is not null, it will override the value in the task</span>
</span><span id="ECSTask-252"><a href="#ECSTask-252"><span class="linenos"> 252</span></a><span class="sd">            definition. This value defaults to a Prefect base image matching</span>
</span><span id="ECSTask-253"><a href="#ECSTask-253"><span class="linenos"> 253</span></a><span class="sd">            your local versions.</span>
</span><span id="ECSTask-254"><a href="#ECSTask-254"><span class="linenos"> 254</span></a><span class="sd">        auto_deregister_task_definition: A boolean that controls if any task</span>
</span><span id="ECSTask-255"><a href="#ECSTask-255"><span class="linenos"> 255</span></a><span class="sd">            definitions that are created by this block will be deregistered</span>
</span><span id="ECSTask-256"><a href="#ECSTask-256"><span class="linenos"> 256</span></a><span class="sd">            or not. Existing task definitions linked by ARN will never be</span>
</span><span id="ECSTask-257"><a href="#ECSTask-257"><span class="linenos"> 257</span></a><span class="sd">            deregistered. Deregistering a task definition does not remove</span>
</span><span id="ECSTask-258"><a href="#ECSTask-258"><span class="linenos"> 258</span></a><span class="sd">            it from your AWS account, instead it will be marked as INACTIVE.</span>
</span><span id="ECSTask-259"><a href="#ECSTask-259"><span class="linenos"> 259</span></a><span class="sd">        cpu: The amount of CPU to provide to the ECS task. Valid amounts are</span>
</span><span id="ECSTask-260"><a href="#ECSTask-260"><span class="linenos"> 260</span></a><span class="sd">            specified in the AWS documentation. If not provided, a default</span>
</span><span id="ECSTask-261"><a href="#ECSTask-261"><span class="linenos"> 261</span></a><span class="sd">            value of ECS_DEFAULT_CPU will be used unless present on</span>
</span><span id="ECSTask-262"><a href="#ECSTask-262"><span class="linenos"> 262</span></a><span class="sd">            the task definition.</span>
</span><span id="ECSTask-263"><a href="#ECSTask-263"><span class="linenos"> 263</span></a><span class="sd">        memory: The amount of memory to provide to the ECS task.</span>
</span><span id="ECSTask-264"><a href="#ECSTask-264"><span class="linenos"> 264</span></a><span class="sd">            Valid amounts are specified in the AWS documentation.</span>
</span><span id="ECSTask-265"><a href="#ECSTask-265"><span class="linenos"> 265</span></a><span class="sd">            If not provided, a default value of ECS_DEFAULT_MEMORY</span>
</span><span id="ECSTask-266"><a href="#ECSTask-266"><span class="linenos"> 266</span></a><span class="sd">            will be used unless present on the task definition.</span>
</span><span id="ECSTask-267"><a href="#ECSTask-267"><span class="linenos"> 267</span></a><span class="sd">        execution_role_arn: An execution role to use for the task.</span>
</span><span id="ECSTask-268"><a href="#ECSTask-268"><span class="linenos"> 268</span></a><span class="sd">            This controls the permissions of the task when it is launching.</span>
</span><span id="ECSTask-269"><a href="#ECSTask-269"><span class="linenos"> 269</span></a><span class="sd">            If this value is not null, it will override the value in the task</span>
</span><span id="ECSTask-270"><a href="#ECSTask-270"><span class="linenos"> 270</span></a><span class="sd">            definition. An execution role must be provided to capture logs</span>
</span><span id="ECSTask-271"><a href="#ECSTask-271"><span class="linenos"> 271</span></a><span class="sd">            from the container.</span>
</span><span id="ECSTask-272"><a href="#ECSTask-272"><span class="linenos"> 272</span></a><span class="sd">        configure_cloudwatch_logs: A boolean that controls if the Prefect</span>
</span><span id="ECSTask-273"><a href="#ECSTask-273"><span class="linenos"> 273</span></a><span class="sd">            container will be configured to send its output to the</span>
</span><span id="ECSTask-274"><a href="#ECSTask-274"><span class="linenos"> 274</span></a><span class="sd">            AWS CloudWatch logs service or not. This functionality requires</span>
</span><span id="ECSTask-275"><a href="#ECSTask-275"><span class="linenos"> 275</span></a><span class="sd">            an execution role with permissions to create log streams and groups.</span>
</span><span id="ECSTask-276"><a href="#ECSTask-276"><span class="linenos"> 276</span></a><span class="sd">        cloudwatch_logs_options: A dictionary of options to pass to</span>
</span><span id="ECSTask-277"><a href="#ECSTask-277"><span class="linenos"> 277</span></a><span class="sd">            the CloudWatch logs configuration.</span>
</span><span id="ECSTask-278"><a href="#ECSTask-278"><span class="linenos"> 278</span></a><span class="sd">        stream_output: A boolean indicating whether logs will be</span>
</span><span id="ECSTask-279"><a href="#ECSTask-279"><span class="linenos"> 279</span></a><span class="sd">            streamed from the Prefect container to the local console.</span>
</span><span id="ECSTask-280"><a href="#ECSTask-280"><span class="linenos"> 280</span></a><span class="sd">        launch_type: An optional launch type for the ECS task run infrastructure.</span>
</span><span id="ECSTask-281"><a href="#ECSTask-281"><span class="linenos"> 281</span></a><span class="sd">        vpc_id: An optional VPC ID to link the task run to.</span>
</span><span id="ECSTask-282"><a href="#ECSTask-282"><span class="linenos"> 282</span></a><span class="sd">            This is only applicable when using the &#39;awsvpc&#39; network mode for your task.</span>
</span><span id="ECSTask-283"><a href="#ECSTask-283"><span class="linenos"> 283</span></a><span class="sd">        cluster: An optional ECS cluster to run the task in.</span>
</span><span id="ECSTask-284"><a href="#ECSTask-284"><span class="linenos"> 284</span></a><span class="sd">            The ARN or name may be provided. If not provided,</span>
</span><span id="ECSTask-285"><a href="#ECSTask-285"><span class="linenos"> 285</span></a><span class="sd">            the default cluster will be used.</span>
</span><span id="ECSTask-286"><a href="#ECSTask-286"><span class="linenos"> 286</span></a><span class="sd">        env: A dictionary of environment variables to provide to</span>
</span><span id="ECSTask-287"><a href="#ECSTask-287"><span class="linenos"> 287</span></a><span class="sd">            the task run. These variables are set on the</span>
</span><span id="ECSTask-288"><a href="#ECSTask-288"><span class="linenos"> 288</span></a><span class="sd">            Prefect container at task runtime.</span>
</span><span id="ECSTask-289"><a href="#ECSTask-289"><span class="linenos"> 289</span></a><span class="sd">        task_role_arn: An optional role to attach to the task run.</span>
</span><span id="ECSTask-290"><a href="#ECSTask-290"><span class="linenos"> 290</span></a><span class="sd">            This controls the permissions of the task while it is running.</span>
</span><span id="ECSTask-291"><a href="#ECSTask-291"><span class="linenos"> 291</span></a><span class="sd">        task_customizations: A list of JSON 6902 patches to apply to the task</span>
</span><span id="ECSTask-292"><a href="#ECSTask-292"><span class="linenos"> 292</span></a><span class="sd">            run request. If a string is given, it will parsed as a JSON expression.</span>
</span><span id="ECSTask-293"><a href="#ECSTask-293"><span class="linenos"> 293</span></a><span class="sd">        task_start_timeout_seconds: The amount of time to watch for the</span>
</span><span id="ECSTask-294"><a href="#ECSTask-294"><span class="linenos"> 294</span></a><span class="sd">            start of the ECS task before marking it as failed. The task must</span>
</span><span id="ECSTask-295"><a href="#ECSTask-295"><span class="linenos"> 295</span></a><span class="sd">            enter a RUNNING state to be considered started.</span>
</span><span id="ECSTask-296"><a href="#ECSTask-296"><span class="linenos"> 296</span></a><span class="sd">        task_watch_poll_interval: The amount of time to wait between AWS API</span>
</span><span id="ECSTask-297"><a href="#ECSTask-297"><span class="linenos"> 297</span></a><span class="sd">            calls while monitoring the state of an ECS task.</span>
</span><span id="ECSTask-298"><a href="#ECSTask-298"><span class="linenos"> 298</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ECSTask-299"><a href="#ECSTask-299"><span class="linenos"> 299</span></a>
</span><span id="ECSTask-300"><a href="#ECSTask-300"><span class="linenos"> 300</span></a>    <span class="n">_block_type_slug</span> <span class="o">=</span> <span class="s2">&quot;ecs-task&quot;</span>
</span><span id="ECSTask-301"><a href="#ECSTask-301"><span class="linenos"> 301</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;ECS Task&quot;</span>
</span><span id="ECSTask-302"><a href="#ECSTask-302"><span class="linenos"> 302</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask-303"><a href="#ECSTask-303"><span class="linenos"> 303</span></a>    <span class="n">_description</span> <span class="o">=</span> <span class="s2">&quot;Run a command as an ECS task.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask-304"><a href="#ECSTask-304"><span class="linenos"> 304</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSTask-305"><a href="#ECSTask-305"><span class="linenos"> 305</span></a>        <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/ecs/#prefect_aws.ecs.ECSTask&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask-306"><a href="#ECSTask-306"><span class="linenos"> 306</span></a>    <span class="p">)</span>
</span><span id="ECSTask-307"><a href="#ECSTask-307"><span class="linenos"> 307</span></a>
</span><span id="ECSTask-308"><a href="#ECSTask-308"><span class="linenos"> 308</span></a>    <span class="nb">type</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;ecs-task&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-309"><a href="#ECSTask-309"><span class="linenos"> 309</span></a>        <span class="s2">&quot;ecs-task&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The slug for this task type.&quot;</span>
</span><span id="ECSTask-310"><a href="#ECSTask-310"><span class="linenos"> 310</span></a>    <span class="p">)</span>
</span><span id="ECSTask-311"><a href="#ECSTask-311"><span class="linenos"> 311</span></a>
</span><span id="ECSTask-312"><a href="#ECSTask-312"><span class="linenos"> 312</span></a>    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-313"><a href="#ECSTask-313"><span class="linenos"> 313</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;AWS Credentials&quot;</span><span class="p">,</span>
</span><span id="ECSTask-314"><a href="#ECSTask-314"><span class="linenos"> 314</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="n">AwsCredentials</span><span class="p">,</span>
</span><span id="ECSTask-315"><a href="#ECSTask-315"><span class="linenos"> 315</span></a>        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The AWS credentials to use to connect to ECS.&quot;</span><span class="p">,</span>
</span><span id="ECSTask-316"><a href="#ECSTask-316"><span class="linenos"> 316</span></a>    <span class="p">)</span>
</span><span id="ECSTask-317"><a href="#ECSTask-317"><span class="linenos"> 317</span></a>
</span><span id="ECSTask-318"><a href="#ECSTask-318"><span class="linenos"> 318</span></a>    <span class="c1"># Task definition settings</span>
</span><span id="ECSTask-319"><a href="#ECSTask-319"><span class="linenos"> 319</span></a>    <span class="n">task_definition_arn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-320"><a href="#ECSTask-320"><span class="linenos"> 320</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-321"><a href="#ECSTask-321"><span class="linenos"> 321</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-322"><a href="#ECSTask-322"><span class="linenos"> 322</span></a>            <span class="s2">&quot;An identifier for an existing task definition to use. If fields are set &quot;</span>
</span><span id="ECSTask-323"><a href="#ECSTask-323"><span class="linenos"> 323</span></a>            <span class="s2">&quot;on the `ECSTask` that conflict with the task definition, a new copy &quot;</span>
</span><span id="ECSTask-324"><a href="#ECSTask-324"><span class="linenos"> 324</span></a>            <span class="s2">&quot;will be registered with the required values. &quot;</span>
</span><span id="ECSTask-325"><a href="#ECSTask-325"><span class="linenos"> 325</span></a>            <span class="s2">&quot;Cannot be used with `task_definition`. If not provided, Prefect will &quot;</span>
</span><span id="ECSTask-326"><a href="#ECSTask-326"><span class="linenos"> 326</span></a>            <span class="s2">&quot;generate and register a minimal task definition.&quot;</span>
</span><span id="ECSTask-327"><a href="#ECSTask-327"><span class="linenos"> 327</span></a>        <span class="p">),</span>
</span><span id="ECSTask-328"><a href="#ECSTask-328"><span class="linenos"> 328</span></a>    <span class="p">)</span>
</span><span id="ECSTask-329"><a href="#ECSTask-329"><span class="linenos"> 329</span></a>    <span class="n">task_definition</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-330"><a href="#ECSTask-330"><span class="linenos"> 330</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-331"><a href="#ECSTask-331"><span class="linenos"> 331</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-332"><a href="#ECSTask-332"><span class="linenos"> 332</span></a>            <span class="s2">&quot;An ECS task definition to use. Prefect may set defaults or override &quot;</span>
</span><span id="ECSTask-333"><a href="#ECSTask-333"><span class="linenos"> 333</span></a>            <span class="s2">&quot;fields on this task definition to match other `ECSTask` fields. &quot;</span>
</span><span id="ECSTask-334"><a href="#ECSTask-334"><span class="linenos"> 334</span></a>            <span class="s2">&quot;Cannot be used with `task_definition_arn`. If not provided, Prefect will &quot;</span>
</span><span id="ECSTask-335"><a href="#ECSTask-335"><span class="linenos"> 335</span></a>            <span class="s2">&quot;generate and register a minimal task definition.&quot;</span>
</span><span id="ECSTask-336"><a href="#ECSTask-336"><span class="linenos"> 336</span></a>        <span class="p">),</span>
</span><span id="ECSTask-337"><a href="#ECSTask-337"><span class="linenos"> 337</span></a>    <span class="p">)</span>
</span><span id="ECSTask-338"><a href="#ECSTask-338"><span class="linenos"> 338</span></a>    <span class="n">family</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-339"><a href="#ECSTask-339"><span class="linenos"> 339</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-340"><a href="#ECSTask-340"><span class="linenos"> 340</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-341"><a href="#ECSTask-341"><span class="linenos"> 341</span></a>            <span class="s2">&quot;A family for the task definition. If not provided, it will be inferred &quot;</span>
</span><span id="ECSTask-342"><a href="#ECSTask-342"><span class="linenos"> 342</span></a>            <span class="s2">&quot;from the task definition. If the task definition does not have a family, &quot;</span>
</span><span id="ECSTask-343"><a href="#ECSTask-343"><span class="linenos"> 343</span></a>            <span class="s2">&quot;the name will be generated. When flow and deployment metadata is &quot;</span>
</span><span id="ECSTask-344"><a href="#ECSTask-344"><span class="linenos"> 344</span></a>            <span class="s2">&quot;available, the generated name will include their names. Values for this &quot;</span>
</span><span id="ECSTask-345"><a href="#ECSTask-345"><span class="linenos"> 345</span></a>            <span class="s2">&quot;field will be slugified to match AWS character requirements.&quot;</span>
</span><span id="ECSTask-346"><a href="#ECSTask-346"><span class="linenos"> 346</span></a>        <span class="p">),</span>
</span><span id="ECSTask-347"><a href="#ECSTask-347"><span class="linenos"> 347</span></a>    <span class="p">)</span>
</span><span id="ECSTask-348"><a href="#ECSTask-348"><span class="linenos"> 348</span></a>    <span class="n">image</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-349"><a href="#ECSTask-349"><span class="linenos"> 349</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-350"><a href="#ECSTask-350"><span class="linenos"> 350</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-351"><a href="#ECSTask-351"><span class="linenos"> 351</span></a>            <span class="s2">&quot;The image to use for the Prefect container in the task. If this value is &quot;</span>
</span><span id="ECSTask-352"><a href="#ECSTask-352"><span class="linenos"> 352</span></a>            <span class="s2">&quot;not null, it will override the value in the task definition. This value &quot;</span>
</span><span id="ECSTask-353"><a href="#ECSTask-353"><span class="linenos"> 353</span></a>            <span class="s2">&quot;defaults to a Prefect base image matching your local versions.&quot;</span>
</span><span id="ECSTask-354"><a href="#ECSTask-354"><span class="linenos"> 354</span></a>        <span class="p">),</span>
</span><span id="ECSTask-355"><a href="#ECSTask-355"><span class="linenos"> 355</span></a>    <span class="p">)</span>
</span><span id="ECSTask-356"><a href="#ECSTask-356"><span class="linenos"> 356</span></a>    <span class="n">auto_deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-357"><a href="#ECSTask-357"><span class="linenos"> 357</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSTask-358"><a href="#ECSTask-358"><span class="linenos"> 358</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-359"><a href="#ECSTask-359"><span class="linenos"> 359</span></a>            <span class="s2">&quot;If set, any task definitions that are created by this block will be &quot;</span>
</span><span id="ECSTask-360"><a href="#ECSTask-360"><span class="linenos"> 360</span></a>            <span class="s2">&quot;deregistered. Existing task definitions linked by ARN will never be &quot;</span>
</span><span id="ECSTask-361"><a href="#ECSTask-361"><span class="linenos"> 361</span></a>            <span class="s2">&quot;deregistered. Deregistering a task definition does not remove it from &quot;</span>
</span><span id="ECSTask-362"><a href="#ECSTask-362"><span class="linenos"> 362</span></a>            <span class="s2">&quot;your AWS account, instead it will be marked as INACTIVE.&quot;</span>
</span><span id="ECSTask-363"><a href="#ECSTask-363"><span class="linenos"> 363</span></a>        <span class="p">),</span>
</span><span id="ECSTask-364"><a href="#ECSTask-364"><span class="linenos"> 364</span></a>    <span class="p">)</span>
</span><span id="ECSTask-365"><a href="#ECSTask-365"><span class="linenos"> 365</span></a>
</span><span id="ECSTask-366"><a href="#ECSTask-366"><span class="linenos"> 366</span></a>    <span class="c1"># Mixed task definition / run settings</span>
</span><span id="ECSTask-367"><a href="#ECSTask-367"><span class="linenos"> 367</span></a>    <span class="n">cpu</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-368"><a href="#ECSTask-368"><span class="linenos"> 368</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;CPU&quot;</span><span class="p">,</span>
</span><span id="ECSTask-369"><a href="#ECSTask-369"><span class="linenos"> 369</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-370"><a href="#ECSTask-370"><span class="linenos"> 370</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-371"><a href="#ECSTask-371"><span class="linenos"> 371</span></a>            <span class="s2">&quot;The amount of CPU to provide to the ECS task. Valid amounts are &quot;</span>
</span><span id="ECSTask-372"><a href="#ECSTask-372"><span class="linenos"> 372</span></a>            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
</span><span id="ECSTask-373"><a href="#ECSTask-373"><span class="linenos"> 373</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_CPU</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
</span><span id="ECSTask-374"><a href="#ECSTask-374"><span class="linenos"> 374</span></a>        <span class="p">),</span>
</span><span id="ECSTask-375"><a href="#ECSTask-375"><span class="linenos"> 375</span></a>    <span class="p">)</span>
</span><span id="ECSTask-376"><a href="#ECSTask-376"><span class="linenos"> 376</span></a>    <span class="n">memory</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-377"><a href="#ECSTask-377"><span class="linenos"> 377</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-378"><a href="#ECSTask-378"><span class="linenos"> 378</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-379"><a href="#ECSTask-379"><span class="linenos"> 379</span></a>            <span class="s2">&quot;The amount of memory to provide to the ECS task. Valid amounts are &quot;</span>
</span><span id="ECSTask-380"><a href="#ECSTask-380"><span class="linenos"> 380</span></a>            <span class="s2">&quot;specified in the AWS documentation. If not provided, a default value of &quot;</span>
</span><span id="ECSTask-381"><a href="#ECSTask-381"><span class="linenos"> 381</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_MEMORY</span><span class="si">}</span><span class="s2"> will be used unless present on the task definition.&quot;</span>
</span><span id="ECSTask-382"><a href="#ECSTask-382"><span class="linenos"> 382</span></a>        <span class="p">),</span>
</span><span id="ECSTask-383"><a href="#ECSTask-383"><span class="linenos"> 383</span></a>    <span class="p">)</span>
</span><span id="ECSTask-384"><a href="#ECSTask-384"><span class="linenos"> 384</span></a>    <span class="n">execution_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-385"><a href="#ECSTask-385"><span class="linenos"> 385</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Execution Role ARN&quot;</span><span class="p">,</span>
</span><span id="ECSTask-386"><a href="#ECSTask-386"><span class="linenos"> 386</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-387"><a href="#ECSTask-387"><span class="linenos"> 387</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-388"><a href="#ECSTask-388"><span class="linenos"> 388</span></a>            <span class="s2">&quot;An execution role to use for the task. This controls the permissions of &quot;</span>
</span><span id="ECSTask-389"><a href="#ECSTask-389"><span class="linenos"> 389</span></a>            <span class="s2">&quot;the task when it is launching. If this value is not null, it will &quot;</span>
</span><span id="ECSTask-390"><a href="#ECSTask-390"><span class="linenos"> 390</span></a>            <span class="s2">&quot;override the value in the task definition. An execution role must be &quot;</span>
</span><span id="ECSTask-391"><a href="#ECSTask-391"><span class="linenos"> 391</span></a>            <span class="s2">&quot;provided to capture logs from the container.&quot;</span>
</span><span id="ECSTask-392"><a href="#ECSTask-392"><span class="linenos"> 392</span></a>        <span class="p">),</span>
</span><span id="ECSTask-393"><a href="#ECSTask-393"><span class="linenos"> 393</span></a>    <span class="p">)</span>
</span><span id="ECSTask-394"><a href="#ECSTask-394"><span class="linenos"> 394</span></a>    <span class="n">configure_cloudwatch_logs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-395"><a href="#ECSTask-395"><span class="linenos"> 395</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-396"><a href="#ECSTask-396"><span class="linenos"> 396</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-397"><a href="#ECSTask-397"><span class="linenos"> 397</span></a>            <span class="s2">&quot;If `True`, the Prefect container will be configured to send its output &quot;</span>
</span><span id="ECSTask-398"><a href="#ECSTask-398"><span class="linenos"> 398</span></a>            <span class="s2">&quot;to the AWS CloudWatch logs service. This functionality requires an &quot;</span>
</span><span id="ECSTask-399"><a href="#ECSTask-399"><span class="linenos"> 399</span></a>            <span class="s2">&quot;execution role with logs:CreateLogStream, logs:CreateLogGroup, and &quot;</span>
</span><span id="ECSTask-400"><a href="#ECSTask-400"><span class="linenos"> 400</span></a>            <span class="s2">&quot;logs:PutLogEvents permissions. The default for this field is `False` &quot;</span>
</span><span id="ECSTask-401"><a href="#ECSTask-401"><span class="linenos"> 401</span></a>            <span class="s2">&quot;unless `stream_output` is set.&quot;</span>
</span><span id="ECSTask-402"><a href="#ECSTask-402"><span class="linenos"> 402</span></a>        <span class="p">),</span>
</span><span id="ECSTask-403"><a href="#ECSTask-403"><span class="linenos"> 403</span></a>    <span class="p">)</span>
</span><span id="ECSTask-404"><a href="#ECSTask-404"><span class="linenos"> 404</span></a>    <span class="n">cloudwatch_logs_options</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-405"><a href="#ECSTask-405"><span class="linenos"> 405</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSTask-406"><a href="#ECSTask-406"><span class="linenos"> 406</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-407"><a href="#ECSTask-407"><span class="linenos"> 407</span></a>            <span class="s2">&quot;When `configure_cloudwatch_logs` is enabled, this setting may be used to &quot;</span>
</span><span id="ECSTask-408"><a href="#ECSTask-408"><span class="linenos"> 408</span></a>            <span class="s2">&quot;pass additional options to the CloudWatch logs configuration or override &quot;</span>
</span><span id="ECSTask-409"><a href="#ECSTask-409"><span class="linenos"> 409</span></a>            <span class="s2">&quot;the default options. See the AWS documentation for available options. &quot;</span>
</span><span id="ECSTask-410"><a href="#ECSTask-410"><span class="linenos"> 410</span></a>            <span class="s2">&quot;https://docs.aws.amazon.com/AmazonECS/latest/developerguide/using_awslogs.html#create_awslogs_logdriver_options.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask-411"><a href="#ECSTask-411"><span class="linenos"> 411</span></a>        <span class="p">),</span>
</span><span id="ECSTask-412"><a href="#ECSTask-412"><span class="linenos"> 412</span></a>    <span class="p">)</span>
</span><span id="ECSTask-413"><a href="#ECSTask-413"><span class="linenos"> 413</span></a>    <span class="n">stream_output</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-414"><a href="#ECSTask-414"><span class="linenos"> 414</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-415"><a href="#ECSTask-415"><span class="linenos"> 415</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-416"><a href="#ECSTask-416"><span class="linenos"> 416</span></a>            <span class="s2">&quot;If `True`, logs will be streamed from the Prefect container to the local &quot;</span>
</span><span id="ECSTask-417"><a href="#ECSTask-417"><span class="linenos"> 417</span></a>            <span class="s2">&quot;console. Unless you have configured AWS CloudWatch logs manually on your &quot;</span>
</span><span id="ECSTask-418"><a href="#ECSTask-418"><span class="linenos"> 418</span></a>            <span class="s2">&quot;task definition, this requires the same prerequisites outlined in &quot;</span>
</span><span id="ECSTask-419"><a href="#ECSTask-419"><span class="linenos"> 419</span></a>            <span class="s2">&quot;`configure_cloudwatch_logs`.&quot;</span>
</span><span id="ECSTask-420"><a href="#ECSTask-420"><span class="linenos"> 420</span></a>        <span class="p">),</span>
</span><span id="ECSTask-421"><a href="#ECSTask-421"><span class="linenos"> 421</span></a>    <span class="p">)</span>
</span><span id="ECSTask-422"><a href="#ECSTask-422"><span class="linenos"> 422</span></a>
</span><span id="ECSTask-423"><a href="#ECSTask-423"><span class="linenos"> 423</span></a>    <span class="c1"># Task run settings</span>
</span><span id="ECSTask-424"><a href="#ECSTask-424"><span class="linenos"> 424</span></a>    <span class="n">launch_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
</span><span id="ECSTask-425"><a href="#ECSTask-425"><span class="linenos"> 425</span></a>        <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">,</span> <span class="s2">&quot;EC2&quot;</span><span class="p">,</span> <span class="s2">&quot;EXTERNAL&quot;</span><span class="p">,</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">]</span>
</span><span id="ECSTask-426"><a href="#ECSTask-426"><span class="linenos"> 426</span></a>    <span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-427"><a href="#ECSTask-427"><span class="linenos"> 427</span></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">,</span>
</span><span id="ECSTask-428"><a href="#ECSTask-428"><span class="linenos"> 428</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-429"><a href="#ECSTask-429"><span class="linenos"> 429</span></a>            <span class="s2">&quot;The type of ECS task run infrastructure that should be used. Note that&quot;</span>
</span><span id="ECSTask-430"><a href="#ECSTask-430"><span class="linenos"> 430</span></a>            <span class="s2">&quot; &#39;FARGATE_SPOT&#39; is not a formal ECS launch type, but we will configure&quot;</span>
</span><span id="ECSTask-431"><a href="#ECSTask-431"><span class="linenos"> 431</span></a>            <span class="s2">&quot; the proper capacity provider strategy if set here.&quot;</span>
</span><span id="ECSTask-432"><a href="#ECSTask-432"><span class="linenos"> 432</span></a>        <span class="p">),</span>
</span><span id="ECSTask-433"><a href="#ECSTask-433"><span class="linenos"> 433</span></a>    <span class="p">)</span>
</span><span id="ECSTask-434"><a href="#ECSTask-434"><span class="linenos"> 434</span></a>    <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-435"><a href="#ECSTask-435"><span class="linenos"> 435</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;VPC ID&quot;</span><span class="p">,</span>
</span><span id="ECSTask-436"><a href="#ECSTask-436"><span class="linenos"> 436</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-437"><a href="#ECSTask-437"><span class="linenos"> 437</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-438"><a href="#ECSTask-438"><span class="linenos"> 438</span></a>            <span class="s2">&quot;The AWS VPC to link the task run to. This is only applicable when using &quot;</span>
</span><span id="ECSTask-439"><a href="#ECSTask-439"><span class="linenos"> 439</span></a>            <span class="s2">&quot;the &#39;awsvpc&#39; network mode for your task. FARGATE tasks require this &quot;</span>
</span><span id="ECSTask-440"><a href="#ECSTask-440"><span class="linenos"> 440</span></a>            <span class="s2">&quot;network  mode, but for EC2 tasks the default network mode is &#39;bridge&#39;. &quot;</span>
</span><span id="ECSTask-441"><a href="#ECSTask-441"><span class="linenos"> 441</span></a>            <span class="s2">&quot;If using the &#39;awsvpc&#39; network mode and this field is null, your default &quot;</span>
</span><span id="ECSTask-442"><a href="#ECSTask-442"><span class="linenos"> 442</span></a>            <span class="s2">&quot;VPC will be used. If no default VPC can be found, the task run will fail.&quot;</span>
</span><span id="ECSTask-443"><a href="#ECSTask-443"><span class="linenos"> 443</span></a>        <span class="p">),</span>
</span><span id="ECSTask-444"><a href="#ECSTask-444"><span class="linenos"> 444</span></a>    <span class="p">)</span>
</span><span id="ECSTask-445"><a href="#ECSTask-445"><span class="linenos"> 445</span></a>    <span class="n">cluster</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-446"><a href="#ECSTask-446"><span class="linenos"> 446</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-447"><a href="#ECSTask-447"><span class="linenos"> 447</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-448"><a href="#ECSTask-448"><span class="linenos"> 448</span></a>            <span class="s2">&quot;The ECS cluster to run the task in. The ARN or name may be provided. If &quot;</span>
</span><span id="ECSTask-449"><a href="#ECSTask-449"><span class="linenos"> 449</span></a>            <span class="s2">&quot;not provided, the default cluster will be used.&quot;</span>
</span><span id="ECSTask-450"><a href="#ECSTask-450"><span class="linenos"> 450</span></a>        <span class="p">),</span>
</span><span id="ECSTask-451"><a href="#ECSTask-451"><span class="linenos"> 451</span></a>    <span class="p">)</span>
</span><span id="ECSTask-452"><a href="#ECSTask-452"><span class="linenos"> 452</span></a>    <span class="n">env</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-453"><a href="#ECSTask-453"><span class="linenos"> 453</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Environment Variables&quot;</span><span class="p">,</span>
</span><span id="ECSTask-454"><a href="#ECSTask-454"><span class="linenos"> 454</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSTask-455"><a href="#ECSTask-455"><span class="linenos"> 455</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-456"><a href="#ECSTask-456"><span class="linenos"> 456</span></a>            <span class="s2">&quot;Environment variables to provide to the task run. These variables are set &quot;</span>
</span><span id="ECSTask-457"><a href="#ECSTask-457"><span class="linenos"> 457</span></a>            <span class="s2">&quot;on the Prefect container at task runtime. These will not be set on the &quot;</span>
</span><span id="ECSTask-458"><a href="#ECSTask-458"><span class="linenos"> 458</span></a>            <span class="s2">&quot;task definition.&quot;</span>
</span><span id="ECSTask-459"><a href="#ECSTask-459"><span class="linenos"> 459</span></a>        <span class="p">),</span>
</span><span id="ECSTask-460"><a href="#ECSTask-460"><span class="linenos"> 460</span></a>    <span class="p">)</span>
</span><span id="ECSTask-461"><a href="#ECSTask-461"><span class="linenos"> 461</span></a>    <span class="n">task_role_arn</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-462"><a href="#ECSTask-462"><span class="linenos"> 462</span></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Task Role ARN&quot;</span><span class="p">,</span>
</span><span id="ECSTask-463"><a href="#ECSTask-463"><span class="linenos"> 463</span></a>        <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-464"><a href="#ECSTask-464"><span class="linenos"> 464</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-465"><a href="#ECSTask-465"><span class="linenos"> 465</span></a>            <span class="s2">&quot;A role to attach to the task run. This controls the permissions of the &quot;</span>
</span><span id="ECSTask-466"><a href="#ECSTask-466"><span class="linenos"> 466</span></a>            <span class="s2">&quot;task while it is running.&quot;</span>
</span><span id="ECSTask-467"><a href="#ECSTask-467"><span class="linenos"> 467</span></a>        <span class="p">),</span>
</span><span id="ECSTask-468"><a href="#ECSTask-468"><span class="linenos"> 468</span></a>    <span class="p">)</span>
</span><span id="ECSTask-469"><a href="#ECSTask-469"><span class="linenos"> 469</span></a>    <span class="n">task_customizations</span><span class="p">:</span> <span class="n">JsonPatch</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-470"><a href="#ECSTask-470"><span class="linenos"> 470</span></a>        <span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">JsonPatch</span><span class="p">([]),</span>
</span><span id="ECSTask-471"><a href="#ECSTask-471"><span class="linenos"> 471</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-472"><a href="#ECSTask-472"><span class="linenos"> 472</span></a>            <span class="s2">&quot;A list of JSON 6902 patches to apply to the task run request. &quot;</span>
</span><span id="ECSTask-473"><a href="#ECSTask-473"><span class="linenos"> 473</span></a>            <span class="s2">&quot;If a string is given, it will parsed as a JSON expression.&quot;</span>
</span><span id="ECSTask-474"><a href="#ECSTask-474"><span class="linenos"> 474</span></a>        <span class="p">),</span>
</span><span id="ECSTask-475"><a href="#ECSTask-475"><span class="linenos"> 475</span></a>    <span class="p">)</span>
</span><span id="ECSTask-476"><a href="#ECSTask-476"><span class="linenos"> 476</span></a>
</span><span id="ECSTask-477"><a href="#ECSTask-477"><span class="linenos"> 477</span></a>    <span class="c1"># Execution settings</span>
</span><span id="ECSTask-478"><a href="#ECSTask-478"><span class="linenos"> 478</span></a>    <span class="n">task_start_timeout_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-479"><a href="#ECSTask-479"><span class="linenos"> 479</span></a>        <span class="n">default</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span>
</span><span id="ECSTask-480"><a href="#ECSTask-480"><span class="linenos"> 480</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-481"><a href="#ECSTask-481"><span class="linenos"> 481</span></a>            <span class="s2">&quot;The amount of time to watch for the start of the ECS task &quot;</span>
</span><span id="ECSTask-482"><a href="#ECSTask-482"><span class="linenos"> 482</span></a>            <span class="s2">&quot;before marking it as failed. The task must enter a RUNNING state to be &quot;</span>
</span><span id="ECSTask-483"><a href="#ECSTask-483"><span class="linenos"> 483</span></a>            <span class="s2">&quot;considered started.&quot;</span>
</span><span id="ECSTask-484"><a href="#ECSTask-484"><span class="linenos"> 484</span></a>        <span class="p">),</span>
</span><span id="ECSTask-485"><a href="#ECSTask-485"><span class="linenos"> 485</span></a>    <span class="p">)</span>
</span><span id="ECSTask-486"><a href="#ECSTask-486"><span class="linenos"> 486</span></a>    <span class="n">task_watch_poll_interval</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
</span><span id="ECSTask-487"><a href="#ECSTask-487"><span class="linenos"> 487</span></a>        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
</span><span id="ECSTask-488"><a href="#ECSTask-488"><span class="linenos"> 488</span></a>        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
</span><span id="ECSTask-489"><a href="#ECSTask-489"><span class="linenos"> 489</span></a>            <span class="s2">&quot;The amount of time to wait between AWS API calls while monitoring the &quot;</span>
</span><span id="ECSTask-490"><a href="#ECSTask-490"><span class="linenos"> 490</span></a>            <span class="s2">&quot;state of an ECS task.&quot;</span>
</span><span id="ECSTask-491"><a href="#ECSTask-491"><span class="linenos"> 491</span></a>        <span class="p">),</span>
</span><span id="ECSTask-492"><a href="#ECSTask-492"><span class="linenos"> 492</span></a>    <span class="p">)</span>
</span><span id="ECSTask-493"><a href="#ECSTask-493"><span class="linenos"> 493</span></a>
</span><span id="ECSTask-494"><a href="#ECSTask-494"><span class="linenos"> 494</span></a>    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask-495"><a href="#ECSTask-495"><span class="linenos"> 495</span></a>    <span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-496"><a href="#ECSTask-496"><span class="linenos"> 496</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-497"><a href="#ECSTask-497"><span class="linenos"> 497</span></a><span class="sd">        Streaming output generally requires CloudWatch logs to be configured.</span>
</span><span id="ECSTask-498"><a href="#ECSTask-498"><span class="linenos"> 498</span></a>
</span><span id="ECSTask-499"><a href="#ECSTask-499"><span class="linenos"> 499</span></a><span class="sd">        To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
</span><span id="ECSTask-500"><a href="#ECSTask-500"><span class="linenos"> 500</span></a><span class="sd">        defaults to matching the value of `stream_output`.</span>
</span><span id="ECSTask-501"><a href="#ECSTask-501"><span class="linenos"> 501</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-502"><a href="#ECSTask-502"><span class="linenos"> 502</span></a>        <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
</span><span id="ECSTask-503"><a href="#ECSTask-503"><span class="linenos"> 503</span></a>        <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-504"><a href="#ECSTask-504"><span class="linenos"> 504</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
</span><span id="ECSTask-505"><a href="#ECSTask-505"><span class="linenos"> 505</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask-506"><a href="#ECSTask-506"><span class="linenos"> 506</span></a>
</span><span id="ECSTask-507"><a href="#ECSTask-507"><span class="linenos"> 507</span></a>    <span class="nd">@root_validator</span>
</span><span id="ECSTask-508"><a href="#ECSTask-508"><span class="linenos"> 508</span></a>    <span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
</span><span id="ECSTask-509"><a href="#ECSTask-509"><span class="linenos"> 509</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ECSTask-510"><a href="#ECSTask-510"><span class="linenos"> 510</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-511"><a href="#ECSTask-511"><span class="linenos"> 511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-512"><a href="#ECSTask-512"><span class="linenos"> 512</span></a><span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
</span><span id="ECSTask-513"><a href="#ECSTask-513"><span class="linenos"> 513</span></a><span class="sd">        runtime task definition) when configuring logging.</span>
</span><span id="ECSTask-514"><a href="#ECSTask-514"><span class="linenos"> 514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-515"><a href="#ECSTask-515"><span class="linenos"> 515</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSTask-516"><a href="#ECSTask-516"><span class="linenos"> 516</span></a>            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
</span><span id="ECSTask-517"><a href="#ECSTask-517"><span class="linenos"> 517</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
</span><span id="ECSTask-518"><a href="#ECSTask-518"><span class="linenos"> 518</span></a>            <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
</span><span id="ECSTask-519"><a href="#ECSTask-519"><span class="linenos"> 519</span></a>            <span class="c1"># it without using our shortcuts</span>
</span><span id="ECSTask-520"><a href="#ECSTask-520"><span class="linenos"> 520</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition_arn&quot;</span><span class="p">)</span>
</span><span id="ECSTask-521"><a href="#ECSTask-521"><span class="linenos"> 521</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
</span><span id="ECSTask-522"><a href="#ECSTask-522"><span class="linenos"> 522</span></a>        <span class="p">):</span>
</span><span id="ECSTask-523"><a href="#ECSTask-523"><span class="linenos"> 523</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask-524"><a href="#ECSTask-524"><span class="linenos"> 524</span></a>                <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
</span><span id="ECSTask-525"><a href="#ECSTask-525"><span class="linenos"> 525</span></a>                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
</span><span id="ECSTask-526"><a href="#ECSTask-526"><span class="linenos"> 526</span></a>            <span class="p">)</span>
</span><span id="ECSTask-527"><a href="#ECSTask-527"><span class="linenos"> 527</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask-528"><a href="#ECSTask-528"><span class="linenos"> 528</span></a>
</span><span id="ECSTask-529"><a href="#ECSTask-529"><span class="linenos"> 529</span></a>    <span class="nd">@root_validator</span>
</span><span id="ECSTask-530"><a href="#ECSTask-530"><span class="linenos"> 530</span></a>    <span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
</span><span id="ECSTask-531"><a href="#ECSTask-531"><span class="linenos"> 531</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ECSTask-532"><a href="#ECSTask-532"><span class="linenos"> 532</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-533"><a href="#ECSTask-533"><span class="linenos"> 533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-534"><a href="#ECSTask-534"><span class="linenos"> 534</span></a><span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
</span><span id="ECSTask-535"><a href="#ECSTask-535"><span class="linenos"> 535</span></a><span class="sd">        runtime task definition) when configuring logging.</span>
</span><span id="ECSTask-536"><a href="#ECSTask-536"><span class="linenos"> 536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-537"><a href="#ECSTask-537"><span class="linenos"> 537</span></a>        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSTask-538"><a href="#ECSTask-538"><span class="linenos"> 538</span></a>            <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
</span><span id="ECSTask-539"><a href="#ECSTask-539"><span class="linenos"> 539</span></a>        <span class="p">):</span>
</span><span id="ECSTask-540"><a href="#ECSTask-540"><span class="linenos"> 540</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask-541"><a href="#ECSTask-541"><span class="linenos"> 541</span></a>                <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
</span><span id="ECSTask-542"><a href="#ECSTask-542"><span class="linenos"> 542</span></a>                <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
</span><span id="ECSTask-543"><a href="#ECSTask-543"><span class="linenos"> 543</span></a>            <span class="p">)</span>
</span><span id="ECSTask-544"><a href="#ECSTask-544"><span class="linenos"> 544</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask-545"><a href="#ECSTask-545"><span class="linenos"> 545</span></a>
</span><span id="ECSTask-546"><a href="#ECSTask-546"><span class="linenos"> 546</span></a>    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask-547"><a href="#ECSTask-547"><span class="linenos"> 547</span></a>    <span class="k">def</span> <span class="nf">image_is_required</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-548"><a href="#ECSTask-548"><span class="linenos"> 548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-549"><a href="#ECSTask-549"><span class="linenos"> 549</span></a><span class="sd">        Enforces that an image is available if image is `None`.</span>
</span><span id="ECSTask-550"><a href="#ECSTask-550"><span class="linenos"> 550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-551"><a href="#ECSTask-551"><span class="linenos"> 551</span></a>        <span class="n">has_image</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">))</span>
</span><span id="ECSTask-552"><a href="#ECSTask-552"><span class="linenos"> 552</span></a>        <span class="n">has_task_definition_arn</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition_arn&quot;</span><span class="p">))</span>
</span><span id="ECSTask-553"><a href="#ECSTask-553"><span class="linenos"> 553</span></a>
</span><span id="ECSTask-554"><a href="#ECSTask-554"><span class="linenos"> 554</span></a>        <span class="c1"># The image can only be null when the task_definition_arn is set</span>
</span><span id="ECSTask-555"><a href="#ECSTask-555"><span class="linenos"> 555</span></a>        <span class="k">if</span> <span class="n">has_image</span> <span class="ow">or</span> <span class="n">has_task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask-556"><a href="#ECSTask-556"><span class="linenos"> 556</span></a>            <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask-557"><a href="#ECSTask-557"><span class="linenos"> 557</span></a>
</span><span id="ECSTask-558"><a href="#ECSTask-558"><span class="linenos"> 558</span></a>        <span class="n">prefect_container</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSTask-559"><a href="#ECSTask-559"><span class="linenos"> 559</span></a>            <span class="n">get_prefect_container</span><span class="p">(</span>
</span><span id="ECSTask-560"><a href="#ECSTask-560"><span class="linenos"> 560</span></a>                <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask-561"><a href="#ECSTask-561"><span class="linenos"> 561</span></a>            <span class="p">)</span>
</span><span id="ECSTask-562"><a href="#ECSTask-562"><span class="linenos"> 562</span></a>            <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ECSTask-563"><a href="#ECSTask-563"><span class="linenos"> 563</span></a>        <span class="p">)</span>
</span><span id="ECSTask-564"><a href="#ECSTask-564"><span class="linenos"> 564</span></a>        <span class="n">image_in_task_definition</span> <span class="o">=</span> <span class="n">prefect_container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</span><span id="ECSTask-565"><a href="#ECSTask-565"><span class="linenos"> 565</span></a>
</span><span id="ECSTask-566"><a href="#ECSTask-566"><span class="linenos"> 566</span></a>        <span class="c1"># If a task_definition is given with a prefect container image, use that value</span>
</span><span id="ECSTask-567"><a href="#ECSTask-567"><span class="linenos"> 567</span></a>        <span class="k">if</span> <span class="n">image_in_task_definition</span><span class="p">:</span>
</span><span id="ECSTask-568"><a href="#ECSTask-568"><span class="linenos"> 568</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_in_task_definition</span>
</span><span id="ECSTask-569"><a href="#ECSTask-569"><span class="linenos"> 569</span></a>        <span class="c1"># Otherwise, it should default to the Prefect base image</span>
</span><span id="ECSTask-570"><a href="#ECSTask-570"><span class="linenos"> 570</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-571"><a href="#ECSTask-571"><span class="linenos"> 571</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_prefect_image_name</span><span class="p">()</span>
</span><span id="ECSTask-572"><a href="#ECSTask-572"><span class="linenos"> 572</span></a>        <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask-573"><a href="#ECSTask-573"><span class="linenos"> 573</span></a>
</span><span id="ECSTask-574"><a href="#ECSTask-574"><span class="linenos"> 574</span></a>    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;task_customizations&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask-575"><a href="#ECSTask-575"><span class="linenos"> 575</span></a>    <span class="k">def</span> <span class="nf">cast_customizations_to_a_json_patch</span><span class="p">(</span>
</span><span id="ECSTask-576"><a href="#ECSTask-576"><span class="linenos"> 576</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">JsonPatch</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="ECSTask-577"><a href="#ECSTask-577"><span class="linenos"> 577</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonPatch</span><span class="p">:</span>
</span><span id="ECSTask-578"><a href="#ECSTask-578"><span class="linenos"> 578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-579"><a href="#ECSTask-579"><span class="linenos"> 579</span></a><span class="sd">        Casts lists to JsonPatch instances.</span>
</span><span id="ECSTask-580"><a href="#ECSTask-580"><span class="linenos"> 580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-581"><a href="#ECSTask-581"><span class="linenos"> 581</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ECSTask-582"><a href="#ECSTask-582"><span class="linenos"> 582</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask-583"><a href="#ECSTask-583"><span class="linenos"> 583</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ECSTask-584"><a href="#ECSTask-584"><span class="linenos"> 584</span></a>            <span class="k">return</span> <span class="n">JsonPatch</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask-585"><a href="#ECSTask-585"><span class="linenos"> 585</span></a>        <span class="k">return</span> <span class="n">value</span>  <span class="c1"># type: ignore</span>
</span><span id="ECSTask-586"><a href="#ECSTask-586"><span class="linenos"> 586</span></a>
</span><span id="ECSTask-587"><a href="#ECSTask-587"><span class="linenos"> 587</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="ECSTask-588"><a href="#ECSTask-588"><span class="linenos"> 588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration of pydantic.&quot;&quot;&quot;</span>
</span><span id="ECSTask-589"><a href="#ECSTask-589"><span class="linenos"> 589</span></a>
</span><span id="ECSTask-590"><a href="#ECSTask-590"><span class="linenos"> 590</span></a>        <span class="c1"># Support serialization of the &#39;JsonPatch&#39; type</span>
</span><span id="ECSTask-591"><a href="#ECSTask-591"><span class="linenos"> 591</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSTask-592"><a href="#ECSTask-592"><span class="linenos"> 592</span></a>        <span class="n">json_encoders</span> <span class="o">=</span> <span class="p">{</span><span class="n">JsonPatch</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">patch</span><span class="p">}</span>
</span><span id="ECSTask-593"><a href="#ECSTask-593"><span class="linenos"> 593</span></a>
</span><span id="ECSTask-594"><a href="#ECSTask-594"><span class="linenos"> 594</span></a>    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ECSTask-595"><a href="#ECSTask-595"><span class="linenos"> 595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-596"><a href="#ECSTask-596"><span class="linenos"> 596</span></a><span class="sd">        Convert to a dictionary.</span>
</span><span id="ECSTask-597"><a href="#ECSTask-597"><span class="linenos"> 597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-598"><a href="#ECSTask-598"><span class="linenos"> 598</span></a>        <span class="c1"># Support serialization of the &#39;JsonPatch&#39; type</span>
</span><span id="ECSTask-599"><a href="#ECSTask-599"><span class="linenos"> 599</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ECSTask-600"><a href="#ECSTask-600"><span class="linenos"> 600</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;task_customizations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="o">.</span><span class="n">patch</span>
</span><span id="ECSTask-601"><a href="#ECSTask-601"><span class="linenos"> 601</span></a>        <span class="k">return</span> <span class="n">d</span>
</span><span id="ECSTask-602"><a href="#ECSTask-602"><span class="linenos"> 602</span></a>
</span><span id="ECSTask-603"><a href="#ECSTask-603"><span class="linenos"> 603</span></a>    <span class="k">def</span> <span class="nf">prepare_for_flow_run</span><span class="p">(</span>
</span><span id="ECSTask-604"><a href="#ECSTask-604"><span class="linenos"> 604</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span>
</span><span id="ECSTask-605"><a href="#ECSTask-605"><span class="linenos"> 605</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
</span><span id="ECSTask-606"><a href="#ECSTask-606"><span class="linenos"> 606</span></a>        <span class="n">deployment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Deployment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-607"><a href="#ECSTask-607"><span class="linenos"> 607</span></a>        <span class="n">flow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Flow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-608"><a href="#ECSTask-608"><span class="linenos"> 608</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ECSTask-609"><a href="#ECSTask-609"><span class="linenos"> 609</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-610"><a href="#ECSTask-610"><span class="linenos"> 610</span></a><span class="sd">        Return an copy of the block that is prepared to execute a flow run.</span>
</span><span id="ECSTask-611"><a href="#ECSTask-611"><span class="linenos"> 611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-612"><a href="#ECSTask-612"><span class="linenos"> 612</span></a>        <span class="n">new_family</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-613"><a href="#ECSTask-613"><span class="linenos"> 613</span></a>
</span><span id="ECSTask-614"><a href="#ECSTask-614"><span class="linenos"> 614</span></a>        <span class="c1"># Update the family if not specified elsewhere</span>
</span><span id="ECSTask-615"><a href="#ECSTask-615"><span class="linenos"> 615</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSTask-616"><a href="#ECSTask-616"><span class="linenos"> 616</span></a>            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span>
</span><span id="ECSTask-617"><a href="#ECSTask-617"><span class="linenos"> 617</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span>
</span><span id="ECSTask-618"><a href="#ECSTask-618"><span class="linenos"> 618</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">))</span>
</span><span id="ECSTask-619"><a href="#ECSTask-619"><span class="linenos"> 619</span></a>        <span class="p">):</span>
</span><span id="ECSTask-620"><a href="#ECSTask-620"><span class="linenos"> 620</span></a>            <span class="k">if</span> <span class="n">flow</span> <span class="ow">and</span> <span class="n">deployment</span><span class="p">:</span>
</span><span id="ECSTask-621"><a href="#ECSTask-621"><span class="linenos"> 621</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-622"><a href="#ECSTask-622"><span class="linenos"> 622</span></a>            <span class="k">elif</span> <span class="n">flow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">deployment</span><span class="p">:</span>
</span><span id="ECSTask-623"><a href="#ECSTask-623"><span class="linenos"> 623</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-624"><a href="#ECSTask-624"><span class="linenos"> 624</span></a>            <span class="k">elif</span> <span class="n">deployment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flow</span><span class="p">:</span>
</span><span id="ECSTask-625"><a href="#ECSTask-625"><span class="linenos"> 625</span></a>                <span class="c1"># This is a weird case and should not be see in the wild</span>
</span><span id="ECSTask-626"><a href="#ECSTask-626"><span class="linenos"> 626</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__unknown-flow__</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-627"><a href="#ECSTask-627"><span class="linenos"> 627</span></a>
</span><span id="ECSTask-628"><a href="#ECSTask-628"><span class="linenos"> 628</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_for_flow_run</span><span class="p">(</span><span class="n">flow_run</span><span class="p">,</span> <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">)</span>
</span><span id="ECSTask-629"><a href="#ECSTask-629"><span class="linenos"> 629</span></a>
</span><span id="ECSTask-630"><a href="#ECSTask-630"><span class="linenos"> 630</span></a>        <span class="k">if</span> <span class="n">new_family</span><span class="p">:</span>
</span><span id="ECSTask-631"><a href="#ECSTask-631"><span class="linenos"> 631</span></a>            <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="n">new_family</span><span class="p">})</span>
</span><span id="ECSTask-632"><a href="#ECSTask-632"><span class="linenos"> 632</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-633"><a href="#ECSTask-633"><span class="linenos"> 633</span></a>            <span class="c1"># Avoid an extra copy if not needed</span>
</span><span id="ECSTask-634"><a href="#ECSTask-634"><span class="linenos"> 634</span></a>            <span class="k">return</span> <span class="n">new</span>
</span><span id="ECSTask-635"><a href="#ECSTask-635"><span class="linenos"> 635</span></a>
</span><span id="ECSTask-636"><a href="#ECSTask-636"><span class="linenos"> 636</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="ECSTask-637"><a href="#ECSTask-637"><span class="linenos"> 637</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ECSTaskResult</span><span class="p">:</span>
</span><span id="ECSTask-638"><a href="#ECSTask-638"><span class="linenos"> 638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-639"><a href="#ECSTask-639"><span class="linenos"> 639</span></a><span class="sd">        Run the configured task on ECS.</span>
</span><span id="ECSTask-640"><a href="#ECSTask-640"><span class="linenos"> 640</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-641"><a href="#ECSTask-641"><span class="linenos"> 641</span></a>        <span class="n">boto_session</span><span class="p">,</span> <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask-642"><a href="#ECSTask-642"><span class="linenos"> 642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_session_and_client</span>
</span><span id="ECSTask-643"><a href="#ECSTask-643"><span class="linenos"> 643</span></a>        <span class="p">)</span>
</span><span id="ECSTask-644"><a href="#ECSTask-644"><span class="linenos"> 644</span></a>
</span><span id="ECSTask-645"><a href="#ECSTask-645"><span class="linenos"> 645</span></a>        <span class="p">(</span>
</span><span id="ECSTask-646"><a href="#ECSTask-646"><span class="linenos"> 646</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSTask-647"><a href="#ECSTask-647"><span class="linenos"> 647</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSTask-648"><a href="#ECSTask-648"><span class="linenos"> 648</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSTask-649"><a href="#ECSTask-649"><span class="linenos"> 649</span></a>            <span class="n">is_new_task_definition</span><span class="p">,</span>
</span><span id="ECSTask-650"><a href="#ECSTask-650"><span class="linenos"> 650</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask-651"><a href="#ECSTask-651"><span class="linenos"> 651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span> <span class="n">boto_session</span><span class="p">,</span> <span class="n">ecs_client</span>
</span><span id="ECSTask-652"><a href="#ECSTask-652"><span class="linenos"> 652</span></a>        <span class="p">)</span>
</span><span id="ECSTask-653"><a href="#ECSTask-653"><span class="linenos"> 653</span></a>
</span><span id="ECSTask-654"><a href="#ECSTask-654"><span class="linenos"> 654</span></a>        <span class="c1"># Display a nice message indicating the command and image</span>
</span><span id="ECSTask-655"><a href="#ECSTask-655"><span class="linenos"> 655</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="ow">or</span> <span class="n">get_prefect_container</span><span class="p">(</span>
</span><span id="ECSTask-656"><a href="#ECSTask-656"><span class="linenos"> 656</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span>
</span><span id="ECSTask-657"><a href="#ECSTask-657"><span class="linenos"> 657</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask-658"><a href="#ECSTask-658"><span class="linenos"> 658</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask-659"><a href="#ECSTask-659"><span class="linenos"> 659</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Running command </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="ECSTask-660"><a href="#ECSTask-660"><span class="linenos"> 660</span></a>            <span class="sa">f</span><span class="s2">&quot;in container </span><span class="si">{</span><span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="si">!r}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="si">}</span><span class="s2">)...&quot;</span>
</span><span id="ECSTask-661"><a href="#ECSTask-661"><span class="linenos"> 661</span></a>        <span class="p">)</span>
</span><span id="ECSTask-662"><a href="#ECSTask-662"><span class="linenos"> 662</span></a>
</span><span id="ECSTask-663"><a href="#ECSTask-663"><span class="linenos"> 663</span></a>        <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
</span><span id="ECSTask-664"><a href="#ECSTask-664"><span class="linenos"> 664</span></a>        <span class="c1"># if set to preserve matching by name rather than arn</span>
</span><span id="ECSTask-665"><a href="#ECSTask-665"><span class="linenos"> 665</span></a>        <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
</span><span id="ECSTask-666"><a href="#ECSTask-666"><span class="linenos"> 666</span></a>        <span class="c1"># single colons.</span>
</span><span id="ECSTask-667"><a href="#ECSTask-667"><span class="linenos"> 667</span></a>        <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;::&quot;</span> <span class="o">+</span> <span class="n">task_arn</span>
</span><span id="ECSTask-668"><a href="#ECSTask-668"><span class="linenos"> 668</span></a>
</span><span id="ECSTask-669"><a href="#ECSTask-669"><span class="linenos"> 669</span></a>        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
</span><span id="ECSTask-670"><a href="#ECSTask-670"><span class="linenos"> 670</span></a>            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSTask-671"><a href="#ECSTask-671"><span class="linenos"> 671</span></a>
</span><span id="ECSTask-672"><a href="#ECSTask-672"><span class="linenos"> 672</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask-673"><a href="#ECSTask-673"><span class="linenos"> 673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
</span><span id="ECSTask-674"><a href="#ECSTask-674"><span class="linenos"> 674</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSTask-675"><a href="#ECSTask-675"><span class="linenos"> 675</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSTask-676"><a href="#ECSTask-676"><span class="linenos"> 676</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSTask-677"><a href="#ECSTask-677"><span class="linenos"> 677</span></a>            <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
</span><span id="ECSTask-678"><a href="#ECSTask-678"><span class="linenos"> 678</span></a>            <span class="n">boto_session</span><span class="p">,</span>
</span><span id="ECSTask-679"><a href="#ECSTask-679"><span class="linenos"> 679</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSTask-680"><a href="#ECSTask-680"><span class="linenos"> 680</span></a>        <span class="p">)</span>
</span><span id="ECSTask-681"><a href="#ECSTask-681"><span class="linenos"> 681</span></a>
</span><span id="ECSTask-682"><a href="#ECSTask-682"><span class="linenos"> 682</span></a>        <span class="k">return</span> <span class="n">ECSTaskResult</span><span class="p">(</span>
</span><span id="ECSTask-683"><a href="#ECSTask-683"><span class="linenos"> 683</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="ECSTask-684"><a href="#ECSTask-684"><span class="linenos"> 684</span></a>            <span class="c1"># If the container does not start the exit code can be null but we must</span>
</span><span id="ECSTask-685"><a href="#ECSTask-685"><span class="linenos"> 685</span></a>            <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
</span><span id="ECSTask-686"><a href="#ECSTask-686"><span class="linenos"> 686</span></a>            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ECSTask-687"><a href="#ECSTask-687"><span class="linenos"> 687</span></a>        <span class="p">)</span>
</span><span id="ECSTask-688"><a href="#ECSTask-688"><span class="linenos"> 688</span></a>
</span><span id="ECSTask-689"><a href="#ECSTask-689"><span class="linenos"> 689</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="ECSTask-690"><a href="#ECSTask-690"><span class="linenos"> 690</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-691"><a href="#ECSTask-691"><span class="linenos"> 691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-692"><a href="#ECSTask-692"><span class="linenos"> 692</span></a><span class="sd">        Kill a task running on ECS.</span>
</span><span id="ECSTask-693"><a href="#ECSTask-693"><span class="linenos"> 693</span></a>
</span><span id="ECSTask-694"><a href="#ECSTask-694"><span class="linenos"> 694</span></a><span class="sd">        Args:</span>
</span><span id="ECSTask-695"><a href="#ECSTask-695"><span class="linenos"> 695</span></a><span class="sd">            identifier: A cluster and task arn combination. This should match a value</span>
</span><span id="ECSTask-696"><a href="#ECSTask-696"><span class="linenos"> 696</span></a><span class="sd">                yielded by `ECSTask.run`.</span>
</span><span id="ECSTask-697"><a href="#ECSTask-697"><span class="linenos"> 697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-698"><a href="#ECSTask-698"><span class="linenos"> 698</span></a>        <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="ECSTask-699"><a href="#ECSTask-699"><span class="linenos"> 699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-700"><a href="#ECSTask-700"><span class="linenos"> 700</span></a>                <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
</span><span id="ECSTask-701"><a href="#ECSTask-701"><span class="linenos"> 701</span></a>                <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
</span><span id="ECSTask-702"><a href="#ECSTask-702"><span class="linenos"> 702</span></a>                <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask-703"><a href="#ECSTask-703"><span class="linenos"> 703</span></a>            <span class="p">)</span>
</span><span id="ECSTask-704"><a href="#ECSTask-704"><span class="linenos"> 704</span></a>        <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_task_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSTask-705"><a href="#ECSTask-705"><span class="linenos"> 705</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</span><span id="ECSTask-706"><a href="#ECSTask-706"><span class="linenos"> 706</span></a>
</span><span id="ECSTask-707"><a href="#ECSTask-707"><span class="linenos"> 707</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ECSTask-708"><a href="#ECSTask-708"><span class="linenos"> 708</span></a>    <span class="k">def</span> <span class="nf">get_corresponding_worker_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask-709"><a href="#ECSTask-709"><span class="linenos"> 709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the corresponding worker type for this infrastructure block.&quot;&quot;&quot;</span>
</span><span id="ECSTask-710"><a href="#ECSTask-710"><span class="linenos"> 710</span></a>        <span class="k">return</span> <span class="n">ECSWorker</span><span class="o">.</span><span class="n">type</span>
</span><span id="ECSTask-711"><a href="#ECSTask-711"><span class="linenos"> 711</span></a>
</span><span id="ECSTask-712"><a href="#ECSTask-712"><span class="linenos"> 712</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_work_pool_base_job_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-713"><a href="#ECSTask-713"><span class="linenos"> 713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-714"><a href="#ECSTask-714"><span class="linenos"> 714</span></a><span class="sd">        Generate a base job template for a cloud-run work pool with the same</span>
</span><span id="ECSTask-715"><a href="#ECSTask-715"><span class="linenos"> 715</span></a><span class="sd">        configuration as this block.</span>
</span><span id="ECSTask-716"><a href="#ECSTask-716"><span class="linenos"> 716</span></a>
</span><span id="ECSTask-717"><a href="#ECSTask-717"><span class="linenos"> 717</span></a><span class="sd">        Returns:</span>
</span><span id="ECSTask-718"><a href="#ECSTask-718"><span class="linenos"> 718</span></a><span class="sd">            - dict: a base job template for a cloud-run work pool</span>
</span><span id="ECSTask-719"><a href="#ECSTask-719"><span class="linenos"> 719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-720"><a href="#ECSTask-720"><span class="linenos"> 720</span></a>        <span class="n">base_job_template</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ECSWorker</span><span class="o">.</span><span class="n">get_default_base_job_template</span><span class="p">())</span>
</span><span id="ECSTask-721"><a href="#ECSTask-721"><span class="linenos"> 721</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ECSTask-722"><a href="#ECSTask-722"><span class="linenos"> 722</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;command&quot;</span><span class="p">:</span>
</span><span id="ECSTask-723"><a href="#ECSTask-723"><span class="linenos"> 723</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;command&quot;</span><span class="p">][</span>
</span><span id="ECSTask-724"><a href="#ECSTask-724"><span class="linenos"> 724</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask-725"><a href="#ECSTask-725"><span class="linenos"> 725</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask-726"><a href="#ECSTask-726"><span class="linenos"> 726</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ECSTask-727"><a href="#ECSTask-727"><span class="linenos"> 727</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span id="ECSTask-728"><a href="#ECSTask-728"><span class="linenos"> 728</span></a>                <span class="s2">&quot;block_type_slug&quot;</span><span class="p">,</span>
</span><span id="ECSTask-729"><a href="#ECSTask-729"><span class="linenos"> 729</span></a>                <span class="s2">&quot;_block_document_id&quot;</span><span class="p">,</span>
</span><span id="ECSTask-730"><a href="#ECSTask-730"><span class="linenos"> 730</span></a>                <span class="s2">&quot;_block_document_name&quot;</span><span class="p">,</span>
</span><span id="ECSTask-731"><a href="#ECSTask-731"><span class="linenos"> 731</span></a>                <span class="s2">&quot;_is_anonymous&quot;</span><span class="p">,</span>
</span><span id="ECSTask-732"><a href="#ECSTask-732"><span class="linenos"> 732</span></a>                <span class="s2">&quot;task_customizations&quot;</span><span class="p">,</span>
</span><span id="ECSTask-733"><a href="#ECSTask-733"><span class="linenos"> 733</span></a>            <span class="p">]:</span>
</span><span id="ECSTask-734"><a href="#ECSTask-734"><span class="linenos"> 734</span></a>                <span class="k">continue</span>
</span><span id="ECSTask-735"><a href="#ECSTask-735"><span class="linenos"> 735</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;aws_credentials&quot;</span><span class="p">:</span>
</span><span id="ECSTask-736"><a href="#ECSTask-736"><span class="linenos"> 736</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">_block_document_id</span><span class="p">:</span>
</span><span id="ECSTask-737"><a href="#ECSTask-737"><span class="linenos"> 737</span></a>                    <span class="k">raise</span> <span class="n">BlockNotSavedError</span><span class="p">(</span>
</span><span id="ECSTask-738"><a href="#ECSTask-738"><span class="linenos"> 738</span></a>                        <span class="s2">&quot;It looks like you are trying to use a block that&quot;</span>
</span><span id="ECSTask-739"><a href="#ECSTask-739"><span class="linenos"> 739</span></a>                        <span class="s2">&quot; has not been saved. Please call `.save` on your block&quot;</span>
</span><span id="ECSTask-740"><a href="#ECSTask-740"><span class="linenos"> 740</span></a>                        <span class="s2">&quot; before publishing it as a work pool.&quot;</span>
</span><span id="ECSTask-741"><a href="#ECSTask-741"><span class="linenos"> 741</span></a>                    <span class="p">)</span>
</span><span id="ECSTask-742"><a href="#ECSTask-742"><span class="linenos"> 742</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;aws_credentials&quot;</span><span class="p">][</span>
</span><span id="ECSTask-743"><a href="#ECSTask-743"><span class="linenos"> 743</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask-744"><a href="#ECSTask-744"><span class="linenos"> 744</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-745"><a href="#ECSTask-745"><span class="linenos"> 745</span></a>                    <span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask-746"><a href="#ECSTask-746"><span class="linenos"> 746</span></a>                        <span class="s2">&quot;block_document_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="ECSTask-747"><a href="#ECSTask-747"><span class="linenos"> 747</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">_block_document_id</span>
</span><span id="ECSTask-748"><a href="#ECSTask-748"><span class="linenos"> 748</span></a>                        <span class="p">)</span>
</span><span id="ECSTask-749"><a href="#ECSTask-749"><span class="linenos"> 749</span></a>                    <span class="p">}</span>
</span><span id="ECSTask-750"><a href="#ECSTask-750"><span class="linenos"> 750</span></a>                <span class="p">}</span>
</span><span id="ECSTask-751"><a href="#ECSTask-751"><span class="linenos"> 751</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;task_definition&quot;</span><span class="p">:</span>
</span><span id="ECSTask-752"><a href="#ECSTask-752"><span class="linenos"> 752</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span><span class="s2">&quot;task_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ECSTask-753"><a href="#ECSTask-753"><span class="linenos"> 753</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">]:</span>
</span><span id="ECSTask-754"><a href="#ECSTask-754"><span class="linenos"> 754</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ECSTask-755"><a href="#ECSTask-755"><span class="linenos"> 755</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-756"><a href="#ECSTask-756"><span class="linenos"> 756</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-757"><a href="#ECSTask-757"><span class="linenos"> 757</span></a>                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> is not supported by Cloud Run work pools.&quot;</span>
</span><span id="ECSTask-758"><a href="#ECSTask-758"><span class="linenos"> 758</span></a>                    <span class="s2">&quot; Skipping.&quot;</span>
</span><span id="ECSTask-759"><a href="#ECSTask-759"><span class="linenos"> 759</span></a>                <span class="p">)</span>
</span><span id="ECSTask-760"><a href="#ECSTask-760"><span class="linenos"> 760</span></a>
</span><span id="ECSTask-761"><a href="#ECSTask-761"><span class="linenos"> 761</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="p">:</span>
</span><span id="ECSTask-762"><a href="#ECSTask-762"><span class="linenos"> 762</span></a>            <span class="n">network_config_patches</span> <span class="o">=</span> <span class="n">JsonPatch</span><span class="p">(</span>
</span><span id="ECSTask-763"><a href="#ECSTask-763"><span class="linenos"> 763</span></a>                <span class="p">[</span>
</span><span id="ECSTask-764"><a href="#ECSTask-764"><span class="linenos"> 764</span></a>                    <span class="n">patch</span>
</span><span id="ECSTask-765"><a href="#ECSTask-765"><span class="linenos"> 765</span></a>                    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span>
</span><span id="ECSTask-766"><a href="#ECSTask-766"><span class="linenos"> 766</span></a>                    <span class="k">if</span> <span class="s2">&quot;networkConfiguration&quot;</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
</span><span id="ECSTask-767"><a href="#ECSTask-767"><span class="linenos"> 767</span></a>                <span class="p">]</span>
</span><span id="ECSTask-768"><a href="#ECSTask-768"><span class="linenos"> 768</span></a>            <span class="p">)</span>
</span><span id="ECSTask-769"><a href="#ECSTask-769"><span class="linenos"> 769</span></a>            <span class="n">minimal_network_config</span> <span class="o">=</span> <span class="n">assemble_document_for_patches</span><span class="p">(</span>
</span><span id="ECSTask-770"><a href="#ECSTask-770"><span class="linenos"> 770</span></a>                <span class="n">network_config_patches</span>
</span><span id="ECSTask-771"><a href="#ECSTask-771"><span class="linenos"> 771</span></a>            <span class="p">)</span>
</span><span id="ECSTask-772"><a href="#ECSTask-772"><span class="linenos"> 772</span></a>            <span class="k">if</span> <span class="n">minimal_network_config</span><span class="p">:</span>
</span><span id="ECSTask-773"><a href="#ECSTask-773"><span class="linenos"> 773</span></a>                <span class="n">minimal_network_config_with_patches</span> <span class="o">=</span> <span class="n">network_config_patches</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="ECSTask-774"><a href="#ECSTask-774"><span class="linenos"> 774</span></a>                    <span class="n">minimal_network_config</span>
</span><span id="ECSTask-775"><a href="#ECSTask-775"><span class="linenos"> 775</span></a>                <span class="p">)</span>
</span><span id="ECSTask-776"><a href="#ECSTask-776"><span class="linenos"> 776</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">][</span>
</span><span id="ECSTask-777"><a href="#ECSTask-777"><span class="linenos"> 777</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask-778"><a href="#ECSTask-778"><span class="linenos"> 778</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">minimal_network_config_with_patches</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span>
</span><span id="ECSTask-779"><a href="#ECSTask-779"><span class="linenos"> 779</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask-780"><a href="#ECSTask-780"><span class="linenos"> 780</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span>
</span><span id="ECSTask-781"><a href="#ECSTask-781"><span class="linenos"> 781</span></a>                    <span class="s2">&quot;task_run_request&quot;</span>
</span><span id="ECSTask-782"><a href="#ECSTask-782"><span class="linenos"> 782</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="ECSTask-783"><a href="#ECSTask-783"><span class="linenos"> 783</span></a>                    <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">]</span>
</span><span id="ECSTask-784"><a href="#ECSTask-784"><span class="linenos"> 784</span></a>                <span class="p">)</span>
</span><span id="ECSTask-785"><a href="#ECSTask-785"><span class="linenos"> 785</span></a>            <span class="k">except</span> <span class="n">JsonPointerException</span><span class="p">:</span>
</span><span id="ECSTask-786"><a href="#ECSTask-786"><span class="linenos"> 786</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-787"><a href="#ECSTask-787"><span class="linenos"> 787</span></a>                    <span class="s2">&quot;Unable to apply task customizations to the base job template.&quot;</span>
</span><span id="ECSTask-788"><a href="#ECSTask-788"><span class="linenos"> 788</span></a>                    <span class="s2">&quot;You may need to update the template manually.&quot;</span>
</span><span id="ECSTask-789"><a href="#ECSTask-789"><span class="linenos"> 789</span></a>                <span class="p">)</span>
</span><span id="ECSTask-790"><a href="#ECSTask-790"><span class="linenos"> 790</span></a>
</span><span id="ECSTask-791"><a href="#ECSTask-791"><span class="linenos"> 791</span></a>        <span class="k">return</span> <span class="n">base_job_template</span>
</span><span id="ECSTask-792"><a href="#ECSTask-792"><span class="linenos"> 792</span></a>
</span><span id="ECSTask-793"><a href="#ECSTask-793"><span class="linenos"> 793</span></a>    <span class="k">def</span> <span class="nf">_stop_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-794"><a href="#ECSTask-794"><span class="linenos"> 794</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-795"><a href="#ECSTask-795"><span class="linenos"> 795</span></a><span class="sd">        Stop a running ECS task.</span>
</span><span id="ECSTask-796"><a href="#ECSTask-796"><span class="linenos"> 796</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-797"><a href="#ECSTask-797"><span class="linenos"> 797</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="p">:</span>
</span><span id="ECSTask-798"><a href="#ECSTask-798"><span class="linenos"> 798</span></a>            <span class="k">raise</span> <span class="n">InfrastructureNotAvailable</span><span class="p">(</span>
</span><span id="ECSTask-799"><a href="#ECSTask-799"><span class="linenos"> 799</span></a>                <span class="s2">&quot;Cannot stop ECS task: this infrastructure block has access to &quot;</span>
</span><span id="ECSTask-800"><a href="#ECSTask-800"><span class="linenos"> 800</span></a>                <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> but the task is running in cluster &quot;</span>
</span><span id="ECSTask-801"><a href="#ECSTask-801"><span class="linenos"> 801</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSTask-802"><a href="#ECSTask-802"><span class="linenos"> 802</span></a>            <span class="p">)</span>
</span><span id="ECSTask-803"><a href="#ECSTask-803"><span class="linenos"> 803</span></a>
</span><span id="ECSTask-804"><a href="#ECSTask-804"><span class="linenos"> 804</span></a>        <span class="n">_</span><span class="p">,</span> <span class="n">ecs_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_session_and_client</span><span class="p">()</span>
</span><span id="ECSTask-805"><a href="#ECSTask-805"><span class="linenos"> 805</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask-806"><a href="#ECSTask-806"><span class="linenos"> 806</span></a>            <span class="n">ecs_client</span><span class="o">.</span><span class="n">stop_task</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</span><span id="ECSTask-807"><a href="#ECSTask-807"><span class="linenos"> 807</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="ECSTask-808"><a href="#ECSTask-808"><span class="linenos"> 808</span></a>            <span class="c1"># Raise a special exception if the task does not exist</span>
</span><span id="ECSTask-809"><a href="#ECSTask-809"><span class="linenos"> 809</span></a>            <span class="k">if</span> <span class="s2">&quot;ClusterNotFound&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSTask-810"><a href="#ECSTask-810"><span class="linenos"> 810</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSTask-811"><a href="#ECSTask-811"><span class="linenos"> 811</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> could not be found.&quot;</span>
</span><span id="ECSTask-812"><a href="#ECSTask-812"><span class="linenos"> 812</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSTask-813"><a href="#ECSTask-813"><span class="linenos"> 813</span></a>            <span class="k">if</span> <span class="s2">&quot;not find task&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;referenced task was not found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="ECSTask-814"><a href="#ECSTask-814"><span class="linenos"> 814</span></a>                <span class="n">exc</span>
</span><span id="ECSTask-815"><a href="#ECSTask-815"><span class="linenos"> 815</span></a>            <span class="p">):</span>
</span><span id="ECSTask-816"><a href="#ECSTask-816"><span class="linenos"> 816</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSTask-817"><a href="#ECSTask-817"><span class="linenos"> 817</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the task </span><span class="si">{</span><span class="n">task</span><span class="si">!r}</span><span class="s2"> could not be found in &quot;</span>
</span><span id="ECSTask-818"><a href="#ECSTask-818"><span class="linenos"> 818</span></a>                    <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSTask-819"><a href="#ECSTask-819"><span class="linenos"> 819</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSTask-820"><a href="#ECSTask-820"><span class="linenos"> 820</span></a>            <span class="k">if</span> <span class="s2">&quot;no registered tasks&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSTask-821"><a href="#ECSTask-821"><span class="linenos"> 821</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSTask-822"><a href="#ECSTask-822"><span class="linenos"> 822</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> has no tasks.&quot;</span>
</span><span id="ECSTask-823"><a href="#ECSTask-823"><span class="linenos"> 823</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSTask-824"><a href="#ECSTask-824"><span class="linenos"> 824</span></a>
</span><span id="ECSTask-825"><a href="#ECSTask-825"><span class="linenos"> 825</span></a>            <span class="c1"># Reraise unknown exceptions</span>
</span><span id="ECSTask-826"><a href="#ECSTask-826"><span class="linenos"> 826</span></a>            <span class="k">raise</span>
</span><span id="ECSTask-827"><a href="#ECSTask-827"><span class="linenos"> 827</span></a>
</span><span id="ECSTask-828"><a href="#ECSTask-828"><span class="linenos"> 828</span></a>    <span class="nd">@property</span>
</span><span id="ECSTask-829"><a href="#ECSTask-829"><span class="linenos"> 829</span></a>    <span class="k">def</span> <span class="nf">_log_prefix</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask-830"><a href="#ECSTask-830"><span class="linenos"> 830</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-831"><a href="#ECSTask-831"><span class="linenos"> 831</span></a><span class="sd">        Internal property for generating a prefix for logs where `name` may be null</span>
</span><span id="ECSTask-832"><a href="#ECSTask-832"><span class="linenos"> 832</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-833"><a href="#ECSTask-833"><span class="linenos"> 833</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-834"><a href="#ECSTask-834"><span class="linenos"> 834</span></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ECSTask </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-835"><a href="#ECSTask-835"><span class="linenos"> 835</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-836"><a href="#ECSTask-836"><span class="linenos"> 836</span></a>            <span class="k">return</span> <span class="s2">&quot;ECSTask&quot;</span>
</span><span id="ECSTask-837"><a href="#ECSTask-837"><span class="linenos"> 837</span></a>
</span><span id="ECSTask-838"><a href="#ECSTask-838"><span class="linenos"> 838</span></a>    <span class="k">def</span> <span class="nf">_get_session_and_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">_ECSClient</span><span class="p">]:</span>
</span><span id="ECSTask-839"><a href="#ECSTask-839"><span class="linenos"> 839</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-840"><a href="#ECSTask-840"><span class="linenos"> 840</span></a><span class="sd">        Retrieve a boto3 session and ECS client</span>
</span><span id="ECSTask-841"><a href="#ECSTask-841"><span class="linenos"> 841</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-842"><a href="#ECSTask-842"><span class="linenos"> 842</span></a>        <span class="n">boto_session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_boto3_session</span><span class="p">()</span>
</span><span id="ECSTask-843"><a href="#ECSTask-843"><span class="linenos"> 843</span></a>        <span class="n">ecs_client</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;ecs&quot;</span><span class="p">)</span>
</span><span id="ECSTask-844"><a href="#ECSTask-844"><span class="linenos"> 844</span></a>        <span class="k">return</span> <span class="n">boto_session</span><span class="p">,</span> <span class="n">ecs_client</span>
</span><span id="ECSTask-845"><a href="#ECSTask-845"><span class="linenos"> 845</span></a>
</span><span id="ECSTask-846"><a href="#ECSTask-846"><span class="linenos"> 846</span></a>    <span class="k">def</span> <span class="nf">_create_task_and_wait_for_start</span><span class="p">(</span>
</span><span id="ECSTask-847"><a href="#ECSTask-847"><span class="linenos"> 847</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">boto_session</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span>
</span><span id="ECSTask-848"><a href="#ECSTask-848"><span class="linenos"> 848</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="ECSTask-849"><a href="#ECSTask-849"><span class="linenos"> 849</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-850"><a href="#ECSTask-850"><span class="linenos"> 850</span></a><span class="sd">        Register the task definition, create the task run, and wait for it to start.</span>
</span><span id="ECSTask-851"><a href="#ECSTask-851"><span class="linenos"> 851</span></a>
</span><span id="ECSTask-852"><a href="#ECSTask-852"><span class="linenos"> 852</span></a><span class="sd">        Returns a tuple of</span>
</span><span id="ECSTask-853"><a href="#ECSTask-853"><span class="linenos"> 853</span></a><span class="sd">        - The task ARN</span>
</span><span id="ECSTask-854"><a href="#ECSTask-854"><span class="linenos"> 854</span></a><span class="sd">        - The task&#39;s cluster ARN</span>
</span><span id="ECSTask-855"><a href="#ECSTask-855"><span class="linenos"> 855</span></a><span class="sd">        - The task definition</span>
</span><span id="ECSTask-856"><a href="#ECSTask-856"><span class="linenos"> 856</span></a><span class="sd">        - A bool indicating if the task definition is newly registered</span>
</span><span id="ECSTask-857"><a href="#ECSTask-857"><span class="linenos"> 857</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-858"><a href="#ECSTask-858"><span class="linenos"> 858</span></a>        <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ECSTask-859"><a href="#ECSTask-859"><span class="linenos"> 859</span></a>        <span class="n">requested_task_definition</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSTask-860"><a href="#ECSTask-860"><span class="linenos"> 860</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span><span class="n">ecs_client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span><span class="p">)</span>
</span><span id="ECSTask-861"><a href="#ECSTask-861"><span class="linenos"> 861</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span>
</span><span id="ECSTask-862"><a href="#ECSTask-862"><span class="linenos"> 862</span></a>            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span>
</span><span id="ECSTask-863"><a href="#ECSTask-863"><span class="linenos"> 863</span></a>        <span class="p">)</span> <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ECSTask-864"><a href="#ECSTask-864"><span class="linenos"> 864</span></a>        <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">requested_task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSTask-865"><a href="#ECSTask-865"><span class="linenos"> 865</span></a>
</span><span id="ECSTask-866"><a href="#ECSTask-866"><span class="linenos"> 866</span></a>        <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-867"><a href="#ECSTask-867"><span class="linenos"> 867</span></a>            <span class="n">requested_task_definition</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">ecs_client</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_name</span>
</span><span id="ECSTask-868"><a href="#ECSTask-868"><span class="linenos"> 868</span></a>        <span class="p">)</span>
</span><span id="ECSTask-869"><a href="#ECSTask-869"><span class="linenos"> 869</span></a>
</span><span id="ECSTask-870"><a href="#ECSTask-870"><span class="linenos"> 870</span></a>        <span class="c1"># We must register the task definition if the arn is null or changes were made</span>
</span><span id="ECSTask-871"><a href="#ECSTask-871"><span class="linenos"> 871</span></a>        <span class="k">if</span> <span class="n">task_definition</span> <span class="o">!=</span> <span class="n">requested_task_definition</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask-872"><a href="#ECSTask-872"><span class="linenos"> 872</span></a>            <span class="c1"># Before registering, check if the latest task definition in the family</span>
</span><span id="ECSTask-873"><a href="#ECSTask-873"><span class="linenos"> 873</span></a>            <span class="c1"># can be used</span>
</span><span id="ECSTask-874"><a href="#ECSTask-874"><span class="linenos"> 874</span></a>            <span class="n">latest_task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_latest_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-875"><a href="#ECSTask-875"><span class="linenos"> 875</span></a>                <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;family&quot;</span><span class="p">]</span>
</span><span id="ECSTask-876"><a href="#ECSTask-876"><span class="linenos"> 876</span></a>            <span class="p">)</span>
</span><span id="ECSTask-877"><a href="#ECSTask-877"><span class="linenos"> 877</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_definitions_equal</span><span class="p">(</span><span class="n">latest_task_definition</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">):</span>
</span><span id="ECSTask-878"><a href="#ECSTask-878"><span class="linenos"> 878</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSTask-879"><a href="#ECSTask-879"><span class="linenos"> 879</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: The latest task definition matches the &quot;</span>
</span><span id="ECSTask-880"><a href="#ECSTask-880"><span class="linenos"> 880</span></a>                    <span class="s2">&quot;required task definition; using that instead of registering a new &quot;</span>
</span><span id="ECSTask-881"><a href="#ECSTask-881"><span class="linenos"> 881</span></a>                    <span class="s2">&quot; one.&quot;</span>
</span><span id="ECSTask-882"><a href="#ECSTask-882"><span class="linenos"> 882</span></a>                <span class="p">)</span>
</span><span id="ECSTask-883"><a href="#ECSTask-883"><span class="linenos"> 883</span></a>                <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">latest_task_definition</span><span class="p">[</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
</span><span id="ECSTask-884"><a href="#ECSTask-884"><span class="linenos"> 884</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-885"><a href="#ECSTask-885"><span class="linenos"> 885</span></a>                <span class="k">if</span> <span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask-886"><a href="#ECSTask-886"><span class="linenos"> 886</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-887"><a href="#ECSTask-887"><span class="linenos"> 887</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Settings require changes to the linked &quot;</span>
</span><span id="ECSTask-888"><a href="#ECSTask-888"><span class="linenos"> 888</span></a>                        <span class="s2">&quot;task definition. A new task definition will be registered. &quot;</span>
</span><span id="ECSTask-889"><a href="#ECSTask-889"><span class="linenos"> 889</span></a>                        <span class="o">+</span> <span class="p">(</span>
</span><span id="ECSTask-890"><a href="#ECSTask-890"><span class="linenos"> 890</span></a>                            <span class="s2">&quot;Enable DEBUG level logs to see the difference.&quot;</span>
</span><span id="ECSTask-891"><a href="#ECSTask-891"><span class="linenos"> 891</span></a>                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">level</span> <span class="o">&gt;</span> <span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span>
</span><span id="ECSTask-892"><a href="#ECSTask-892"><span class="linenos"> 892</span></a>                            <span class="k">else</span> <span class="s2">&quot;&quot;</span>
</span><span id="ECSTask-893"><a href="#ECSTask-893"><span class="linenos"> 893</span></a>                        <span class="p">)</span>
</span><span id="ECSTask-894"><a href="#ECSTask-894"><span class="linenos"> 894</span></a>                    <span class="p">)</span>
</span><span id="ECSTask-895"><a href="#ECSTask-895"><span class="linenos"> 895</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSTask-896"><a href="#ECSTask-896"><span class="linenos"> 896</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Diff for requested task definition&quot;</span>
</span><span id="ECSTask-897"><a href="#ECSTask-897"><span class="linenos"> 897</span></a>                        <span class="o">+</span> <span class="n">_pretty_diff</span><span class="p">(</span><span class="n">requested_task_definition</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask-898"><a href="#ECSTask-898"><span class="linenos"> 898</span></a>                    <span class="p">)</span>
</span><span id="ECSTask-899"><a href="#ECSTask-899"><span class="linenos"> 899</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-900"><a href="#ECSTask-900"><span class="linenos"> 900</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask-901"><a href="#ECSTask-901"><span class="linenos"> 901</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Registering task definition...&quot;</span>
</span><span id="ECSTask-902"><a href="#ECSTask-902"><span class="linenos"> 902</span></a>                    <span class="p">)</span>
</span><span id="ECSTask-903"><a href="#ECSTask-903"><span class="linenos"> 903</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSTask-904"><a href="#ECSTask-904"><span class="linenos"> 904</span></a>                        <span class="s2">&quot;Task definition payload</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask-905"><a href="#ECSTask-905"><span class="linenos"> 905</span></a>                    <span class="p">)</span>
</span><span id="ECSTask-906"><a href="#ECSTask-906"><span class="linenos"> 906</span></a>
</span><span id="ECSTask-907"><a href="#ECSTask-907"><span class="linenos"> 907</span></a>                <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-908"><a href="#ECSTask-908"><span class="linenos"> 908</span></a>                    <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition</span>
</span><span id="ECSTask-909"><a href="#ECSTask-909"><span class="linenos"> 909</span></a>                <span class="p">)</span>
</span><span id="ECSTask-910"><a href="#ECSTask-910"><span class="linenos"> 910</span></a>                <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSTask-911"><a href="#ECSTask-911"><span class="linenos"> 911</span></a>
</span><span id="ECSTask-912"><a href="#ECSTask-912"><span class="linenos"> 912</span></a>        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
</span><span id="ECSTask-913"><a href="#ECSTask-913"><span class="linenos"> 913</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_vpc_network_config</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vpc_id</span><span class="p">,</span> <span class="n">boto_session</span><span class="p">)</span>
</span><span id="ECSTask-914"><a href="#ECSTask-914"><span class="linenos"> 914</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-915"><a href="#ECSTask-915"><span class="linenos"> 915</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-916"><a href="#ECSTask-916"><span class="linenos"> 916</span></a>
</span><span id="ECSTask-917"><a href="#ECSTask-917"><span class="linenos"> 917</span></a>        <span class="n">task_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run</span><span class="p">(</span>
</span><span id="ECSTask-918"><a href="#ECSTask-918"><span class="linenos"> 918</span></a>            <span class="n">network_config</span><span class="o">=</span><span class="n">network_config</span><span class="p">,</span>
</span><span id="ECSTask-919"><a href="#ECSTask-919"><span class="linenos"> 919</span></a>            <span class="n">task_definition_arn</span><span class="o">=</span><span class="n">task_definition_arn</span><span class="p">,</span>
</span><span id="ECSTask-920"><a href="#ECSTask-920"><span class="linenos"> 920</span></a>        <span class="p">)</span>
</span><span id="ECSTask-921"><a href="#ECSTask-921"><span class="linenos"> 921</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Creating task run...&quot;</span><span class="p">)</span>
</span><span id="ECSTask-922"><a href="#ECSTask-922"><span class="linenos"> 922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Task run payload</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_run</span><span class="p">))</span>
</span><span id="ECSTask-923"><a href="#ECSTask-923"><span class="linenos"> 923</span></a>
</span><span id="ECSTask-924"><a href="#ECSTask-924"><span class="linenos"> 924</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask-925"><a href="#ECSTask-925"><span class="linenos"> 925</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_run_task</span><span class="p">(</span><span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_run</span><span class="p">)</span>
</span><span id="ECSTask-926"><a href="#ECSTask-926"><span class="linenos"> 926</span></a>            <span class="n">task_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskArn&quot;</span><span class="p">]</span>
</span><span id="ECSTask-927"><a href="#ECSTask-927"><span class="linenos"> 927</span></a>            <span class="n">cluster_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;clusterArn&quot;</span><span class="p">]</span>
</span><span id="ECSTask-928"><a href="#ECSTask-928"><span class="linenos"> 928</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="ECSTask-929"><a href="#ECSTask-929"><span class="linenos"> 929</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_report_task_run_creation_failure</span><span class="p">(</span><span class="n">task_run</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
</span><span id="ECSTask-930"><a href="#ECSTask-930"><span class="linenos"> 930</span></a>
</span><span id="ECSTask-931"><a href="#ECSTask-931"><span class="linenos"> 931</span></a>        <span class="c1"># Raises an exception if the task does not start</span>
</span><span id="ECSTask-932"><a href="#ECSTask-932"><span class="linenos"> 932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Waiting for task run to start...&quot;</span><span class="p">)</span>
</span><span id="ECSTask-933"><a href="#ECSTask-933"><span class="linenos"> 933</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_start</span><span class="p">(</span>
</span><span id="ECSTask-934"><a href="#ECSTask-934"><span class="linenos"> 934</span></a>            <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">task_start_timeout_seconds</span>
</span><span id="ECSTask-935"><a href="#ECSTask-935"><span class="linenos"> 935</span></a>        <span class="p">)</span>
</span><span id="ECSTask-936"><a href="#ECSTask-936"><span class="linenos"> 936</span></a>
</span><span id="ECSTask-937"><a href="#ECSTask-937"><span class="linenos"> 937</span></a>        <span class="k">return</span> <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">,</span> <span class="n">new_task_definition_registered</span>
</span><span id="ECSTask-938"><a href="#ECSTask-938"><span class="linenos"> 938</span></a>
</span><span id="ECSTask-939"><a href="#ECSTask-939"><span class="linenos"> 939</span></a>    <span class="k">def</span> <span class="nf">_watch_task_and_get_exit_code</span><span class="p">(</span>
</span><span id="ECSTask-940"><a href="#ECSTask-940"><span class="linenos"> 940</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSTask-941"><a href="#ECSTask-941"><span class="linenos"> 941</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-942"><a href="#ECSTask-942"><span class="linenos"> 942</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-943"><a href="#ECSTask-943"><span class="linenos"> 943</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSTask-944"><a href="#ECSTask-944"><span class="linenos"> 944</span></a>        <span class="n">deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ECSTask-945"><a href="#ECSTask-945"><span class="linenos"> 945</span></a>        <span class="n">boto_session</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span>
</span><span id="ECSTask-946"><a href="#ECSTask-946"><span class="linenos"> 946</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSTask-947"><a href="#ECSTask-947"><span class="linenos"> 947</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ECSTask-948"><a href="#ECSTask-948"><span class="linenos"> 948</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-949"><a href="#ECSTask-949"><span class="linenos"> 949</span></a><span class="sd">        Wait for the task run to complete and retrieve the exit code of the Prefect</span>
</span><span id="ECSTask-950"><a href="#ECSTask-950"><span class="linenos"> 950</span></a><span class="sd">        container.</span>
</span><span id="ECSTask-951"><a href="#ECSTask-951"><span class="linenos"> 951</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-952"><a href="#ECSTask-952"><span class="linenos"> 952</span></a>
</span><span id="ECSTask-953"><a href="#ECSTask-953"><span class="linenos"> 953</span></a>        <span class="c1"># Wait for completion and stream logs</span>
</span><span id="ECSTask-954"><a href="#ECSTask-954"><span class="linenos"> 954</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_finish</span><span class="p">(</span>
</span><span id="ECSTask-955"><a href="#ECSTask-955"><span class="linenos"> 955</span></a>            <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">boto_session</span>
</span><span id="ECSTask-956"><a href="#ECSTask-956"><span class="linenos"> 956</span></a>        <span class="p">)</span>
</span><span id="ECSTask-957"><a href="#ECSTask-957"><span class="linenos"> 957</span></a>
</span><span id="ECSTask-958"><a href="#ECSTask-958"><span class="linenos"> 958</span></a>        <span class="k">if</span> <span class="n">deregister_task_definition</span><span class="p">:</span>
</span><span id="ECSTask-959"><a href="#ECSTask-959"><span class="linenos"> 959</span></a>            <span class="n">ecs_client</span><span class="o">.</span><span class="n">deregister_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-960"><a href="#ECSTask-960"><span class="linenos"> 960</span></a>                <span class="n">taskDefinition</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
</span><span id="ECSTask-961"><a href="#ECSTask-961"><span class="linenos"> 961</span></a>            <span class="p">)</span>
</span><span id="ECSTask-962"><a href="#ECSTask-962"><span class="linenos"> 962</span></a>
</span><span id="ECSTask-963"><a href="#ECSTask-963"><span class="linenos"> 963</span></a>        <span class="c1"># Check the status code of the Prefect container</span>
</span><span id="ECSTask-964"><a href="#ECSTask-964"><span class="linenos"> 964</span></a>        <span class="n">prefect_container</span> <span class="o">=</span> <span class="n">get_prefect_container</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;containers&quot;</span><span class="p">])</span>
</span><span id="ECSTask-965"><a href="#ECSTask-965"><span class="linenos"> 965</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="ECSTask-966"><a href="#ECSTask-966"><span class="linenos"> 966</span></a>            <span class="n">prefect_container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSTask-967"><a href="#ECSTask-967"><span class="linenos"> 967</span></a>        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;prefect&#39; container missing from task: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-968"><a href="#ECSTask-968"><span class="linenos"> 968</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">prefect_container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exitCode&quot;</span><span class="p">)</span>
</span><span id="ECSTask-969"><a href="#ECSTask-969"><span class="linenos"> 969</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_report_container_status_code</span><span class="p">(</span><span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="p">,</span> <span class="n">status_code</span><span class="p">)</span>
</span><span id="ECSTask-970"><a href="#ECSTask-970"><span class="linenos"> 970</span></a>
</span><span id="ECSTask-971"><a href="#ECSTask-971"><span class="linenos"> 971</span></a>        <span class="k">return</span> <span class="n">status_code</span>
</span><span id="ECSTask-972"><a href="#ECSTask-972"><span class="linenos"> 972</span></a>
</span><span id="ECSTask-973"><a href="#ECSTask-973"><span class="linenos"> 973</span></a>    <span class="k">def</span> <span class="nf">_task_definitions_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskdef_1</span><span class="p">,</span> <span class="n">taskdef_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ECSTask-974"><a href="#ECSTask-974"><span class="linenos"> 974</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-975"><a href="#ECSTask-975"><span class="linenos"> 975</span></a><span class="sd">        Compare two task definitions.</span>
</span><span id="ECSTask-976"><a href="#ECSTask-976"><span class="linenos"> 976</span></a>
</span><span id="ECSTask-977"><a href="#ECSTask-977"><span class="linenos"> 977</span></a><span class="sd">        Since one may come from the AWS API and have populated defaults, we do our best</span>
</span><span id="ECSTask-978"><a href="#ECSTask-978"><span class="linenos"> 978</span></a><span class="sd">        to homogenize the definitions without changing their meaning.</span>
</span><span id="ECSTask-979"><a href="#ECSTask-979"><span class="linenos"> 979</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-980"><a href="#ECSTask-980"><span class="linenos"> 980</span></a>        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span><span class="p">:</span>
</span><span id="ECSTask-981"><a href="#ECSTask-981"><span class="linenos"> 981</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ECSTask-982"><a href="#ECSTask-982"><span class="linenos"> 982</span></a>
</span><span id="ECSTask-983"><a href="#ECSTask-983"><span class="linenos"> 983</span></a>        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">taskdef_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-984"><a href="#ECSTask-984"><span class="linenos"> 984</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ECSTask-985"><a href="#ECSTask-985"><span class="linenos"> 985</span></a>
</span><span id="ECSTask-986"><a href="#ECSTask-986"><span class="linenos"> 986</span></a>        <span class="n">taskdef_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
</span><span id="ECSTask-987"><a href="#ECSTask-987"><span class="linenos"> 987</span></a>        <span class="n">taskdef_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>
</span><span id="ECSTask-988"><a href="#ECSTask-988"><span class="linenos"> 988</span></a>
</span><span id="ECSTask-989"><a href="#ECSTask-989"><span class="linenos"> 989</span></a>        <span class="k">def</span> <span class="nf">_set_aws_defaults</span><span class="p">(</span><span class="n">taskdef</span><span class="p">):</span>
</span><span id="ECSTask-990"><a href="#ECSTask-990"><span class="linenos"> 990</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Set defaults that AWS would set after registration&quot;&quot;&quot;</span>
</span><span id="ECSTask-991"><a href="#ECSTask-991"><span class="linenos"> 991</span></a>            <span class="n">container_definitions</span> <span class="o">=</span> <span class="n">taskdef</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask-992"><a href="#ECSTask-992"><span class="linenos"> 992</span></a>            <span class="n">essential</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="ECSTask-993"><a href="#ECSTask-993"><span class="linenos"> 993</span></a>                <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">container_definitions</span>
</span><span id="ECSTask-994"><a href="#ECSTask-994"><span class="linenos"> 994</span></a>            <span class="p">)</span>
</span><span id="ECSTask-995"><a href="#ECSTask-995"><span class="linenos"> 995</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">essential</span><span class="p">:</span>
</span><span id="ECSTask-996"><a href="#ECSTask-996"><span class="linenos"> 996</span></a>                <span class="n">container_definitions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask-997"><a href="#ECSTask-997"><span class="linenos"> 997</span></a>
</span><span id="ECSTask-998"><a href="#ECSTask-998"><span class="linenos"> 998</span></a>            <span class="n">taskdef</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;bridge&quot;</span><span class="p">)</span>
</span><span id="ECSTask-999"><a href="#ECSTask-999"><span class="linenos"> 999</span></a>
</span><span id="ECSTask-1000"><a href="#ECSTask-1000"><span class="linenos">1000</span></a>        <span class="n">_set_aws_defaults</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
</span><span id="ECSTask-1001"><a href="#ECSTask-1001"><span class="linenos">1001</span></a>        <span class="n">_set_aws_defaults</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>
</span><span id="ECSTask-1002"><a href="#ECSTask-1002"><span class="linenos">1002</span></a>
</span><span id="ECSTask-1003"><a href="#ECSTask-1003"><span class="linenos">1003</span></a>        <span class="k">def</span> <span class="nf">_drop_empty_keys</span><span class="p">(</span><span class="n">dict_</span><span class="p">):</span>
</span><span id="ECSTask-1004"><a href="#ECSTask-1004"><span class="linenos">1004</span></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;Recursively drop keys with &#39;empty&#39; values&quot;&quot;&quot;</span>
</span><span id="ECSTask-1005"><a href="#ECSTask-1005"><span class="linenos">1005</span></a>            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dict_</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
</span><span id="ECSTask-1006"><a href="#ECSTask-1006"><span class="linenos">1006</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>
</span><span id="ECSTask-1007"><a href="#ECSTask-1007"><span class="linenos">1007</span></a>                    <span class="n">dict_</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span><span id="ECSTask-1008"><a href="#ECSTask-1008"><span class="linenos">1008</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ECSTask-1009"><a href="#ECSTask-1009"><span class="linenos">1009</span></a>                    <span class="n">_drop_empty_keys</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask-1010"><a href="#ECSTask-1010"><span class="linenos">1010</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ECSTask-1011"><a href="#ECSTask-1011"><span class="linenos">1011</span></a>                    <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
</span><span id="ECSTask-1012"><a href="#ECSTask-1012"><span class="linenos">1012</span></a>                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ECSTask-1013"><a href="#ECSTask-1013"><span class="linenos">1013</span></a>                            <span class="n">_drop_empty_keys</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="ECSTask-1014"><a href="#ECSTask-1014"><span class="linenos">1014</span></a>
</span><span id="ECSTask-1015"><a href="#ECSTask-1015"><span class="linenos">1015</span></a>        <span class="n">_drop_empty_keys</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
</span><span id="ECSTask-1016"><a href="#ECSTask-1016"><span class="linenos">1016</span></a>        <span class="n">_drop_empty_keys</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>
</span><span id="ECSTask-1017"><a href="#ECSTask-1017"><span class="linenos">1017</span></a>
</span><span id="ECSTask-1018"><a href="#ECSTask-1018"><span class="linenos">1018</span></a>        <span class="c1"># Clear fields that change on registration for comparison</span>
</span><span id="ECSTask-1019"><a href="#ECSTask-1019"><span class="linenos">1019</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">POST_REGISTRATION_FIELDS</span><span class="p">:</span>
</span><span id="ECSTask-1020"><a href="#ECSTask-1020"><span class="linenos">1020</span></a>            <span class="n">taskdef_1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSTask-1021"><a href="#ECSTask-1021"><span class="linenos">1021</span></a>            <span class="n">taskdef_2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSTask-1022"><a href="#ECSTask-1022"><span class="linenos">1022</span></a>
</span><span id="ECSTask-1023"><a href="#ECSTask-1023"><span class="linenos">1023</span></a>        <span class="k">return</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span>
</span><span id="ECSTask-1024"><a href="#ECSTask-1024"><span class="linenos">1024</span></a>
</span><span id="ECSTask-1025"><a href="#ECSTask-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask-1026"><a href="#ECSTask-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1027"><a href="#ECSTask-1027"><span class="linenos">1027</span></a><span class="sd">        Generate a preview of the task definition and task run that will be sent to AWS.</span>
</span><span id="ECSTask-1028"><a href="#ECSTask-1028"><span class="linenos">1028</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1029"><a href="#ECSTask-1029"><span class="linenos">1029</span></a>        <span class="n">preview</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ECSTask-1030"><a href="#ECSTask-1030"><span class="linenos">1030</span></a>
</span><span id="ECSTask-1031"><a href="#ECSTask-1031"><span class="linenos">1031</span></a>        <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span> <span class="ow">or</span> <span class="s2">&quot;&lt;registered at runtime&gt;&quot;</span>
</span><span id="ECSTask-1032"><a href="#ECSTask-1032"><span class="linenos">1032</span></a>
</span><span id="ECSTask-1033"><a href="#ECSTask-1033"><span class="linenos">1033</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask-1034"><a href="#ECSTask-1034"><span class="linenos">1034</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1035"><a href="#ECSTask-1035"><span class="linenos">1035</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="ECSTask-1036"><a href="#ECSTask-1036"><span class="linenos">1036</span></a>                <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">region_name</span>
</span><span id="ECSTask-1037"><a href="#ECSTask-1037"><span class="linenos">1037</span></a>                <span class="ow">or</span> <span class="s2">&quot;&lt;loaded from client at runtime&gt;&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1038"><a href="#ECSTask-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1039"><a href="#ECSTask-1039"><span class="linenos">1039</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2"># Task definition</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1040"><a href="#ECSTask-1040"><span class="linenos">1040</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask-1041"><a href="#ECSTask-1041"><span class="linenos">1041</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1042"><a href="#ECSTask-1042"><span class="linenos">1042</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1043"><a href="#ECSTask-1043"><span class="linenos">1043</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-1044"><a href="#ECSTask-1044"><span class="linenos">1044</span></a>
</span><span id="ECSTask-1045"><a href="#ECSTask-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="n">task_definition</span> <span class="ow">and</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1046"><a href="#ECSTask-1046"><span class="linenos">1046</span></a>            <span class="n">vpc</span> <span class="o">=</span> <span class="s2">&quot;the default VPC&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vpc_id</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">vpc_id</span>
</span><span id="ECSTask-1047"><a href="#ECSTask-1047"><span class="linenos">1047</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-1048"><a href="#ECSTask-1048"><span class="linenos">1048</span></a>                <span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask-1049"><a href="#ECSTask-1049"><span class="linenos">1049</span></a>                    <span class="s2">&quot;subnets&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&lt;loaded from </span><span class="si">{</span><span class="n">vpc</span><span class="si">}</span><span class="s2"> at runtime&gt;&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1050"><a href="#ECSTask-1050"><span class="linenos">1050</span></a>                    <span class="s2">&quot;assignPublicIp&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1051"><a href="#ECSTask-1051"><span class="linenos">1051</span></a>                <span class="p">}</span>
</span><span id="ECSTask-1052"><a href="#ECSTask-1052"><span class="linenos">1052</span></a>            <span class="p">}</span>
</span><span id="ECSTask-1053"><a href="#ECSTask-1053"><span class="linenos">1053</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1054"><a href="#ECSTask-1054"><span class="linenos">1054</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-1055"><a href="#ECSTask-1055"><span class="linenos">1055</span></a>
</span><span id="ECSTask-1056"><a href="#ECSTask-1056"><span class="linenos">1056</span></a>        <span class="n">task_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run</span><span class="p">(</span><span class="n">network_config</span><span class="p">,</span> <span class="n">task_definition_arn</span><span class="p">)</span>
</span><span id="ECSTask-1057"><a href="#ECSTask-1057"><span class="linenos">1057</span></a>        <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2"># Task run request</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1058"><a href="#ECSTask-1058"><span class="linenos">1058</span></a>        <span class="n">preview</span> <span class="o">+=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_run</span><span class="p">)</span>
</span><span id="ECSTask-1059"><a href="#ECSTask-1059"><span class="linenos">1059</span></a>
</span><span id="ECSTask-1060"><a href="#ECSTask-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="n">preview</span>
</span><span id="ECSTask-1061"><a href="#ECSTask-1061"><span class="linenos">1061</span></a>
</span><span id="ECSTask-1062"><a href="#ECSTask-1062"><span class="linenos">1062</span></a>    <span class="k">def</span> <span class="nf">_report_container_status_code</span><span class="p">(</span>
</span><span id="ECSTask-1063"><a href="#ECSTask-1063"><span class="linenos">1063</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="ECSTask-1064"><a href="#ECSTask-1064"><span class="linenos">1064</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1065"><a href="#ECSTask-1065"><span class="linenos">1065</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1066"><a href="#ECSTask-1066"><span class="linenos">1066</span></a><span class="sd">        Display a log for the given container status code.</span>
</span><span id="ECSTask-1067"><a href="#ECSTask-1067"><span class="linenos">1067</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1068"><a href="#ECSTask-1068"><span class="linenos">1068</span></a>        <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1069"><a href="#ECSTask-1069"><span class="linenos">1069</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ECSTask-1070"><a href="#ECSTask-1070"><span class="linenos">1070</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Task exited without reporting an exit status &quot;</span>
</span><span id="ECSTask-1071"><a href="#ECSTask-1071"><span class="linenos">1071</span></a>                <span class="sa">f</span><span class="s2">&quot;for container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSTask-1072"><a href="#ECSTask-1072"><span class="linenos">1072</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1073"><a href="#ECSTask-1073"><span class="linenos">1073</span></a>        <span class="k">elif</span> <span class="n">status_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ECSTask-1074"><a href="#ECSTask-1074"><span class="linenos">1074</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask-1075"><a href="#ECSTask-1075"><span class="linenos">1075</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited successfully.&quot;</span>
</span><span id="ECSTask-1076"><a href="#ECSTask-1076"><span class="linenos">1076</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1077"><a href="#ECSTask-1077"><span class="linenos">1077</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1078"><a href="#ECSTask-1078"><span class="linenos">1078</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-1079"><a href="#ECSTask-1079"><span class="linenos">1079</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited with non-zero exit &quot;</span>
</span><span id="ECSTask-1080"><a href="#ECSTask-1080"><span class="linenos">1080</span></a>                <span class="sa">f</span><span class="s2">&quot;code </span><span class="si">{</span><span class="n">status_code</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ECSTask-1081"><a href="#ECSTask-1081"><span class="linenos">1081</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1082"><a href="#ECSTask-1082"><span class="linenos">1082</span></a>
</span><span id="ECSTask-1083"><a href="#ECSTask-1083"><span class="linenos">1083</span></a>    <span class="k">def</span> <span class="nf">_report_task_run_creation_failure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1084"><a href="#ECSTask-1084"><span class="linenos">1084</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1085"><a href="#ECSTask-1085"><span class="linenos">1085</span></a><span class="sd">        Wrap common AWS task run creation failures with nicer user-facing messages.</span>
</span><span id="ECSTask-1086"><a href="#ECSTask-1086"><span class="linenos">1086</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1087"><a href="#ECSTask-1087"><span class="linenos">1087</span></a>        <span class="c1"># AWS generates exception types at runtime so they must be captured a bit</span>
</span><span id="ECSTask-1088"><a href="#ECSTask-1088"><span class="linenos">1088</span></a>        <span class="c1"># differently than normal.</span>
</span><span id="ECSTask-1089"><a href="#ECSTask-1089"><span class="linenos">1089</span></a>        <span class="k">if</span> <span class="s2">&quot;ClusterNotFoundException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSTask-1090"><a href="#ECSTask-1090"><span class="linenos">1090</span></a>            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1091"><a href="#ECSTask-1091"><span class="linenos">1091</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSTask-1092"><a href="#ECSTask-1092"><span class="linenos">1092</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> not found. &quot;</span>
</span><span id="ECSTask-1093"><a href="#ECSTask-1093"><span class="linenos">1093</span></a>                <span class="s2">&quot;Confirm that the cluster is configured in your region.&quot;</span>
</span><span id="ECSTask-1094"><a href="#ECSTask-1094"><span class="linenos">1094</span></a>            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSTask-1095"><a href="#ECSTask-1095"><span class="linenos">1095</span></a>        <span class="k">elif</span> <span class="s2">&quot;No Container Instances&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1096"><a href="#ECSTask-1096"><span class="linenos">1096</span></a>            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1097"><a href="#ECSTask-1097"><span class="linenos">1097</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSTask-1098"><a href="#ECSTask-1098"><span class="linenos">1098</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> does not appear to &quot;</span>
</span><span id="ECSTask-1099"><a href="#ECSTask-1099"><span class="linenos">1099</span></a>                <span class="s2">&quot;have any container instances associated with it. Confirm that you &quot;</span>
</span><span id="ECSTask-1100"><a href="#ECSTask-1100"><span class="linenos">1100</span></a>                <span class="s2">&quot;have EC2 container instances available.&quot;</span>
</span><span id="ECSTask-1101"><a href="#ECSTask-1101"><span class="linenos">1101</span></a>            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSTask-1102"><a href="#ECSTask-1102"><span class="linenos">1102</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="ECSTask-1103"><a href="#ECSTask-1103"><span class="linenos">1103</span></a>            <span class="s2">&quot;failed to validate logger args&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="ECSTask-1104"><a href="#ECSTask-1104"><span class="linenos">1104</span></a>            <span class="ow">and</span> <span class="s2">&quot;AccessDeniedException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="ECSTask-1105"><a href="#ECSTask-1105"><span class="linenos">1105</span></a>            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span>
</span><span id="ECSTask-1106"><a href="#ECSTask-1106"><span class="linenos">1106</span></a>        <span class="p">):</span>
</span><span id="ECSTask-1107"><a href="#ECSTask-1107"><span class="linenos">1107</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSTask-1108"><a href="#ECSTask-1108"><span class="linenos">1108</span></a>                <span class="s2">&quot;Failed to run ECS task, the attached execution role does not appear &quot;</span>
</span><span id="ECSTask-1109"><a href="#ECSTask-1109"><span class="linenos">1109</span></a>                <span class="s2">&quot;to have sufficient permissions. Ensure that the execution role &quot;</span>
</span><span id="ECSTask-1110"><a href="#ECSTask-1110"><span class="linenos">1110</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">execution_role</span><span class="si">!r}</span><span class="s2"> has permissions logs:CreateLogStream, &quot;</span>
</span><span id="ECSTask-1111"><a href="#ECSTask-1111"><span class="linenos">1111</span></a>                <span class="s2">&quot;logs:CreateLogGroup, and logs:PutLogEvents.&quot;</span>
</span><span id="ECSTask-1112"><a href="#ECSTask-1112"><span class="linenos">1112</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1113"><a href="#ECSTask-1113"><span class="linenos">1113</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1114"><a href="#ECSTask-1114"><span class="linenos">1114</span></a>            <span class="k">raise</span>
</span><span id="ECSTask-1115"><a href="#ECSTask-1115"><span class="linenos">1115</span></a>
</span><span id="ECSTask-1116"><a href="#ECSTask-1116"><span class="linenos">1116</span></a>    <span class="k">def</span> <span class="nf">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSTask-1117"><a href="#ECSTask-1117"><span class="linenos">1117</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSTask-1118"><a href="#ECSTask-1118"><span class="linenos">1118</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1119"><a href="#ECSTask-1119"><span class="linenos">1119</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1120"><a href="#ECSTask-1120"><span class="linenos">1120</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSTask-1121"><a href="#ECSTask-1121"><span class="linenos">1121</span></a>        <span class="n">current_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1122"><a href="#ECSTask-1122"><span class="linenos">1122</span></a>        <span class="n">until_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-1123"><a href="#ECSTask-1123"><span class="linenos">1123</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-1124"><a href="#ECSTask-1124"><span class="linenos">1124</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="ECSTask-1125"><a href="#ECSTask-1125"><span class="linenos">1125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1126"><a href="#ECSTask-1126"><span class="linenos">1126</span></a><span class="sd">        Watches an ECS task run by querying every `poll_interval` seconds. After each</span>
</span><span id="ECSTask-1127"><a href="#ECSTask-1127"><span class="linenos">1127</span></a><span class="sd">        query, the retrieved task is yielded. This function returns when the task run</span>
</span><span id="ECSTask-1128"><a href="#ECSTask-1128"><span class="linenos">1128</span></a><span class="sd">        reaches a STOPPED status or the provided `until_status`.</span>
</span><span id="ECSTask-1129"><a href="#ECSTask-1129"><span class="linenos">1129</span></a>
</span><span id="ECSTask-1130"><a href="#ECSTask-1130"><span class="linenos">1130</span></a><span class="sd">        Emits a log each time the status changes.</span>
</span><span id="ECSTask-1131"><a href="#ECSTask-1131"><span class="linenos">1131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1132"><a href="#ECSTask-1132"><span class="linenos">1132</span></a>        <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">=</span> <span class="n">current_status</span>
</span><span id="ECSTask-1133"><a href="#ECSTask-1133"><span class="linenos">1133</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ECSTask-1134"><a href="#ECSTask-1134"><span class="linenos">1134</span></a>        <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">until_status</span><span class="p">:</span>
</span><span id="ECSTask-1135"><a href="#ECSTask-1135"><span class="linenos">1135</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_tasks</span><span class="p">(</span>
</span><span id="ECSTask-1136"><a href="#ECSTask-1136"><span class="linenos">1136</span></a>                <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">task_arn</span><span class="p">],</span> <span class="n">cluster</span><span class="o">=</span><span class="n">cluster_arn</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TAGS&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1137"><a href="#ECSTask-1137"><span class="linenos">1137</span></a>            <span class="p">)[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1138"><a href="#ECSTask-1138"><span class="linenos">1138</span></a>
</span><span id="ECSTask-1139"><a href="#ECSTask-1139"><span class="linenos">1139</span></a>            <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="ECSTask-1140"><a href="#ECSTask-1140"><span class="linenos">1140</span></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ECSTask-1141"><a href="#ECSTask-1141"><span class="linenos">1141</span></a>
</span><span id="ECSTask-1142"><a href="#ECSTask-1142"><span class="linenos">1142</span></a>                <span class="n">status</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1143"><a href="#ECSTask-1143"><span class="linenos">1143</span></a>                <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">last_status</span><span class="p">:</span>
</span><span id="ECSTask-1144"><a href="#ECSTask-1144"><span class="linenos">1144</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Status is </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1145"><a href="#ECSTask-1145"><span class="linenos">1145</span></a>
</span><span id="ECSTask-1146"><a href="#ECSTask-1146"><span class="linenos">1146</span></a>                <span class="k">yield</span> <span class="n">task</span>
</span><span id="ECSTask-1147"><a href="#ECSTask-1147"><span class="linenos">1147</span></a>
</span><span id="ECSTask-1148"><a href="#ECSTask-1148"><span class="linenos">1148</span></a>                <span class="c1"># No point in continuing if the status is final</span>
</span><span id="ECSTask-1149"><a href="#ECSTask-1149"><span class="linenos">1149</span></a>                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1150"><a href="#ECSTask-1150"><span class="linenos">1150</span></a>                    <span class="k">break</span>
</span><span id="ECSTask-1151"><a href="#ECSTask-1151"><span class="linenos">1151</span></a>
</span><span id="ECSTask-1152"><a href="#ECSTask-1152"><span class="linenos">1152</span></a>                <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ECSTask-1153"><a href="#ECSTask-1153"><span class="linenos">1153</span></a>
</span><span id="ECSTask-1154"><a href="#ECSTask-1154"><span class="linenos">1154</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1155"><a href="#ECSTask-1155"><span class="linenos">1155</span></a>                <span class="c1"># Intermittently, the task will not be described. We wat to respect the</span>
</span><span id="ECSTask-1156"><a href="#ECSTask-1156"><span class="linenos">1156</span></a>                <span class="c1"># watch timeout though.</span>
</span><span id="ECSTask-1157"><a href="#ECSTask-1157"><span class="linenos">1157</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Task not found.&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1158"><a href="#ECSTask-1158"><span class="linenos">1158</span></a>
</span><span id="ECSTask-1159"><a href="#ECSTask-1159"><span class="linenos">1159</span></a>            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="ECSTask-1160"><a href="#ECSTask-1160"><span class="linenos">1160</span></a>            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="ECSTask-1161"><a href="#ECSTask-1161"><span class="linenos">1161</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSTask-1162"><a href="#ECSTask-1162"><span class="linenos">1162</span></a>                    <span class="sa">f</span><span class="s2">&quot;Timed out after </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2">s while watching task for status &quot;</span>
</span><span id="ECSTask-1163"><a href="#ECSTask-1163"><span class="linenos">1163</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">until_status</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;STOPPED&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1164"><a href="#ECSTask-1164"><span class="linenos">1164</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1165"><a href="#ECSTask-1165"><span class="linenos">1165</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_watch_poll_interval</span><span class="p">)</span>
</span><span id="ECSTask-1166"><a href="#ECSTask-1166"><span class="linenos">1166</span></a>
</span><span id="ECSTask-1167"><a href="#ECSTask-1167"><span class="linenos">1167</span></a>    <span class="k">def</span> <span class="nf">_wait_for_task_start</span><span class="p">(</span>
</span><span id="ECSTask-1168"><a href="#ECSTask-1168"><span class="linenos">1168</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span>
</span><span id="ECSTask-1169"><a href="#ECSTask-1169"><span class="linenos">1169</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-1170"><a href="#ECSTask-1170"><span class="linenos">1170</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1171"><a href="#ECSTask-1171"><span class="linenos">1171</span></a><span class="sd">        Waits for an ECS task run to reach a RUNNING status.</span>
</span><span id="ECSTask-1172"><a href="#ECSTask-1172"><span class="linenos">1172</span></a>
</span><span id="ECSTask-1173"><a href="#ECSTask-1173"><span class="linenos">1173</span></a><span class="sd">        If a STOPPED status is reached instead, an exception is raised indicating the</span>
</span><span id="ECSTask-1174"><a href="#ECSTask-1174"><span class="linenos">1174</span></a><span class="sd">        reason that the task run did not start.</span>
</span><span id="ECSTask-1175"><a href="#ECSTask-1175"><span class="linenos">1175</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1176"><a href="#ECSTask-1176"><span class="linenos">1176</span></a>        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSTask-1177"><a href="#ECSTask-1177"><span class="linenos">1177</span></a>            <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">until_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span>
</span><span id="ECSTask-1178"><a href="#ECSTask-1178"><span class="linenos">1178</span></a>        <span class="p">):</span>
</span><span id="ECSTask-1179"><a href="#ECSTask-1179"><span class="linenos">1179</span></a>            <span class="c1"># TODO: It is possible that the task has passed _through_ a RUNNING</span>
</span><span id="ECSTask-1180"><a href="#ECSTask-1180"><span class="linenos">1180</span></a>            <span class="c1">#       status during the polling interval. In this case, there is not an</span>
</span><span id="ECSTask-1181"><a href="#ECSTask-1181"><span class="linenos">1181</span></a>            <span class="c1">#       exception to raise.</span>
</span><span id="ECSTask-1182"><a href="#ECSTask-1182"><span class="linenos">1182</span></a>            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1183"><a href="#ECSTask-1183"><span class="linenos">1183</span></a>                <span class="n">code</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stopCode&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1184"><a href="#ECSTask-1184"><span class="linenos">1184</span></a>                <span class="n">reason</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stoppedReason&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1185"><a href="#ECSTask-1185"><span class="linenos">1185</span></a>                <span class="c1"># Generate a dynamic exception type from the AWS name</span>
</span><span id="ECSTask-1186"><a href="#ECSTask-1186"><span class="linenos">1186</span></a>                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,),</span> <span class="p">{})(</span><span class="n">reason</span><span class="p">)</span>
</span><span id="ECSTask-1187"><a href="#ECSTask-1187"><span class="linenos">1187</span></a>
</span><span id="ECSTask-1188"><a href="#ECSTask-1188"><span class="linenos">1188</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="ECSTask-1189"><a href="#ECSTask-1189"><span class="linenos">1189</span></a>
</span><span id="ECSTask-1190"><a href="#ECSTask-1190"><span class="linenos">1190</span></a>    <span class="k">def</span> <span class="nf">_wait_for_task_finish</span><span class="p">(</span>
</span><span id="ECSTask-1191"><a href="#ECSTask-1191"><span class="linenos">1191</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSTask-1192"><a href="#ECSTask-1192"><span class="linenos">1192</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1193"><a href="#ECSTask-1193"><span class="linenos">1193</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1194"><a href="#ECSTask-1194"><span class="linenos">1194</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSTask-1195"><a href="#ECSTask-1195"><span class="linenos">1195</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSTask-1196"><a href="#ECSTask-1196"><span class="linenos">1196</span></a>        <span class="n">boto_session</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span><span class="p">,</span>
</span><span id="ECSTask-1197"><a href="#ECSTask-1197"><span class="linenos">1197</span></a>    <span class="p">):</span>
</span><span id="ECSTask-1198"><a href="#ECSTask-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1199"><a href="#ECSTask-1199"><span class="linenos">1199</span></a><span class="sd">        Watch an ECS task until it reaches a STOPPED status.</span>
</span><span id="ECSTask-1200"><a href="#ECSTask-1200"><span class="linenos">1200</span></a>
</span><span id="ECSTask-1201"><a href="#ECSTask-1201"><span class="linenos">1201</span></a><span class="sd">        If configured, logs from the Prefect container are streamed to stderr.</span>
</span><span id="ECSTask-1202"><a href="#ECSTask-1202"><span class="linenos">1202</span></a>
</span><span id="ECSTask-1203"><a href="#ECSTask-1203"><span class="linenos">1203</span></a><span class="sd">        Returns a description of the task on completion.</span>
</span><span id="ECSTask-1204"><a href="#ECSTask-1204"><span class="linenos">1204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1205"><a href="#ECSTask-1205"><span class="linenos">1205</span></a>        <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ECSTask-1206"><a href="#ECSTask-1206"><span class="linenos">1206</span></a>
</span><span id="ECSTask-1207"><a href="#ECSTask-1207"><span class="linenos">1207</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_output</span><span class="p">:</span>
</span><span id="ECSTask-1208"><a href="#ECSTask-1208"><span class="linenos">1208</span></a>            <span class="n">container_def</span> <span class="o">=</span> <span class="n">get_prefect_container</span><span class="p">(</span>
</span><span id="ECSTask-1209"><a href="#ECSTask-1209"><span class="linenos">1209</span></a>                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1210"><a href="#ECSTask-1210"><span class="linenos">1210</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1211"><a href="#ECSTask-1211"><span class="linenos">1211</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">:</span>
</span><span id="ECSTask-1212"><a href="#ECSTask-1212"><span class="linenos">1212</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-1213"><a href="#ECSTask-1213"><span class="linenos">1213</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Prefect container definition not found in &quot;</span>
</span><span id="ECSTask-1214"><a href="#ECSTask-1214"><span class="linenos">1214</span></a>                    <span class="s2">&quot;task definition. Output cannot be streamed.&quot;</span>
</span><span id="ECSTask-1215"><a href="#ECSTask-1215"><span class="linenos">1215</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1216"><a href="#ECSTask-1216"><span class="linenos">1216</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">):</span>
</span><span id="ECSTask-1217"><a href="#ECSTask-1217"><span class="linenos">1217</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-1218"><a href="#ECSTask-1218"><span class="linenos">1218</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Logging configuration not found on task. &quot;</span>
</span><span id="ECSTask-1219"><a href="#ECSTask-1219"><span class="linenos">1219</span></a>                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
</span><span id="ECSTask-1220"><a href="#ECSTask-1220"><span class="linenos">1220</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1221"><a href="#ECSTask-1221"><span class="linenos">1221</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logDriver&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1222"><a href="#ECSTask-1222"><span class="linenos">1222</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask-1223"><a href="#ECSTask-1223"><span class="linenos">1223</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Logging configuration uses unsupported &quot;</span>
</span><span id="ECSTask-1224"><a href="#ECSTask-1224"><span class="linenos">1224</span></a>                    <span class="s2">&quot; driver {container_def[&#39;logConfiguration&#39;].get(&#39;logDriver&#39;)!r}. &quot;</span>
</span><span id="ECSTask-1225"><a href="#ECSTask-1225"><span class="linenos">1225</span></a>                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
</span><span id="ECSTask-1226"><a href="#ECSTask-1226"><span class="linenos">1226</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1227"><a href="#ECSTask-1227"><span class="linenos">1227</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1228"><a href="#ECSTask-1228"><span class="linenos">1228</span></a>                <span class="c1"># Prepare to stream the output</span>
</span><span id="ECSTask-1229"><a href="#ECSTask-1229"><span class="linenos">1229</span></a>                <span class="n">log_config</span> <span class="o">=</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1230"><a href="#ECSTask-1230"><span class="linenos">1230</span></a>                <span class="n">logs_client</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;logs&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1231"><a href="#ECSTask-1231"><span class="linenos">1231</span></a>                <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSTask-1232"><a href="#ECSTask-1232"><span class="linenos">1232</span></a>                <span class="c1"># Track the last log timestamp to prevent double display</span>
</span><span id="ECSTask-1233"><a href="#ECSTask-1233"><span class="linenos">1233</span></a>                <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-1234"><a href="#ECSTask-1234"><span class="linenos">1234</span></a>                <span class="c1"># Determine the name of the stream as &quot;prefix/container/run-id&quot;</span>
</span><span id="ECSTask-1235"><a href="#ECSTask-1235"><span class="linenos">1235</span></a>                <span class="n">stream_name</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="ECSTask-1236"><a href="#ECSTask-1236"><span class="linenos">1236</span></a>                    <span class="p">[</span>
</span><span id="ECSTask-1237"><a href="#ECSTask-1237"><span class="linenos">1237</span></a>                        <span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">],</span>
</span><span id="ECSTask-1238"><a href="#ECSTask-1238"><span class="linenos">1238</span></a>                        <span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="p">,</span>
</span><span id="ECSTask-1239"><a href="#ECSTask-1239"><span class="linenos">1239</span></a>                        <span class="n">task_arn</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ECSTask-1240"><a href="#ECSTask-1240"><span class="linenos">1240</span></a>                    <span class="p">]</span>
</span><span id="ECSTask-1241"><a href="#ECSTask-1241"><span class="linenos">1241</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1242"><a href="#ECSTask-1242"><span class="linenos">1242</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask-1243"><a href="#ECSTask-1243"><span class="linenos">1243</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Streaming output from container &quot;</span>
</span><span id="ECSTask-1244"><a href="#ECSTask-1244"><span class="linenos">1244</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="si">!r}</span><span class="s2">...&quot;</span>
</span><span id="ECSTask-1245"><a href="#ECSTask-1245"><span class="linenos">1245</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1246"><a href="#ECSTask-1246"><span class="linenos">1246</span></a>
</span><span id="ECSTask-1247"><a href="#ECSTask-1247"><span class="linenos">1247</span></a>        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSTask-1248"><a href="#ECSTask-1248"><span class="linenos">1248</span></a>            <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">current_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span>
</span><span id="ECSTask-1249"><a href="#ECSTask-1249"><span class="linenos">1249</span></a>        <span class="p">):</span>
</span><span id="ECSTask-1250"><a href="#ECSTask-1250"><span class="linenos">1250</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stream_output</span> <span class="ow">and</span> <span class="n">can_stream_output</span><span class="p">:</span>
</span><span id="ECSTask-1251"><a href="#ECSTask-1251"><span class="linenos">1251</span></a>                <span class="c1"># On each poll for task run status, also retrieve available logs</span>
</span><span id="ECSTask-1252"><a href="#ECSTask-1252"><span class="linenos">1252</span></a>                <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_available_logs</span><span class="p">(</span>
</span><span id="ECSTask-1253"><a href="#ECSTask-1253"><span class="linenos">1253</span></a>                    <span class="n">logs_client</span><span class="p">,</span>
</span><span id="ECSTask-1254"><a href="#ECSTask-1254"><span class="linenos">1254</span></a>                    <span class="n">log_group</span><span class="o">=</span><span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-group&quot;</span><span class="p">],</span>
</span><span id="ECSTask-1255"><a href="#ECSTask-1255"><span class="linenos">1255</span></a>                    <span class="n">log_stream</span><span class="o">=</span><span class="n">stream_name</span><span class="p">,</span>
</span><span id="ECSTask-1256"><a href="#ECSTask-1256"><span class="linenos">1256</span></a>                    <span class="n">last_log_timestamp</span><span class="o">=</span><span class="n">last_log_timestamp</span><span class="p">,</span>
</span><span id="ECSTask-1257"><a href="#ECSTask-1257"><span class="linenos">1257</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1258"><a href="#ECSTask-1258"><span class="linenos">1258</span></a>
</span><span id="ECSTask-1259"><a href="#ECSTask-1259"><span class="linenos">1259</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="ECSTask-1260"><a href="#ECSTask-1260"><span class="linenos">1260</span></a>
</span><span id="ECSTask-1261"><a href="#ECSTask-1261"><span class="linenos">1261</span></a>    <span class="k">def</span> <span class="nf">_stream_available_logs</span><span class="p">(</span>
</span><span id="ECSTask-1262"><a href="#ECSTask-1262"><span class="linenos">1262</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSTask-1263"><a href="#ECSTask-1263"><span class="linenos">1263</span></a>        <span class="n">logs_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="ECSTask-1264"><a href="#ECSTask-1264"><span class="linenos">1264</span></a>        <span class="n">log_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1265"><a href="#ECSTask-1265"><span class="linenos">1265</span></a>        <span class="n">log_stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1266"><a href="#ECSTask-1266"><span class="linenos">1266</span></a>        <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask-1267"><a href="#ECSTask-1267"><span class="linenos">1267</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ECSTask-1268"><a href="#ECSTask-1268"><span class="linenos">1268</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1269"><a href="#ECSTask-1269"><span class="linenos">1269</span></a><span class="sd">        Stream logs from the given log group and stream since the last log timestamp.</span>
</span><span id="ECSTask-1270"><a href="#ECSTask-1270"><span class="linenos">1270</span></a>
</span><span id="ECSTask-1271"><a href="#ECSTask-1271"><span class="linenos">1271</span></a><span class="sd">        Will continue on paginated responses until all logs are returned.</span>
</span><span id="ECSTask-1272"><a href="#ECSTask-1272"><span class="linenos">1272</span></a>
</span><span id="ECSTask-1273"><a href="#ECSTask-1273"><span class="linenos">1273</span></a><span class="sd">        Returns the last log timestamp which can be used to call this method in the</span>
</span><span id="ECSTask-1274"><a href="#ECSTask-1274"><span class="linenos">1274</span></a><span class="sd">        future.</span>
</span><span id="ECSTask-1275"><a href="#ECSTask-1275"><span class="linenos">1275</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1276"><a href="#ECSTask-1276"><span class="linenos">1276</span></a>        <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="s2">&quot;NO-TOKEN&quot;</span>
</span><span id="ECSTask-1277"><a href="#ECSTask-1277"><span class="linenos">1277</span></a>        <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask-1278"><a href="#ECSTask-1278"><span class="linenos">1278</span></a>
</span><span id="ECSTask-1279"><a href="#ECSTask-1279"><span class="linenos">1279</span></a>        <span class="c1"># AWS will return the same token that we send once the end of the paginated</span>
</span><span id="ECSTask-1280"><a href="#ECSTask-1280"><span class="linenos">1280</span></a>        <span class="c1"># response is reached</span>
</span><span id="ECSTask-1281"><a href="#ECSTask-1281"><span class="linenos">1281</span></a>        <span class="k">while</span> <span class="n">last_log_stream_token</span> <span class="o">!=</span> <span class="n">next_log_stream_token</span><span class="p">:</span>
</span><span id="ECSTask-1282"><a href="#ECSTask-1282"><span class="linenos">1282</span></a>            <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="n">next_log_stream_token</span>
</span><span id="ECSTask-1283"><a href="#ECSTask-1283"><span class="linenos">1283</span></a>
</span><span id="ECSTask-1284"><a href="#ECSTask-1284"><span class="linenos">1284</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-1285"><a href="#ECSTask-1285"><span class="linenos">1285</span></a>                <span class="s2">&quot;logGroupName&quot;</span><span class="p">:</span> <span class="n">log_group</span><span class="p">,</span>
</span><span id="ECSTask-1286"><a href="#ECSTask-1286"><span class="linenos">1286</span></a>                <span class="s2">&quot;logStreamName&quot;</span><span class="p">:</span> <span class="n">log_stream</span><span class="p">,</span>
</span><span id="ECSTask-1287"><a href="#ECSTask-1287"><span class="linenos">1287</span></a>            <span class="p">}</span>
</span><span id="ECSTask-1288"><a href="#ECSTask-1288"><span class="linenos">1288</span></a>
</span><span id="ECSTask-1289"><a href="#ECSTask-1289"><span class="linenos">1289</span></a>            <span class="k">if</span> <span class="n">last_log_stream_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1290"><a href="#ECSTask-1290"><span class="linenos">1290</span></a>                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;nextToken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_stream_token</span>
</span><span id="ECSTask-1291"><a href="#ECSTask-1291"><span class="linenos">1291</span></a>
</span><span id="ECSTask-1292"><a href="#ECSTask-1292"><span class="linenos">1292</span></a>            <span class="k">if</span> <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1293"><a href="#ECSTask-1293"><span class="linenos">1293</span></a>                <span class="c1"># Bump the timestamp by one ms to avoid retrieving the last log again</span>
</span><span id="ECSTask-1294"><a href="#ECSTask-1294"><span class="linenos">1294</span></a>                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;startTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_timestamp</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ECSTask-1295"><a href="#ECSTask-1295"><span class="linenos">1295</span></a>
</span><span id="ECSTask-1296"><a href="#ECSTask-1296"><span class="linenos">1296</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask-1297"><a href="#ECSTask-1297"><span class="linenos">1297</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">get_log_events</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="p">)</span>
</span><span id="ECSTask-1298"><a href="#ECSTask-1298"><span class="linenos">1298</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ECSTask-1299"><a href="#ECSTask-1299"><span class="linenos">1299</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ECSTask-1300"><a href="#ECSTask-1300"><span class="linenos">1300</span></a>                    <span class="p">(</span>
</span><span id="ECSTask-1301"><a href="#ECSTask-1301"><span class="linenos">1301</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Failed to read log events with request &quot;</span>
</span><span id="ECSTask-1302"><a href="#ECSTask-1302"><span class="linenos">1302</span></a>                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1303"><a href="#ECSTask-1303"><span class="linenos">1303</span></a>                    <span class="p">),</span>
</span><span id="ECSTask-1304"><a href="#ECSTask-1304"><span class="linenos">1304</span></a>                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSTask-1305"><a href="#ECSTask-1305"><span class="linenos">1305</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1306"><a href="#ECSTask-1306"><span class="linenos">1306</span></a>                <span class="k">return</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSTask-1307"><a href="#ECSTask-1307"><span class="linenos">1307</span></a>
</span><span id="ECSTask-1308"><a href="#ECSTask-1308"><span class="linenos">1308</span></a>            <span class="n">log_events</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1309"><a href="#ECSTask-1309"><span class="linenos">1309</span></a>            <span class="k">for</span> <span class="n">log_event</span> <span class="ow">in</span> <span class="n">log_events</span><span class="p">:</span>
</span><span id="ECSTask-1310"><a href="#ECSTask-1310"><span class="linenos">1310</span></a>                <span class="c1"># TODO: This doesn&#39;t forward to the local logger, which can be</span>
</span><span id="ECSTask-1311"><a href="#ECSTask-1311"><span class="linenos">1311</span></a>                <span class="c1">#       bad for customizing handling and understanding where the</span>
</span><span id="ECSTask-1312"><a href="#ECSTask-1312"><span class="linenos">1312</span></a>                <span class="c1">#       log is coming from, but it avoid nesting logger information</span>
</span><span id="ECSTask-1313"><a href="#ECSTask-1313"><span class="linenos">1313</span></a>                <span class="c1">#       when the content is output from a Prefect logger on the</span>
</span><span id="ECSTask-1314"><a href="#ECSTask-1314"><span class="linenos">1314</span></a>                <span class="c1">#       running infrastructure</span>
</span><span id="ECSTask-1315"><a href="#ECSTask-1315"><span class="linenos">1315</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="ECSTask-1316"><a href="#ECSTask-1316"><span class="linenos">1316</span></a>
</span><span id="ECSTask-1317"><a href="#ECSTask-1317"><span class="linenos">1317</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSTask-1318"><a href="#ECSTask-1318"><span class="linenos">1318</span></a>                    <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ECSTask-1319"><a href="#ECSTask-1319"><span class="linenos">1319</span></a>                    <span class="ow">or</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSTask-1320"><a href="#ECSTask-1320"><span class="linenos">1320</span></a>                <span class="p">):</span>
</span><span id="ECSTask-1321"><a href="#ECSTask-1321"><span class="linenos">1321</span></a>                    <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1322"><a href="#ECSTask-1322"><span class="linenos">1322</span></a>
</span><span id="ECSTask-1323"><a href="#ECSTask-1323"><span class="linenos">1323</span></a>            <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextForwardToken&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1324"><a href="#ECSTask-1324"><span class="linenos">1324</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">log_events</span><span class="p">:</span>
</span><span id="ECSTask-1325"><a href="#ECSTask-1325"><span class="linenos">1325</span></a>                <span class="c1"># Stop reading pages if there was no data</span>
</span><span id="ECSTask-1326"><a href="#ECSTask-1326"><span class="linenos">1326</span></a>                <span class="k">break</span>
</span><span id="ECSTask-1327"><a href="#ECSTask-1327"><span class="linenos">1327</span></a>
</span><span id="ECSTask-1328"><a href="#ECSTask-1328"><span class="linenos">1328</span></a>        <span class="k">return</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSTask-1329"><a href="#ECSTask-1329"><span class="linenos">1329</span></a>
</span><span id="ECSTask-1330"><a href="#ECSTask-1330"><span class="linenos">1330</span></a>    <span class="k">def</span> <span class="nf">_retrieve_latest_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1331"><a href="#ECSTask-1331"><span class="linenos">1331</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_definition_family</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ECSTask-1332"><a href="#ECSTask-1332"><span class="linenos">1332</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="ECSTask-1333"><a href="#ECSTask-1333"><span class="linenos">1333</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask-1334"><a href="#ECSTask-1334"><span class="linenos">1334</span></a>            <span class="n">latest_task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1335"><a href="#ECSTask-1335"><span class="linenos">1335</span></a>                <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition_family</span>
</span><span id="ECSTask-1336"><a href="#ECSTask-1336"><span class="linenos">1336</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1337"><a href="#ECSTask-1337"><span class="linenos">1337</span></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ECSTask-1338"><a href="#ECSTask-1338"><span class="linenos">1338</span></a>            <span class="c1"># The family does not exist...</span>
</span><span id="ECSTask-1339"><a href="#ECSTask-1339"><span class="linenos">1339</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="ECSTask-1340"><a href="#ECSTask-1340"><span class="linenos">1340</span></a>
</span><span id="ECSTask-1341"><a href="#ECSTask-1341"><span class="linenos">1341</span></a>        <span class="k">return</span> <span class="n">latest_task_definition</span>
</span><span id="ECSTask-1342"><a href="#ECSTask-1342"><span class="linenos">1342</span></a>
</span><span id="ECSTask-1343"><a href="#ECSTask-1343"><span class="linenos">1343</span></a>    <span class="k">def</span> <span class="nf">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1344"><a href="#ECSTask-1344"><span class="linenos">1344</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ECSTask-1345"><a href="#ECSTask-1345"><span class="linenos">1345</span></a>    <span class="p">):</span>
</span><span id="ECSTask-1346"><a href="#ECSTask-1346"><span class="linenos">1346</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1347"><a href="#ECSTask-1347"><span class="linenos">1347</span></a><span class="sd">        Retrieve an existing task definition from AWS.</span>
</span><span id="ECSTask-1348"><a href="#ECSTask-1348"><span class="linenos">1348</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1349"><a href="#ECSTask-1349"><span class="linenos">1349</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask-1350"><a href="#ECSTask-1350"><span class="linenos">1350</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Retrieving task definition </span><span class="si">{</span><span class="n">task_definition_arn</span><span class="si">!r}</span><span class="s2">...&quot;</span>
</span><span id="ECSTask-1351"><a href="#ECSTask-1351"><span class="linenos">1351</span></a>        <span class="p">)</span>
</span><span id="ECSTask-1352"><a href="#ECSTask-1352"><span class="linenos">1352</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1353"><a href="#ECSTask-1353"><span class="linenos">1353</span></a>            <span class="n">taskDefinition</span><span class="o">=</span><span class="n">task_definition_arn</span>
</span><span id="ECSTask-1354"><a href="#ECSTask-1354"><span class="linenos">1354</span></a>        <span class="p">)</span>
</span><span id="ECSTask-1355"><a href="#ECSTask-1355"><span class="linenos">1355</span></a>        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1356"><a href="#ECSTask-1356"><span class="linenos">1356</span></a>
</span><span id="ECSTask-1357"><a href="#ECSTask-1357"><span class="linenos">1357</span></a>    <span class="k">def</span> <span class="nf">_register_task_definition</span><span class="p">(</span>
</span><span id="ECSTask-1358"><a href="#ECSTask-1358"><span class="linenos">1358</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ECSTask-1359"><a href="#ECSTask-1359"><span class="linenos">1359</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask-1360"><a href="#ECSTask-1360"><span class="linenos">1360</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1361"><a href="#ECSTask-1361"><span class="linenos">1361</span></a><span class="sd">        Register a new task definition with AWS.</span>
</span><span id="ECSTask-1362"><a href="#ECSTask-1362"><span class="linenos">1362</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1363"><a href="#ECSTask-1363"><span class="linenos">1363</span></a>        <span class="c1"># TODO: Consider including a global cache for this task definition since</span>
</span><span id="ECSTask-1364"><a href="#ECSTask-1364"><span class="linenos">1364</span></a>        <span class="c1">#       registration of task definitions is frequently rate limited</span>
</span><span id="ECSTask-1365"><a href="#ECSTask-1365"><span class="linenos">1365</span></a>        <span class="n">task_definition_request</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask-1366"><a href="#ECSTask-1366"><span class="linenos">1366</span></a>
</span><span id="ECSTask-1367"><a href="#ECSTask-1367"><span class="linenos">1367</span></a>        <span class="c1"># We need to remove some fields here if copying an existing task definition</span>
</span><span id="ECSTask-1368"><a href="#ECSTask-1368"><span class="linenos">1368</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">POST_REGISTRATION_FIELDS</span><span class="p">:</span>
</span><span id="ECSTask-1369"><a href="#ECSTask-1369"><span class="linenos">1369</span></a>            <span class="n">task_definition_request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSTask-1370"><a href="#ECSTask-1370"><span class="linenos">1370</span></a>
</span><span id="ECSTask-1371"><a href="#ECSTask-1371"><span class="linenos">1371</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">register_task_definition</span><span class="p">(</span><span class="o">**</span><span class="n">task_definition_request</span><span class="p">)</span>
</span><span id="ECSTask-1372"><a href="#ECSTask-1372"><span class="linenos">1372</span></a>        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">][</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1373"><a href="#ECSTask-1373"><span class="linenos">1373</span></a>
</span><span id="ECSTask-1374"><a href="#ECSTask-1374"><span class="linenos">1374</span></a>    <span class="k">def</span> <span class="nf">_prepare_task_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-1375"><a href="#ECSTask-1375"><span class="linenos">1375</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1376"><a href="#ECSTask-1376"><span class="linenos">1376</span></a><span class="sd">        Prepare a task definition by inferring any defaults and merging overrides.</span>
</span><span id="ECSTask-1377"><a href="#ECSTask-1377"><span class="linenos">1377</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1378"><a href="#ECSTask-1378"><span class="linenos">1378</span></a>        <span class="n">task_definition</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask-1379"><a href="#ECSTask-1379"><span class="linenos">1379</span></a>
</span><span id="ECSTask-1380"><a href="#ECSTask-1380"><span class="linenos">1380</span></a>        <span class="c1"># Configure the Prefect runtime container</span>
</span><span id="ECSTask-1381"><a href="#ECSTask-1381"><span class="linenos">1381</span></a>        <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask-1382"><a href="#ECSTask-1382"><span class="linenos">1382</span></a>        <span class="n">container</span> <span class="o">=</span> <span class="n">get_prefect_container</span><span class="p">(</span><span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">])</span>
</span><span id="ECSTask-1383"><a href="#ECSTask-1383"><span class="linenos">1383</span></a>        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask-1384"><a href="#ECSTask-1384"><span class="linenos">1384</span></a>            <span class="n">container</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="p">}</span>
</span><span id="ECSTask-1385"><a href="#ECSTask-1385"><span class="linenos">1385</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</span><span id="ECSTask-1386"><a href="#ECSTask-1386"><span class="linenos">1386</span></a>
</span><span id="ECSTask-1387"><a href="#ECSTask-1387"><span class="linenos">1387</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="p">:</span>
</span><span id="ECSTask-1388"><a href="#ECSTask-1388"><span class="linenos">1388</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">image</span>
</span><span id="ECSTask-1389"><a href="#ECSTask-1389"><span class="linenos">1389</span></a>
</span><span id="ECSTask-1390"><a href="#ECSTask-1390"><span class="linenos">1390</span></a>        <span class="c1"># Remove any keys that have been explicitly &quot;unset&quot;</span>
</span><span id="ECSTask-1391"><a href="#ECSTask-1391"><span class="linenos">1391</span></a>        <span class="n">unset_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="ECSTask-1392"><a href="#ECSTask-1392"><span class="linenos">1392</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])):</span>
</span><span id="ECSTask-1393"><a href="#ECSTask-1393"><span class="linenos">1393</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unset_keys</span><span class="p">:</span>
</span><span id="ECSTask-1394"><a href="#ECSTask-1394"><span class="linenos">1394</span></a>                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="ECSTask-1395"><a href="#ECSTask-1395"><span class="linenos">1395</span></a>
</span><span id="ECSTask-1396"><a href="#ECSTask-1396"><span class="linenos">1396</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span><span class="p">:</span>
</span><span id="ECSTask-1397"><a href="#ECSTask-1397"><span class="linenos">1397</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-1398"><a href="#ECSTask-1398"><span class="linenos">1398</span></a>                <span class="s2">&quot;logDriver&quot;</span><span class="p">:</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1399"><a href="#ECSTask-1399"><span class="linenos">1399</span></a>                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask-1400"><a href="#ECSTask-1400"><span class="linenos">1400</span></a>                    <span class="s2">&quot;awslogs-create-group&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1401"><a href="#ECSTask-1401"><span class="linenos">1401</span></a>                    <span class="s2">&quot;awslogs-group&quot;</span><span class="p">:</span> <span class="s2">&quot;prefect&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1402"><a href="#ECSTask-1402"><span class="linenos">1402</span></a>                    <span class="s2">&quot;awslogs-region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
</span><span id="ECSTask-1403"><a href="#ECSTask-1403"><span class="linenos">1403</span></a>                    <span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;prefect&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1404"><a href="#ECSTask-1404"><span class="linenos">1404</span></a>                    <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">cloudwatch_logs_options</span><span class="p">,</span>
</span><span id="ECSTask-1405"><a href="#ECSTask-1405"><span class="linenos">1405</span></a>                <span class="p">},</span>
</span><span id="ECSTask-1406"><a href="#ECSTask-1406"><span class="linenos">1406</span></a>            <span class="p">}</span>
</span><span id="ECSTask-1407"><a href="#ECSTask-1407"><span class="linenos">1407</span></a>
</span><span id="ECSTask-1408"><a href="#ECSTask-1408"><span class="linenos">1408</span></a>        <span class="n">family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span> <span class="ow">or</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_FAMILY</span>
</span><span id="ECSTask-1409"><a href="#ECSTask-1409"><span class="linenos">1409</span></a>        <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSTask-1410"><a href="#ECSTask-1410"><span class="linenos">1410</span></a>            <span class="n">family</span><span class="p">,</span>
</span><span id="ECSTask-1411"><a href="#ECSTask-1411"><span class="linenos">1411</span></a>            <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
</span><span id="ECSTask-1412"><a href="#ECSTask-1412"><span class="linenos">1412</span></a>            <span class="n">regex_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9-_]+&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1413"><a href="#ECSTask-1413"><span class="linenos">1413</span></a>        <span class="p">)</span>
</span><span id="ECSTask-1414"><a href="#ECSTask-1414"><span class="linenos">1414</span></a>
</span><span id="ECSTask-1415"><a href="#ECSTask-1415"><span class="linenos">1415</span></a>        <span class="c1"># CPU and memory are required in some cases, retrieve the value to use</span>
</span><span id="ECSTask-1416"><a href="#ECSTask-1416"><span class="linenos">1416</span></a>        <span class="n">cpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span> <span class="ow">or</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_CPU</span>
</span><span id="ECSTask-1417"><a href="#ECSTask-1417"><span class="linenos">1417</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span> <span class="ow">or</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_MEMORY</span>
</span><span id="ECSTask-1418"><a href="#ECSTask-1418"><span class="linenos">1418</span></a>
</span><span id="ECSTask-1419"><a href="#ECSTask-1419"><span class="linenos">1419</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1420"><a href="#ECSTask-1420"><span class="linenos">1420</span></a>            <span class="c1"># Task level memory and cpu are required when using fargate</span>
</span><span id="ECSTask-1421"><a href="#ECSTask-1421"><span class="linenos">1421</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span>
</span><span id="ECSTask-1422"><a href="#ECSTask-1422"><span class="linenos">1422</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
</span><span id="ECSTask-1423"><a href="#ECSTask-1423"><span class="linenos">1423</span></a>
</span><span id="ECSTask-1424"><a href="#ECSTask-1424"><span class="linenos">1424</span></a>            <span class="c1"># The FARGATE compatibility is required if it will be used as as launch type</span>
</span><span id="ECSTask-1425"><a href="#ECSTask-1425"><span class="linenos">1425</span></a>            <span class="n">requires_compatibilities</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
</span><span id="ECSTask-1426"><a href="#ECSTask-1426"><span class="linenos">1426</span></a>                <span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">,</span> <span class="p">[]</span>
</span><span id="ECSTask-1427"><a href="#ECSTask-1427"><span class="linenos">1427</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1428"><a href="#ECSTask-1428"><span class="linenos">1428</span></a>            <span class="k">if</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requires_compatibilities</span><span class="p">:</span>
</span><span id="ECSTask-1429"><a href="#ECSTask-1429"><span class="linenos">1429</span></a>                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1430"><a href="#ECSTask-1430"><span class="linenos">1430</span></a>
</span><span id="ECSTask-1431"><a href="#ECSTask-1431"><span class="linenos">1431</span></a>            <span class="c1"># Only the &#39;awsvpc&#39; network mode is supported when using FARGATE</span>
</span><span id="ECSTask-1432"><a href="#ECSTask-1432"><span class="linenos">1432</span></a>            <span class="c1"># However, we will not enforce that here if the user has set it</span>
</span><span id="ECSTask-1433"><a href="#ECSTask-1433"><span class="linenos">1433</span></a>            <span class="n">network_mode</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1434"><a href="#ECSTask-1434"><span class="linenos">1434</span></a>
</span><span id="ECSTask-1435"><a href="#ECSTask-1435"><span class="linenos">1435</span></a>            <span class="k">if</span> <span class="n">network_mode</span> <span class="o">!=</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1436"><a href="#ECSTask-1436"><span class="linenos">1436</span></a>                <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
</span><span id="ECSTask-1437"><a href="#ECSTask-1437"><span class="linenos">1437</span></a>                    <span class="sa">f</span><span class="s2">&quot;Found network mode </span><span class="si">{</span><span class="n">network_mode</span><span class="si">!r}</span><span class="s2"> which is not compatible with &quot;</span>
</span><span id="ECSTask-1438"><a href="#ECSTask-1438"><span class="linenos">1438</span></a>                    <span class="sa">f</span><span class="s2">&quot;launch type </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span><span class="si">!r}</span><span class="s2">. Use either the &#39;EC2&#39; launch &quot;</span>
</span><span id="ECSTask-1439"><a href="#ECSTask-1439"><span class="linenos">1439</span></a>                    <span class="s2">&quot;type or the &#39;awsvpc&#39; network mode.&quot;</span>
</span><span id="ECSTask-1440"><a href="#ECSTask-1440"><span class="linenos">1440</span></a>                <span class="p">)</span>
</span><span id="ECSTask-1441"><a href="#ECSTask-1441"><span class="linenos">1441</span></a>
</span><span id="ECSTask-1442"><a href="#ECSTask-1442"><span class="linenos">1442</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1443"><a href="#ECSTask-1443"><span class="linenos">1443</span></a>            <span class="c1"># Container level memory and cpu are required when using ec2</span>
</span><span id="ECSTask-1444"><a href="#ECSTask-1444"><span class="linenos">1444</span></a>            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">cpu</span><span class="p">))</span>
</span><span id="ECSTask-1445"><a href="#ECSTask-1445"><span class="linenos">1445</span></a>            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">memory</span><span class="p">))</span>
</span><span id="ECSTask-1446"><a href="#ECSTask-1446"><span class="linenos">1446</span></a>
</span><span id="ECSTask-1447"><a href="#ECSTask-1447"><span class="linenos">1447</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_role_arn</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask-1448"><a href="#ECSTask-1448"><span class="linenos">1448</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_role_arn</span>
</span><span id="ECSTask-1449"><a href="#ECSTask-1449"><span class="linenos">1449</span></a>
</span><span id="ECSTask-1450"><a href="#ECSTask-1450"><span class="linenos">1450</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSTask-1451"><a href="#ECSTask-1451"><span class="linenos">1451</span></a>            <span class="s2">&quot;executionRoleArn&quot;</span>
</span><span id="ECSTask-1452"><a href="#ECSTask-1452"><span class="linenos">1452</span></a>        <span class="p">):</span>
</span><span id="ECSTask-1453"><a href="#ECSTask-1453"><span class="linenos">1453</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask-1454"><a href="#ECSTask-1454"><span class="linenos">1454</span></a>                <span class="s2">&quot;An execution role arn must be set on the task definition to use &quot;</span>
</span><span id="ECSTask-1455"><a href="#ECSTask-1455"><span class="linenos">1455</span></a>                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs` but no execution role &quot;</span>
</span><span id="ECSTask-1456"><a href="#ECSTask-1456"><span class="linenos">1456</span></a>                <span class="s2">&quot;was found on the task definition.&quot;</span>
</span><span id="ECSTask-1457"><a href="#ECSTask-1457"><span class="linenos">1457</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1458"><a href="#ECSTask-1458"><span class="linenos">1458</span></a>
</span><span id="ECSTask-1459"><a href="#ECSTask-1459"><span class="linenos">1459</span></a>        <span class="k">return</span> <span class="n">task_definition</span>
</span><span id="ECSTask-1460"><a href="#ECSTask-1460"><span class="linenos">1460</span></a>
</span><span id="ECSTask-1461"><a href="#ECSTask-1461"><span class="linenos">1461</span></a>    <span class="k">def</span> <span class="nf">_prepare_task_run_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-1462"><a href="#ECSTask-1462"><span class="linenos">1462</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1463"><a href="#ECSTask-1463"><span class="linenos">1463</span></a><span class="sd">        Prepare the &#39;overrides&#39; payload for a task run request.</span>
</span><span id="ECSTask-1464"><a href="#ECSTask-1464"><span class="linenos">1464</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1465"><a href="#ECSTask-1465"><span class="linenos">1465</span></a>        <span class="n">overrides</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-1466"><a href="#ECSTask-1466"><span class="linenos">1466</span></a>            <span class="s2">&quot;containerOverrides&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="ECSTask-1467"><a href="#ECSTask-1467"><span class="linenos">1467</span></a>                <span class="p">{</span>
</span><span id="ECSTask-1468"><a href="#ECSTask-1468"><span class="linenos">1468</span></a>                    <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="p">,</span>
</span><span id="ECSTask-1469"><a href="#ECSTask-1469"><span class="linenos">1469</span></a>                    <span class="s2">&quot;environment&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="ECSTask-1470"><a href="#ECSTask-1470"><span class="linenos">1470</span></a>                        <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
</span><span id="ECSTask-1471"><a href="#ECSTask-1471"><span class="linenos">1471</span></a>                        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">{</span>
</span><span id="ECSTask-1472"><a href="#ECSTask-1472"><span class="linenos">1472</span></a>                            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_environment</span><span class="p">(),</span>
</span><span id="ECSTask-1473"><a href="#ECSTask-1473"><span class="linenos">1473</span></a>                            <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">env</span><span class="p">,</span>
</span><span id="ECSTask-1474"><a href="#ECSTask-1474"><span class="linenos">1474</span></a>                        <span class="p">}</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSTask-1475"><a href="#ECSTask-1475"><span class="linenos">1475</span></a>                        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSTask-1476"><a href="#ECSTask-1476"><span class="linenos">1476</span></a>                    <span class="p">],</span>
</span><span id="ECSTask-1477"><a href="#ECSTask-1477"><span class="linenos">1477</span></a>                <span class="p">}</span>
</span><span id="ECSTask-1478"><a href="#ECSTask-1478"><span class="linenos">1478</span></a>            <span class="p">],</span>
</span><span id="ECSTask-1479"><a href="#ECSTask-1479"><span class="linenos">1479</span></a>        <span class="p">}</span>
</span><span id="ECSTask-1480"><a href="#ECSTask-1480"><span class="linenos">1480</span></a>
</span><span id="ECSTask-1481"><a href="#ECSTask-1481"><span class="linenos">1481</span></a>        <span class="n">prefect_container_overrides</span> <span class="o">=</span> <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;containerOverrides&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ECSTask-1482"><a href="#ECSTask-1482"><span class="linenos">1482</span></a>
</span><span id="ECSTask-1483"><a href="#ECSTask-1483"><span class="linenos">1483</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
</span><span id="ECSTask-1484"><a href="#ECSTask-1484"><span class="linenos">1484</span></a>            <span class="n">prefect_container_overrides</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span>
</span><span id="ECSTask-1485"><a href="#ECSTask-1485"><span class="linenos">1485</span></a>
</span><span id="ECSTask-1486"><a href="#ECSTask-1486"><span class="linenos">1486</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_role_arn</span><span class="p">:</span>
</span><span id="ECSTask-1487"><a href="#ECSTask-1487"><span class="linenos">1487</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">execution_role_arn</span>
</span><span id="ECSTask-1488"><a href="#ECSTask-1488"><span class="linenos">1488</span></a>
</span><span id="ECSTask-1489"><a href="#ECSTask-1489"><span class="linenos">1489</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_role_arn</span><span class="p">:</span>
</span><span id="ECSTask-1490"><a href="#ECSTask-1490"><span class="linenos">1490</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;taskRoleArn&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_role_arn</span>
</span><span id="ECSTask-1491"><a href="#ECSTask-1491"><span class="linenos">1491</span></a>
</span><span id="ECSTask-1492"><a href="#ECSTask-1492"><span class="linenos">1492</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">:</span>
</span><span id="ECSTask-1493"><a href="#ECSTask-1493"><span class="linenos">1493</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="ECSTask-1494"><a href="#ECSTask-1494"><span class="linenos">1494</span></a>            <span class="n">prefect_container_overrides</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">memory</span><span class="p">)</span>
</span><span id="ECSTask-1495"><a href="#ECSTask-1495"><span class="linenos">1495</span></a>
</span><span id="ECSTask-1496"><a href="#ECSTask-1496"><span class="linenos">1496</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">:</span>
</span><span id="ECSTask-1497"><a href="#ECSTask-1497"><span class="linenos">1497</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
</span><span id="ECSTask-1498"><a href="#ECSTask-1498"><span class="linenos">1498</span></a>            <span class="n">prefect_container_overrides</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpu</span><span class="p">)</span>
</span><span id="ECSTask-1499"><a href="#ECSTask-1499"><span class="linenos">1499</span></a>
</span><span id="ECSTask-1500"><a href="#ECSTask-1500"><span class="linenos">1500</span></a>        <span class="k">return</span> <span class="n">overrides</span>
</span><span id="ECSTask-1501"><a href="#ECSTask-1501"><span class="linenos">1501</span></a>
</span><span id="ECSTask-1502"><a href="#ECSTask-1502"><span class="linenos">1502</span></a>    <span class="k">def</span> <span class="nf">_load_vpc_network_config</span><span class="p">(</span>
</span><span id="ECSTask-1503"><a href="#ECSTask-1503"><span class="linenos">1503</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">boto_session</span><span class="p">:</span> <span class="n">boto3</span><span class="o">.</span><span class="n">Session</span>
</span><span id="ECSTask-1504"><a href="#ECSTask-1504"><span class="linenos">1504</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-1505"><a href="#ECSTask-1505"><span class="linenos">1505</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1506"><a href="#ECSTask-1506"><span class="linenos">1506</span></a><span class="sd">        Load settings from a specific VPC or the default VPC and generate a task</span>
</span><span id="ECSTask-1507"><a href="#ECSTask-1507"><span class="linenos">1507</span></a><span class="sd">        run request&#39;s network configuration.</span>
</span><span id="ECSTask-1508"><a href="#ECSTask-1508"><span class="linenos">1508</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1509"><a href="#ECSTask-1509"><span class="linenos">1509</span></a>        <span class="n">ec2_client</span> <span class="o">=</span> <span class="n">boto_session</span><span class="o">.</span><span class="n">client</span><span class="p">(</span><span class="s2">&quot;ec2&quot;</span><span class="p">)</span>
</span><span id="ECSTask-1510"><a href="#ECSTask-1510"><span class="linenos">1510</span></a>        <span class="n">vpc_message</span> <span class="o">=</span> <span class="s2">&quot;the default VPC&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;VPC with ID </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask-1511"><a href="#ECSTask-1511"><span class="linenos">1511</span></a>
</span><span id="ECSTask-1512"><a href="#ECSTask-1512"><span class="linenos">1512</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span><span class="p">:</span>
</span><span id="ECSTask-1513"><a href="#ECSTask-1513"><span class="linenos">1513</span></a>            <span class="c1"># Retrieve the default VPC</span>
</span><span id="ECSTask-1514"><a href="#ECSTask-1514"><span class="linenos">1514</span></a>            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Filters&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;isDefault&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;true&quot;</span><span class="p">]}]}</span>
</span><span id="ECSTask-1515"><a href="#ECSTask-1515"><span class="linenos">1515</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1516"><a href="#ECSTask-1516"><span class="linenos">1516</span></a>            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VpcIds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}</span>
</span><span id="ECSTask-1517"><a href="#ECSTask-1517"><span class="linenos">1517</span></a>
</span><span id="ECSTask-1518"><a href="#ECSTask-1518"><span class="linenos">1518</span></a>        <span class="n">vpcs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">(</span><span class="o">**</span><span class="n">describe</span><span class="p">)[</span><span class="s2">&quot;Vpcs&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1519"><a href="#ECSTask-1519"><span class="linenos">1519</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpcs</span><span class="p">:</span>
</span><span id="ECSTask-1520"><a href="#ECSTask-1520"><span class="linenos">1520</span></a>            <span class="n">help_message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSTask-1521"><a href="#ECSTask-1521"><span class="linenos">1521</span></a>                <span class="s2">&quot;Pass an explicit `vpc_id` or configure a default VPC.&quot;</span>
</span><span id="ECSTask-1522"><a href="#ECSTask-1522"><span class="linenos">1522</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span>
</span><span id="ECSTask-1523"><a href="#ECSTask-1523"><span class="linenos">1523</span></a>                <span class="k">else</span> <span class="s2">&quot;Check that the VPC exists in the current region.&quot;</span>
</span><span id="ECSTask-1524"><a href="#ECSTask-1524"><span class="linenos">1524</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1525"><a href="#ECSTask-1525"><span class="linenos">1525</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask-1526"><a href="#ECSTask-1526"><span class="linenos">1526</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSTask-1527"><a href="#ECSTask-1527"><span class="linenos">1527</span></a>                <span class="s2">&quot;Network configuration cannot be inferred. &quot;</span> <span class="o">+</span> <span class="n">help_message</span>
</span><span id="ECSTask-1528"><a href="#ECSTask-1528"><span class="linenos">1528</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1529"><a href="#ECSTask-1529"><span class="linenos">1529</span></a>
</span><span id="ECSTask-1530"><a href="#ECSTask-1530"><span class="linenos">1530</span></a>        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;VpcId&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1531"><a href="#ECSTask-1531"><span class="linenos">1531</span></a>        <span class="n">subnets</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">(</span>
</span><span id="ECSTask-1532"><a href="#ECSTask-1532"><span class="linenos">1532</span></a>            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}]</span>
</span><span id="ECSTask-1533"><a href="#ECSTask-1533"><span class="linenos">1533</span></a>        <span class="p">)[</span><span class="s2">&quot;Subnets&quot;</span><span class="p">]</span>
</span><span id="ECSTask-1534"><a href="#ECSTask-1534"><span class="linenos">1534</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">subnets</span><span class="p">:</span>
</span><span id="ECSTask-1535"><a href="#ECSTask-1535"><span class="linenos">1535</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask-1536"><a href="#ECSTask-1536"><span class="linenos">1536</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find subnets for </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSTask-1537"><a href="#ECSTask-1537"><span class="linenos">1537</span></a>                <span class="s2">&quot;Network configuration cannot be inferred.&quot;</span>
</span><span id="ECSTask-1538"><a href="#ECSTask-1538"><span class="linenos">1538</span></a>            <span class="p">)</span>
</span><span id="ECSTask-1539"><a href="#ECSTask-1539"><span class="linenos">1539</span></a>
</span><span id="ECSTask-1540"><a href="#ECSTask-1540"><span class="linenos">1540</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ECSTask-1541"><a href="#ECSTask-1541"><span class="linenos">1541</span></a>            <span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask-1542"><a href="#ECSTask-1542"><span class="linenos">1542</span></a>                <span class="s2">&quot;subnets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">],</span>
</span><span id="ECSTask-1543"><a href="#ECSTask-1543"><span class="linenos">1543</span></a>                <span class="s2">&quot;assignPublicIp&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
</span><span id="ECSTask-1544"><a href="#ECSTask-1544"><span class="linenos">1544</span></a>                <span class="s2">&quot;securityGroups&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="ECSTask-1545"><a href="#ECSTask-1545"><span class="linenos">1545</span></a>            <span class="p">}</span>
</span><span id="ECSTask-1546"><a href="#ECSTask-1546"><span class="linenos">1546</span></a>        <span class="p">}</span>
</span><span id="ECSTask-1547"><a href="#ECSTask-1547"><span class="linenos">1547</span></a>
</span><span id="ECSTask-1548"><a href="#ECSTask-1548"><span class="linenos">1548</span></a>    <span class="k">def</span> <span class="nf">_prepare_task_run</span><span class="p">(</span>
</span><span id="ECSTask-1549"><a href="#ECSTask-1549"><span class="linenos">1549</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSTask-1550"><a href="#ECSTask-1550"><span class="linenos">1550</span></a>        <span class="n">network_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span>
</span><span id="ECSTask-1551"><a href="#ECSTask-1551"><span class="linenos">1551</span></a>        <span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSTask-1552"><a href="#ECSTask-1552"><span class="linenos">1552</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask-1553"><a href="#ECSTask-1553"><span class="linenos">1553</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1554"><a href="#ECSTask-1554"><span class="linenos">1554</span></a><span class="sd">        Prepare a task run request payload.</span>
</span><span id="ECSTask-1555"><a href="#ECSTask-1555"><span class="linenos">1555</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1556"><a href="#ECSTask-1556"><span class="linenos">1556</span></a>        <span class="n">task_run</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask-1557"><a href="#ECSTask-1557"><span class="linenos">1557</span></a>            <span class="s2">&quot;overrides&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run_overrides</span><span class="p">(),</span>
</span><span id="ECSTask-1558"><a href="#ECSTask-1558"><span class="linenos">1558</span></a>            <span class="s2">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="ECSTask-1559"><a href="#ECSTask-1559"><span class="linenos">1559</span></a>                <span class="p">{</span>
</span><span id="ECSTask-1560"><a href="#ECSTask-1560"><span class="linenos">1560</span></a>                    <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSTask-1561"><a href="#ECSTask-1561"><span class="linenos">1561</span></a>                        <span class="n">key</span><span class="p">,</span>
</span><span id="ECSTask-1562"><a href="#ECSTask-1562"><span class="linenos">1562</span></a>                        <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
</span><span id="ECSTask-1563"><a href="#ECSTask-1563"><span class="linenos">1563</span></a>                        <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSTask-1564"><a href="#ECSTask-1564"><span class="linenos">1564</span></a>                        <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ECSTask-1565"><a href="#ECSTask-1565"><span class="linenos">1565</span></a>                    <span class="p">),</span>
</span><span id="ECSTask-1566"><a href="#ECSTask-1566"><span class="linenos">1566</span></a>                    <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSTask-1567"><a href="#ECSTask-1567"><span class="linenos">1567</span></a>                        <span class="n">value</span><span class="p">,</span>
</span><span id="ECSTask-1568"><a href="#ECSTask-1568"><span class="linenos">1568</span></a>                        <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
</span><span id="ECSTask-1569"><a href="#ECSTask-1569"><span class="linenos">1569</span></a>                        <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSTask-1570"><a href="#ECSTask-1570"><span class="linenos">1570</span></a>                        <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ECSTask-1571"><a href="#ECSTask-1571"><span class="linenos">1571</span></a>                    <span class="p">),</span>
</span><span id="ECSTask-1572"><a href="#ECSTask-1572"><span class="linenos">1572</span></a>                <span class="p">}</span>
</span><span id="ECSTask-1573"><a href="#ECSTask-1573"><span class="linenos">1573</span></a>                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSTask-1574"><a href="#ECSTask-1574"><span class="linenos">1574</span></a>            <span class="p">],</span>
</span><span id="ECSTask-1575"><a href="#ECSTask-1575"><span class="linenos">1575</span></a>            <span class="s2">&quot;taskDefinition&quot;</span><span class="p">:</span> <span class="n">task_definition_arn</span><span class="p">,</span>
</span><span id="ECSTask-1576"><a href="#ECSTask-1576"><span class="linenos">1576</span></a>        <span class="p">}</span>
</span><span id="ECSTask-1577"><a href="#ECSTask-1577"><span class="linenos">1577</span></a>
</span><span id="ECSTask-1578"><a href="#ECSTask-1578"><span class="linenos">1578</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span><span class="p">:</span>
</span><span id="ECSTask-1579"><a href="#ECSTask-1579"><span class="linenos">1579</span></a>            <span class="n">task_run</span><span class="p">[</span><span class="s2">&quot;cluster&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span>
</span><span id="ECSTask-1580"><a href="#ECSTask-1580"><span class="linenos">1580</span></a>
</span><span id="ECSTask-1581"><a href="#ECSTask-1581"><span class="linenos">1581</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span><span class="p">:</span>
</span><span id="ECSTask-1582"><a href="#ECSTask-1582"><span class="linenos">1582</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
</span><span id="ECSTask-1583"><a href="#ECSTask-1583"><span class="linenos">1583</span></a>                <span class="n">task_run</span><span class="p">[</span><span class="s2">&quot;capacityProviderStrategy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSTask-1584"><a href="#ECSTask-1584"><span class="linenos">1584</span></a>                    <span class="p">{</span><span class="s2">&quot;capacityProvider&quot;</span><span class="p">:</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="ECSTask-1585"><a href="#ECSTask-1585"><span class="linenos">1585</span></a>                <span class="p">]</span>
</span><span id="ECSTask-1586"><a href="#ECSTask-1586"><span class="linenos">1586</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask-1587"><a href="#ECSTask-1587"><span class="linenos">1587</span></a>                <span class="n">task_run</span><span class="p">[</span><span class="s2">&quot;launchType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_type</span>
</span><span id="ECSTask-1588"><a href="#ECSTask-1588"><span class="linenos">1588</span></a>
</span><span id="ECSTask-1589"><a href="#ECSTask-1589"><span class="linenos">1589</span></a>        <span class="k">if</span> <span class="n">network_config</span><span class="p">:</span>
</span><span id="ECSTask-1590"><a href="#ECSTask-1590"><span class="linenos">1590</span></a>            <span class="n">task_run</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">network_config</span>
</span><span id="ECSTask-1591"><a href="#ECSTask-1591"><span class="linenos">1591</span></a>
</span><span id="ECSTask-1592"><a href="#ECSTask-1592"><span class="linenos">1592</span></a>        <span class="n">task_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">task_run</span><span class="p">)</span>
</span><span id="ECSTask-1593"><a href="#ECSTask-1593"><span class="linenos">1593</span></a>        <span class="k">return</span> <span class="n">task_run</span>
</span><span id="ECSTask-1594"><a href="#ECSTask-1594"><span class="linenos">1594</span></a>
</span><span id="ECSTask-1595"><a href="#ECSTask-1595"><span class="linenos">1595</span></a>    <span class="k">def</span> <span class="nf">_run_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ECSTask-1596"><a href="#ECSTask-1596"><span class="linenos">1596</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask-1597"><a href="#ECSTask-1597"><span class="linenos">1597</span></a><span class="sd">        Run the task using the ECS client.</span>
</span><span id="ECSTask-1598"><a href="#ECSTask-1598"><span class="linenos">1598</span></a>
</span><span id="ECSTask-1599"><a href="#ECSTask-1599"><span class="linenos">1599</span></a><span class="sd">        This is isolated as a separate method for testing purposes.</span>
</span><span id="ECSTask-1600"><a href="#ECSTask-1600"><span class="linenos">1600</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask-1601"><a href="#ECSTask-1601"><span class="linenos">1601</span></a>        <span class="k">return</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="o">**</span><span class="n">task_run</span><span class="p">)[</span><span class="s2">&quot;tasks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Run a command as an ECS task.</p>

<p>Attributes:
    type: The slug for this task type with a default value of "ecs-task".
    aws_credentials: The AWS credentials to use to connect to ECS with a
        default factory of AwsCredentials.
    task_definition_arn: An optional identifier for an existing task definition
        to use. If fields are set on the ECSTask that conflict with the task
        definition, a new copy will be registered with the required values.
        Cannot be used with task_definition. If not provided, Prefect will
        generate and register a minimal task definition.
    task_definition: An optional ECS task definition to use. Prefect may set
        defaults or override fields on this task definition to match other
        ECSTask fields. Cannot be used with task_definition_arn.
        If not provided, Prefect will generate and register
        a minimal task definition.
    family: An optional family for the task definition. If not provided,
        it will be inferred from the task definition. If the task definition
        does not have a family, the name will be generated. When flow and
        deployment metadata is available, the generated name will include
        their names. Values for this field will be slugified to match
        AWS character requirements.
    image: An optional image to use for the Prefect container in the task.
        If this value is not null, it will override the value in the task
        definition. This value defaults to a Prefect base image matching
        your local versions.
    auto_deregister_task_definition: A boolean that controls if any task
        definitions that are created by this block will be deregistered
        or not. Existing task definitions linked by ARN will never be
        deregistered. Deregistering a task definition does not remove
        it from your AWS account, instead it will be marked as INACTIVE.
    cpu: The amount of CPU to provide to the ECS task. Valid amounts are
        specified in the AWS documentation. If not provided, a default
        value of ECS_DEFAULT_CPU will be used unless present on
        the task definition.
    memory: The amount of memory to provide to the ECS task.
        Valid amounts are specified in the AWS documentation.
        If not provided, a default value of ECS_DEFAULT_MEMORY
        will be used unless present on the task definition.
    execution_role_arn: An execution role to use for the task.
        This controls the permissions of the task when it is launching.
        If this value is not null, it will override the value in the task
        definition. An execution role must be provided to capture logs
        from the container.
    configure_cloudwatch_logs: A boolean that controls if the Prefect
        container will be configured to send its output to the
        AWS CloudWatch logs service or not. This functionality requires
        an execution role with permissions to create log streams and groups.
    cloudwatch_logs_options: A dictionary of options to pass to
        the CloudWatch logs configuration.
    stream_output: A boolean indicating whether logs will be
        streamed from the Prefect container to the local console.
    launch_type: An optional launch type for the ECS task run infrastructure.
    vpc_id: An optional VPC ID to link the task run to.
        This is only applicable when using the 'awsvpc' network mode for your task.
    cluster: An optional ECS cluster to run the task in.
        The ARN or name may be provided. If not provided,
        the default cluster will be used.
    env: A dictionary of environment variables to provide to
        the task run. These variables are set on the
        Prefect container at task runtime.
    task_role_arn: An optional role to attach to the task run.
        This controls the permissions of the task while it is running.
    task_customizations: A list of JSON 6902 patches to apply to the task
        run request. If a string is given, it will parsed as a JSON expression.
    task_start_timeout_seconds: The amount of time to watch for the
        start of the ECS task before marking it as failed. The task must
        enter a RUNNING state to be considered started.
    task_watch_poll_interval: The amount of time to wait between AWS API
        calls while monitoring the state of an ECS task.</p>
</div>


                            <div id="ECSTask.__init__" class="classattr">
                                        <input id="ECSTask.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">ECSTask</span><span class="signature pdoc-code condensed">(<span class="param"><span class="o">**</span><span class="n">kwargs</span></span>)</span>

                <label class="view-source-button" for="ECSTask.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.__init__-1046"><a href="#ECSTask.__init__-1046"><span class="linenos">1046</span></a>    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Self</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ECSTask.__init__-1047"><a href="#ECSTask.__init__-1047"><span class="linenos">1047</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.__init__-1048"><a href="#ECSTask.__init__-1048"><span class="linenos">1048</span></a><span class="sd">        Create an instance of the Block subclass type if a `block_type_slug` is</span>
</span><span id="ECSTask.__init__-1049"><a href="#ECSTask.__init__-1049"><span class="linenos">1049</span></a><span class="sd">        present in the data payload.</span>
</span><span id="ECSTask.__init__-1050"><a href="#ECSTask.__init__-1050"><span class="linenos">1050</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.__init__-1051"><a href="#ECSTask.__init__-1051"><span class="linenos">1051</span></a>        <span class="n">block_type_slug</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;block_type_slug&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1052"><a href="#ECSTask.__init__-1052"><span class="linenos">1052</span></a>        <span class="k">if</span> <span class="n">block_type_slug</span><span class="p">:</span>
</span><span id="ECSTask.__init__-1053"><a href="#ECSTask.__init__-1053"><span class="linenos">1053</span></a>            <span class="n">subcls</span> <span class="o">=</span> <span class="n">lookup_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">dispatch_key</span><span class="o">=</span><span class="n">block_type_slug</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1054"><a href="#ECSTask.__init__-1054"><span class="linenos">1054</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="n">subcls</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1055"><a href="#ECSTask.__init__-1055"><span class="linenos">1055</span></a>            <span class="c1"># NOTE: This is a workaround for an obscure issue where copied models were</span>
</span><span id="ECSTask.__init__-1056"><a href="#ECSTask.__init__-1056"><span class="linenos">1056</span></a>            <span class="c1">#       missing attributes. This pattern is from Pydantic&#39;s</span>
</span><span id="ECSTask.__init__-1057"><a href="#ECSTask.__init__-1057"><span class="linenos">1057</span></a>            <span class="c1">#       `BaseModel._copy_and_set_values`.</span>
</span><span id="ECSTask.__init__-1058"><a href="#ECSTask.__init__-1058"><span class="linenos">1058</span></a>            <span class="c1">#       The issue this fixes could not be reproduced in unit tests that</span>
</span><span id="ECSTask.__init__-1059"><a href="#ECSTask.__init__-1059"><span class="linenos">1059</span></a>            <span class="c1">#       directly targeted dispatch handling and was only observed when</span>
</span><span id="ECSTask.__init__-1060"><a href="#ECSTask.__init__-1060"><span class="linenos">1060</span></a>            <span class="c1">#       copying then saving infrastructure blocks on deployment models.</span>
</span><span id="ECSTask.__init__-1061"><a href="#ECSTask.__init__-1061"><span class="linenos">1061</span></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1062"><a href="#ECSTask.__init__-1062"><span class="linenos">1062</span></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__fields_set__&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="ECSTask.__init__-1063"><a href="#ECSTask.__init__-1063"><span class="linenos">1063</span></a>            <span class="k">return</span> <span class="n">m</span>
</span><span id="ECSTask.__init__-1064"><a href="#ECSTask.__init__-1064"><span class="linenos">1064</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.__init__-1065"><a href="#ECSTask.__init__-1065"><span class="linenos">1065</span></a>            <span class="n">m</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1066"><a href="#ECSTask.__init__-1066"><span class="linenos">1066</span></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__dict__&quot;</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span>
</span><span id="ECSTask.__init__-1067"><a href="#ECSTask.__init__-1067"><span class="linenos">1067</span></a>            <span class="nb">object</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__fields_set__&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
</span><span id="ECSTask.__init__-1068"><a href="#ECSTask.__init__-1068"><span class="linenos">1068</span></a>            <span class="k">return</span> <span class="n">m</span>
</span></pre></div>


            <div class="docstring"><p>Create an instance of the Block subclass type if a <code>block_type_slug</code> is
present in the data payload.</p>
</div>


                            </div>
                            <div id="ECSTask.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span><span class="annotation">: Literal[&#39;ecs-task&#39;]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.type"></a>
    
    

                            </div>
                            <div id="ECSTask.aws_credentials" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_credentials</span><span class="annotation">: <a href="#AwsCredentials">AwsCredentials</a></span>

        
    </div>
    <a class="headerlink" href="#ECSTask.aws_credentials"></a>
    
    

                            </div>
                            <div id="ECSTask.task_definition_arn" class="classattr">
                                <div class="attr variable">
            <span class="name">task_definition_arn</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_definition_arn"></a>
    
    

                            </div>
                            <div id="ECSTask.task_definition" class="classattr">
                                <div class="attr variable">
            <span class="name">task_definition</span><span class="annotation">: Optional[dict]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_definition"></a>
    
    

                            </div>
                            <div id="ECSTask.family" class="classattr">
                                <div class="attr variable">
            <span class="name">family</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.family"></a>
    
    

                            </div>
                            <div id="ECSTask.image" class="classattr">
                                <div class="attr variable">
            <span class="name">image</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.image"></a>
    
    

                            </div>
                            <div id="ECSTask.auto_deregister_task_definition" class="classattr">
                                <div class="attr variable">
            <span class="name">auto_deregister_task_definition</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.auto_deregister_task_definition"></a>
    
    

                            </div>
                            <div id="ECSTask.cpu" class="classattr">
                                <div class="attr variable">
            <span class="name">cpu</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.cpu"></a>
    
    

                            </div>
                            <div id="ECSTask.memory" class="classattr">
                                <div class="attr variable">
            <span class="name">memory</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.memory"></a>
    
    

                            </div>
                            <div id="ECSTask.execution_role_arn" class="classattr">
                                <div class="attr variable">
            <span class="name">execution_role_arn</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.execution_role_arn"></a>
    
    

                            </div>
                            <div id="ECSTask.configure_cloudwatch_logs" class="classattr">
                                <div class="attr variable">
            <span class="name">configure_cloudwatch_logs</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.configure_cloudwatch_logs"></a>
    
    

                            </div>
                            <div id="ECSTask.cloudwatch_logs_options" class="classattr">
                                <div class="attr variable">
            <span class="name">cloudwatch_logs_options</span><span class="annotation">: Dict[str, str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.cloudwatch_logs_options"></a>
    
    

                            </div>
                            <div id="ECSTask.stream_output" class="classattr">
                                <div class="attr variable">
            <span class="name">stream_output</span><span class="annotation">: bool</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.stream_output"></a>
    
    

                            </div>
                            <div id="ECSTask.launch_type" class="classattr">
                                <div class="attr variable">
            <span class="name">launch_type</span><span class="annotation">: Optional[Literal[&#39;FARGATE&#39;, &#39;EC2&#39;, &#39;EXTERNAL&#39;, &#39;FARGATE_SPOT&#39;]]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.launch_type"></a>
    
    

                            </div>
                            <div id="ECSTask.vpc_id" class="classattr">
                                <div class="attr variable">
            <span class="name">vpc_id</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.vpc_id"></a>
    
    

                            </div>
                            <div id="ECSTask.cluster" class="classattr">
                                <div class="attr variable">
            <span class="name">cluster</span><span class="annotation">: Optional[str]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.cluster"></a>
    
    

                            </div>
                            <div id="ECSTask.env" class="classattr">
                                <div class="attr variable">
            <span class="name">env</span><span class="annotation">: Dict[str, Optional[str]]</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.env"></a>
    
    

                            </div>
                            <div id="ECSTask.task_role_arn" class="classattr">
                                <div class="attr variable">
            <span class="name">task_role_arn</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_role_arn"></a>
    
    

                            </div>
                            <div id="ECSTask.task_customizations" class="classattr">
                                <div class="attr variable">
            <span class="name">task_customizations</span><span class="annotation">: prefect.utilities.pydantic.JsonPatch</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_customizations"></a>
    
    

                            </div>
                            <div id="ECSTask.task_start_timeout_seconds" class="classattr">
                                <div class="attr variable">
            <span class="name">task_start_timeout_seconds</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_start_timeout_seconds"></a>
    
    

                            </div>
                            <div id="ECSTask.task_watch_poll_interval" class="classattr">
                                <div class="attr variable">
            <span class="name">task_watch_poll_interval</span><span class="annotation">: float</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.task_watch_poll_interval"></a>
    
    

                            </div>
                            <div id="ECSTask.set_default_configure_cloudwatch_logs" class="classattr">
                                        <input id="ECSTask.set_default_configure_cloudwatch_logs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator(pre=True)</div>

        <span class="def">def</span>
        <span class="name">set_default_configure_cloudwatch_logs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ECSTask.set_default_configure_cloudwatch_logs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.set_default_configure_cloudwatch_logs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.set_default_configure_cloudwatch_logs-494"><a href="#ECSTask.set_default_configure_cloudwatch_logs-494"><span class="linenos">494</span></a>    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-495"><a href="#ECSTask.set_default_configure_cloudwatch_logs-495"><span class="linenos">495</span></a>    <span class="k">def</span> <span class="nf">set_default_configure_cloudwatch_logs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-496"><a href="#ECSTask.set_default_configure_cloudwatch_logs-496"><span class="linenos">496</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-497"><a href="#ECSTask.set_default_configure_cloudwatch_logs-497"><span class="linenos">497</span></a><span class="sd">        Streaming output generally requires CloudWatch logs to be configured.</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-498"><a href="#ECSTask.set_default_configure_cloudwatch_logs-498"><span class="linenos">498</span></a>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-499"><a href="#ECSTask.set_default_configure_cloudwatch_logs-499"><span class="linenos">499</span></a><span class="sd">        To avoid entangled arguments in the simple case, `configure_cloudwatch_logs`</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-500"><a href="#ECSTask.set_default_configure_cloudwatch_logs-500"><span class="linenos">500</span></a><span class="sd">        defaults to matching the value of `stream_output`.</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-501"><a href="#ECSTask.set_default_configure_cloudwatch_logs-501"><span class="linenos">501</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-502"><a href="#ECSTask.set_default_configure_cloudwatch_logs-502"><span class="linenos">502</span></a>        <span class="n">configure_cloudwatch_logs</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-503"><a href="#ECSTask.set_default_configure_cloudwatch_logs-503"><span class="linenos">503</span></a>        <span class="k">if</span> <span class="n">configure_cloudwatch_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-504"><a href="#ECSTask.set_default_configure_cloudwatch_logs-504"><span class="linenos">504</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stream_output&quot;</span><span class="p">)</span>
</span><span id="ECSTask.set_default_configure_cloudwatch_logs-505"><a href="#ECSTask.set_default_configure_cloudwatch_logs-505"><span class="linenos">505</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Streaming output generally requires CloudWatch logs to be configured.</p>

<p>To avoid entangled arguments in the simple case, <code><a href="#ECSTask.configure_cloudwatch_logs">configure_cloudwatch_logs</a></code>
defaults to matching the value of <code><a href="#ECSTask.stream_output">stream_output</a></code>.</p>
</div>


                            </div>
                            <div id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn" class="classattr">
                                        <input id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator</div>

        <span class="def">def</span>
        <span class="name">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-507"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-507"><span class="linenos">507</span></a>    <span class="nd">@root_validator</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-508"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-508"><span class="linenos">508</span></a>    <span class="k">def</span> <span class="nf">configure_cloudwatch_logs_requires_execution_role_arn</span><span class="p">(</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-509"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-509"><span class="linenos">509</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-510"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-510"><span class="linenos">510</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-511"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-511"><span class="linenos">511</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-512"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-512"><span class="linenos">512</span></a><span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-513"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-513"><span class="linenos">513</span></a><span class="sd">        runtime task definition) when configuring logging.</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-514"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-515"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-515"><span class="linenos">515</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-516"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-516"><span class="linenos">516</span></a>            <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;configure_cloudwatch_logs&quot;</span><span class="p">)</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-517"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-517"><span class="linenos">517</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_role_arn&quot;</span><span class="p">)</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-518"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-518"><span class="linenos">518</span></a>            <span class="c1"># Do not raise if they&#39;ve linked to another task definition or provided</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-519"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-519"><span class="linenos">519</span></a>            <span class="c1"># it without using our shortcuts</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-520"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-520"><span class="linenos">520</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition_arn&quot;</span><span class="p">)</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-521"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-521"><span class="linenos">521</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;executionRoleArn&quot;</span><span class="p">)</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-522"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-522"><span class="linenos">522</span></a>        <span class="p">):</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-523"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-523"><span class="linenos">523</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-524"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-524"><span class="linenos">524</span></a>                <span class="s2">&quot;An `execution_role_arn` must be provided to use &quot;</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-525"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-525"><span class="linenos">525</span></a>                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs`.&quot;</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-526"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-526"><span class="linenos">526</span></a>            <span class="p">)</span>
</span><span id="ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-527"><a href="#ECSTask.configure_cloudwatch_logs_requires_execution_role_arn-527"><span class="linenos">527</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>
</div>


                            </div>
                            <div id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs" class="classattr">
                                        <input id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator</div>

        <span class="def">def</span>
        <span class="name">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-529"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-529"><span class="linenos">529</span></a>    <span class="nd">@root_validator</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-530"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-530"><span class="linenos">530</span></a>    <span class="k">def</span> <span class="nf">cloudwatch_logs_options_requires_configure_cloudwatch_logs</span><span class="p">(</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-531"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-531"><span class="linenos">531</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-532"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-532"><span class="linenos">532</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-533"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-533"><span class="linenos">533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-534"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-534"><span class="linenos">534</span></a><span class="sd">        Enforces that an execution role arn is provided (or could be provided by a</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-535"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-535"><span class="linenos">535</span></a><span class="sd">        runtime task definition) when configuring logging.</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-536"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-536"><span class="linenos">536</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-537"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-537"><span class="linenos">537</span></a>        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cloudwatch_logs_options&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-538"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-538"><span class="linenos">538</span></a>            <span class="s2">&quot;configure_cloudwatch_logs&quot;</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-539"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-539"><span class="linenos">539</span></a>        <span class="p">):</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-540"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-540"><span class="linenos">540</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-541"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-541"><span class="linenos">541</span></a>                <span class="s2">&quot;`configure_cloudwatch_log` must be enabled to use &quot;</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-542"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-542"><span class="linenos">542</span></a>                <span class="s2">&quot;`cloudwatch_logs_options`.&quot;</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-543"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-543"><span class="linenos">543</span></a>            <span class="p">)</span>
</span><span id="ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-544"><a href="#ECSTask.cloudwatch_logs_options_requires_configure_cloudwatch_logs-544"><span class="linenos">544</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Enforces that an execution role arn is provided (or could be provided by a
runtime task definition) when configuring logging.</p>
</div>


                            </div>
                            <div id="ECSTask.image_is_required" class="classattr">
                                        <input id="ECSTask.image_is_required-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@root_validator(pre=True)</div>

        <span class="def">def</span>
        <span class="name">image_is_required</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">cls</span>, </span><span class="param"><span class="n">values</span><span class="p">:</span> <span class="nb">dict</span></span><span class="return-annotation">) -> <span class="nb">dict</span>:</span></span>

                <label class="view-source-button" for="ECSTask.image_is_required-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.image_is_required"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.image_is_required-546"><a href="#ECSTask.image_is_required-546"><span class="linenos">546</span></a>    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask.image_is_required-547"><a href="#ECSTask.image_is_required-547"><span class="linenos">547</span></a>    <span class="k">def</span> <span class="nf">image_is_required</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask.image_is_required-548"><a href="#ECSTask.image_is_required-548"><span class="linenos">548</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.image_is_required-549"><a href="#ECSTask.image_is_required-549"><span class="linenos">549</span></a><span class="sd">        Enforces that an image is available if image is `None`.</span>
</span><span id="ECSTask.image_is_required-550"><a href="#ECSTask.image_is_required-550"><span class="linenos">550</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.image_is_required-551"><a href="#ECSTask.image_is_required-551"><span class="linenos">551</span></a>        <span class="n">has_image</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">))</span>
</span><span id="ECSTask.image_is_required-552"><a href="#ECSTask.image_is_required-552"><span class="linenos">552</span></a>        <span class="n">has_task_definition_arn</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition_arn&quot;</span><span class="p">))</span>
</span><span id="ECSTask.image_is_required-553"><a href="#ECSTask.image_is_required-553"><span class="linenos">553</span></a>
</span><span id="ECSTask.image_is_required-554"><a href="#ECSTask.image_is_required-554"><span class="linenos">554</span></a>        <span class="c1"># The image can only be null when the task_definition_arn is set</span>
</span><span id="ECSTask.image_is_required-555"><a href="#ECSTask.image_is_required-555"><span class="linenos">555</span></a>        <span class="k">if</span> <span class="n">has_image</span> <span class="ow">or</span> <span class="n">has_task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask.image_is_required-556"><a href="#ECSTask.image_is_required-556"><span class="linenos">556</span></a>            <span class="k">return</span> <span class="n">values</span>
</span><span id="ECSTask.image_is_required-557"><a href="#ECSTask.image_is_required-557"><span class="linenos">557</span></a>
</span><span id="ECSTask.image_is_required-558"><a href="#ECSTask.image_is_required-558"><span class="linenos">558</span></a>        <span class="n">prefect_container</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSTask.image_is_required-559"><a href="#ECSTask.image_is_required-559"><span class="linenos">559</span></a>            <span class="n">get_prefect_container</span><span class="p">(</span>
</span><span id="ECSTask.image_is_required-560"><a href="#ECSTask.image_is_required-560"><span class="linenos">560</span></a>                <span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;task_definition&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask.image_is_required-561"><a href="#ECSTask.image_is_required-561"><span class="linenos">561</span></a>            <span class="p">)</span>
</span><span id="ECSTask.image_is_required-562"><a href="#ECSTask.image_is_required-562"><span class="linenos">562</span></a>            <span class="ow">or</span> <span class="p">{}</span>
</span><span id="ECSTask.image_is_required-563"><a href="#ECSTask.image_is_required-563"><span class="linenos">563</span></a>        <span class="p">)</span>
</span><span id="ECSTask.image_is_required-564"><a href="#ECSTask.image_is_required-564"><span class="linenos">564</span></a>        <span class="n">image_in_task_definition</span> <span class="o">=</span> <span class="n">prefect_container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">)</span>
</span><span id="ECSTask.image_is_required-565"><a href="#ECSTask.image_is_required-565"><span class="linenos">565</span></a>
</span><span id="ECSTask.image_is_required-566"><a href="#ECSTask.image_is_required-566"><span class="linenos">566</span></a>        <span class="c1"># If a task_definition is given with a prefect container image, use that value</span>
</span><span id="ECSTask.image_is_required-567"><a href="#ECSTask.image_is_required-567"><span class="linenos">567</span></a>        <span class="k">if</span> <span class="n">image_in_task_definition</span><span class="p">:</span>
</span><span id="ECSTask.image_is_required-568"><a href="#ECSTask.image_is_required-568"><span class="linenos">568</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">image_in_task_definition</span>
</span><span id="ECSTask.image_is_required-569"><a href="#ECSTask.image_is_required-569"><span class="linenos">569</span></a>        <span class="c1"># Otherwise, it should default to the Prefect base image</span>
</span><span id="ECSTask.image_is_required-570"><a href="#ECSTask.image_is_required-570"><span class="linenos">570</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.image_is_required-571"><a href="#ECSTask.image_is_required-571"><span class="linenos">571</span></a>            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;image&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_prefect_image_name</span><span class="p">()</span>
</span><span id="ECSTask.image_is_required-572"><a href="#ECSTask.image_is_required-572"><span class="linenos">572</span></a>        <span class="k">return</span> <span class="n">values</span>
</span></pre></div>


            <div class="docstring"><p>Enforces that an image is available if image is <code>None</code>.</p>
</div>


                            </div>
                            <div id="ECSTask.cast_customizations_to_a_json_patch" class="classattr">
                                        <input id="ECSTask.cast_customizations_to_a_json_patch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@validator(&#39;task_customizations&#39;, pre=True)</div>

        <span class="def">def</span>
        <span class="name">cast_customizations_to_a_json_patch</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">cls</span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">prefect</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">pydantic</span><span class="o">.</span><span class="n">JsonPatch</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n">prefect</span><span class="o">.</span><span class="n">utilities</span><span class="o">.</span><span class="n">pydantic</span><span class="o">.</span><span class="n">JsonPatch</span>:</span></span>

                <label class="view-source-button" for="ECSTask.cast_customizations_to_a_json_patch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.cast_customizations_to_a_json_patch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.cast_customizations_to_a_json_patch-574"><a href="#ECSTask.cast_customizations_to_a_json_patch-574"><span class="linenos">574</span></a>    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;task_customizations&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-575"><a href="#ECSTask.cast_customizations_to_a_json_patch-575"><span class="linenos">575</span></a>    <span class="k">def</span> <span class="nf">cast_customizations_to_a_json_patch</span><span class="p">(</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-576"><a href="#ECSTask.cast_customizations_to_a_json_patch-576"><span class="linenos">576</span></a>        <span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">],</span> <span class="n">JsonPatch</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-577"><a href="#ECSTask.cast_customizations_to_a_json_patch-577"><span class="linenos">577</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonPatch</span><span class="p">:</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-578"><a href="#ECSTask.cast_customizations_to_a_json_patch-578"><span class="linenos">578</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-579"><a href="#ECSTask.cast_customizations_to_a_json_patch-579"><span class="linenos">579</span></a><span class="sd">        Casts lists to JsonPatch instances.</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-580"><a href="#ECSTask.cast_customizations_to_a_json_patch-580"><span class="linenos">580</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-581"><a href="#ECSTask.cast_customizations_to_a_json_patch-581"><span class="linenos">581</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-582"><a href="#ECSTask.cast_customizations_to_a_json_patch-582"><span class="linenos">582</span></a>            <span class="n">value</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-583"><a href="#ECSTask.cast_customizations_to_a_json_patch-583"><span class="linenos">583</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-584"><a href="#ECSTask.cast_customizations_to_a_json_patch-584"><span class="linenos">584</span></a>            <span class="k">return</span> <span class="n">JsonPatch</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask.cast_customizations_to_a_json_patch-585"><a href="#ECSTask.cast_customizations_to_a_json_patch-585"><span class="linenos">585</span></a>        <span class="k">return</span> <span class="n">value</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Casts lists to JsonPatch instances.</p>
</div>


                            </div>
                            <div id="ECSTask.dict" class="classattr">
                                        <input id="ECSTask.dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">) -> <span class="n">Dict</span>:</span></span>

                <label class="view-source-button" for="ECSTask.dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.dict-594"><a href="#ECSTask.dict-594"><span class="linenos">594</span></a>    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">:</span>
</span><span id="ECSTask.dict-595"><a href="#ECSTask.dict-595"><span class="linenos">595</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.dict-596"><a href="#ECSTask.dict-596"><span class="linenos">596</span></a><span class="sd">        Convert to a dictionary.</span>
</span><span id="ECSTask.dict-597"><a href="#ECSTask.dict-597"><span class="linenos">597</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.dict-598"><a href="#ECSTask.dict-598"><span class="linenos">598</span></a>        <span class="c1"># Support serialization of the &#39;JsonPatch&#39; type</span>
</span><span id="ECSTask.dict-599"><a href="#ECSTask.dict-599"><span class="linenos">599</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="ECSTask.dict-600"><a href="#ECSTask.dict-600"><span class="linenos">600</span></a>        <span class="n">d</span><span class="p">[</span><span class="s2">&quot;task_customizations&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="o">.</span><span class="n">patch</span>
</span><span id="ECSTask.dict-601"><a href="#ECSTask.dict-601"><span class="linenos">601</span></a>        <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Convert to a dictionary.</p>
</div>


                            </div>
                            <div id="ECSTask.prepare_for_flow_run" class="classattr">
                                        <input id="ECSTask.prepare_for_flow_run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prepare_for_flow_run</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span><span class="p">:</span> <span class="n">Self</span>,</span><span class="param">	<span class="n">flow_run</span><span class="p">:</span> <span class="n">prefect</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">FlowRun</span>,</span><span class="param">	<span class="n">deployment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prefect</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Deployment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">flow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">prefect</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">Flow</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Self</span>:</span></span>

                <label class="view-source-button" for="ECSTask.prepare_for_flow_run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.prepare_for_flow_run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.prepare_for_flow_run-603"><a href="#ECSTask.prepare_for_flow_run-603"><span class="linenos">603</span></a>    <span class="k">def</span> <span class="nf">prepare_for_flow_run</span><span class="p">(</span>
</span><span id="ECSTask.prepare_for_flow_run-604"><a href="#ECSTask.prepare_for_flow_run-604"><span class="linenos">604</span></a>        <span class="bp">self</span><span class="p">:</span> <span class="n">Self</span><span class="p">,</span>
</span><span id="ECSTask.prepare_for_flow_run-605"><a href="#ECSTask.prepare_for_flow_run-605"><span class="linenos">605</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
</span><span id="ECSTask.prepare_for_flow_run-606"><a href="#ECSTask.prepare_for_flow_run-606"><span class="linenos">606</span></a>        <span class="n">deployment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Deployment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask.prepare_for_flow_run-607"><a href="#ECSTask.prepare_for_flow_run-607"><span class="linenos">607</span></a>        <span class="n">flow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Flow&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSTask.prepare_for_flow_run-608"><a href="#ECSTask.prepare_for_flow_run-608"><span class="linenos">608</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-609"><a href="#ECSTask.prepare_for_flow_run-609"><span class="linenos">609</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.prepare_for_flow_run-610"><a href="#ECSTask.prepare_for_flow_run-610"><span class="linenos">610</span></a><span class="sd">        Return an copy of the block that is prepared to execute a flow run.</span>
</span><span id="ECSTask.prepare_for_flow_run-611"><a href="#ECSTask.prepare_for_flow_run-611"><span class="linenos">611</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.prepare_for_flow_run-612"><a href="#ECSTask.prepare_for_flow_run-612"><span class="linenos">612</span></a>        <span class="n">new_family</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask.prepare_for_flow_run-613"><a href="#ECSTask.prepare_for_flow_run-613"><span class="linenos">613</span></a>
</span><span id="ECSTask.prepare_for_flow_run-614"><a href="#ECSTask.prepare_for_flow_run-614"><span class="linenos">614</span></a>        <span class="c1"># Update the family if not specified elsewhere</span>
</span><span id="ECSTask.prepare_for_flow_run-615"><a href="#ECSTask.prepare_for_flow_run-615"><span class="linenos">615</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSTask.prepare_for_flow_run-616"><a href="#ECSTask.prepare_for_flow_run-616"><span class="linenos">616</span></a>            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">family</span>
</span><span id="ECSTask.prepare_for_flow_run-617"><a href="#ECSTask.prepare_for_flow_run-617"><span class="linenos">617</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span>
</span><span id="ECSTask.prepare_for_flow_run-618"><a href="#ECSTask.prepare_for_flow_run-618"><span class="linenos">618</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">))</span>
</span><span id="ECSTask.prepare_for_flow_run-619"><a href="#ECSTask.prepare_for_flow_run-619"><span class="linenos">619</span></a>        <span class="p">):</span>
</span><span id="ECSTask.prepare_for_flow_run-620"><a href="#ECSTask.prepare_for_flow_run-620"><span class="linenos">620</span></a>            <span class="k">if</span> <span class="n">flow</span> <span class="ow">and</span> <span class="n">deployment</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-621"><a href="#ECSTask.prepare_for_flow_run-621"><span class="linenos">621</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask.prepare_for_flow_run-622"><a href="#ECSTask.prepare_for_flow_run-622"><span class="linenos">622</span></a>            <span class="k">elif</span> <span class="n">flow</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">deployment</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-623"><a href="#ECSTask.prepare_for_flow_run-623"><span class="linenos">623</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__</span><span class="si">{</span><span class="n">flow</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask.prepare_for_flow_run-624"><a href="#ECSTask.prepare_for_flow_run-624"><span class="linenos">624</span></a>            <span class="k">elif</span> <span class="n">deployment</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">flow</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-625"><a href="#ECSTask.prepare_for_flow_run-625"><span class="linenos">625</span></a>                <span class="c1"># This is a weird case and should not be see in the wild</span>
</span><span id="ECSTask.prepare_for_flow_run-626"><a href="#ECSTask.prepare_for_flow_run-626"><span class="linenos">626</span></a>                <span class="n">new_family</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">__unknown-flow__</span><span class="si">{</span><span class="n">deployment</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSTask.prepare_for_flow_run-627"><a href="#ECSTask.prepare_for_flow_run-627"><span class="linenos">627</span></a>
</span><span id="ECSTask.prepare_for_flow_run-628"><a href="#ECSTask.prepare_for_flow_run-628"><span class="linenos">628</span></a>        <span class="n">new</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">prepare_for_flow_run</span><span class="p">(</span><span class="n">flow_run</span><span class="p">,</span> <span class="n">deployment</span><span class="o">=</span><span class="n">deployment</span><span class="p">,</span> <span class="n">flow</span><span class="o">=</span><span class="n">flow</span><span class="p">)</span>
</span><span id="ECSTask.prepare_for_flow_run-629"><a href="#ECSTask.prepare_for_flow_run-629"><span class="linenos">629</span></a>
</span><span id="ECSTask.prepare_for_flow_run-630"><a href="#ECSTask.prepare_for_flow_run-630"><span class="linenos">630</span></a>        <span class="k">if</span> <span class="n">new_family</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-631"><a href="#ECSTask.prepare_for_flow_run-631"><span class="linenos">631</span></a>            <span class="k">return</span> <span class="n">new</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">update</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;family&quot;</span><span class="p">:</span> <span class="n">new_family</span><span class="p">})</span>
</span><span id="ECSTask.prepare_for_flow_run-632"><a href="#ECSTask.prepare_for_flow_run-632"><span class="linenos">632</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.prepare_for_flow_run-633"><a href="#ECSTask.prepare_for_flow_run-633"><span class="linenos">633</span></a>            <span class="c1"># Avoid an extra copy if not needed</span>
</span><span id="ECSTask.prepare_for_flow_run-634"><a href="#ECSTask.prepare_for_flow_run-634"><span class="linenos">634</span></a>            <span class="k">return</span> <span class="n">new</span>
</span></pre></div>


            <div class="docstring"><p>Return an copy of the block that is prepared to execute a flow run.</p>
</div>


                            </div>
                            <div id="ECSTask.run" class="classattr">
                                        <input id="ECSTask.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">prefect_aws</span><span class="o">.</span><span class="n">ecs</span><span class="o">.</span><span class="n">ECSTaskResult</span>:</span></span>

                <label class="view-source-button" for="ECSTask.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.run-636"><a href="#ECSTask.run-636"><span class="linenos">636</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="ECSTask.run-637"><a href="#ECSTask.run-637"><span class="linenos">637</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ECSTaskResult</span><span class="p">:</span>
</span><span id="ECSTask.run-638"><a href="#ECSTask.run-638"><span class="linenos">638</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.run-639"><a href="#ECSTask.run-639"><span class="linenos">639</span></a><span class="sd">        Run the configured task on ECS.</span>
</span><span id="ECSTask.run-640"><a href="#ECSTask.run-640"><span class="linenos">640</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.run-641"><a href="#ECSTask.run-641"><span class="linenos">641</span></a>        <span class="n">boto_session</span><span class="p">,</span> <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask.run-642"><a href="#ECSTask.run-642"><span class="linenos">642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_session_and_client</span>
</span><span id="ECSTask.run-643"><a href="#ECSTask.run-643"><span class="linenos">643</span></a>        <span class="p">)</span>
</span><span id="ECSTask.run-644"><a href="#ECSTask.run-644"><span class="linenos">644</span></a>
</span><span id="ECSTask.run-645"><a href="#ECSTask.run-645"><span class="linenos">645</span></a>        <span class="p">(</span>
</span><span id="ECSTask.run-646"><a href="#ECSTask.run-646"><span class="linenos">646</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSTask.run-647"><a href="#ECSTask.run-647"><span class="linenos">647</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSTask.run-648"><a href="#ECSTask.run-648"><span class="linenos">648</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSTask.run-649"><a href="#ECSTask.run-649"><span class="linenos">649</span></a>            <span class="n">is_new_task_definition</span><span class="p">,</span>
</span><span id="ECSTask.run-650"><a href="#ECSTask.run-650"><span class="linenos">650</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask.run-651"><a href="#ECSTask.run-651"><span class="linenos">651</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span> <span class="n">boto_session</span><span class="p">,</span> <span class="n">ecs_client</span>
</span><span id="ECSTask.run-652"><a href="#ECSTask.run-652"><span class="linenos">652</span></a>        <span class="p">)</span>
</span><span id="ECSTask.run-653"><a href="#ECSTask.run-653"><span class="linenos">653</span></a>
</span><span id="ECSTask.run-654"><a href="#ECSTask.run-654"><span class="linenos">654</span></a>        <span class="c1"># Display a nice message indicating the command and image</span>
</span><span id="ECSTask.run-655"><a href="#ECSTask.run-655"><span class="linenos">655</span></a>        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="ow">or</span> <span class="n">get_prefect_container</span><span class="p">(</span>
</span><span id="ECSTask.run-656"><a href="#ECSTask.run-656"><span class="linenos">656</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span>
</span><span id="ECSTask.run-657"><a href="#ECSTask.run-657"><span class="linenos">657</span></a>        <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSTask.run-658"><a href="#ECSTask.run-658"><span class="linenos">658</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSTask.run-659"><a href="#ECSTask.run-659"><span class="linenos">659</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_log_prefix</span><span class="si">}</span><span class="s2">: Running command </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">command</span><span class="p">)</span><span class="si">!r}</span><span class="s2"> &quot;</span>
</span><span id="ECSTask.run-660"><a href="#ECSTask.run-660"><span class="linenos">660</span></a>            <span class="sa">f</span><span class="s2">&quot;in container </span><span class="si">{</span><span class="n">PREFECT_ECS_CONTAINER_NAME</span><span class="si">!r}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">image</span><span class="si">}</span><span class="s2">)...&quot;</span>
</span><span id="ECSTask.run-661"><a href="#ECSTask.run-661"><span class="linenos">661</span></a>        <span class="p">)</span>
</span><span id="ECSTask.run-662"><a href="#ECSTask.run-662"><span class="linenos">662</span></a>
</span><span id="ECSTask.run-663"><a href="#ECSTask.run-663"><span class="linenos">663</span></a>        <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
</span><span id="ECSTask.run-664"><a href="#ECSTask.run-664"><span class="linenos">664</span></a>        <span class="c1"># if set to preserve matching by name rather than arn</span>
</span><span id="ECSTask.run-665"><a href="#ECSTask.run-665"><span class="linenos">665</span></a>        <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
</span><span id="ECSTask.run-666"><a href="#ECSTask.run-666"><span class="linenos">666</span></a>        <span class="c1"># single colons.</span>
</span><span id="ECSTask.run-667"><a href="#ECSTask.run-667"><span class="linenos">667</span></a>        <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;::&quot;</span> <span class="o">+</span> <span class="n">task_arn</span>
</span><span id="ECSTask.run-668"><a href="#ECSTask.run-668"><span class="linenos">668</span></a>
</span><span id="ECSTask.run-669"><a href="#ECSTask.run-669"><span class="linenos">669</span></a>        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
</span><span id="ECSTask.run-670"><a href="#ECSTask.run-670"><span class="linenos">670</span></a>            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSTask.run-671"><a href="#ECSTask.run-671"><span class="linenos">671</span></a>
</span><span id="ECSTask.run-672"><a href="#ECSTask.run-672"><span class="linenos">672</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSTask.run-673"><a href="#ECSTask.run-673"><span class="linenos">673</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
</span><span id="ECSTask.run-674"><a href="#ECSTask.run-674"><span class="linenos">674</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSTask.run-675"><a href="#ECSTask.run-675"><span class="linenos">675</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSTask.run-676"><a href="#ECSTask.run-676"><span class="linenos">676</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSTask.run-677"><a href="#ECSTask.run-677"><span class="linenos">677</span></a>            <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
</span><span id="ECSTask.run-678"><a href="#ECSTask.run-678"><span class="linenos">678</span></a>            <span class="n">boto_session</span><span class="p">,</span>
</span><span id="ECSTask.run-679"><a href="#ECSTask.run-679"><span class="linenos">679</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSTask.run-680"><a href="#ECSTask.run-680"><span class="linenos">680</span></a>        <span class="p">)</span>
</span><span id="ECSTask.run-681"><a href="#ECSTask.run-681"><span class="linenos">681</span></a>
</span><span id="ECSTask.run-682"><a href="#ECSTask.run-682"><span class="linenos">682</span></a>        <span class="k">return</span> <span class="n">ECSTaskResult</span><span class="p">(</span>
</span><span id="ECSTask.run-683"><a href="#ECSTask.run-683"><span class="linenos">683</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="ECSTask.run-684"><a href="#ECSTask.run-684"><span class="linenos">684</span></a>            <span class="c1"># If the container does not start the exit code can be null but we must</span>
</span><span id="ECSTask.run-685"><a href="#ECSTask.run-685"><span class="linenos">685</span></a>            <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
</span><span id="ECSTask.run-686"><a href="#ECSTask.run-686"><span class="linenos">686</span></a>            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ECSTask.run-687"><a href="#ECSTask.run-687"><span class="linenos">687</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Run the configured task on ECS.</p>
</div>


                            </div>
                            <div id="ECSTask.kill" class="classattr">
                                        <input id="ECSTask.kill-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">kill</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span>, </span><span class="param"><span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ECSTask.kill-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.kill"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.kill-689"><a href="#ECSTask.kill-689"><span class="linenos">689</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="ECSTask.kill-690"><a href="#ECSTask.kill-690"><span class="linenos">690</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">identifier</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSTask.kill-691"><a href="#ECSTask.kill-691"><span class="linenos">691</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.kill-692"><a href="#ECSTask.kill-692"><span class="linenos">692</span></a><span class="sd">        Kill a task running on ECS.</span>
</span><span id="ECSTask.kill-693"><a href="#ECSTask.kill-693"><span class="linenos">693</span></a>
</span><span id="ECSTask.kill-694"><a href="#ECSTask.kill-694"><span class="linenos">694</span></a><span class="sd">        Args:</span>
</span><span id="ECSTask.kill-695"><a href="#ECSTask.kill-695"><span class="linenos">695</span></a><span class="sd">            identifier: A cluster and task arn combination. This should match a value</span>
</span><span id="ECSTask.kill-696"><a href="#ECSTask.kill-696"><span class="linenos">696</span></a><span class="sd">                yielded by `ECSTask.run`.</span>
</span><span id="ECSTask.kill-697"><a href="#ECSTask.kill-697"><span class="linenos">697</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.kill-698"><a href="#ECSTask.kill-698"><span class="linenos">698</span></a>        <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="ECSTask.kill-699"><a href="#ECSTask.kill-699"><span class="linenos">699</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask.kill-700"><a href="#ECSTask.kill-700"><span class="linenos">700</span></a>                <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
</span><span id="ECSTask.kill-701"><a href="#ECSTask.kill-701"><span class="linenos">701</span></a>                <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
</span><span id="ECSTask.kill-702"><a href="#ECSTask.kill-702"><span class="linenos">702</span></a>                <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSTask.kill-703"><a href="#ECSTask.kill-703"><span class="linenos">703</span></a>            <span class="p">)</span>
</span><span id="ECSTask.kill-704"><a href="#ECSTask.kill-704"><span class="linenos">704</span></a>        <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_task_identifier</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSTask.kill-705"><a href="#ECSTask.kill-705"><span class="linenos">705</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Kill a task running on ECS.</p>

<p>Args:
    identifier: A cluster and task arn combination. This should match a value
        yielded by <code><a href="#ECSTask.run">ECSTask.run</a></code>.</p>
</div>


                            </div>
                            <div id="ECSTask.get_corresponding_worker_type" class="classattr">
                                        <input id="ECSTask.get_corresponding_worker_type-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@staticmethod</div>

        <span class="def">def</span>
        <span class="name">get_corresponding_worker_type</span><span class="signature pdoc-code condensed">(<span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ECSTask.get_corresponding_worker_type-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.get_corresponding_worker_type"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.get_corresponding_worker_type-707"><a href="#ECSTask.get_corresponding_worker_type-707"><span class="linenos">707</span></a>    <span class="nd">@staticmethod</span>
</span><span id="ECSTask.get_corresponding_worker_type-708"><a href="#ECSTask.get_corresponding_worker_type-708"><span class="linenos">708</span></a>    <span class="k">def</span> <span class="nf">get_corresponding_worker_type</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask.get_corresponding_worker_type-709"><a href="#ECSTask.get_corresponding_worker_type-709"><span class="linenos">709</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the corresponding worker type for this infrastructure block.&quot;&quot;&quot;</span>
</span><span id="ECSTask.get_corresponding_worker_type-710"><a href="#ECSTask.get_corresponding_worker_type-710"><span class="linenos">710</span></a>        <span class="k">return</span> <span class="n">ECSWorker</span><span class="o">.</span><span class="n">type</span>
</span></pre></div>


            <div class="docstring"><p>Return the corresponding worker type for this infrastructure block.</p>
</div>


                            </div>
                            <div id="ECSTask.generate_work_pool_base_job_template" class="classattr">
                                        <input id="ECSTask.generate_work_pool_base_job_template-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">generate_work_pool_base_job_template</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="o">&lt;</span><span class="n">function</span> <span class="n"><a href="#ECSTask.dict">ECSTask.dict</a></span> <span class="n">at</span> <span class="mh">0x10a13a660</span><span class="o">&gt;</span>:</span></span>

                <label class="view-source-button" for="ECSTask.generate_work_pool_base_job_template-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.generate_work_pool_base_job_template"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.generate_work_pool_base_job_template-712"><a href="#ECSTask.generate_work_pool_base_job_template-712"><span class="linenos">712</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">generate_work_pool_base_job_template</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-713"><a href="#ECSTask.generate_work_pool_base_job_template-713"><span class="linenos">713</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-714"><a href="#ECSTask.generate_work_pool_base_job_template-714"><span class="linenos">714</span></a><span class="sd">        Generate a base job template for a cloud-run work pool with the same</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-715"><a href="#ECSTask.generate_work_pool_base_job_template-715"><span class="linenos">715</span></a><span class="sd">        configuration as this block.</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-716"><a href="#ECSTask.generate_work_pool_base_job_template-716"><span class="linenos">716</span></a>
</span><span id="ECSTask.generate_work_pool_base_job_template-717"><a href="#ECSTask.generate_work_pool_base_job_template-717"><span class="linenos">717</span></a><span class="sd">        Returns:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-718"><a href="#ECSTask.generate_work_pool_base_job_template-718"><span class="linenos">718</span></a><span class="sd">            - dict: a base job template for a cloud-run work pool</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-719"><a href="#ECSTask.generate_work_pool_base_job_template-719"><span class="linenos">719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-720"><a href="#ECSTask.generate_work_pool_base_job_template-720"><span class="linenos">720</span></a>        <span class="n">base_job_template</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ECSWorker</span><span class="o">.</span><span class="n">get_default_base_job_template</span><span class="p">())</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-721"><a href="#ECSTask.generate_work_pool_base_job_template-721"><span class="linenos">721</span></a>        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="n">exclude_unset</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exclude_defaults</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-722"><a href="#ECSTask.generate_work_pool_base_job_template-722"><span class="linenos">722</span></a>            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;command&quot;</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-723"><a href="#ECSTask.generate_work_pool_base_job_template-723"><span class="linenos">723</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;command&quot;</span><span class="p">][</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-724"><a href="#ECSTask.generate_work_pool_base_job_template-724"><span class="linenos">724</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-725"><a href="#ECSTask.generate_work_pool_base_job_template-725"><span class="linenos">725</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-726"><a href="#ECSTask.generate_work_pool_base_job_template-726"><span class="linenos">726</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-727"><a href="#ECSTask.generate_work_pool_base_job_template-727"><span class="linenos">727</span></a>                <span class="s2">&quot;type&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-728"><a href="#ECSTask.generate_work_pool_base_job_template-728"><span class="linenos">728</span></a>                <span class="s2">&quot;block_type_slug&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-729"><a href="#ECSTask.generate_work_pool_base_job_template-729"><span class="linenos">729</span></a>                <span class="s2">&quot;_block_document_id&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-730"><a href="#ECSTask.generate_work_pool_base_job_template-730"><span class="linenos">730</span></a>                <span class="s2">&quot;_block_document_name&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-731"><a href="#ECSTask.generate_work_pool_base_job_template-731"><span class="linenos">731</span></a>                <span class="s2">&quot;_is_anonymous&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-732"><a href="#ECSTask.generate_work_pool_base_job_template-732"><span class="linenos">732</span></a>                <span class="s2">&quot;task_customizations&quot;</span><span class="p">,</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-733"><a href="#ECSTask.generate_work_pool_base_job_template-733"><span class="linenos">733</span></a>            <span class="p">]:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-734"><a href="#ECSTask.generate_work_pool_base_job_template-734"><span class="linenos">734</span></a>                <span class="k">continue</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-735"><a href="#ECSTask.generate_work_pool_base_job_template-735"><span class="linenos">735</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;aws_credentials&quot;</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-736"><a href="#ECSTask.generate_work_pool_base_job_template-736"><span class="linenos">736</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">_block_document_id</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-737"><a href="#ECSTask.generate_work_pool_base_job_template-737"><span class="linenos">737</span></a>                    <span class="k">raise</span> <span class="n">BlockNotSavedError</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-738"><a href="#ECSTask.generate_work_pool_base_job_template-738"><span class="linenos">738</span></a>                        <span class="s2">&quot;It looks like you are trying to use a block that&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-739"><a href="#ECSTask.generate_work_pool_base_job_template-739"><span class="linenos">739</span></a>                        <span class="s2">&quot; has not been saved. Please call `.save` on your block&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-740"><a href="#ECSTask.generate_work_pool_base_job_template-740"><span class="linenos">740</span></a>                        <span class="s2">&quot; before publishing it as a work pool.&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-741"><a href="#ECSTask.generate_work_pool_base_job_template-741"><span class="linenos">741</span></a>                    <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-742"><a href="#ECSTask.generate_work_pool_base_job_template-742"><span class="linenos">742</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;aws_credentials&quot;</span><span class="p">][</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-743"><a href="#ECSTask.generate_work_pool_base_job_template-743"><span class="linenos">743</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-744"><a href="#ECSTask.generate_work_pool_base_job_template-744"><span class="linenos">744</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-745"><a href="#ECSTask.generate_work_pool_base_job_template-745"><span class="linenos">745</span></a>                    <span class="s2">&quot;$ref&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-746"><a href="#ECSTask.generate_work_pool_base_job_template-746"><span class="linenos">746</span></a>                        <span class="s2">&quot;block_document_id&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-747"><a href="#ECSTask.generate_work_pool_base_job_template-747"><span class="linenos">747</span></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">_block_document_id</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-748"><a href="#ECSTask.generate_work_pool_base_job_template-748"><span class="linenos">748</span></a>                        <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-749"><a href="#ECSTask.generate_work_pool_base_job_template-749"><span class="linenos">749</span></a>                    <span class="p">}</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-750"><a href="#ECSTask.generate_work_pool_base_job_template-750"><span class="linenos">750</span></a>                <span class="p">}</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-751"><a href="#ECSTask.generate_work_pool_base_job_template-751"><span class="linenos">751</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s2">&quot;task_definition&quot;</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-752"><a href="#ECSTask.generate_work_pool_base_job_template-752"><span class="linenos">752</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span><span class="s2">&quot;task_definition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-753"><a href="#ECSTask.generate_work_pool_base_job_template-753"><span class="linenos">753</span></a>            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">]:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-754"><a href="#ECSTask.generate_work_pool_base_job_template-754"><span class="linenos">754</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;default&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-755"><a href="#ECSTask.generate_work_pool_base_job_template-755"><span class="linenos">755</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-756"><a href="#ECSTask.generate_work_pool_base_job_template-756"><span class="linenos">756</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-757"><a href="#ECSTask.generate_work_pool_base_job_template-757"><span class="linenos">757</span></a>                    <span class="sa">f</span><span class="s2">&quot;Variable </span><span class="si">{</span><span class="n">key</span><span class="si">!r}</span><span class="s2"> is not supported by Cloud Run work pools.&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-758"><a href="#ECSTask.generate_work_pool_base_job_template-758"><span class="linenos">758</span></a>                    <span class="s2">&quot; Skipping.&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-759"><a href="#ECSTask.generate_work_pool_base_job_template-759"><span class="linenos">759</span></a>                <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-760"><a href="#ECSTask.generate_work_pool_base_job_template-760"><span class="linenos">760</span></a>
</span><span id="ECSTask.generate_work_pool_base_job_template-761"><a href="#ECSTask.generate_work_pool_base_job_template-761"><span class="linenos">761</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-762"><a href="#ECSTask.generate_work_pool_base_job_template-762"><span class="linenos">762</span></a>            <span class="n">network_config_patches</span> <span class="o">=</span> <span class="n">JsonPatch</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-763"><a href="#ECSTask.generate_work_pool_base_job_template-763"><span class="linenos">763</span></a>                <span class="p">[</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-764"><a href="#ECSTask.generate_work_pool_base_job_template-764"><span class="linenos">764</span></a>                    <span class="n">patch</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-765"><a href="#ECSTask.generate_work_pool_base_job_template-765"><span class="linenos">765</span></a>                    <span class="k">for</span> <span class="n">patch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-766"><a href="#ECSTask.generate_work_pool_base_job_template-766"><span class="linenos">766</span></a>                    <span class="k">if</span> <span class="s2">&quot;networkConfiguration&quot;</span> <span class="ow">in</span> <span class="n">patch</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-767"><a href="#ECSTask.generate_work_pool_base_job_template-767"><span class="linenos">767</span></a>                <span class="p">]</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-768"><a href="#ECSTask.generate_work_pool_base_job_template-768"><span class="linenos">768</span></a>            <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-769"><a href="#ECSTask.generate_work_pool_base_job_template-769"><span class="linenos">769</span></a>            <span class="n">minimal_network_config</span> <span class="o">=</span> <span class="n">assemble_document_for_patches</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-770"><a href="#ECSTask.generate_work_pool_base_job_template-770"><span class="linenos">770</span></a>                <span class="n">network_config_patches</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-771"><a href="#ECSTask.generate_work_pool_base_job_template-771"><span class="linenos">771</span></a>            <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-772"><a href="#ECSTask.generate_work_pool_base_job_template-772"><span class="linenos">772</span></a>            <span class="k">if</span> <span class="n">minimal_network_config</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-773"><a href="#ECSTask.generate_work_pool_base_job_template-773"><span class="linenos">773</span></a>                <span class="n">minimal_network_config_with_patches</span> <span class="o">=</span> <span class="n">network_config_patches</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-774"><a href="#ECSTask.generate_work_pool_base_job_template-774"><span class="linenos">774</span></a>                    <span class="n">minimal_network_config</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-775"><a href="#ECSTask.generate_work_pool_base_job_template-775"><span class="linenos">775</span></a>                <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-776"><a href="#ECSTask.generate_work_pool_base_job_template-776"><span class="linenos">776</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;variables&quot;</span><span class="p">][</span><span class="s2">&quot;properties&quot;</span><span class="p">][</span><span class="s2">&quot;network_configuration&quot;</span><span class="p">][</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-777"><a href="#ECSTask.generate_work_pool_base_job_template-777"><span class="linenos">777</span></a>                    <span class="s2">&quot;default&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-778"><a href="#ECSTask.generate_work_pool_base_job_template-778"><span class="linenos">778</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="n">minimal_network_config_with_patches</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-779"><a href="#ECSTask.generate_work_pool_base_job_template-779"><span class="linenos">779</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-780"><a href="#ECSTask.generate_work_pool_base_job_template-780"><span class="linenos">780</span></a>                <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-781"><a href="#ECSTask.generate_work_pool_base_job_template-781"><span class="linenos">781</span></a>                    <span class="s2">&quot;task_run_request&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-782"><a href="#ECSTask.generate_work_pool_base_job_template-782"><span class="linenos">782</span></a>                <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_customizations</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-783"><a href="#ECSTask.generate_work_pool_base_job_template-783"><span class="linenos">783</span></a>                    <span class="n">base_job_template</span><span class="p">[</span><span class="s2">&quot;job_configuration&quot;</span><span class="p">][</span><span class="s2">&quot;task_run_request&quot;</span><span class="p">]</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-784"><a href="#ECSTask.generate_work_pool_base_job_template-784"><span class="linenos">784</span></a>                <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-785"><a href="#ECSTask.generate_work_pool_base_job_template-785"><span class="linenos">785</span></a>            <span class="k">except</span> <span class="n">JsonPointerException</span><span class="p">:</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-786"><a href="#ECSTask.generate_work_pool_base_job_template-786"><span class="linenos">786</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-787"><a href="#ECSTask.generate_work_pool_base_job_template-787"><span class="linenos">787</span></a>                    <span class="s2">&quot;Unable to apply task customizations to the base job template.&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-788"><a href="#ECSTask.generate_work_pool_base_job_template-788"><span class="linenos">788</span></a>                    <span class="s2">&quot;You may need to update the template manually.&quot;</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-789"><a href="#ECSTask.generate_work_pool_base_job_template-789"><span class="linenos">789</span></a>                <span class="p">)</span>
</span><span id="ECSTask.generate_work_pool_base_job_template-790"><a href="#ECSTask.generate_work_pool_base_job_template-790"><span class="linenos">790</span></a>
</span><span id="ECSTask.generate_work_pool_base_job_template-791"><a href="#ECSTask.generate_work_pool_base_job_template-791"><span class="linenos">791</span></a>        <span class="k">return</span> <span class="n">base_job_template</span>
</span></pre></div>


            <div class="docstring"><p>Generate a base job template for a cloud-run work pool with the same
configuration as this block.</p>

<p>Returns:
    - dict: a base job template for a cloud-run work pool</p>
</div>


                            </div>
                            <div id="ECSTask.preview" class="classattr">
                                        <input id="ECSTask.preview-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">preview</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="ECSTask.preview-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.preview"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.preview-1025"><a href="#ECSTask.preview-1025"><span class="linenos">1025</span></a>    <span class="k">def</span> <span class="nf">preview</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSTask.preview-1026"><a href="#ECSTask.preview-1026"><span class="linenos">1026</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSTask.preview-1027"><a href="#ECSTask.preview-1027"><span class="linenos">1027</span></a><span class="sd">        Generate a preview of the task definition and task run that will be sent to AWS.</span>
</span><span id="ECSTask.preview-1028"><a href="#ECSTask.preview-1028"><span class="linenos">1028</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSTask.preview-1029"><a href="#ECSTask.preview-1029"><span class="linenos">1029</span></a>        <span class="n">preview</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="ECSTask.preview-1030"><a href="#ECSTask.preview-1030"><span class="linenos">1030</span></a>
</span><span id="ECSTask.preview-1031"><a href="#ECSTask.preview-1031"><span class="linenos">1031</span></a>        <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span> <span class="ow">or</span> <span class="s2">&quot;&lt;registered at runtime&gt;&quot;</span>
</span><span id="ECSTask.preview-1032"><a href="#ECSTask.preview-1032"><span class="linenos">1032</span></a>
</span><span id="ECSTask.preview-1033"><a href="#ECSTask.preview-1033"><span class="linenos">1033</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSTask.preview-1034"><a href="#ECSTask.preview-1034"><span class="linenos">1034</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_definition</span><span class="p">(</span>
</span><span id="ECSTask.preview-1035"><a href="#ECSTask.preview-1035"><span class="linenos">1035</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">task_definition</span> <span class="ow">or</span> <span class="p">{},</span>
</span><span id="ECSTask.preview-1036"><a href="#ECSTask.preview-1036"><span class="linenos">1036</span></a>                <span class="n">region</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">region_name</span>
</span><span id="ECSTask.preview-1037"><a href="#ECSTask.preview-1037"><span class="linenos">1037</span></a>                <span class="ow">or</span> <span class="s2">&quot;&lt;loaded from client at runtime&gt;&quot;</span><span class="p">,</span>
</span><span id="ECSTask.preview-1038"><a href="#ECSTask.preview-1038"><span class="linenos">1038</span></a>            <span class="p">)</span>
</span><span id="ECSTask.preview-1039"><a href="#ECSTask.preview-1039"><span class="linenos">1039</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2"># Task definition</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask.preview-1040"><a href="#ECSTask.preview-1040"><span class="linenos">1040</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSTask.preview-1041"><a href="#ECSTask.preview-1041"><span class="linenos">1041</span></a>            <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask.preview-1042"><a href="#ECSTask.preview-1042"><span class="linenos">1042</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.preview-1043"><a href="#ECSTask.preview-1043"><span class="linenos">1043</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask.preview-1044"><a href="#ECSTask.preview-1044"><span class="linenos">1044</span></a>
</span><span id="ECSTask.preview-1045"><a href="#ECSTask.preview-1045"><span class="linenos">1045</span></a>        <span class="k">if</span> <span class="n">task_definition</span> <span class="ow">and</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
</span><span id="ECSTask.preview-1046"><a href="#ECSTask.preview-1046"><span class="linenos">1046</span></a>            <span class="n">vpc</span> <span class="o">=</span> <span class="s2">&quot;the default VPC&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">vpc_id</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">vpc_id</span>
</span><span id="ECSTask.preview-1047"><a href="#ECSTask.preview-1047"><span class="linenos">1047</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSTask.preview-1048"><a href="#ECSTask.preview-1048"><span class="linenos">1048</span></a>                <span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSTask.preview-1049"><a href="#ECSTask.preview-1049"><span class="linenos">1049</span></a>                    <span class="s2">&quot;subnets&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;&lt;loaded from </span><span class="si">{</span><span class="n">vpc</span><span class="si">}</span><span class="s2"> at runtime&gt;&quot;</span><span class="p">,</span>
</span><span id="ECSTask.preview-1050"><a href="#ECSTask.preview-1050"><span class="linenos">1050</span></a>                    <span class="s2">&quot;assignPublicIp&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
</span><span id="ECSTask.preview-1051"><a href="#ECSTask.preview-1051"><span class="linenos">1051</span></a>                <span class="p">}</span>
</span><span id="ECSTask.preview-1052"><a href="#ECSTask.preview-1052"><span class="linenos">1052</span></a>            <span class="p">}</span>
</span><span id="ECSTask.preview-1053"><a href="#ECSTask.preview-1053"><span class="linenos">1053</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSTask.preview-1054"><a href="#ECSTask.preview-1054"><span class="linenos">1054</span></a>            <span class="n">network_config</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSTask.preview-1055"><a href="#ECSTask.preview-1055"><span class="linenos">1055</span></a>
</span><span id="ECSTask.preview-1056"><a href="#ECSTask.preview-1056"><span class="linenos">1056</span></a>        <span class="n">task_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run</span><span class="p">(</span><span class="n">network_config</span><span class="p">,</span> <span class="n">task_definition_arn</span><span class="p">)</span>
</span><span id="ECSTask.preview-1057"><a href="#ECSTask.preview-1057"><span class="linenos">1057</span></a>        <span class="n">preview</span> <span class="o">+=</span> <span class="s2">&quot;---</span><span class="se">\n</span><span class="s2"># Task run request</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="ECSTask.preview-1058"><a href="#ECSTask.preview-1058"><span class="linenos">1058</span></a>        <span class="n">preview</span> <span class="o">+=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">task_run</span><span class="p">)</span>
</span><span id="ECSTask.preview-1059"><a href="#ECSTask.preview-1059"><span class="linenos">1059</span></a>
</span><span id="ECSTask.preview-1060"><a href="#ECSTask.preview-1060"><span class="linenos">1060</span></a>        <span class="k">return</span> <span class="n">preview</span>
</span></pre></div>


            <div class="docstring"><p>Generate a preview of the task definition and task run that will be sent to AWS.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.infrastructure.base.Infrastructure</dt>
                                <dd id="ECSTask.labels" class="variable">labels</dd>
                <dd id="ECSTask.name" class="variable">name</dd>
                <dd id="ECSTask.command" class="variable">command</dd>
                <dd id="ECSTask.publish_as_work_pool" class="function">publish_as_work_pool</dd>
                <dd id="ECSTask.logger" class="variable">logger</dd>
                <dd id="ECSTask.is_using_a_runner" class="variable">is_using_a_runner</dd>

            </div>
            <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="ECSTask.block_initialization" class="function">block_initialization</dd>
                <dd id="ECSTask.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="ECSTask.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="ECSTask.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="ECSTask.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="ECSTask.get_description" class="function">get_description</dd>
                <dd id="ECSTask.get_code_example" class="function">get_code_example</dd>
                <dd id="ECSTask.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="ECSTask.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="ECSTask.load" class="function">load</dd>
                <dd id="ECSTask.is_block_class" class="function">is_block_class</dd>
                <dd id="ECSTask.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="ECSTask.save" class="function">save</dd>
                <dd id="ECSTask.delete" class="function">delete</dd>
                <dd id="ECSTask.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="ECSTask.json" class="function">json</dd>
                <dd id="ECSTask.copy" class="function">copy</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="ECSTask.parse_obj" class="function">parse_obj</dd>
                <dd id="ECSTask.parse_raw" class="function">parse_raw</dd>
                <dd id="ECSTask.parse_file" class="function">parse_file</dd>
                <dd id="ECSTask.from_orm" class="function">from_orm</dd>
                <dd id="ECSTask.construct" class="function">construct</dd>
                <dd id="ECSTask.schema" class="function">schema</dd>
                <dd id="ECSTask.schema_json" class="function">schema_json</dd>
                <dd id="ECSTask.validate" class="function">validate</dd>
                <dd id="ECSTask.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ECSTask.Config">
                            <input id="ECSTask.Config-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ECSTask.Config</span>:

                <label class="view-source-button" for="ECSTask.Config-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSTask.Config"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSTask.Config-587"><a href="#ECSTask.Config-587"><span class="linenos">587</span></a>    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
</span><span id="ECSTask.Config-588"><a href="#ECSTask.Config-588"><span class="linenos">588</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Configuration of pydantic.&quot;&quot;&quot;</span>
</span><span id="ECSTask.Config-589"><a href="#ECSTask.Config-589"><span class="linenos">589</span></a>
</span><span id="ECSTask.Config-590"><a href="#ECSTask.Config-590"><span class="linenos">590</span></a>        <span class="c1"># Support serialization of the &#39;JsonPatch&#39; type</span>
</span><span id="ECSTask.Config-591"><a href="#ECSTask.Config-591"><span class="linenos">591</span></a>        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSTask.Config-592"><a href="#ECSTask.Config-592"><span class="linenos">592</span></a>        <span class="n">json_encoders</span> <span class="o">=</span> <span class="p">{</span><span class="n">JsonPatch</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">patch</span><span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Configuration of pydantic.</p>
</div>


                            <div id="ECSTask.Config.arbitrary_types_allowed" class="classattr">
                                <div class="attr variable">
            <span class="name">arbitrary_types_allowed</span>        =
<span class="default_value">True</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.Config.arbitrary_types_allowed"></a>
    
    

                            </div>
                            <div id="ECSTask.Config.json_encoders" class="classattr">
                                <div class="attr variable">
            <span class="name">json_encoders</span>        =
<span class="default_value">{&lt;class &#39;prefect.utilities.pydantic.JsonPatch&#39;&gt;: &lt;function <a href="#ECSTask.Config">ECSTask.Config</a>.&lt;lambda&gt;&gt;}</span>

        
    </div>
    <a class="headerlink" href="#ECSTask.Config.json_encoders"></a>
    
    

                            </div>
                </section>
                <section id="AwsSecret">
                            <input id="AwsSecret-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AwsSecret</span><wbr>(<span class="base">prefect.blocks.abstract.SecretBlock</span>):

                <label class="view-source-button" for="AwsSecret-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsSecret"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsSecret-365"><a href="#AwsSecret-365"><span class="linenos">365</span></a><span class="k">class</span> <span class="nc">AwsSecret</span><span class="p">(</span><span class="n">SecretBlock</span><span class="p">):</span>
</span><span id="AwsSecret-366"><a href="#AwsSecret-366"><span class="linenos">366</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret-367"><a href="#AwsSecret-367"><span class="linenos">367</span></a><span class="sd">    Manages a secret in AWS&#39;s Secrets Manager.</span>
</span><span id="AwsSecret-368"><a href="#AwsSecret-368"><span class="linenos">368</span></a>
</span><span id="AwsSecret-369"><a href="#AwsSecret-369"><span class="linenos">369</span></a><span class="sd">    Attributes:</span>
</span><span id="AwsSecret-370"><a href="#AwsSecret-370"><span class="linenos">370</span></a><span class="sd">        aws_credentials: The credentials to use for authentication with AWS.</span>
</span><span id="AwsSecret-371"><a href="#AwsSecret-371"><span class="linenos">371</span></a><span class="sd">        secret_name: The name of the secret.</span>
</span><span id="AwsSecret-372"><a href="#AwsSecret-372"><span class="linenos">372</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AwsSecret-373"><a href="#AwsSecret-373"><span class="linenos">373</span></a>
</span><span id="AwsSecret-374"><a href="#AwsSecret-374"><span class="linenos">374</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="AwsSecret-375"><a href="#AwsSecret-375"><span class="linenos">375</span></a>    <span class="n">_block_type_name</span> <span class="o">=</span> <span class="s2">&quot;AWS Secret&quot;</span>
</span><span id="AwsSecret-376"><a href="#AwsSecret-376"><span class="linenos">376</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/secrets_manager/#prefect_aws.secrets_manager.AwsSecret&quot;</span>  <span class="c1"># noqa</span>
</span><span id="AwsSecret-377"><a href="#AwsSecret-377"><span class="linenos">377</span></a>
</span><span id="AwsSecret-378"><a href="#AwsSecret-378"><span class="linenos">378</span></a>    <span class="n">aws_credentials</span><span class="p">:</span> <span class="n">AwsCredentials</span>
</span><span id="AwsSecret-379"><a href="#AwsSecret-379"><span class="linenos">379</span></a>    <span class="n">secret_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The name of the secret.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret-380"><a href="#AwsSecret-380"><span class="linenos">380</span></a>
</span><span id="AwsSecret-381"><a href="#AwsSecret-381"><span class="linenos">381</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret-382"><a href="#AwsSecret-382"><span class="linenos">382</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">read_secret</span><span class="p">(</span>
</span><span id="AwsSecret-383"><a href="#AwsSecret-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AwsSecret-384"><a href="#AwsSecret-384"><span class="linenos">384</span></a>        <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AwsSecret-385"><a href="#AwsSecret-385"><span class="linenos">385</span></a>        <span class="n">version_stage</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AwsSecret-386"><a href="#AwsSecret-386"><span class="linenos">386</span></a>        <span class="o">**</span><span class="n">read_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="AwsSecret-387"><a href="#AwsSecret-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="AwsSecret-388"><a href="#AwsSecret-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret-389"><a href="#AwsSecret-389"><span class="linenos">389</span></a><span class="sd">        Reads the secret from the secret storage service.</span>
</span><span id="AwsSecret-390"><a href="#AwsSecret-390"><span class="linenos">390</span></a>
</span><span id="AwsSecret-391"><a href="#AwsSecret-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret-392"><a href="#AwsSecret-392"><span class="linenos">392</span></a><span class="sd">            version_id: The version of the secret to read. If not provided, the latest</span>
</span><span id="AwsSecret-393"><a href="#AwsSecret-393"><span class="linenos">393</span></a><span class="sd">                version will be read.</span>
</span><span id="AwsSecret-394"><a href="#AwsSecret-394"><span class="linenos">394</span></a><span class="sd">            version_stage: The version stage of the secret to read. If not provided,</span>
</span><span id="AwsSecret-395"><a href="#AwsSecret-395"><span class="linenos">395</span></a><span class="sd">                the latest version will be read.</span>
</span><span id="AwsSecret-396"><a href="#AwsSecret-396"><span class="linenos">396</span></a><span class="sd">            read_kwargs: Additional keyword arguments to pass to the</span>
</span><span id="AwsSecret-397"><a href="#AwsSecret-397"><span class="linenos">397</span></a><span class="sd">                `get_secret_value` method of the boto3 client.</span>
</span><span id="AwsSecret-398"><a href="#AwsSecret-398"><span class="linenos">398</span></a>
</span><span id="AwsSecret-399"><a href="#AwsSecret-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret-400"><a href="#AwsSecret-400"><span class="linenos">400</span></a><span class="sd">            The secret data.</span>
</span><span id="AwsSecret-401"><a href="#AwsSecret-401"><span class="linenos">401</span></a>
</span><span id="AwsSecret-402"><a href="#AwsSecret-402"><span class="linenos">402</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret-403"><a href="#AwsSecret-403"><span class="linenos">403</span></a><span class="sd">            Reads a secret.</span>
</span><span id="AwsSecret-404"><a href="#AwsSecret-404"><span class="linenos">404</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret-405"><a href="#AwsSecret-405"><span class="linenos">405</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret-406"><a href="#AwsSecret-406"><span class="linenos">406</span></a><span class="sd">            secrets_manager.read_secret()</span>
</span><span id="AwsSecret-407"><a href="#AwsSecret-407"><span class="linenos">407</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret-408"><a href="#AwsSecret-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret-409"><a href="#AwsSecret-409"><span class="linenos">409</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret-410"><a href="#AwsSecret-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">version_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsSecret-411"><a href="#AwsSecret-411"><span class="linenos">411</span></a>            <span class="n">read_kwargs</span><span class="p">[</span><span class="s2">&quot;VersionId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_id</span>
</span><span id="AwsSecret-412"><a href="#AwsSecret-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">version_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsSecret-413"><a href="#AwsSecret-413"><span class="linenos">413</span></a>            <span class="n">read_kwargs</span><span class="p">[</span><span class="s2">&quot;VersionStage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_stage</span>
</span><span id="AwsSecret-414"><a href="#AwsSecret-414"><span class="linenos">414</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret-415"><a href="#AwsSecret-415"><span class="linenos">415</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">,</span> <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span> <span class="o">**</span><span class="n">read_kwargs</span>
</span><span id="AwsSecret-416"><a href="#AwsSecret-416"><span class="linenos">416</span></a>        <span class="p">)</span>
</span><span id="AwsSecret-417"><a href="#AwsSecret-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="s2">&quot;SecretBinary&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AwsSecret-418"><a href="#AwsSecret-418"><span class="linenos">418</span></a>            <span class="n">secret</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;SecretBinary&quot;</span><span class="p">]</span>
</span><span id="AwsSecret-419"><a href="#AwsSecret-419"><span class="linenos">419</span></a>        <span class="k">elif</span> <span class="s2">&quot;SecretString&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AwsSecret-420"><a href="#AwsSecret-420"><span class="linenos">420</span></a>            <span class="n">secret</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;SecretString&quot;</span><span class="p">]</span>
</span><span id="AwsSecret-421"><a href="#AwsSecret-421"><span class="linenos">421</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret-422"><a href="#AwsSecret-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="n">arn</span><span class="si">!r}</span><span class="s2"> data was successfully read.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret-423"><a href="#AwsSecret-423"><span class="linenos">423</span></a>        <span class="k">return</span> <span class="n">secret</span>
</span><span id="AwsSecret-424"><a href="#AwsSecret-424"><span class="linenos">424</span></a>
</span><span id="AwsSecret-425"><a href="#AwsSecret-425"><span class="linenos">425</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret-426"><a href="#AwsSecret-426"><span class="linenos">426</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">write_secret</span><span class="p">(</span>
</span><span id="AwsSecret-427"><a href="#AwsSecret-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">secret_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="AwsSecret-428"><a href="#AwsSecret-428"><span class="linenos">428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AwsSecret-429"><a href="#AwsSecret-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret-430"><a href="#AwsSecret-430"><span class="linenos">430</span></a><span class="sd">        Writes the secret to the secret storage service as a SecretBinary;</span>
</span><span id="AwsSecret-431"><a href="#AwsSecret-431"><span class="linenos">431</span></a><span class="sd">        if it doesn&#39;t exist, it will be created.</span>
</span><span id="AwsSecret-432"><a href="#AwsSecret-432"><span class="linenos">432</span></a>
</span><span id="AwsSecret-433"><a href="#AwsSecret-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret-434"><a href="#AwsSecret-434"><span class="linenos">434</span></a><span class="sd">            secret_data: The secret data to write.</span>
</span><span id="AwsSecret-435"><a href="#AwsSecret-435"><span class="linenos">435</span></a><span class="sd">            **put_or_create_secret_kwargs: Additional keyword arguments to pass to</span>
</span><span id="AwsSecret-436"><a href="#AwsSecret-436"><span class="linenos">436</span></a><span class="sd">                put_secret_value or create_secret method of the boto3 client.</span>
</span><span id="AwsSecret-437"><a href="#AwsSecret-437"><span class="linenos">437</span></a>
</span><span id="AwsSecret-438"><a href="#AwsSecret-438"><span class="linenos">438</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret-439"><a href="#AwsSecret-439"><span class="linenos">439</span></a><span class="sd">            The path that the secret was written to.</span>
</span><span id="AwsSecret-440"><a href="#AwsSecret-440"><span class="linenos">440</span></a>
</span><span id="AwsSecret-441"><a href="#AwsSecret-441"><span class="linenos">441</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret-442"><a href="#AwsSecret-442"><span class="linenos">442</span></a><span class="sd">            Write some secret data.</span>
</span><span id="AwsSecret-443"><a href="#AwsSecret-443"><span class="linenos">443</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret-444"><a href="#AwsSecret-444"><span class="linenos">444</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret-445"><a href="#AwsSecret-445"><span class="linenos">445</span></a><span class="sd">            secrets_manager.write_secret(b&quot;my_secret_data&quot;)</span>
</span><span id="AwsSecret-446"><a href="#AwsSecret-446"><span class="linenos">446</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret-447"><a href="#AwsSecret-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret-448"><a href="#AwsSecret-448"><span class="linenos">448</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret-449"><a href="#AwsSecret-449"><span class="linenos">449</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AwsSecret-450"><a href="#AwsSecret-450"><span class="linenos">450</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret-451"><a href="#AwsSecret-451"><span class="linenos">451</span></a>                <span class="n">client</span><span class="o">.</span><span class="n">put_secret_value</span><span class="p">,</span>
</span><span id="AwsSecret-452"><a href="#AwsSecret-452"><span class="linenos">452</span></a>                <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret-453"><a href="#AwsSecret-453"><span class="linenos">453</span></a>                <span class="n">SecretBinary</span><span class="o">=</span><span class="n">secret_data</span><span class="p">,</span>
</span><span id="AwsSecret-454"><a href="#AwsSecret-454"><span class="linenos">454</span></a>                <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret-455"><a href="#AwsSecret-455"><span class="linenos">455</span></a>            <span class="p">)</span>
</span><span id="AwsSecret-456"><a href="#AwsSecret-456"><span class="linenos">456</span></a>        <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ResourceNotFoundException</span><span class="p">:</span>
</span><span id="AwsSecret-457"><a href="#AwsSecret-457"><span class="linenos">457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AwsSecret-458"><a href="#AwsSecret-458"><span class="linenos">458</span></a>                <span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="si">!r}</span><span class="s2"> does not exist yet, creating it now.&quot;</span>
</span><span id="AwsSecret-459"><a href="#AwsSecret-459"><span class="linenos">459</span></a>            <span class="p">)</span>
</span><span id="AwsSecret-460"><a href="#AwsSecret-460"><span class="linenos">460</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret-461"><a href="#AwsSecret-461"><span class="linenos">461</span></a>                <span class="n">client</span><span class="o">.</span><span class="n">create_secret</span><span class="p">,</span>
</span><span id="AwsSecret-462"><a href="#AwsSecret-462"><span class="linenos">462</span></a>                <span class="n">Name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret-463"><a href="#AwsSecret-463"><span class="linenos">463</span></a>                <span class="n">SecretBinary</span><span class="o">=</span><span class="n">secret_data</span><span class="p">,</span>
</span><span id="AwsSecret-464"><a href="#AwsSecret-464"><span class="linenos">464</span></a>                <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret-465"><a href="#AwsSecret-465"><span class="linenos">465</span></a>            <span class="p">)</span>
</span><span id="AwsSecret-466"><a href="#AwsSecret-466"><span class="linenos">466</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret-467"><a href="#AwsSecret-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret data was written successfully to </span><span class="si">{</span><span class="n">arn</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret-468"><a href="#AwsSecret-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="n">arn</span>
</span><span id="AwsSecret-469"><a href="#AwsSecret-469"><span class="linenos">469</span></a>
</span><span id="AwsSecret-470"><a href="#AwsSecret-470"><span class="linenos">470</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret-471"><a href="#AwsSecret-471"><span class="linenos">471</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_secret</span><span class="p">(</span>
</span><span id="AwsSecret-472"><a href="#AwsSecret-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AwsSecret-473"><a href="#AwsSecret-473"><span class="linenos">473</span></a>        <span class="n">recovery_window_in_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="AwsSecret-474"><a href="#AwsSecret-474"><span class="linenos">474</span></a>        <span class="n">force_delete_without_recovery</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AwsSecret-475"><a href="#AwsSecret-475"><span class="linenos">475</span></a>        <span class="o">**</span><span class="n">delete_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="AwsSecret-476"><a href="#AwsSecret-476"><span class="linenos">476</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AwsSecret-477"><a href="#AwsSecret-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret-478"><a href="#AwsSecret-478"><span class="linenos">478</span></a><span class="sd">        Deletes the secret from the secret storage service.</span>
</span><span id="AwsSecret-479"><a href="#AwsSecret-479"><span class="linenos">479</span></a>
</span><span id="AwsSecret-480"><a href="#AwsSecret-480"><span class="linenos">480</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret-481"><a href="#AwsSecret-481"><span class="linenos">481</span></a><span class="sd">            recovery_window_in_days: The number of days to wait before permanently</span>
</span><span id="AwsSecret-482"><a href="#AwsSecret-482"><span class="linenos">482</span></a><span class="sd">                deleting the secret. Must be between 7 and 30 days.</span>
</span><span id="AwsSecret-483"><a href="#AwsSecret-483"><span class="linenos">483</span></a><span class="sd">            force_delete_without_recovery: If True, the secret will be deleted</span>
</span><span id="AwsSecret-484"><a href="#AwsSecret-484"><span class="linenos">484</span></a><span class="sd">                immediately without a recovery window.</span>
</span><span id="AwsSecret-485"><a href="#AwsSecret-485"><span class="linenos">485</span></a><span class="sd">            **delete_kwargs: Additional keyword arguments to pass to the</span>
</span><span id="AwsSecret-486"><a href="#AwsSecret-486"><span class="linenos">486</span></a><span class="sd">                delete_secret method of the boto3 client.</span>
</span><span id="AwsSecret-487"><a href="#AwsSecret-487"><span class="linenos">487</span></a>
</span><span id="AwsSecret-488"><a href="#AwsSecret-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret-489"><a href="#AwsSecret-489"><span class="linenos">489</span></a><span class="sd">            The path that the secret was deleted from.</span>
</span><span id="AwsSecret-490"><a href="#AwsSecret-490"><span class="linenos">490</span></a>
</span><span id="AwsSecret-491"><a href="#AwsSecret-491"><span class="linenos">491</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret-492"><a href="#AwsSecret-492"><span class="linenos">492</span></a><span class="sd">            Deletes the secret with a recovery window of 15 days.</span>
</span><span id="AwsSecret-493"><a href="#AwsSecret-493"><span class="linenos">493</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret-494"><a href="#AwsSecret-494"><span class="linenos">494</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret-495"><a href="#AwsSecret-495"><span class="linenos">495</span></a><span class="sd">            secrets_manager.delete_secret(recovery_window_in_days=15)</span>
</span><span id="AwsSecret-496"><a href="#AwsSecret-496"><span class="linenos">496</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret-497"><a href="#AwsSecret-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret-498"><a href="#AwsSecret-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">force_delete_without_recovery</span> <span class="ow">and</span> <span class="n">recovery_window_in_days</span><span class="p">:</span>
</span><span id="AwsSecret-499"><a href="#AwsSecret-499"><span class="linenos">499</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="AwsSecret-500"><a href="#AwsSecret-500"><span class="linenos">500</span></a>                <span class="s2">&quot;Cannot specify recovery window and force delete without recovery.&quot;</span>
</span><span id="AwsSecret-501"><a href="#AwsSecret-501"><span class="linenos">501</span></a>            <span class="p">)</span>
</span><span id="AwsSecret-502"><a href="#AwsSecret-502"><span class="linenos">502</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;=</span> <span class="n">recovery_window_in_days</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">):</span>
</span><span id="AwsSecret-503"><a href="#AwsSecret-503"><span class="linenos">503</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="AwsSecret-504"><a href="#AwsSecret-504"><span class="linenos">504</span></a>                <span class="s2">&quot;Recovery window must be between 7 and 30 days, got &quot;</span>
</span><span id="AwsSecret-505"><a href="#AwsSecret-505"><span class="linenos">505</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">recovery_window_in_days</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="AwsSecret-506"><a href="#AwsSecret-506"><span class="linenos">506</span></a>            <span class="p">)</span>
</span><span id="AwsSecret-507"><a href="#AwsSecret-507"><span class="linenos">507</span></a>
</span><span id="AwsSecret-508"><a href="#AwsSecret-508"><span class="linenos">508</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret-509"><a href="#AwsSecret-509"><span class="linenos">509</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret-510"><a href="#AwsSecret-510"><span class="linenos">510</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">,</span>
</span><span id="AwsSecret-511"><a href="#AwsSecret-511"><span class="linenos">511</span></a>            <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret-512"><a href="#AwsSecret-512"><span class="linenos">512</span></a>            <span class="n">RecoveryWindowInDays</span><span class="o">=</span><span class="n">recovery_window_in_days</span><span class="p">,</span>
</span><span id="AwsSecret-513"><a href="#AwsSecret-513"><span class="linenos">513</span></a>            <span class="n">ForceDeleteWithoutRecovery</span><span class="o">=</span><span class="n">force_delete_without_recovery</span><span class="p">,</span>
</span><span id="AwsSecret-514"><a href="#AwsSecret-514"><span class="linenos">514</span></a>            <span class="o">**</span><span class="n">delete_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret-515"><a href="#AwsSecret-515"><span class="linenos">515</span></a>        <span class="p">)</span>
</span><span id="AwsSecret-516"><a href="#AwsSecret-516"><span class="linenos">516</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret-517"><a href="#AwsSecret-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="n">arn</span><span class="si">}</span><span class="s2"> was deleted successfully.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret-518"><a href="#AwsSecret-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="n">arn</span>
</span></pre></div>


            <div class="docstring"><p>Manages a secret in AWS's Secrets Manager.</p>

<p>Attributes:
    aws_credentials: The credentials to use for authentication with AWS.
    secret_name: The name of the secret.</p>
</div>


                            <div id="AwsSecret.aws_credentials" class="classattr">
                                <div class="attr variable">
            <span class="name">aws_credentials</span><span class="annotation">: <a href="#AwsCredentials">AwsCredentials</a></span>

        
    </div>
    <a class="headerlink" href="#AwsSecret.aws_credentials"></a>
    
    

                            </div>
                            <div id="AwsSecret.secret_name" class="classattr">
                                <div class="attr variable">
            <span class="name">secret_name</span><span class="annotation">: str</span>

        
    </div>
    <a class="headerlink" href="#AwsSecret.secret_name"></a>
    
    

                            </div>
                            <div id="AwsSecret.read_secret" class="classattr">
                                        <input id="AwsSecret.read_secret-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">read_secret</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">version_stage</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">read_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">bytes</span>:</span></span>

                <label class="view-source-button" for="AwsSecret.read_secret-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsSecret.read_secret"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsSecret.read_secret-381"><a href="#AwsSecret.read_secret-381"><span class="linenos">381</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret.read_secret-382"><a href="#AwsSecret.read_secret-382"><span class="linenos">382</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">read_secret</span><span class="p">(</span>
</span><span id="AwsSecret.read_secret-383"><a href="#AwsSecret.read_secret-383"><span class="linenos">383</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AwsSecret.read_secret-384"><a href="#AwsSecret.read_secret-384"><span class="linenos">384</span></a>        <span class="n">version_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AwsSecret.read_secret-385"><a href="#AwsSecret.read_secret-385"><span class="linenos">385</span></a>        <span class="n">version_stage</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="AwsSecret.read_secret-386"><a href="#AwsSecret.read_secret-386"><span class="linenos">386</span></a>        <span class="o">**</span><span class="n">read_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="AwsSecret.read_secret-387"><a href="#AwsSecret.read_secret-387"><span class="linenos">387</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span id="AwsSecret.read_secret-388"><a href="#AwsSecret.read_secret-388"><span class="linenos">388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret.read_secret-389"><a href="#AwsSecret.read_secret-389"><span class="linenos">389</span></a><span class="sd">        Reads the secret from the secret storage service.</span>
</span><span id="AwsSecret.read_secret-390"><a href="#AwsSecret.read_secret-390"><span class="linenos">390</span></a>
</span><span id="AwsSecret.read_secret-391"><a href="#AwsSecret.read_secret-391"><span class="linenos">391</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret.read_secret-392"><a href="#AwsSecret.read_secret-392"><span class="linenos">392</span></a><span class="sd">            version_id: The version of the secret to read. If not provided, the latest</span>
</span><span id="AwsSecret.read_secret-393"><a href="#AwsSecret.read_secret-393"><span class="linenos">393</span></a><span class="sd">                version will be read.</span>
</span><span id="AwsSecret.read_secret-394"><a href="#AwsSecret.read_secret-394"><span class="linenos">394</span></a><span class="sd">            version_stage: The version stage of the secret to read. If not provided,</span>
</span><span id="AwsSecret.read_secret-395"><a href="#AwsSecret.read_secret-395"><span class="linenos">395</span></a><span class="sd">                the latest version will be read.</span>
</span><span id="AwsSecret.read_secret-396"><a href="#AwsSecret.read_secret-396"><span class="linenos">396</span></a><span class="sd">            read_kwargs: Additional keyword arguments to pass to the</span>
</span><span id="AwsSecret.read_secret-397"><a href="#AwsSecret.read_secret-397"><span class="linenos">397</span></a><span class="sd">                `get_secret_value` method of the boto3 client.</span>
</span><span id="AwsSecret.read_secret-398"><a href="#AwsSecret.read_secret-398"><span class="linenos">398</span></a>
</span><span id="AwsSecret.read_secret-399"><a href="#AwsSecret.read_secret-399"><span class="linenos">399</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret.read_secret-400"><a href="#AwsSecret.read_secret-400"><span class="linenos">400</span></a><span class="sd">            The secret data.</span>
</span><span id="AwsSecret.read_secret-401"><a href="#AwsSecret.read_secret-401"><span class="linenos">401</span></a>
</span><span id="AwsSecret.read_secret-402"><a href="#AwsSecret.read_secret-402"><span class="linenos">402</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret.read_secret-403"><a href="#AwsSecret.read_secret-403"><span class="linenos">403</span></a><span class="sd">            Reads a secret.</span>
</span><span id="AwsSecret.read_secret-404"><a href="#AwsSecret.read_secret-404"><span class="linenos">404</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret.read_secret-405"><a href="#AwsSecret.read_secret-405"><span class="linenos">405</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret.read_secret-406"><a href="#AwsSecret.read_secret-406"><span class="linenos">406</span></a><span class="sd">            secrets_manager.read_secret()</span>
</span><span id="AwsSecret.read_secret-407"><a href="#AwsSecret.read_secret-407"><span class="linenos">407</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret.read_secret-408"><a href="#AwsSecret.read_secret-408"><span class="linenos">408</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret.read_secret-409"><a href="#AwsSecret.read_secret-409"><span class="linenos">409</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret.read_secret-410"><a href="#AwsSecret.read_secret-410"><span class="linenos">410</span></a>        <span class="k">if</span> <span class="n">version_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsSecret.read_secret-411"><a href="#AwsSecret.read_secret-411"><span class="linenos">411</span></a>            <span class="n">read_kwargs</span><span class="p">[</span><span class="s2">&quot;VersionId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_id</span>
</span><span id="AwsSecret.read_secret-412"><a href="#AwsSecret.read_secret-412"><span class="linenos">412</span></a>        <span class="k">if</span> <span class="n">version_stage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AwsSecret.read_secret-413"><a href="#AwsSecret.read_secret-413"><span class="linenos">413</span></a>            <span class="n">read_kwargs</span><span class="p">[</span><span class="s2">&quot;VersionStage&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">version_stage</span>
</span><span id="AwsSecret.read_secret-414"><a href="#AwsSecret.read_secret-414"><span class="linenos">414</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret.read_secret-415"><a href="#AwsSecret.read_secret-415"><span class="linenos">415</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">get_secret_value</span><span class="p">,</span> <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span> <span class="o">**</span><span class="n">read_kwargs</span>
</span><span id="AwsSecret.read_secret-416"><a href="#AwsSecret.read_secret-416"><span class="linenos">416</span></a>        <span class="p">)</span>
</span><span id="AwsSecret.read_secret-417"><a href="#AwsSecret.read_secret-417"><span class="linenos">417</span></a>        <span class="k">if</span> <span class="s2">&quot;SecretBinary&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AwsSecret.read_secret-418"><a href="#AwsSecret.read_secret-418"><span class="linenos">418</span></a>            <span class="n">secret</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;SecretBinary&quot;</span><span class="p">]</span>
</span><span id="AwsSecret.read_secret-419"><a href="#AwsSecret.read_secret-419"><span class="linenos">419</span></a>        <span class="k">elif</span> <span class="s2">&quot;SecretString&quot;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
</span><span id="AwsSecret.read_secret-420"><a href="#AwsSecret.read_secret-420"><span class="linenos">420</span></a>            <span class="n">secret</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;SecretString&quot;</span><span class="p">]</span>
</span><span id="AwsSecret.read_secret-421"><a href="#AwsSecret.read_secret-421"><span class="linenos">421</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret.read_secret-422"><a href="#AwsSecret.read_secret-422"><span class="linenos">422</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="n">arn</span><span class="si">!r}</span><span class="s2"> data was successfully read.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret.read_secret-423"><a href="#AwsSecret.read_secret-423"><span class="linenos">423</span></a>        <span class="k">return</span> <span class="n">secret</span>
</span></pre></div>


            <div class="docstring"><p>Reads the secret from the secret storage service.</p>

<p>Args:
    version_id: The version of the secret to read. If not provided, the latest
        version will be read.
    version_stage: The version stage of the secret to read. If not provided,
        the latest version will be read.
    read_kwargs: Additional keyword arguments to pass to the
        <code>get_secret_value</code> method of the boto3 client.</p>

<p>Returns:
    The secret data.</p>

<p>Examples:
    Reads a secret.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="n">secrets_manager</span> <span class="o">=</span> <span class="n">SecretsManager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;MY_BLOCK&quot;</span><span class="p">)</span>
    <span class="n">secrets_manager</span><span class="o">.</span><span class="n">read_secret</span><span class="p">()</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="AwsSecret.write_secret" class="classattr">
                                        <input id="AwsSecret.write_secret-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">write_secret</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">secret_data</span><span class="p">:</span> <span class="nb">bytes</span>,</span><span class="param">	<span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AwsSecret.write_secret-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsSecret.write_secret"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsSecret.write_secret-425"><a href="#AwsSecret.write_secret-425"><span class="linenos">425</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret.write_secret-426"><a href="#AwsSecret.write_secret-426"><span class="linenos">426</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">write_secret</span><span class="p">(</span>
</span><span id="AwsSecret.write_secret-427"><a href="#AwsSecret.write_secret-427"><span class="linenos">427</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">secret_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>
</span><span id="AwsSecret.write_secret-428"><a href="#AwsSecret.write_secret-428"><span class="linenos">428</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AwsSecret.write_secret-429"><a href="#AwsSecret.write_secret-429"><span class="linenos">429</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret.write_secret-430"><a href="#AwsSecret.write_secret-430"><span class="linenos">430</span></a><span class="sd">        Writes the secret to the secret storage service as a SecretBinary;</span>
</span><span id="AwsSecret.write_secret-431"><a href="#AwsSecret.write_secret-431"><span class="linenos">431</span></a><span class="sd">        if it doesn&#39;t exist, it will be created.</span>
</span><span id="AwsSecret.write_secret-432"><a href="#AwsSecret.write_secret-432"><span class="linenos">432</span></a>
</span><span id="AwsSecret.write_secret-433"><a href="#AwsSecret.write_secret-433"><span class="linenos">433</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret.write_secret-434"><a href="#AwsSecret.write_secret-434"><span class="linenos">434</span></a><span class="sd">            secret_data: The secret data to write.</span>
</span><span id="AwsSecret.write_secret-435"><a href="#AwsSecret.write_secret-435"><span class="linenos">435</span></a><span class="sd">            **put_or_create_secret_kwargs: Additional keyword arguments to pass to</span>
</span><span id="AwsSecret.write_secret-436"><a href="#AwsSecret.write_secret-436"><span class="linenos">436</span></a><span class="sd">                put_secret_value or create_secret method of the boto3 client.</span>
</span><span id="AwsSecret.write_secret-437"><a href="#AwsSecret.write_secret-437"><span class="linenos">437</span></a>
</span><span id="AwsSecret.write_secret-438"><a href="#AwsSecret.write_secret-438"><span class="linenos">438</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret.write_secret-439"><a href="#AwsSecret.write_secret-439"><span class="linenos">439</span></a><span class="sd">            The path that the secret was written to.</span>
</span><span id="AwsSecret.write_secret-440"><a href="#AwsSecret.write_secret-440"><span class="linenos">440</span></a>
</span><span id="AwsSecret.write_secret-441"><a href="#AwsSecret.write_secret-441"><span class="linenos">441</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret.write_secret-442"><a href="#AwsSecret.write_secret-442"><span class="linenos">442</span></a><span class="sd">            Write some secret data.</span>
</span><span id="AwsSecret.write_secret-443"><a href="#AwsSecret.write_secret-443"><span class="linenos">443</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret.write_secret-444"><a href="#AwsSecret.write_secret-444"><span class="linenos">444</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret.write_secret-445"><a href="#AwsSecret.write_secret-445"><span class="linenos">445</span></a><span class="sd">            secrets_manager.write_secret(b&quot;my_secret_data&quot;)</span>
</span><span id="AwsSecret.write_secret-446"><a href="#AwsSecret.write_secret-446"><span class="linenos">446</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret.write_secret-447"><a href="#AwsSecret.write_secret-447"><span class="linenos">447</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret.write_secret-448"><a href="#AwsSecret.write_secret-448"><span class="linenos">448</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret.write_secret-449"><a href="#AwsSecret.write_secret-449"><span class="linenos">449</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="AwsSecret.write_secret-450"><a href="#AwsSecret.write_secret-450"><span class="linenos">450</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret.write_secret-451"><a href="#AwsSecret.write_secret-451"><span class="linenos">451</span></a>                <span class="n">client</span><span class="o">.</span><span class="n">put_secret_value</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-452"><a href="#AwsSecret.write_secret-452"><span class="linenos">452</span></a>                <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-453"><a href="#AwsSecret.write_secret-453"><span class="linenos">453</span></a>                <span class="n">SecretBinary</span><span class="o">=</span><span class="n">secret_data</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-454"><a href="#AwsSecret.write_secret-454"><span class="linenos">454</span></a>                <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-455"><a href="#AwsSecret.write_secret-455"><span class="linenos">455</span></a>            <span class="p">)</span>
</span><span id="AwsSecret.write_secret-456"><a href="#AwsSecret.write_secret-456"><span class="linenos">456</span></a>        <span class="k">except</span> <span class="n">client</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ResourceNotFoundException</span><span class="p">:</span>
</span><span id="AwsSecret.write_secret-457"><a href="#AwsSecret.write_secret-457"><span class="linenos">457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="AwsSecret.write_secret-458"><a href="#AwsSecret.write_secret-458"><span class="linenos">458</span></a>                <span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="si">!r}</span><span class="s2"> does not exist yet, creating it now.&quot;</span>
</span><span id="AwsSecret.write_secret-459"><a href="#AwsSecret.write_secret-459"><span class="linenos">459</span></a>            <span class="p">)</span>
</span><span id="AwsSecret.write_secret-460"><a href="#AwsSecret.write_secret-460"><span class="linenos">460</span></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret.write_secret-461"><a href="#AwsSecret.write_secret-461"><span class="linenos">461</span></a>                <span class="n">client</span><span class="o">.</span><span class="n">create_secret</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-462"><a href="#AwsSecret.write_secret-462"><span class="linenos">462</span></a>                <span class="n">Name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-463"><a href="#AwsSecret.write_secret-463"><span class="linenos">463</span></a>                <span class="n">SecretBinary</span><span class="o">=</span><span class="n">secret_data</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-464"><a href="#AwsSecret.write_secret-464"><span class="linenos">464</span></a>                <span class="o">**</span><span class="n">put_or_create_secret_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret.write_secret-465"><a href="#AwsSecret.write_secret-465"><span class="linenos">465</span></a>            <span class="p">)</span>
</span><span id="AwsSecret.write_secret-466"><a href="#AwsSecret.write_secret-466"><span class="linenos">466</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret.write_secret-467"><a href="#AwsSecret.write_secret-467"><span class="linenos">467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret data was written successfully to </span><span class="si">{</span><span class="n">arn</span><span class="si">!r}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret.write_secret-468"><a href="#AwsSecret.write_secret-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="n">arn</span>
</span></pre></div>


            <div class="docstring"><p>Writes the secret to the secret storage service as a SecretBinary;
if it doesn't exist, it will be created.</p>

<p>Args:
    secret_data: The secret data to write.
    **put_or_create_secret_kwargs: Additional keyword arguments to pass to
        put_secret_value or create_secret method of the boto3 client.</p>

<p>Returns:
    The path that the secret was written to.</p>

<p>Examples:
    Write some secret data.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="n">secrets_manager</span> <span class="o">=</span> <span class="n">SecretsManager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;MY_BLOCK&quot;</span><span class="p">)</span>
    <span class="n">secrets_manager</span><span class="o">.</span><span class="n">write_secret</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;my_secret_data&quot;</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div id="AwsSecret.delete_secret" class="classattr">
                                        <input id="AwsSecret.delete_secret-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@sync_compatible</div>

        <span class="def">async def</span>
        <span class="name">delete_secret</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">recovery_window_in_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>,</span><span class="param">	<span class="n">force_delete_without_recovery</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">delete_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="nb">str</span>:</span></span>

                <label class="view-source-button" for="AwsSecret.delete_secret-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AwsSecret.delete_secret"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AwsSecret.delete_secret-470"><a href="#AwsSecret.delete_secret-470"><span class="linenos">470</span></a>    <span class="nd">@sync_compatible</span>
</span><span id="AwsSecret.delete_secret-471"><a href="#AwsSecret.delete_secret-471"><span class="linenos">471</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">delete_secret</span><span class="p">(</span>
</span><span id="AwsSecret.delete_secret-472"><a href="#AwsSecret.delete_secret-472"><span class="linenos">472</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-473"><a href="#AwsSecret.delete_secret-473"><span class="linenos">473</span></a>        <span class="n">recovery_window_in_days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-474"><a href="#AwsSecret.delete_secret-474"><span class="linenos">474</span></a>        <span class="n">force_delete_without_recovery</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-475"><a href="#AwsSecret.delete_secret-475"><span class="linenos">475</span></a>        <span class="o">**</span><span class="n">delete_kwargs</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
</span><span id="AwsSecret.delete_secret-476"><a href="#AwsSecret.delete_secret-476"><span class="linenos">476</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="AwsSecret.delete_secret-477"><a href="#AwsSecret.delete_secret-477"><span class="linenos">477</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AwsSecret.delete_secret-478"><a href="#AwsSecret.delete_secret-478"><span class="linenos">478</span></a><span class="sd">        Deletes the secret from the secret storage service.</span>
</span><span id="AwsSecret.delete_secret-479"><a href="#AwsSecret.delete_secret-479"><span class="linenos">479</span></a>
</span><span id="AwsSecret.delete_secret-480"><a href="#AwsSecret.delete_secret-480"><span class="linenos">480</span></a><span class="sd">        Args:</span>
</span><span id="AwsSecret.delete_secret-481"><a href="#AwsSecret.delete_secret-481"><span class="linenos">481</span></a><span class="sd">            recovery_window_in_days: The number of days to wait before permanently</span>
</span><span id="AwsSecret.delete_secret-482"><a href="#AwsSecret.delete_secret-482"><span class="linenos">482</span></a><span class="sd">                deleting the secret. Must be between 7 and 30 days.</span>
</span><span id="AwsSecret.delete_secret-483"><a href="#AwsSecret.delete_secret-483"><span class="linenos">483</span></a><span class="sd">            force_delete_without_recovery: If True, the secret will be deleted</span>
</span><span id="AwsSecret.delete_secret-484"><a href="#AwsSecret.delete_secret-484"><span class="linenos">484</span></a><span class="sd">                immediately without a recovery window.</span>
</span><span id="AwsSecret.delete_secret-485"><a href="#AwsSecret.delete_secret-485"><span class="linenos">485</span></a><span class="sd">            **delete_kwargs: Additional keyword arguments to pass to the</span>
</span><span id="AwsSecret.delete_secret-486"><a href="#AwsSecret.delete_secret-486"><span class="linenos">486</span></a><span class="sd">                delete_secret method of the boto3 client.</span>
</span><span id="AwsSecret.delete_secret-487"><a href="#AwsSecret.delete_secret-487"><span class="linenos">487</span></a>
</span><span id="AwsSecret.delete_secret-488"><a href="#AwsSecret.delete_secret-488"><span class="linenos">488</span></a><span class="sd">        Returns:</span>
</span><span id="AwsSecret.delete_secret-489"><a href="#AwsSecret.delete_secret-489"><span class="linenos">489</span></a><span class="sd">            The path that the secret was deleted from.</span>
</span><span id="AwsSecret.delete_secret-490"><a href="#AwsSecret.delete_secret-490"><span class="linenos">490</span></a>
</span><span id="AwsSecret.delete_secret-491"><a href="#AwsSecret.delete_secret-491"><span class="linenos">491</span></a><span class="sd">        Examples:</span>
</span><span id="AwsSecret.delete_secret-492"><a href="#AwsSecret.delete_secret-492"><span class="linenos">492</span></a><span class="sd">            Deletes the secret with a recovery window of 15 days.</span>
</span><span id="AwsSecret.delete_secret-493"><a href="#AwsSecret.delete_secret-493"><span class="linenos">493</span></a><span class="sd">            ```python</span>
</span><span id="AwsSecret.delete_secret-494"><a href="#AwsSecret.delete_secret-494"><span class="linenos">494</span></a><span class="sd">            secrets_manager = SecretsManager.load(&quot;MY_BLOCK&quot;)</span>
</span><span id="AwsSecret.delete_secret-495"><a href="#AwsSecret.delete_secret-495"><span class="linenos">495</span></a><span class="sd">            secrets_manager.delete_secret(recovery_window_in_days=15)</span>
</span><span id="AwsSecret.delete_secret-496"><a href="#AwsSecret.delete_secret-496"><span class="linenos">496</span></a><span class="sd">            ```</span>
</span><span id="AwsSecret.delete_secret-497"><a href="#AwsSecret.delete_secret-497"><span class="linenos">497</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AwsSecret.delete_secret-498"><a href="#AwsSecret.delete_secret-498"><span class="linenos">498</span></a>        <span class="k">if</span> <span class="n">force_delete_without_recovery</span> <span class="ow">and</span> <span class="n">recovery_window_in_days</span><span class="p">:</span>
</span><span id="AwsSecret.delete_secret-499"><a href="#AwsSecret.delete_secret-499"><span class="linenos">499</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="AwsSecret.delete_secret-500"><a href="#AwsSecret.delete_secret-500"><span class="linenos">500</span></a>                <span class="s2">&quot;Cannot specify recovery window and force delete without recovery.&quot;</span>
</span><span id="AwsSecret.delete_secret-501"><a href="#AwsSecret.delete_secret-501"><span class="linenos">501</span></a>            <span class="p">)</span>
</span><span id="AwsSecret.delete_secret-502"><a href="#AwsSecret.delete_secret-502"><span class="linenos">502</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;=</span> <span class="n">recovery_window_in_days</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">):</span>
</span><span id="AwsSecret.delete_secret-503"><a href="#AwsSecret.delete_secret-503"><span class="linenos">503</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="AwsSecret.delete_secret-504"><a href="#AwsSecret.delete_secret-504"><span class="linenos">504</span></a>                <span class="s2">&quot;Recovery window must be between 7 and 30 days, got &quot;</span>
</span><span id="AwsSecret.delete_secret-505"><a href="#AwsSecret.delete_secret-505"><span class="linenos">505</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">recovery_window_in_days</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="AwsSecret.delete_secret-506"><a href="#AwsSecret.delete_secret-506"><span class="linenos">506</span></a>            <span class="p">)</span>
</span><span id="AwsSecret.delete_secret-507"><a href="#AwsSecret.delete_secret-507"><span class="linenos">507</span></a>
</span><span id="AwsSecret.delete_secret-508"><a href="#AwsSecret.delete_secret-508"><span class="linenos">508</span></a>        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_secrets_manager_client</span><span class="p">()</span>
</span><span id="AwsSecret.delete_secret-509"><a href="#AwsSecret.delete_secret-509"><span class="linenos">509</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="AwsSecret.delete_secret-510"><a href="#AwsSecret.delete_secret-510"><span class="linenos">510</span></a>            <span class="n">client</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-511"><a href="#AwsSecret.delete_secret-511"><span class="linenos">511</span></a>            <span class="n">SecretId</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">secret_name</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-512"><a href="#AwsSecret.delete_secret-512"><span class="linenos">512</span></a>            <span class="n">RecoveryWindowInDays</span><span class="o">=</span><span class="n">recovery_window_in_days</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-513"><a href="#AwsSecret.delete_secret-513"><span class="linenos">513</span></a>            <span class="n">ForceDeleteWithoutRecovery</span><span class="o">=</span><span class="n">force_delete_without_recovery</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-514"><a href="#AwsSecret.delete_secret-514"><span class="linenos">514</span></a>            <span class="o">**</span><span class="n">delete_kwargs</span><span class="p">,</span>
</span><span id="AwsSecret.delete_secret-515"><a href="#AwsSecret.delete_secret-515"><span class="linenos">515</span></a>        <span class="p">)</span>
</span><span id="AwsSecret.delete_secret-516"><a href="#AwsSecret.delete_secret-516"><span class="linenos">516</span></a>        <span class="n">arn</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;ARN&quot;</span><span class="p">]</span>
</span><span id="AwsSecret.delete_secret-517"><a href="#AwsSecret.delete_secret-517"><span class="linenos">517</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The secret </span><span class="si">{</span><span class="n">arn</span><span class="si">}</span><span class="s2"> was deleted successfully.&quot;</span><span class="p">)</span>
</span><span id="AwsSecret.delete_secret-518"><a href="#AwsSecret.delete_secret-518"><span class="linenos">518</span></a>        <span class="k">return</span> <span class="n">arn</span>
</span></pre></div>


            <div class="docstring"><p>Deletes the secret from the secret storage service.</p>

<p>Args:
    recovery_window_in_days: The number of days to wait before permanently
        deleting the secret. Must be between 7 and 30 days.
    force_delete_without_recovery: If True, the secret will be deleted
        immediately without a recovery window.
    **delete_kwargs: Additional keyword arguments to pass to the
        delete_secret method of the boto3 client.</p>

<p>Returns:
    The path that the secret was deleted from.</p>

<p>Examples:
    Deletes the secret with a recovery window of 15 days.
    <div class="pdoc-code codehilite">
    <pre><span></span><code><span class="n">secrets_manager</span> <span class="o">=</span> <span class="n">SecretsManager</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;MY_BLOCK&quot;</span><span class="p">)</span>
    <span class="n">secrets_manager</span><span class="o">.</span><span class="n">delete_secret</span><span class="p">(</span><span class="n">recovery_window_in_days</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    </code></pre>
    </div></p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.blocks.core.Block</dt>
                                <dd id="AwsSecret.__init__" class="function">Block</dd>
                <dd id="AwsSecret.Config" class="class">Config</dd>
                <dd id="AwsSecret.block_initialization" class="function">block_initialization</dd>
                <dd id="AwsSecret.get_block_type_name" class="function">get_block_type_name</dd>
                <dd id="AwsSecret.get_block_type_slug" class="function">get_block_type_slug</dd>
                <dd id="AwsSecret.get_block_capabilities" class="function">get_block_capabilities</dd>
                <dd id="AwsSecret.get_block_schema_version" class="function">get_block_schema_version</dd>
                <dd id="AwsSecret.get_description" class="function">get_description</dd>
                <dd id="AwsSecret.get_code_example" class="function">get_code_example</dd>
                <dd id="AwsSecret.get_block_class_from_schema" class="function">get_block_class_from_schema</dd>
                <dd id="AwsSecret.get_block_class_from_key" class="function">get_block_class_from_key</dd>
                <dd id="AwsSecret.load" class="function">load</dd>
                <dd id="AwsSecret.is_block_class" class="function">is_block_class</dd>
                <dd id="AwsSecret.register_type_and_schema" class="function">register_type_and_schema</dd>
                <dd id="AwsSecret.save" class="function">save</dd>
                <dd id="AwsSecret.delete" class="function">delete</dd>
                <dd id="AwsSecret.get_block_placeholder" class="function">get_block_placeholder</dd>
                <dd id="AwsSecret.json" class="function">json</dd>
                <dd id="AwsSecret.copy" class="function">copy</dd>

            </div>
            <div><dt>prefect.blocks.abstract.SecretBlock</dt>
                                <dd id="AwsSecret.logger" class="variable">logger</dd>

            </div>
            <div><dt>pydantic.v1.main.BaseModel</dt>
                                <dd id="AwsSecret.dict" class="function">dict</dd>
                <dd id="AwsSecret.parse_obj" class="function">parse_obj</dd>
                <dd id="AwsSecret.parse_raw" class="function">parse_raw</dd>
                <dd id="AwsSecret.parse_file" class="function">parse_file</dd>
                <dd id="AwsSecret.from_orm" class="function">from_orm</dd>
                <dd id="AwsSecret.construct" class="function">construct</dd>
                <dd id="AwsSecret.schema" class="function">schema</dd>
                <dd id="AwsSecret.schema_json" class="function">schema_json</dd>
                <dd id="AwsSecret.validate" class="function">validate</dd>
                <dd id="AwsSecret.update_forward_refs" class="function">update_forward_refs</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="ECSWorker">
                            <input id="ECSWorker-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ECSWorker</span><wbr>(<span class="base">prefect.workers.base.BaseWorker</span>):

                <label class="view-source-button" for="ECSWorker-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSWorker"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSWorker-604"><a href="#ECSWorker-604"><span class="linenos"> 604</span></a><span class="k">class</span> <span class="nc">ECSWorker</span><span class="p">(</span><span class="n">BaseWorker</span><span class="p">):</span>
</span><span id="ECSWorker-605"><a href="#ECSWorker-605"><span class="linenos"> 605</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-606"><a href="#ECSWorker-606"><span class="linenos"> 606</span></a><span class="sd">    A Prefect worker to run flow runs as ECS tasks.</span>
</span><span id="ECSWorker-607"><a href="#ECSWorker-607"><span class="linenos"> 607</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="ECSWorker-608"><a href="#ECSWorker-608"><span class="linenos"> 608</span></a>
</span><span id="ECSWorker-609"><a href="#ECSWorker-609"><span class="linenos"> 609</span></a>    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;ecs&quot;</span>
</span><span id="ECSWorker-610"><a href="#ECSWorker-610"><span class="linenos"> 610</span></a>    <span class="n">job_configuration</span> <span class="o">=</span> <span class="n">ECSJobConfiguration</span>
</span><span id="ECSWorker-611"><a href="#ECSWorker-611"><span class="linenos"> 611</span></a>    <span class="n">job_configuration_variables</span> <span class="o">=</span> <span class="n">ECSVariables</span>
</span><span id="ECSWorker-612"><a href="#ECSWorker-612"><span class="linenos"> 612</span></a>    <span class="n">_description</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-613"><a href="#ECSWorker-613"><span class="linenos"> 613</span></a>        <span class="s2">&quot;Execute flow runs within containers on AWS ECS. Works with EC2 &quot;</span>
</span><span id="ECSWorker-614"><a href="#ECSWorker-614"><span class="linenos"> 614</span></a>        <span class="s2">&quot;and Fargate clusters. Requires an AWS account.&quot;</span>
</span><span id="ECSWorker-615"><a href="#ECSWorker-615"><span class="linenos"> 615</span></a>    <span class="p">)</span>
</span><span id="ECSWorker-616"><a href="#ECSWorker-616"><span class="linenos"> 616</span></a>    <span class="n">_display_name</span> <span class="o">=</span> <span class="s2">&quot;AWS Elastic Container Service&quot;</span>
</span><span id="ECSWorker-617"><a href="#ECSWorker-617"><span class="linenos"> 617</span></a>    <span class="n">_documentation_url</span> <span class="o">=</span> <span class="s2">&quot;https://prefecthq.github.io/prefect-aws/ecs_worker/&quot;</span>
</span><span id="ECSWorker-618"><a href="#ECSWorker-618"><span class="linenos"> 618</span></a>    <span class="n">_logo_url</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.sanity.io/images/3ugk85nk/production/d74b16fe84ce626345adf235a47008fea2869a60-225x225.png&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSWorker-619"><a href="#ECSWorker-619"><span class="linenos"> 619</span></a>
</span><span id="ECSWorker-620"><a href="#ECSWorker-620"><span class="linenos"> 620</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="ECSWorker-621"><a href="#ECSWorker-621"><span class="linenos"> 621</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-622"><a href="#ECSWorker-622"><span class="linenos"> 622</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-623"><a href="#ECSWorker-623"><span class="linenos"> 623</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-624"><a href="#ECSWorker-624"><span class="linenos"> 624</span></a>        <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSWorker-625"><a href="#ECSWorker-625"><span class="linenos"> 625</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseWorkerResult</span><span class="p">:</span>
</span><span id="ECSWorker-626"><a href="#ECSWorker-626"><span class="linenos"> 626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-627"><a href="#ECSWorker-627"><span class="linenos"> 627</span></a><span class="sd">        Runs a given flow run on the current worker.</span>
</span><span id="ECSWorker-628"><a href="#ECSWorker-628"><span class="linenos"> 628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-629"><a href="#ECSWorker-629"><span class="linenos"> 629</span></a>        <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker-630"><a href="#ECSWorker-630"><span class="linenos"> 630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span>
</span><span id="ECSWorker-631"><a href="#ECSWorker-631"><span class="linenos"> 631</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-632"><a href="#ECSWorker-632"><span class="linenos"> 632</span></a>
</span><span id="ECSWorker-633"><a href="#ECSWorker-633"><span class="linenos"> 633</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flow_run_logger</span><span class="p">(</span><span class="n">flow_run</span><span class="p">)</span>
</span><span id="ECSWorker-634"><a href="#ECSWorker-634"><span class="linenos"> 634</span></a>
</span><span id="ECSWorker-635"><a href="#ECSWorker-635"><span class="linenos"> 635</span></a>        <span class="p">(</span>
</span><span id="ECSWorker-636"><a href="#ECSWorker-636"><span class="linenos"> 636</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-637"><a href="#ECSWorker-637"><span class="linenos"> 637</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-638"><a href="#ECSWorker-638"><span class="linenos"> 638</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-639"><a href="#ECSWorker-639"><span class="linenos"> 639</span></a>            <span class="n">is_new_task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-640"><a href="#ECSWorker-640"><span class="linenos"> 640</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker-641"><a href="#ECSWorker-641"><span class="linenos"> 641</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span>
</span><span id="ECSWorker-642"><a href="#ECSWorker-642"><span class="linenos"> 642</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-643"><a href="#ECSWorker-643"><span class="linenos"> 643</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-644"><a href="#ECSWorker-644"><span class="linenos"> 644</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-645"><a href="#ECSWorker-645"><span class="linenos"> 645</span></a>            <span class="n">flow_run</span><span class="p">,</span>
</span><span id="ECSWorker-646"><a href="#ECSWorker-646"><span class="linenos"> 646</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-647"><a href="#ECSWorker-647"><span class="linenos"> 647</span></a>
</span><span id="ECSWorker-648"><a href="#ECSWorker-648"><span class="linenos"> 648</span></a>        <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
</span><span id="ECSWorker-649"><a href="#ECSWorker-649"><span class="linenos"> 649</span></a>        <span class="c1"># if set to preserve matching by name rather than arn</span>
</span><span id="ECSWorker-650"><a href="#ECSWorker-650"><span class="linenos"> 650</span></a>        <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
</span><span id="ECSWorker-651"><a href="#ECSWorker-651"><span class="linenos"> 651</span></a>        <span class="c1"># single colons.</span>
</span><span id="ECSWorker-652"><a href="#ECSWorker-652"><span class="linenos"> 652</span></a>        <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-653"><a href="#ECSWorker-653"><span class="linenos"> 653</span></a>            <span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span>
</span><span id="ECSWorker-654"><a href="#ECSWorker-654"><span class="linenos"> 654</span></a>            <span class="o">+</span> <span class="s2">&quot;::&quot;</span>
</span><span id="ECSWorker-655"><a href="#ECSWorker-655"><span class="linenos"> 655</span></a>            <span class="o">+</span> <span class="n">task_arn</span>
</span><span id="ECSWorker-656"><a href="#ECSWorker-656"><span class="linenos"> 656</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-657"><a href="#ECSWorker-657"><span class="linenos"> 657</span></a>
</span><span id="ECSWorker-658"><a href="#ECSWorker-658"><span class="linenos"> 658</span></a>        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
</span><span id="ECSWorker-659"><a href="#ECSWorker-659"><span class="linenos"> 659</span></a>            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSWorker-660"><a href="#ECSWorker-660"><span class="linenos"> 660</span></a>
</span><span id="ECSWorker-661"><a href="#ECSWorker-661"><span class="linenos"> 661</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker-662"><a href="#ECSWorker-662"><span class="linenos"> 662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
</span><span id="ECSWorker-663"><a href="#ECSWorker-663"><span class="linenos"> 663</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-664"><a href="#ECSWorker-664"><span class="linenos"> 664</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-665"><a href="#ECSWorker-665"><span class="linenos"> 665</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-666"><a href="#ECSWorker-666"><span class="linenos"> 666</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-667"><a href="#ECSWorker-667"><span class="linenos"> 667</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-668"><a href="#ECSWorker-668"><span class="linenos"> 668</span></a>            <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-669"><a href="#ECSWorker-669"><span class="linenos"> 669</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-670"><a href="#ECSWorker-670"><span class="linenos"> 670</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-671"><a href="#ECSWorker-671"><span class="linenos"> 671</span></a>
</span><span id="ECSWorker-672"><a href="#ECSWorker-672"><span class="linenos"> 672</span></a>        <span class="k">return</span> <span class="n">ECSWorkerResult</span><span class="p">(</span>
</span><span id="ECSWorker-673"><a href="#ECSWorker-673"><span class="linenos"> 673</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="ECSWorker-674"><a href="#ECSWorker-674"><span class="linenos"> 674</span></a>            <span class="c1"># If the container does not start the exit code can be null but we must</span>
</span><span id="ECSWorker-675"><a href="#ECSWorker-675"><span class="linenos"> 675</span></a>            <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
</span><span id="ECSWorker-676"><a href="#ECSWorker-676"><span class="linenos"> 676</span></a>            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ECSWorker-677"><a href="#ECSWorker-677"><span class="linenos"> 677</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-678"><a href="#ECSWorker-678"><span class="linenos"> 678</span></a>
</span><span id="ECSWorker-679"><a href="#ECSWorker-679"><span class="linenos"> 679</span></a>    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span>
</span><span id="ECSWorker-680"><a href="#ECSWorker-680"><span class="linenos"> 680</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">client_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ClientType</span><span class="p">]</span>
</span><span id="ECSWorker-681"><a href="#ECSWorker-681"><span class="linenos"> 681</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ECSClient</span><span class="p">:</span>
</span><span id="ECSWorker-682"><a href="#ECSWorker-682"><span class="linenos"> 682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-683"><a href="#ECSWorker-683"><span class="linenos"> 683</span></a><span class="sd">        Get a boto3 client of client_type. Will use a cached client if one exists.</span>
</span><span id="ECSWorker-684"><a href="#ECSWorker-684"><span class="linenos"> 684</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-685"><a href="#ECSWorker-685"><span class="linenos"> 685</span></a>        <span class="k">return</span> <span class="n">configuration</span><span class="o">.</span><span class="n">aws_credentials</span><span class="o">.</span><span class="n">get_client</span><span class="p">(</span><span class="n">client_type</span><span class="p">)</span>
</span><span id="ECSWorker-686"><a href="#ECSWorker-686"><span class="linenos"> 686</span></a>
</span><span id="ECSWorker-687"><a href="#ECSWorker-687"><span class="linenos"> 687</span></a>    <span class="k">def</span> <span class="nf">_create_task_and_wait_for_start</span><span class="p">(</span>
</span><span id="ECSWorker-688"><a href="#ECSWorker-688"><span class="linenos"> 688</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-689"><a href="#ECSWorker-689"><span class="linenos"> 689</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-690"><a href="#ECSWorker-690"><span class="linenos"> 690</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-691"><a href="#ECSWorker-691"><span class="linenos"> 691</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-692"><a href="#ECSWorker-692"><span class="linenos"> 692</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
</span><span id="ECSWorker-693"><a href="#ECSWorker-693"><span class="linenos"> 693</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="ECSWorker-694"><a href="#ECSWorker-694"><span class="linenos"> 694</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-695"><a href="#ECSWorker-695"><span class="linenos"> 695</span></a><span class="sd">        Register the task definition, create the task run, and wait for it to start.</span>
</span><span id="ECSWorker-696"><a href="#ECSWorker-696"><span class="linenos"> 696</span></a>
</span><span id="ECSWorker-697"><a href="#ECSWorker-697"><span class="linenos"> 697</span></a><span class="sd">        Returns a tuple of</span>
</span><span id="ECSWorker-698"><a href="#ECSWorker-698"><span class="linenos"> 698</span></a><span class="sd">        - The task ARN</span>
</span><span id="ECSWorker-699"><a href="#ECSWorker-699"><span class="linenos"> 699</span></a><span class="sd">        - The task&#39;s cluster ARN</span>
</span><span id="ECSWorker-700"><a href="#ECSWorker-700"><span class="linenos"> 700</span></a><span class="sd">        - The task definition</span>
</span><span id="ECSWorker-701"><a href="#ECSWorker-701"><span class="linenos"> 701</span></a><span class="sd">        - A bool indicating if the task definition is newly registered</span>
</span><span id="ECSWorker-702"><a href="#ECSWorker-702"><span class="linenos"> 702</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-703"><a href="#ECSWorker-703"><span class="linenos"> 703</span></a>        <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-704"><a href="#ECSWorker-704"><span class="linenos"> 704</span></a>        <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ECSWorker-705"><a href="#ECSWorker-705"><span class="linenos"> 705</span></a>
</span><span id="ECSWorker-706"><a href="#ECSWorker-706"><span class="linenos"> 706</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_definition_arn</span><span class="p">:</span>
</span><span id="ECSWorker-707"><a href="#ECSWorker-707"><span class="linenos"> 707</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-708"><a href="#ECSWorker-708"><span class="linenos"> 708</span></a>                <span class="n">configuration</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">ecs_client</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">region_name</span><span class="p">,</span> <span class="n">flow_run</span><span class="o">=</span><span class="n">flow_run</span>
</span><span id="ECSWorker-709"><a href="#ECSWorker-709"><span class="linenos"> 709</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-710"><a href="#ECSWorker-710"><span class="linenos"> 710</span></a>            <span class="p">(</span>
</span><span id="ECSWorker-711"><a href="#ECSWorker-711"><span class="linenos"> 711</span></a>                <span class="n">task_definition_arn</span><span class="p">,</span>
</span><span id="ECSWorker-712"><a href="#ECSWorker-712"><span class="linenos"> 712</span></a>                <span class="n">new_task_definition_registered</span><span class="p">,</span>
</span><span id="ECSWorker-713"><a href="#ECSWorker-713"><span class="linenos"> 713</span></a>            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_register_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-714"><a href="#ECSWorker-714"><span class="linenos"> 714</span></a>                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">flow_run</span><span class="p">,</span> <span class="n">task_definition</span>
</span><span id="ECSWorker-715"><a href="#ECSWorker-715"><span class="linenos"> 715</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-716"><a href="#ECSWorker-716"><span class="linenos"> 716</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-717"><a href="#ECSWorker-717"><span class="linenos"> 717</span></a>            <span class="n">task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-718"><a href="#ECSWorker-718"><span class="linenos"> 718</span></a>                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition_arn</span>
</span><span id="ECSWorker-719"><a href="#ECSWorker-719"><span class="linenos"> 719</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-720"><a href="#ECSWorker-720"><span class="linenos"> 720</span></a>            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_definition</span><span class="p">:</span>
</span><span id="ECSWorker-721"><a href="#ECSWorker-721"><span class="linenos"> 721</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-722"><a href="#ECSWorker-722"><span class="linenos"> 722</span></a>                    <span class="s2">&quot;Ignoring task definition in configuration since task definition&quot;</span>
</span><span id="ECSWorker-723"><a href="#ECSWorker-723"><span class="linenos"> 723</span></a>                    <span class="s2">&quot; ARN is provided on the task run request.&quot;</span>
</span><span id="ECSWorker-724"><a href="#ECSWorker-724"><span class="linenos"> 724</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-725"><a href="#ECSWorker-725"><span class="linenos"> 725</span></a>
</span><span id="ECSWorker-726"><a href="#ECSWorker-726"><span class="linenos"> 726</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span> <span class="n">configuration</span><span class="p">)</span>
</span><span id="ECSWorker-727"><a href="#ECSWorker-727"><span class="linenos"> 727</span></a>
</span><span id="ECSWorker-728"><a href="#ECSWorker-728"><span class="linenos"> 728</span></a>        <span class="n">_TASK_DEFINITION_CACHE</span><span class="p">[</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">task_definition_arn</span>
</span><span id="ECSWorker-729"><a href="#ECSWorker-729"><span class="linenos"> 729</span></a>
</span><span id="ECSWorker-730"><a href="#ECSWorker-730"><span class="linenos"> 730</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using ECS task definition </span><span class="si">{</span><span class="n">task_definition_arn</span><span class="si">!r}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-731"><a href="#ECSWorker-731"><span class="linenos"> 731</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSWorker-732"><a href="#ECSWorker-732"><span class="linenos"> 732</span></a>            <span class="sa">f</span><span class="s2">&quot;Task definition </span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-733"><a href="#ECSWorker-733"><span class="linenos"> 733</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-734"><a href="#ECSWorker-734"><span class="linenos"> 734</span></a>
</span><span id="ECSWorker-735"><a href="#ECSWorker-735"><span class="linenos"> 735</span></a>        <span class="n">task_run_request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_task_run_request</span><span class="p">(</span>
</span><span id="ECSWorker-736"><a href="#ECSWorker-736"><span class="linenos"> 736</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-737"><a href="#ECSWorker-737"><span class="linenos"> 737</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-738"><a href="#ECSWorker-738"><span class="linenos"> 738</span></a>            <span class="n">task_definition_arn</span><span class="p">,</span>
</span><span id="ECSWorker-739"><a href="#ECSWorker-739"><span class="linenos"> 739</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-740"><a href="#ECSWorker-740"><span class="linenos"> 740</span></a>
</span><span id="ECSWorker-741"><a href="#ECSWorker-741"><span class="linenos"> 741</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Creating ECS task run...&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-742"><a href="#ECSWorker-742"><span class="linenos"> 742</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSWorker-743"><a href="#ECSWorker-743"><span class="linenos"> 743</span></a>            <span class="s2">&quot;Task run request&quot;</span>
</span><span id="ECSWorker-744"><a href="#ECSWorker-744"><span class="linenos"> 744</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">mask_api_key</span><span class="p">(</span><span class="n">task_run_request</span><span class="p">),</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-745"><a href="#ECSWorker-745"><span class="linenos"> 745</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-746"><a href="#ECSWorker-746"><span class="linenos"> 746</span></a>
</span><span id="ECSWorker-747"><a href="#ECSWorker-747"><span class="linenos"> 747</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ECSWorker-748"><a href="#ECSWorker-748"><span class="linenos"> 748</span></a>            <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_run</span><span class="p">(</span><span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">)</span>
</span><span id="ECSWorker-749"><a href="#ECSWorker-749"><span class="linenos"> 749</span></a>            <span class="n">task_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskArn&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-750"><a href="#ECSWorker-750"><span class="linenos"> 750</span></a>            <span class="n">cluster_arn</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;clusterArn&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-751"><a href="#ECSWorker-751"><span class="linenos"> 751</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="ECSWorker-752"><a href="#ECSWorker-752"><span class="linenos"> 752</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_report_task_run_creation_failure</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">,</span> <span class="n">exc</span><span class="p">)</span>
</span><span id="ECSWorker-753"><a href="#ECSWorker-753"><span class="linenos"> 753</span></a>            <span class="k">raise</span>
</span><span id="ECSWorker-754"><a href="#ECSWorker-754"><span class="linenos"> 754</span></a>
</span><span id="ECSWorker-755"><a href="#ECSWorker-755"><span class="linenos"> 755</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Waiting for ECS task run to start...&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-756"><a href="#ECSWorker-756"><span class="linenos"> 756</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_start</span><span class="p">(</span>
</span><span id="ECSWorker-757"><a href="#ECSWorker-757"><span class="linenos"> 757</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-758"><a href="#ECSWorker-758"><span class="linenos"> 758</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-759"><a href="#ECSWorker-759"><span class="linenos"> 759</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-760"><a href="#ECSWorker-760"><span class="linenos"> 760</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-761"><a href="#ECSWorker-761"><span class="linenos"> 761</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-762"><a href="#ECSWorker-762"><span class="linenos"> 762</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_start_timeout_seconds</span><span class="p">,</span>
</span><span id="ECSWorker-763"><a href="#ECSWorker-763"><span class="linenos"> 763</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-764"><a href="#ECSWorker-764"><span class="linenos"> 764</span></a>
</span><span id="ECSWorker-765"><a href="#ECSWorker-765"><span class="linenos"> 765</span></a>        <span class="k">return</span> <span class="n">task_arn</span><span class="p">,</span> <span class="n">cluster_arn</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">,</span> <span class="n">new_task_definition_registered</span>
</span><span id="ECSWorker-766"><a href="#ECSWorker-766"><span class="linenos"> 766</span></a>
</span><span id="ECSWorker-767"><a href="#ECSWorker-767"><span class="linenos"> 767</span></a>    <span class="k">def</span> <span class="nf">_get_or_register_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-768"><a href="#ECSWorker-768"><span class="linenos"> 768</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-769"><a href="#ECSWorker-769"><span class="linenos"> 769</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-770"><a href="#ECSWorker-770"><span class="linenos"> 770</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-771"><a href="#ECSWorker-771"><span class="linenos"> 771</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-772"><a href="#ECSWorker-772"><span class="linenos"> 772</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
</span><span id="ECSWorker-773"><a href="#ECSWorker-773"><span class="linenos"> 773</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-774"><a href="#ECSWorker-774"><span class="linenos"> 774</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span id="ECSWorker-775"><a href="#ECSWorker-775"><span class="linenos"> 775</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or register a task definition for the given flow run.</span>
</span><span id="ECSWorker-776"><a href="#ECSWorker-776"><span class="linenos"> 776</span></a>
</span><span id="ECSWorker-777"><a href="#ECSWorker-777"><span class="linenos"> 777</span></a><span class="sd">        Returns a tuple of the task definition ARN and a bool indicating if the task</span>
</span><span id="ECSWorker-778"><a href="#ECSWorker-778"><span class="linenos"> 778</span></a><span class="sd">        definition is newly registered.</span>
</span><span id="ECSWorker-779"><a href="#ECSWorker-779"><span class="linenos"> 779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-780"><a href="#ECSWorker-780"><span class="linenos"> 780</span></a>
</span><span id="ECSWorker-781"><a href="#ECSWorker-781"><span class="linenos"> 781</span></a>        <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="n">_TASK_DEFINITION_CACHE</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="p">)</span>
</span><span id="ECSWorker-782"><a href="#ECSWorker-782"><span class="linenos"> 782</span></a>        <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ECSWorker-783"><a href="#ECSWorker-783"><span class="linenos"> 783</span></a>
</span><span id="ECSWorker-784"><a href="#ECSWorker-784"><span class="linenos"> 784</span></a>        <span class="k">if</span> <span class="n">cached_task_definition_arn</span><span class="p">:</span>
</span><span id="ECSWorker-785"><a href="#ECSWorker-785"><span class="linenos"> 785</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSWorker-786"><a href="#ECSWorker-786"><span class="linenos"> 786</span></a>                <span class="n">cached_task_definition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-787"><a href="#ECSWorker-787"><span class="linenos"> 787</span></a>                    <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">cached_task_definition_arn</span>
</span><span id="ECSWorker-788"><a href="#ECSWorker-788"><span class="linenos"> 788</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-789"><a href="#ECSWorker-789"><span class="linenos"> 789</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_task_definition</span><span class="p">[</span>
</span><span id="ECSWorker-790"><a href="#ECSWorker-790"><span class="linenos"> 790</span></a>                    <span class="s2">&quot;status&quot;</span>
</span><span id="ECSWorker-791"><a href="#ECSWorker-791"><span class="linenos"> 791</span></a>                <span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ACTIVE&quot;</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_definitions_equal</span><span class="p">(</span>
</span><span id="ECSWorker-792"><a href="#ECSWorker-792"><span class="linenos"> 792</span></a>                    <span class="n">task_definition</span><span class="p">,</span> <span class="n">cached_task_definition</span>
</span><span id="ECSWorker-793"><a href="#ECSWorker-793"><span class="linenos"> 793</span></a>                <span class="p">):</span>
</span><span id="ECSWorker-794"><a href="#ECSWorker-794"><span class="linenos"> 794</span></a>                    <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSWorker-795"><a href="#ECSWorker-795"><span class="linenos"> 795</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ECSWorker-796"><a href="#ECSWorker-796"><span class="linenos"> 796</span></a>                <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSWorker-797"><a href="#ECSWorker-797"><span class="linenos"> 797</span></a>
</span><span id="ECSWorker-798"><a href="#ECSWorker-798"><span class="linenos"> 798</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSWorker-799"><a href="#ECSWorker-799"><span class="linenos"> 799</span></a>            <span class="ow">not</span> <span class="n">cached_task_definition_arn</span>
</span><span id="ECSWorker-800"><a href="#ECSWorker-800"><span class="linenos"> 800</span></a>            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">match_latest_revision_in_family</span>
</span><span id="ECSWorker-801"><a href="#ECSWorker-801"><span class="linenos"> 801</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-802"><a href="#ECSWorker-802"><span class="linenos"> 802</span></a>            <span class="n">family_name</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_FAMILY</span><span class="p">)</span>
</span><span id="ECSWorker-803"><a href="#ECSWorker-803"><span class="linenos"> 803</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSWorker-804"><a href="#ECSWorker-804"><span class="linenos"> 804</span></a>                <span class="n">task_definition_from_family</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-805"><a href="#ECSWorker-805"><span class="linenos"> 805</span></a>                    <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">family_name</span>
</span><span id="ECSWorker-806"><a href="#ECSWorker-806"><span class="linenos"> 806</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-807"><a href="#ECSWorker-807"><span class="linenos"> 807</span></a>                <span class="k">if</span> <span class="n">task_definition_from_family</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_definitions_equal</span><span class="p">(</span>
</span><span id="ECSWorker-808"><a href="#ECSWorker-808"><span class="linenos"> 808</span></a>                    <span class="n">task_definition</span><span class="p">,</span> <span class="n">task_definition_from_family</span>
</span><span id="ECSWorker-809"><a href="#ECSWorker-809"><span class="linenos"> 809</span></a>                <span class="p">):</span>
</span><span id="ECSWorker-810"><a href="#ECSWorker-810"><span class="linenos"> 810</span></a>                    <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="n">task_definition_from_family</span><span class="p">[</span>
</span><span id="ECSWorker-811"><a href="#ECSWorker-811"><span class="linenos"> 811</span></a>                        <span class="s2">&quot;taskDefinitionArn&quot;</span>
</span><span id="ECSWorker-812"><a href="#ECSWorker-812"><span class="linenos"> 812</span></a>                    <span class="p">]</span>
</span><span id="ECSWorker-813"><a href="#ECSWorker-813"><span class="linenos"> 813</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ECSWorker-814"><a href="#ECSWorker-814"><span class="linenos"> 814</span></a>                <span class="n">cached_task_definition_arn</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSWorker-815"><a href="#ECSWorker-815"><span class="linenos"> 815</span></a>
</span><span id="ECSWorker-816"><a href="#ECSWorker-816"><span class="linenos"> 816</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">cached_task_definition_arn</span><span class="p">:</span>
</span><span id="ECSWorker-817"><a href="#ECSWorker-817"><span class="linenos"> 817</span></a>            <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_register_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-818"><a href="#ECSWorker-818"><span class="linenos"> 818</span></a>                <span class="n">logger</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">,</span> <span class="n">task_definition</span>
</span><span id="ECSWorker-819"><a href="#ECSWorker-819"><span class="linenos"> 819</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-820"><a href="#ECSWorker-820"><span class="linenos"> 820</span></a>            <span class="n">new_task_definition_registered</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSWorker-821"><a href="#ECSWorker-821"><span class="linenos"> 821</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-822"><a href="#ECSWorker-822"><span class="linenos"> 822</span></a>            <span class="n">task_definition_arn</span> <span class="o">=</span> <span class="n">cached_task_definition_arn</span>
</span><span id="ECSWorker-823"><a href="#ECSWorker-823"><span class="linenos"> 823</span></a>
</span><span id="ECSWorker-824"><a href="#ECSWorker-824"><span class="linenos"> 824</span></a>        <span class="k">return</span> <span class="n">task_definition_arn</span><span class="p">,</span> <span class="n">new_task_definition_registered</span>
</span><span id="ECSWorker-825"><a href="#ECSWorker-825"><span class="linenos"> 825</span></a>
</span><span id="ECSWorker-826"><a href="#ECSWorker-826"><span class="linenos"> 826</span></a>    <span class="k">def</span> <span class="nf">_watch_task_and_get_exit_code</span><span class="p">(</span>
</span><span id="ECSWorker-827"><a href="#ECSWorker-827"><span class="linenos"> 827</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-828"><a href="#ECSWorker-828"><span class="linenos"> 828</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-829"><a href="#ECSWorker-829"><span class="linenos"> 829</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-830"><a href="#ECSWorker-830"><span class="linenos"> 830</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-831"><a href="#ECSWorker-831"><span class="linenos"> 831</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-832"><a href="#ECSWorker-832"><span class="linenos"> 832</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-833"><a href="#ECSWorker-833"><span class="linenos"> 833</span></a>        <span class="n">deregister_task_definition</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span id="ECSWorker-834"><a href="#ECSWorker-834"><span class="linenos"> 834</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-835"><a href="#ECSWorker-835"><span class="linenos"> 835</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ECSWorker-836"><a href="#ECSWorker-836"><span class="linenos"> 836</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-837"><a href="#ECSWorker-837"><span class="linenos"> 837</span></a><span class="sd">        Wait for the task run to complete and retrieve the exit code of the Prefect</span>
</span><span id="ECSWorker-838"><a href="#ECSWorker-838"><span class="linenos"> 838</span></a><span class="sd">        container.</span>
</span><span id="ECSWorker-839"><a href="#ECSWorker-839"><span class="linenos"> 839</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-840"><a href="#ECSWorker-840"><span class="linenos"> 840</span></a>
</span><span id="ECSWorker-841"><a href="#ECSWorker-841"><span class="linenos"> 841</span></a>        <span class="c1"># Wait for completion and stream logs</span>
</span><span id="ECSWorker-842"><a href="#ECSWorker-842"><span class="linenos"> 842</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_task_finish</span><span class="p">(</span>
</span><span id="ECSWorker-843"><a href="#ECSWorker-843"><span class="linenos"> 843</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-844"><a href="#ECSWorker-844"><span class="linenos"> 844</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-845"><a href="#ECSWorker-845"><span class="linenos"> 845</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-846"><a href="#ECSWorker-846"><span class="linenos"> 846</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-847"><a href="#ECSWorker-847"><span class="linenos"> 847</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker-848"><a href="#ECSWorker-848"><span class="linenos"> 848</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-849"><a href="#ECSWorker-849"><span class="linenos"> 849</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-850"><a href="#ECSWorker-850"><span class="linenos"> 850</span></a>
</span><span id="ECSWorker-851"><a href="#ECSWorker-851"><span class="linenos"> 851</span></a>        <span class="k">if</span> <span class="n">deregister_task_definition</span><span class="p">:</span>
</span><span id="ECSWorker-852"><a href="#ECSWorker-852"><span class="linenos"> 852</span></a>            <span class="n">ecs_client</span><span class="o">.</span><span class="n">deregister_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-853"><a href="#ECSWorker-853"><span class="linenos"> 853</span></a>                <span class="n">taskDefinition</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-854"><a href="#ECSWorker-854"><span class="linenos"> 854</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-855"><a href="#ECSWorker-855"><span class="linenos"> 855</span></a>
</span><span id="ECSWorker-856"><a href="#ECSWorker-856"><span class="linenos"> 856</span></a>        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-857"><a href="#ECSWorker-857"><span class="linenos"> 857</span></a>            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
</span><span id="ECSWorker-858"><a href="#ECSWorker-858"><span class="linenos"> 858</span></a>            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-859"><a href="#ECSWorker-859"><span class="linenos"> 859</span></a>            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
</span><span id="ECSWorker-860"><a href="#ECSWorker-860"><span class="linenos"> 860</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-861"><a href="#ECSWorker-861"><span class="linenos"> 861</span></a>
</span><span id="ECSWorker-862"><a href="#ECSWorker-862"><span class="linenos"> 862</span></a>        <span class="c1"># Check the status code of the Prefect container</span>
</span><span id="ECSWorker-863"><a href="#ECSWorker-863"><span class="linenos"> 863</span></a>        <span class="n">container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;containers&quot;</span><span class="p">],</span> <span class="n">container_name</span><span class="p">)</span>
</span><span id="ECSWorker-864"><a href="#ECSWorker-864"><span class="linenos"> 864</span></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="ECSWorker-865"><a href="#ECSWorker-865"><span class="linenos"> 865</span></a>            <span class="n">container</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSWorker-866"><a href="#ECSWorker-866"><span class="linenos"> 866</span></a>        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">container_name</span><span class="si">}</span><span class="s2">&#39; container missing from task: </span><span class="si">{</span><span class="n">task</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-867"><a href="#ECSWorker-867"><span class="linenos"> 867</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;exitCode&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-868"><a href="#ECSWorker-868"><span class="linenos"> 868</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_report_container_status_code</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">status_code</span><span class="p">)</span>
</span><span id="ECSWorker-869"><a href="#ECSWorker-869"><span class="linenos"> 869</span></a>
</span><span id="ECSWorker-870"><a href="#ECSWorker-870"><span class="linenos"> 870</span></a>        <span class="k">return</span> <span class="n">status_code</span>
</span><span id="ECSWorker-871"><a href="#ECSWorker-871"><span class="linenos"> 871</span></a>
</span><span id="ECSWorker-872"><a href="#ECSWorker-872"><span class="linenos"> 872</span></a>    <span class="k">def</span> <span class="nf">_report_container_status_code</span><span class="p">(</span>
</span><span id="ECSWorker-873"><a href="#ECSWorker-873"><span class="linenos"> 873</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">status_code</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
</span><span id="ECSWorker-874"><a href="#ECSWorker-874"><span class="linenos"> 874</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-875"><a href="#ECSWorker-875"><span class="linenos"> 875</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-876"><a href="#ECSWorker-876"><span class="linenos"> 876</span></a><span class="sd">        Display a log for the given container status code.</span>
</span><span id="ECSWorker-877"><a href="#ECSWorker-877"><span class="linenos"> 877</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-878"><a href="#ECSWorker-878"><span class="linenos"> 878</span></a>        <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-879"><a href="#ECSWorker-879"><span class="linenos"> 879</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ECSWorker-880"><a href="#ECSWorker-880"><span class="linenos"> 880</span></a>                <span class="sa">f</span><span class="s2">&quot;Task exited without reporting an exit status for container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-881"><a href="#ECSWorker-881"><span class="linenos"> 881</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-882"><a href="#ECSWorker-882"><span class="linenos"> 882</span></a>        <span class="k">elif</span> <span class="n">status_code</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="ECSWorker-883"><a href="#ECSWorker-883"><span class="linenos"> 883</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited successfully.&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-884"><a href="#ECSWorker-884"><span class="linenos"> 884</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-885"><a href="#ECSWorker-885"><span class="linenos"> 885</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-886"><a href="#ECSWorker-886"><span class="linenos"> 886</span></a>                <span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2"> exited with non-zero exit code </span><span class="si">{</span><span class="n">status_code</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-887"><a href="#ECSWorker-887"><span class="linenos"> 887</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-888"><a href="#ECSWorker-888"><span class="linenos"> 888</span></a>
</span><span id="ECSWorker-889"><a href="#ECSWorker-889"><span class="linenos"> 889</span></a>    <span class="k">def</span> <span class="nf">_report_task_run_creation_failure</span><span class="p">(</span>
</span><span id="ECSWorker-890"><a href="#ECSWorker-890"><span class="linenos"> 890</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="ne">Exception</span>
</span><span id="ECSWorker-891"><a href="#ECSWorker-891"><span class="linenos"> 891</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-892"><a href="#ECSWorker-892"><span class="linenos"> 892</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-893"><a href="#ECSWorker-893"><span class="linenos"> 893</span></a><span class="sd">        Wrap common AWS task run creation failures with nicer user-facing messages.</span>
</span><span id="ECSWorker-894"><a href="#ECSWorker-894"><span class="linenos"> 894</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-895"><a href="#ECSWorker-895"><span class="linenos"> 895</span></a>        <span class="c1"># AWS generates exception types at runtime so they must be captured a bit</span>
</span><span id="ECSWorker-896"><a href="#ECSWorker-896"><span class="linenos"> 896</span></a>        <span class="c1"># differently than normal.</span>
</span><span id="ECSWorker-897"><a href="#ECSWorker-897"><span class="linenos"> 897</span></a>        <span class="k">if</span> <span class="s2">&quot;ClusterNotFoundException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSWorker-898"><a href="#ECSWorker-898"><span class="linenos"> 898</span></a>            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-899"><a href="#ECSWorker-899"><span class="linenos"> 899</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-900"><a href="#ECSWorker-900"><span class="linenos"> 900</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> not found. &quot;</span>
</span><span id="ECSWorker-901"><a href="#ECSWorker-901"><span class="linenos"> 901</span></a>                <span class="s2">&quot;Confirm that the cluster is configured in your region.&quot;</span>
</span><span id="ECSWorker-902"><a href="#ECSWorker-902"><span class="linenos"> 902</span></a>            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSWorker-903"><a href="#ECSWorker-903"><span class="linenos"> 903</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="ECSWorker-904"><a href="#ECSWorker-904"><span class="linenos"> 904</span></a>            <span class="s2">&quot;No Container Instances&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">and</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span>
</span><span id="ECSWorker-905"><a href="#ECSWorker-905"><span class="linenos"> 905</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-906"><a href="#ECSWorker-906"><span class="linenos"> 906</span></a>            <span class="n">cluster</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="s2">&quot;default&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-907"><a href="#ECSWorker-907"><span class="linenos"> 907</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-908"><a href="#ECSWorker-908"><span class="linenos"> 908</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task, cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> does not appear to &quot;</span>
</span><span id="ECSWorker-909"><a href="#ECSWorker-909"><span class="linenos"> 909</span></a>                <span class="s2">&quot;have any container instances associated with it. Confirm that you &quot;</span>
</span><span id="ECSWorker-910"><a href="#ECSWorker-910"><span class="linenos"> 910</span></a>                <span class="s2">&quot;have EC2 container instances available.&quot;</span>
</span><span id="ECSWorker-911"><a href="#ECSWorker-911"><span class="linenos"> 911</span></a>            <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSWorker-912"><a href="#ECSWorker-912"><span class="linenos"> 912</span></a>        <span class="k">elif</span> <span class="p">(</span>
</span><span id="ECSWorker-913"><a href="#ECSWorker-913"><span class="linenos"> 913</span></a>            <span class="s2">&quot;failed to validate logger args&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="ECSWorker-914"><a href="#ECSWorker-914"><span class="linenos"> 914</span></a>            <span class="ow">and</span> <span class="s2">&quot;AccessDeniedException&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
</span><span id="ECSWorker-915"><a href="#ECSWorker-915"><span class="linenos"> 915</span></a>            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span>
</span><span id="ECSWorker-916"><a href="#ECSWorker-916"><span class="linenos"> 916</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-917"><a href="#ECSWorker-917"><span class="linenos"> 917</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-918"><a href="#ECSWorker-918"><span class="linenos"> 918</span></a>                <span class="s2">&quot;Failed to run ECS task, the attached execution role does not appear&quot;</span>
</span><span id="ECSWorker-919"><a href="#ECSWorker-919"><span class="linenos"> 919</span></a>                <span class="s2">&quot; to have sufficient permissions. Ensure that the execution role&quot;</span>
</span><span id="ECSWorker-920"><a href="#ECSWorker-920"><span class="linenos"> 920</span></a>                <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">configuration</span><span class="o">.</span><span class="n">execution_role</span><span class="si">!r}</span><span class="s2"> has permissions&quot;</span>
</span><span id="ECSWorker-921"><a href="#ECSWorker-921"><span class="linenos"> 921</span></a>                <span class="s2">&quot; logs:CreateLogStream, logs:CreateLogGroup, and logs:PutLogEvents.&quot;</span>
</span><span id="ECSWorker-922"><a href="#ECSWorker-922"><span class="linenos"> 922</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-923"><a href="#ECSWorker-923"><span class="linenos"> 923</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-924"><a href="#ECSWorker-924"><span class="linenos"> 924</span></a>            <span class="k">raise</span>
</span><span id="ECSWorker-925"><a href="#ECSWorker-925"><span class="linenos"> 925</span></a>
</span><span id="ECSWorker-926"><a href="#ECSWorker-926"><span class="linenos"> 926</span></a>    <span class="k">def</span> <span class="nf">_validate_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-927"><a href="#ECSWorker-927"><span class="linenos"> 927</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span>
</span><span id="ECSWorker-928"><a href="#ECSWorker-928"><span class="linenos"> 928</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-929"><a href="#ECSWorker-929"><span class="linenos"> 929</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-930"><a href="#ECSWorker-930"><span class="linenos"> 930</span></a><span class="sd">        Ensure that the task definition is compatible with the configuration.</span>
</span><span id="ECSWorker-931"><a href="#ECSWorker-931"><span class="linenos"> 931</span></a>
</span><span id="ECSWorker-932"><a href="#ECSWorker-932"><span class="linenos"> 932</span></a><span class="sd">        Raises `ValueError` on incompatibility. Returns `None` on success.</span>
</span><span id="ECSWorker-933"><a href="#ECSWorker-933"><span class="linenos"> 933</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-934"><a href="#ECSWorker-934"><span class="linenos"> 934</span></a>        <span class="n">launch_type</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSWorker-935"><a href="#ECSWorker-935"><span class="linenos"> 935</span></a>            <span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_LAUNCH_TYPE</span>
</span><span id="ECSWorker-936"><a href="#ECSWorker-936"><span class="linenos"> 936</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-937"><a href="#ECSWorker-937"><span class="linenos"> 937</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSWorker-938"><a href="#ECSWorker-938"><span class="linenos"> 938</span></a>            <span class="n">launch_type</span> <span class="o">!=</span> <span class="s2">&quot;EC2&quot;</span>
</span><span id="ECSWorker-939"><a href="#ECSWorker-939"><span class="linenos"> 939</span></a>            <span class="ow">and</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-940"><a href="#ECSWorker-940"><span class="linenos"> 940</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-941"><a href="#ECSWorker-941"><span class="linenos"> 941</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-942"><a href="#ECSWorker-942"><span class="linenos"> 942</span></a>                <span class="s2">&quot;Task definition does not have &#39;FARGATE&#39; in &#39;requiresCompatibilities&#39;&quot;</span>
</span><span id="ECSWorker-943"><a href="#ECSWorker-943"><span class="linenos"> 943</span></a>                <span class="sa">f</span><span class="s2">&quot; and cannot be used with launch type </span><span class="si">{</span><span class="n">launch_type</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-944"><a href="#ECSWorker-944"><span class="linenos"> 944</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-945"><a href="#ECSWorker-945"><span class="linenos"> 945</span></a>
</span><span id="ECSWorker-946"><a href="#ECSWorker-946"><span class="linenos"> 946</span></a>        <span class="k">if</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">or</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-947"><a href="#ECSWorker-947"><span class="linenos"> 947</span></a>            <span class="c1"># Only the &#39;awsvpc&#39; network mode is supported when using FARGATE</span>
</span><span id="ECSWorker-948"><a href="#ECSWorker-948"><span class="linenos"> 948</span></a>            <span class="n">network_mode</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-949"><a href="#ECSWorker-949"><span class="linenos"> 949</span></a>            <span class="k">if</span> <span class="n">network_mode</span> <span class="o">!=</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-950"><a href="#ECSWorker-950"><span class="linenos"> 950</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-951"><a href="#ECSWorker-951"><span class="linenos"> 951</span></a>                    <span class="sa">f</span><span class="s2">&quot;Found network mode </span><span class="si">{</span><span class="n">network_mode</span><span class="si">!r}</span><span class="s2"> which is not compatible with &quot;</span>
</span><span id="ECSWorker-952"><a href="#ECSWorker-952"><span class="linenos"> 952</span></a>                    <span class="sa">f</span><span class="s2">&quot;launch type </span><span class="si">{</span><span class="n">launch_type</span><span class="si">!r}</span><span class="s2">. Use either the &#39;EC2&#39; launch &quot;</span>
</span><span id="ECSWorker-953"><a href="#ECSWorker-953"><span class="linenos"> 953</span></a>                    <span class="s2">&quot;type or the &#39;awsvpc&#39; network mode.&quot;</span>
</span><span id="ECSWorker-954"><a href="#ECSWorker-954"><span class="linenos"> 954</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-955"><a href="#ECSWorker-955"><span class="linenos"> 955</span></a>
</span><span id="ECSWorker-956"><a href="#ECSWorker-956"><span class="linenos"> 956</span></a>        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSWorker-957"><a href="#ECSWorker-957"><span class="linenos"> 957</span></a>            <span class="s2">&quot;executionRoleArn&quot;</span>
</span><span id="ECSWorker-958"><a href="#ECSWorker-958"><span class="linenos"> 958</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-959"><a href="#ECSWorker-959"><span class="linenos"> 959</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-960"><a href="#ECSWorker-960"><span class="linenos"> 960</span></a>                <span class="s2">&quot;An execution role arn must be set on the task definition to use &quot;</span>
</span><span id="ECSWorker-961"><a href="#ECSWorker-961"><span class="linenos"> 961</span></a>                <span class="s2">&quot;`configure_cloudwatch_logs` or `stream_logs` but no execution role &quot;</span>
</span><span id="ECSWorker-962"><a href="#ECSWorker-962"><span class="linenos"> 962</span></a>                <span class="s2">&quot;was found on the task definition.&quot;</span>
</span><span id="ECSWorker-963"><a href="#ECSWorker-963"><span class="linenos"> 963</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-964"><a href="#ECSWorker-964"><span class="linenos"> 964</span></a>
</span><span id="ECSWorker-965"><a href="#ECSWorker-965"><span class="linenos"> 965</span></a>    <span class="k">def</span> <span class="nf">_register_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-966"><a href="#ECSWorker-966"><span class="linenos"> 966</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-967"><a href="#ECSWorker-967"><span class="linenos"> 967</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-968"><a href="#ECSWorker-968"><span class="linenos"> 968</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-969"><a href="#ECSWorker-969"><span class="linenos"> 969</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-970"><a href="#ECSWorker-970"><span class="linenos"> 970</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSWorker-971"><a href="#ECSWorker-971"><span class="linenos"> 971</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-972"><a href="#ECSWorker-972"><span class="linenos"> 972</span></a><span class="sd">        Register a new task definition with AWS.</span>
</span><span id="ECSWorker-973"><a href="#ECSWorker-973"><span class="linenos"> 973</span></a>
</span><span id="ECSWorker-974"><a href="#ECSWorker-974"><span class="linenos"> 974</span></a><span class="sd">        Returns the ARN.</span>
</span><span id="ECSWorker-975"><a href="#ECSWorker-975"><span class="linenos"> 975</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-976"><a href="#ECSWorker-976"><span class="linenos"> 976</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Registering ECS task definition...&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-977"><a href="#ECSWorker-977"><span class="linenos"> 977</span></a>        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
</span><span id="ECSWorker-978"><a href="#ECSWorker-978"><span class="linenos"> 978</span></a>            <span class="s2">&quot;Task definition request&quot;</span>
</span><span id="ECSWorker-979"><a href="#ECSWorker-979"><span class="linenos"> 979</span></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">task_definition</span><span class="p">,</span><span class="w"> </span><span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-980"><a href="#ECSWorker-980"><span class="linenos"> 980</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-981"><a href="#ECSWorker-981"><span class="linenos"> 981</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">register_task_definition</span><span class="p">(</span><span class="o">**</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-982"><a href="#ECSWorker-982"><span class="linenos"> 982</span></a>        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">][</span><span class="s2">&quot;taskDefinitionArn&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-983"><a href="#ECSWorker-983"><span class="linenos"> 983</span></a>
</span><span id="ECSWorker-984"><a href="#ECSWorker-984"><span class="linenos"> 984</span></a>    <span class="k">def</span> <span class="nf">_retrieve_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-985"><a href="#ECSWorker-985"><span class="linenos"> 985</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-986"><a href="#ECSWorker-986"><span class="linenos"> 986</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-987"><a href="#ECSWorker-987"><span class="linenos"> 987</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-988"><a href="#ECSWorker-988"><span class="linenos"> 988</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-989"><a href="#ECSWorker-989"><span class="linenos"> 989</span></a>    <span class="p">):</span>
</span><span id="ECSWorker-990"><a href="#ECSWorker-990"><span class="linenos"> 990</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-991"><a href="#ECSWorker-991"><span class="linenos"> 991</span></a><span class="sd">        Retrieve an existing task definition from AWS.</span>
</span><span id="ECSWorker-992"><a href="#ECSWorker-992"><span class="linenos"> 992</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-993"><a href="#ECSWorker-993"><span class="linenos"> 993</span></a>        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;arn:aws:ecs:&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-994"><a href="#ECSWorker-994"><span class="linenos"> 994</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving ECS task definition </span><span class="si">{</span><span class="n">task_definition</span><span class="si">!r}</span><span class="s2">...&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-995"><a href="#ECSWorker-995"><span class="linenos"> 995</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-996"><a href="#ECSWorker-996"><span class="linenos"> 996</span></a>            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSWorker-997"><a href="#ECSWorker-997"><span class="linenos"> 997</span></a>                <span class="s2">&quot;Retrieving most recent active revision from &quot;</span>
</span><span id="ECSWorker-998"><a href="#ECSWorker-998"><span class="linenos"> 998</span></a>                <span class="sa">f</span><span class="s2">&quot;ECS task family </span><span class="si">{</span><span class="n">task_definition</span><span class="si">!r}</span><span class="s2">...&quot;</span>
</span><span id="ECSWorker-999"><a href="#ECSWorker-999"><span class="linenos"> 999</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1000"><a href="#ECSWorker-1000"><span class="linenos">1000</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_task_definition</span><span class="p">(</span><span class="n">taskDefinition</span><span class="o">=</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-1001"><a href="#ECSWorker-1001"><span class="linenos">1001</span></a>        <span class="k">return</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1002"><a href="#ECSWorker-1002"><span class="linenos">1002</span></a>
</span><span id="ECSWorker-1003"><a href="#ECSWorker-1003"><span class="linenos">1003</span></a>    <span class="k">def</span> <span class="nf">_wait_for_task_start</span><span class="p">(</span>
</span><span id="ECSWorker-1004"><a href="#ECSWorker-1004"><span class="linenos">1004</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1005"><a href="#ECSWorker-1005"><span class="linenos">1005</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-1006"><a href="#ECSWorker-1006"><span class="linenos">1006</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1007"><a href="#ECSWorker-1007"><span class="linenos">1007</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1008"><a href="#ECSWorker-1008"><span class="linenos">1008</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1009"><a href="#ECSWorker-1009"><span class="linenos">1009</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-1010"><a href="#ECSWorker-1010"><span class="linenos">1010</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="ECSWorker-1011"><a href="#ECSWorker-1011"><span class="linenos">1011</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSWorker-1012"><a href="#ECSWorker-1012"><span class="linenos">1012</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1013"><a href="#ECSWorker-1013"><span class="linenos">1013</span></a><span class="sd">        Waits for an ECS task run to reach a RUNNING status.</span>
</span><span id="ECSWorker-1014"><a href="#ECSWorker-1014"><span class="linenos">1014</span></a>
</span><span id="ECSWorker-1015"><a href="#ECSWorker-1015"><span class="linenos">1015</span></a><span class="sd">        If a STOPPED status is reached instead, an exception is raised indicating the</span>
</span><span id="ECSWorker-1016"><a href="#ECSWorker-1016"><span class="linenos">1016</span></a><span class="sd">        reason that the task run did not start.</span>
</span><span id="ECSWorker-1017"><a href="#ECSWorker-1017"><span class="linenos">1017</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1018"><a href="#ECSWorker-1018"><span class="linenos">1018</span></a>        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSWorker-1019"><a href="#ECSWorker-1019"><span class="linenos">1019</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-1020"><a href="#ECSWorker-1020"><span class="linenos">1020</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-1021"><a href="#ECSWorker-1021"><span class="linenos">1021</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-1022"><a href="#ECSWorker-1022"><span class="linenos">1022</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-1023"><a href="#ECSWorker-1023"><span class="linenos">1023</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-1024"><a href="#ECSWorker-1024"><span class="linenos">1024</span></a>            <span class="n">until_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1025"><a href="#ECSWorker-1025"><span class="linenos">1025</span></a>            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">,</span>
</span><span id="ECSWorker-1026"><a href="#ECSWorker-1026"><span class="linenos">1026</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-1027"><a href="#ECSWorker-1027"><span class="linenos">1027</span></a>            <span class="c1"># TODO: It is possible that the task has passed _through_ a RUNNING</span>
</span><span id="ECSWorker-1028"><a href="#ECSWorker-1028"><span class="linenos">1028</span></a>            <span class="c1">#       status during the polling interval. In this case, there is not an</span>
</span><span id="ECSWorker-1029"><a href="#ECSWorker-1029"><span class="linenos">1029</span></a>            <span class="c1">#       exception to raise.</span>
</span><span id="ECSWorker-1030"><a href="#ECSWorker-1030"><span class="linenos">1030</span></a>            <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1031"><a href="#ECSWorker-1031"><span class="linenos">1031</span></a>                <span class="n">code</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stopCode&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1032"><a href="#ECSWorker-1032"><span class="linenos">1032</span></a>                <span class="n">reason</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stoppedReason&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1033"><a href="#ECSWorker-1033"><span class="linenos">1033</span></a>                <span class="c1"># Generate a dynamic exception type from the AWS name</span>
</span><span id="ECSWorker-1034"><a href="#ECSWorker-1034"><span class="linenos">1034</span></a>                <span class="k">raise</span> <span class="nb">type</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="p">(</span><span class="ne">RuntimeError</span><span class="p">,),</span> <span class="p">{})(</span><span class="n">reason</span><span class="p">)</span>
</span><span id="ECSWorker-1035"><a href="#ECSWorker-1035"><span class="linenos">1035</span></a>
</span><span id="ECSWorker-1036"><a href="#ECSWorker-1036"><span class="linenos">1036</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="ECSWorker-1037"><a href="#ECSWorker-1037"><span class="linenos">1037</span></a>
</span><span id="ECSWorker-1038"><a href="#ECSWorker-1038"><span class="linenos">1038</span></a>    <span class="k">def</span> <span class="nf">_wait_for_task_finish</span><span class="p">(</span>
</span><span id="ECSWorker-1039"><a href="#ECSWorker-1039"><span class="linenos">1039</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1040"><a href="#ECSWorker-1040"><span class="linenos">1040</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-1041"><a href="#ECSWorker-1041"><span class="linenos">1041</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1042"><a href="#ECSWorker-1042"><span class="linenos">1042</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1043"><a href="#ECSWorker-1043"><span class="linenos">1043</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1044"><a href="#ECSWorker-1044"><span class="linenos">1044</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-1045"><a href="#ECSWorker-1045"><span class="linenos">1045</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-1046"><a href="#ECSWorker-1046"><span class="linenos">1046</span></a>    <span class="p">):</span>
</span><span id="ECSWorker-1047"><a href="#ECSWorker-1047"><span class="linenos">1047</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1048"><a href="#ECSWorker-1048"><span class="linenos">1048</span></a><span class="sd">        Watch an ECS task until it reaches a STOPPED status.</span>
</span><span id="ECSWorker-1049"><a href="#ECSWorker-1049"><span class="linenos">1049</span></a>
</span><span id="ECSWorker-1050"><a href="#ECSWorker-1050"><span class="linenos">1050</span></a><span class="sd">        If configured, logs from the Prefect container are streamed to stderr.</span>
</span><span id="ECSWorker-1051"><a href="#ECSWorker-1051"><span class="linenos">1051</span></a>
</span><span id="ECSWorker-1052"><a href="#ECSWorker-1052"><span class="linenos">1052</span></a><span class="sd">        Returns a description of the task on completion.</span>
</span><span id="ECSWorker-1053"><a href="#ECSWorker-1053"><span class="linenos">1053</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1054"><a href="#ECSWorker-1054"><span class="linenos">1054</span></a>        <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="ECSWorker-1055"><a href="#ECSWorker-1055"><span class="linenos">1055</span></a>        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-1056"><a href="#ECSWorker-1056"><span class="linenos">1056</span></a>            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
</span><span id="ECSWorker-1057"><a href="#ECSWorker-1057"><span class="linenos">1057</span></a>            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-1058"><a href="#ECSWorker-1058"><span class="linenos">1058</span></a>            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
</span><span id="ECSWorker-1059"><a href="#ECSWorker-1059"><span class="linenos">1059</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1060"><a href="#ECSWorker-1060"><span class="linenos">1060</span></a>
</span><span id="ECSWorker-1061"><a href="#ECSWorker-1061"><span class="linenos">1061</span></a>        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">stream_output</span><span class="p">:</span>
</span><span id="ECSWorker-1062"><a href="#ECSWorker-1062"><span class="linenos">1062</span></a>            <span class="n">container_def</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span>
</span><span id="ECSWorker-1063"><a href="#ECSWorker-1063"><span class="linenos">1063</span></a>                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">],</span> <span class="n">container_name</span>
</span><span id="ECSWorker-1064"><a href="#ECSWorker-1064"><span class="linenos">1064</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1065"><a href="#ECSWorker-1065"><span class="linenos">1065</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">:</span>
</span><span id="ECSWorker-1066"><a href="#ECSWorker-1066"><span class="linenos">1066</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-1067"><a href="#ECSWorker-1067"><span class="linenos">1067</span></a>                    <span class="s2">&quot;Prefect container definition not found in &quot;</span>
</span><span id="ECSWorker-1068"><a href="#ECSWorker-1068"><span class="linenos">1068</span></a>                    <span class="s2">&quot;task definition. Output cannot be streamed.&quot;</span>
</span><span id="ECSWorker-1069"><a href="#ECSWorker-1069"><span class="linenos">1069</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1070"><a href="#ECSWorker-1070"><span class="linenos">1070</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1071"><a href="#ECSWorker-1071"><span class="linenos">1071</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-1072"><a href="#ECSWorker-1072"><span class="linenos">1072</span></a>                    <span class="s2">&quot;Logging configuration not found on task. &quot;</span>
</span><span id="ECSWorker-1073"><a href="#ECSWorker-1073"><span class="linenos">1073</span></a>                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
</span><span id="ECSWorker-1074"><a href="#ECSWorker-1074"><span class="linenos">1074</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1075"><a href="#ECSWorker-1075"><span class="linenos">1075</span></a>            <span class="k">elif</span> <span class="ow">not</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;logDriver&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1076"><a href="#ECSWorker-1076"><span class="linenos">1076</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-1077"><a href="#ECSWorker-1077"><span class="linenos">1077</span></a>                    <span class="s2">&quot;Logging configuration uses unsupported &quot;</span>
</span><span id="ECSWorker-1078"><a href="#ECSWorker-1078"><span class="linenos">1078</span></a>                    <span class="s2">&quot; driver {container_def[&#39;logConfiguration&#39;].get(&#39;logDriver&#39;)!r}. &quot;</span>
</span><span id="ECSWorker-1079"><a href="#ECSWorker-1079"><span class="linenos">1079</span></a>                    <span class="s2">&quot;Output cannot be streamed.&quot;</span>
</span><span id="ECSWorker-1080"><a href="#ECSWorker-1080"><span class="linenos">1080</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1081"><a href="#ECSWorker-1081"><span class="linenos">1081</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-1082"><a href="#ECSWorker-1082"><span class="linenos">1082</span></a>                <span class="c1"># Prepare to stream the output</span>
</span><span id="ECSWorker-1083"><a href="#ECSWorker-1083"><span class="linenos">1083</span></a>                <span class="n">log_config</span> <span class="o">=</span> <span class="n">container_def</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">][</span><span class="s2">&quot;options&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1084"><a href="#ECSWorker-1084"><span class="linenos">1084</span></a>                <span class="n">logs_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;logs&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1085"><a href="#ECSWorker-1085"><span class="linenos">1085</span></a>                <span class="n">can_stream_output</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="ECSWorker-1086"><a href="#ECSWorker-1086"><span class="linenos">1086</span></a>                <span class="c1"># Track the last log timestamp to prevent double display</span>
</span><span id="ECSWorker-1087"><a href="#ECSWorker-1087"><span class="linenos">1087</span></a>                <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSWorker-1088"><a href="#ECSWorker-1088"><span class="linenos">1088</span></a>                <span class="c1"># Determine the name of the stream as &quot;prefix/container/run-id&quot;</span>
</span><span id="ECSWorker-1089"><a href="#ECSWorker-1089"><span class="linenos">1089</span></a>                <span class="n">stream_name</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span id="ECSWorker-1090"><a href="#ECSWorker-1090"><span class="linenos">1090</span></a>                    <span class="p">[</span>
</span><span id="ECSWorker-1091"><a href="#ECSWorker-1091"><span class="linenos">1091</span></a>                        <span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">],</span>
</span><span id="ECSWorker-1092"><a href="#ECSWorker-1092"><span class="linenos">1092</span></a>                        <span class="n">container_name</span><span class="p">,</span>
</span><span id="ECSWorker-1093"><a href="#ECSWorker-1093"><span class="linenos">1093</span></a>                        <span class="n">task_arn</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
</span><span id="ECSWorker-1094"><a href="#ECSWorker-1094"><span class="linenos">1094</span></a>                    <span class="p">]</span>
</span><span id="ECSWorker-1095"><a href="#ECSWorker-1095"><span class="linenos">1095</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1096"><a href="#ECSWorker-1096"><span class="linenos">1096</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
</span><span id="ECSWorker-1097"><a href="#ECSWorker-1097"><span class="linenos">1097</span></a>                    <span class="sa">f</span><span class="s2">&quot;Streaming output from container </span><span class="si">{</span><span class="n">container_name</span><span class="si">!r}</span><span class="s2">...&quot;</span>
</span><span id="ECSWorker-1098"><a href="#ECSWorker-1098"><span class="linenos">1098</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1099"><a href="#ECSWorker-1099"><span class="linenos">1099</span></a>
</span><span id="ECSWorker-1100"><a href="#ECSWorker-1100"><span class="linenos">1100</span></a>        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSWorker-1101"><a href="#ECSWorker-1101"><span class="linenos">1101</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-1102"><a href="#ECSWorker-1102"><span class="linenos">1102</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-1103"><a href="#ECSWorker-1103"><span class="linenos">1103</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker-1104"><a href="#ECSWorker-1104"><span class="linenos">1104</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker-1105"><a href="#ECSWorker-1105"><span class="linenos">1105</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker-1106"><a href="#ECSWorker-1106"><span class="linenos">1106</span></a>            <span class="n">current_status</span><span class="o">=</span><span class="s2">&quot;RUNNING&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1107"><a href="#ECSWorker-1107"><span class="linenos">1107</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-1108"><a href="#ECSWorker-1108"><span class="linenos">1108</span></a>            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">stream_output</span> <span class="ow">and</span> <span class="n">can_stream_output</span><span class="p">:</span>
</span><span id="ECSWorker-1109"><a href="#ECSWorker-1109"><span class="linenos">1109</span></a>                <span class="c1"># On each poll for task run status, also retrieve available logs</span>
</span><span id="ECSWorker-1110"><a href="#ECSWorker-1110"><span class="linenos">1110</span></a>                <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stream_available_logs</span><span class="p">(</span>
</span><span id="ECSWorker-1111"><a href="#ECSWorker-1111"><span class="linenos">1111</span></a>                    <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker-1112"><a href="#ECSWorker-1112"><span class="linenos">1112</span></a>                    <span class="n">logs_client</span><span class="p">,</span>
</span><span id="ECSWorker-1113"><a href="#ECSWorker-1113"><span class="linenos">1113</span></a>                    <span class="n">log_group</span><span class="o">=</span><span class="n">log_config</span><span class="p">[</span><span class="s2">&quot;awslogs-group&quot;</span><span class="p">],</span>
</span><span id="ECSWorker-1114"><a href="#ECSWorker-1114"><span class="linenos">1114</span></a>                    <span class="n">log_stream</span><span class="o">=</span><span class="n">stream_name</span><span class="p">,</span>
</span><span id="ECSWorker-1115"><a href="#ECSWorker-1115"><span class="linenos">1115</span></a>                    <span class="n">last_log_timestamp</span><span class="o">=</span><span class="n">last_log_timestamp</span><span class="p">,</span>
</span><span id="ECSWorker-1116"><a href="#ECSWorker-1116"><span class="linenos">1116</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1117"><a href="#ECSWorker-1117"><span class="linenos">1117</span></a>
</span><span id="ECSWorker-1118"><a href="#ECSWorker-1118"><span class="linenos">1118</span></a>        <span class="k">return</span> <span class="n">task</span>
</span><span id="ECSWorker-1119"><a href="#ECSWorker-1119"><span class="linenos">1119</span></a>
</span><span id="ECSWorker-1120"><a href="#ECSWorker-1120"><span class="linenos">1120</span></a>    <span class="k">def</span> <span class="nf">_stream_available_logs</span><span class="p">(</span>
</span><span id="ECSWorker-1121"><a href="#ECSWorker-1121"><span class="linenos">1121</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1122"><a href="#ECSWorker-1122"><span class="linenos">1122</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-1123"><a href="#ECSWorker-1123"><span class="linenos">1123</span></a>        <span class="n">logs_client</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="ECSWorker-1124"><a href="#ECSWorker-1124"><span class="linenos">1124</span></a>        <span class="n">log_group</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1125"><a href="#ECSWorker-1125"><span class="linenos">1125</span></a>        <span class="n">log_stream</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1126"><a href="#ECSWorker-1126"><span class="linenos">1126</span></a>        <span class="n">last_log_timestamp</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSWorker-1127"><a href="#ECSWorker-1127"><span class="linenos">1127</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="ECSWorker-1128"><a href="#ECSWorker-1128"><span class="linenos">1128</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1129"><a href="#ECSWorker-1129"><span class="linenos">1129</span></a><span class="sd">        Stream logs from the given log group and stream since the last log timestamp.</span>
</span><span id="ECSWorker-1130"><a href="#ECSWorker-1130"><span class="linenos">1130</span></a>
</span><span id="ECSWorker-1131"><a href="#ECSWorker-1131"><span class="linenos">1131</span></a><span class="sd">        Will continue on paginated responses until all logs are returned.</span>
</span><span id="ECSWorker-1132"><a href="#ECSWorker-1132"><span class="linenos">1132</span></a>
</span><span id="ECSWorker-1133"><a href="#ECSWorker-1133"><span class="linenos">1133</span></a><span class="sd">        Returns the last log timestamp which can be used to call this method in the</span>
</span><span id="ECSWorker-1134"><a href="#ECSWorker-1134"><span class="linenos">1134</span></a><span class="sd">        future.</span>
</span><span id="ECSWorker-1135"><a href="#ECSWorker-1135"><span class="linenos">1135</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1136"><a href="#ECSWorker-1136"><span class="linenos">1136</span></a>        <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="s2">&quot;NO-TOKEN&quot;</span>
</span><span id="ECSWorker-1137"><a href="#ECSWorker-1137"><span class="linenos">1137</span></a>        <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="ECSWorker-1138"><a href="#ECSWorker-1138"><span class="linenos">1138</span></a>
</span><span id="ECSWorker-1139"><a href="#ECSWorker-1139"><span class="linenos">1139</span></a>        <span class="c1"># AWS will return the same token that we send once the end of the paginated</span>
</span><span id="ECSWorker-1140"><a href="#ECSWorker-1140"><span class="linenos">1140</span></a>        <span class="c1"># response is reached</span>
</span><span id="ECSWorker-1141"><a href="#ECSWorker-1141"><span class="linenos">1141</span></a>        <span class="k">while</span> <span class="n">last_log_stream_token</span> <span class="o">!=</span> <span class="n">next_log_stream_token</span><span class="p">:</span>
</span><span id="ECSWorker-1142"><a href="#ECSWorker-1142"><span class="linenos">1142</span></a>            <span class="n">last_log_stream_token</span> <span class="o">=</span> <span class="n">next_log_stream_token</span>
</span><span id="ECSWorker-1143"><a href="#ECSWorker-1143"><span class="linenos">1143</span></a>
</span><span id="ECSWorker-1144"><a href="#ECSWorker-1144"><span class="linenos">1144</span></a>            <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSWorker-1145"><a href="#ECSWorker-1145"><span class="linenos">1145</span></a>                <span class="s2">&quot;logGroupName&quot;</span><span class="p">:</span> <span class="n">log_group</span><span class="p">,</span>
</span><span id="ECSWorker-1146"><a href="#ECSWorker-1146"><span class="linenos">1146</span></a>                <span class="s2">&quot;logStreamName&quot;</span><span class="p">:</span> <span class="n">log_stream</span><span class="p">,</span>
</span><span id="ECSWorker-1147"><a href="#ECSWorker-1147"><span class="linenos">1147</span></a>            <span class="p">}</span>
</span><span id="ECSWorker-1148"><a href="#ECSWorker-1148"><span class="linenos">1148</span></a>
</span><span id="ECSWorker-1149"><a href="#ECSWorker-1149"><span class="linenos">1149</span></a>            <span class="k">if</span> <span class="n">last_log_stream_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1150"><a href="#ECSWorker-1150"><span class="linenos">1150</span></a>                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;nextToken&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_stream_token</span>
</span><span id="ECSWorker-1151"><a href="#ECSWorker-1151"><span class="linenos">1151</span></a>
</span><span id="ECSWorker-1152"><a href="#ECSWorker-1152"><span class="linenos">1152</span></a>            <span class="k">if</span> <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1153"><a href="#ECSWorker-1153"><span class="linenos">1153</span></a>                <span class="c1"># Bump the timestamp by one ms to avoid retrieving the last log again</span>
</span><span id="ECSWorker-1154"><a href="#ECSWorker-1154"><span class="linenos">1154</span></a>                <span class="n">request</span><span class="p">[</span><span class="s2">&quot;startTime&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">last_log_timestamp</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="ECSWorker-1155"><a href="#ECSWorker-1155"><span class="linenos">1155</span></a>
</span><span id="ECSWorker-1156"><a href="#ECSWorker-1156"><span class="linenos">1156</span></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="ECSWorker-1157"><a href="#ECSWorker-1157"><span class="linenos">1157</span></a>                <span class="n">response</span> <span class="o">=</span> <span class="n">logs_client</span><span class="o">.</span><span class="n">get_log_events</span><span class="p">(</span><span class="o">**</span><span class="n">request</span><span class="p">)</span>
</span><span id="ECSWorker-1158"><a href="#ECSWorker-1158"><span class="linenos">1158</span></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="ECSWorker-1159"><a href="#ECSWorker-1159"><span class="linenos">1159</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
</span><span id="ECSWorker-1160"><a href="#ECSWorker-1160"><span class="linenos">1160</span></a>                    <span class="sa">f</span><span class="s2">&quot;Failed to read log events with request </span><span class="si">{</span><span class="n">request</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1161"><a href="#ECSWorker-1161"><span class="linenos">1161</span></a>                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSWorker-1162"><a href="#ECSWorker-1162"><span class="linenos">1162</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1163"><a href="#ECSWorker-1163"><span class="linenos">1163</span></a>                <span class="k">return</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSWorker-1164"><a href="#ECSWorker-1164"><span class="linenos">1164</span></a>
</span><span id="ECSWorker-1165"><a href="#ECSWorker-1165"><span class="linenos">1165</span></a>            <span class="n">log_events</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1166"><a href="#ECSWorker-1166"><span class="linenos">1166</span></a>            <span class="k">for</span> <span class="n">log_event</span> <span class="ow">in</span> <span class="n">log_events</span><span class="p">:</span>
</span><span id="ECSWorker-1167"><a href="#ECSWorker-1167"><span class="linenos">1167</span></a>                <span class="c1"># TODO: This doesn&#39;t forward to the local logger, which can be</span>
</span><span id="ECSWorker-1168"><a href="#ECSWorker-1168"><span class="linenos">1168</span></a>                <span class="c1">#       bad for customizing handling and understanding where the</span>
</span><span id="ECSWorker-1169"><a href="#ECSWorker-1169"><span class="linenos">1169</span></a>                <span class="c1">#       log is coming from, but it avoid nesting logger information</span>
</span><span id="ECSWorker-1170"><a href="#ECSWorker-1170"><span class="linenos">1170</span></a>                <span class="c1">#       when the content is output from a Prefect logger on the</span>
</span><span id="ECSWorker-1171"><a href="#ECSWorker-1171"><span class="linenos">1171</span></a>                <span class="c1">#       running infrastructure</span>
</span><span id="ECSWorker-1172"><a href="#ECSWorker-1172"><span class="linenos">1172</span></a>                <span class="nb">print</span><span class="p">(</span><span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
</span><span id="ECSWorker-1173"><a href="#ECSWorker-1173"><span class="linenos">1173</span></a>
</span><span id="ECSWorker-1174"><a href="#ECSWorker-1174"><span class="linenos">1174</span></a>                <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSWorker-1175"><a href="#ECSWorker-1175"><span class="linenos">1175</span></a>                    <span class="n">last_log_timestamp</span> <span class="ow">is</span> <span class="kc">None</span>
</span><span id="ECSWorker-1176"><a href="#ECSWorker-1176"><span class="linenos">1176</span></a>                    <span class="ow">or</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSWorker-1177"><a href="#ECSWorker-1177"><span class="linenos">1177</span></a>                <span class="p">):</span>
</span><span id="ECSWorker-1178"><a href="#ECSWorker-1178"><span class="linenos">1178</span></a>                    <span class="n">last_log_timestamp</span> <span class="o">=</span> <span class="n">log_event</span><span class="p">[</span><span class="s2">&quot;timestamp&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1179"><a href="#ECSWorker-1179"><span class="linenos">1179</span></a>
</span><span id="ECSWorker-1180"><a href="#ECSWorker-1180"><span class="linenos">1180</span></a>            <span class="n">next_log_stream_token</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;nextForwardToken&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1181"><a href="#ECSWorker-1181"><span class="linenos">1181</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">log_events</span><span class="p">:</span>
</span><span id="ECSWorker-1182"><a href="#ECSWorker-1182"><span class="linenos">1182</span></a>                <span class="c1"># Stop reading pages if there was no data</span>
</span><span id="ECSWorker-1183"><a href="#ECSWorker-1183"><span class="linenos">1183</span></a>                <span class="k">break</span>
</span><span id="ECSWorker-1184"><a href="#ECSWorker-1184"><span class="linenos">1184</span></a>
</span><span id="ECSWorker-1185"><a href="#ECSWorker-1185"><span class="linenos">1185</span></a>        <span class="k">return</span> <span class="n">last_log_timestamp</span>
</span><span id="ECSWorker-1186"><a href="#ECSWorker-1186"><span class="linenos">1186</span></a>
</span><span id="ECSWorker-1187"><a href="#ECSWorker-1187"><span class="linenos">1187</span></a>    <span class="k">def</span> <span class="nf">_watch_task_run</span><span class="p">(</span>
</span><span id="ECSWorker-1188"><a href="#ECSWorker-1188"><span class="linenos">1188</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1189"><a href="#ECSWorker-1189"><span class="linenos">1189</span></a>        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
</span><span id="ECSWorker-1190"><a href="#ECSWorker-1190"><span class="linenos">1190</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1191"><a href="#ECSWorker-1191"><span class="linenos">1191</span></a>        <span class="n">task_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1192"><a href="#ECSWorker-1192"><span class="linenos">1192</span></a>        <span class="n">cluster_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1193"><a href="#ECSWorker-1193"><span class="linenos">1193</span></a>        <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span>
</span><span id="ECSWorker-1194"><a href="#ECSWorker-1194"><span class="linenos">1194</span></a>        <span class="n">current_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;UNKNOWN&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1195"><a href="#ECSWorker-1195"><span class="linenos">1195</span></a>        <span class="n">until_status</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSWorker-1196"><a href="#ECSWorker-1196"><span class="linenos">1196</span></a>        <span class="n">timeout</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSWorker-1197"><a href="#ECSWorker-1197"><span class="linenos">1197</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">dict</span><span class="p">]:</span>
</span><span id="ECSWorker-1198"><a href="#ECSWorker-1198"><span class="linenos">1198</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1199"><a href="#ECSWorker-1199"><span class="linenos">1199</span></a><span class="sd">        Watches an ECS task run by querying every `poll_interval` seconds. After each</span>
</span><span id="ECSWorker-1200"><a href="#ECSWorker-1200"><span class="linenos">1200</span></a><span class="sd">        query, the retrieved task is yielded. This function returns when the task run</span>
</span><span id="ECSWorker-1201"><a href="#ECSWorker-1201"><span class="linenos">1201</span></a><span class="sd">        reaches a STOPPED status or the provided `until_status`.</span>
</span><span id="ECSWorker-1202"><a href="#ECSWorker-1202"><span class="linenos">1202</span></a>
</span><span id="ECSWorker-1203"><a href="#ECSWorker-1203"><span class="linenos">1203</span></a><span class="sd">        Emits a log each time the status changes.</span>
</span><span id="ECSWorker-1204"><a href="#ECSWorker-1204"><span class="linenos">1204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1205"><a href="#ECSWorker-1205"><span class="linenos">1205</span></a>        <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span> <span class="o">=</span> <span class="n">current_status</span>
</span><span id="ECSWorker-1206"><a href="#ECSWorker-1206"><span class="linenos">1206</span></a>        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="ECSWorker-1207"><a href="#ECSWorker-1207"><span class="linenos">1207</span></a>        <span class="k">while</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">until_status</span><span class="p">:</span>
</span><span id="ECSWorker-1208"><a href="#ECSWorker-1208"><span class="linenos">1208</span></a>            <span class="n">tasks</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">describe_tasks</span><span class="p">(</span>
</span><span id="ECSWorker-1209"><a href="#ECSWorker-1209"><span class="linenos">1209</span></a>                <span class="n">tasks</span><span class="o">=</span><span class="p">[</span><span class="n">task_arn</span><span class="p">],</span> <span class="n">cluster</span><span class="o">=</span><span class="n">cluster_arn</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;TAGS&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1210"><a href="#ECSWorker-1210"><span class="linenos">1210</span></a>            <span class="p">)[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1211"><a href="#ECSWorker-1211"><span class="linenos">1211</span></a>
</span><span id="ECSWorker-1212"><a href="#ECSWorker-1212"><span class="linenos">1212</span></a>            <span class="k">if</span> <span class="n">tasks</span><span class="p">:</span>
</span><span id="ECSWorker-1213"><a href="#ECSWorker-1213"><span class="linenos">1213</span></a>                <span class="n">task</span> <span class="o">=</span> <span class="n">tasks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ECSWorker-1214"><a href="#ECSWorker-1214"><span class="linenos">1214</span></a>
</span><span id="ECSWorker-1215"><a href="#ECSWorker-1215"><span class="linenos">1215</span></a>                <span class="n">status</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;lastStatus&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1216"><a href="#ECSWorker-1216"><span class="linenos">1216</span></a>                <span class="k">if</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">last_status</span><span class="p">:</span>
</span><span id="ECSWorker-1217"><a href="#ECSWorker-1217"><span class="linenos">1217</span></a>                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ECS task status is </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1218"><a href="#ECSWorker-1218"><span class="linenos">1218</span></a>
</span><span id="ECSWorker-1219"><a href="#ECSWorker-1219"><span class="linenos">1219</span></a>                <span class="k">yield</span> <span class="n">task</span>
</span><span id="ECSWorker-1220"><a href="#ECSWorker-1220"><span class="linenos">1220</span></a>
</span><span id="ECSWorker-1221"><a href="#ECSWorker-1221"><span class="linenos">1221</span></a>                <span class="c1"># No point in continuing if the status is final</span>
</span><span id="ECSWorker-1222"><a href="#ECSWorker-1222"><span class="linenos">1222</span></a>                <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="s2">&quot;STOPPED&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1223"><a href="#ECSWorker-1223"><span class="linenos">1223</span></a>                    <span class="k">break</span>
</span><span id="ECSWorker-1224"><a href="#ECSWorker-1224"><span class="linenos">1224</span></a>
</span><span id="ECSWorker-1225"><a href="#ECSWorker-1225"><span class="linenos">1225</span></a>                <span class="n">last_status</span> <span class="o">=</span> <span class="n">status</span>
</span><span id="ECSWorker-1226"><a href="#ECSWorker-1226"><span class="linenos">1226</span></a>
</span><span id="ECSWorker-1227"><a href="#ECSWorker-1227"><span class="linenos">1227</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-1228"><a href="#ECSWorker-1228"><span class="linenos">1228</span></a>                <span class="c1"># Intermittently, the task will not be described. We wat to respect the</span>
</span><span id="ECSWorker-1229"><a href="#ECSWorker-1229"><span class="linenos">1229</span></a>                <span class="c1"># watch timeout though.</span>
</span><span id="ECSWorker-1230"><a href="#ECSWorker-1230"><span class="linenos">1230</span></a>                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Task not found.&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1231"><a href="#ECSWorker-1231"><span class="linenos">1231</span></a>
</span><span id="ECSWorker-1232"><a href="#ECSWorker-1232"><span class="linenos">1232</span></a>            <span class="n">elapsed_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
</span><span id="ECSWorker-1233"><a href="#ECSWorker-1233"><span class="linenos">1233</span></a>            <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">elapsed_time</span> <span class="o">&gt;</span> <span class="n">timeout</span><span class="p">:</span>
</span><span id="ECSWorker-1234"><a href="#ECSWorker-1234"><span class="linenos">1234</span></a>                <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-1235"><a href="#ECSWorker-1235"><span class="linenos">1235</span></a>                    <span class="sa">f</span><span class="s2">&quot;Timed out after </span><span class="si">{</span><span class="n">elapsed_time</span><span class="si">}</span><span class="s2">s while watching task for status &quot;</span>
</span><span id="ECSWorker-1236"><a href="#ECSWorker-1236"><span class="linenos">1236</span></a>                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">until_status</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;STOPPED&#39;</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-1237"><a href="#ECSWorker-1237"><span class="linenos">1237</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1238"><a href="#ECSWorker-1238"><span class="linenos">1238</span></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_watch_poll_interval</span><span class="p">)</span>
</span><span id="ECSWorker-1239"><a href="#ECSWorker-1239"><span class="linenos">1239</span></a>
</span><span id="ECSWorker-1240"><a href="#ECSWorker-1240"><span class="linenos">1240</span></a>    <span class="k">def</span> <span class="nf">_get_or_generate_family</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSWorker-1241"><a href="#ECSWorker-1241"><span class="linenos">1241</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1242"><a href="#ECSWorker-1242"><span class="linenos">1242</span></a><span class="sd">        Gets or generate a family for the task definition.</span>
</span><span id="ECSWorker-1243"><a href="#ECSWorker-1243"><span class="linenos">1243</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1244"><a href="#ECSWorker-1244"><span class="linenos">1244</span></a>        <span class="n">family</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;family&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1245"><a href="#ECSWorker-1245"><span class="linenos">1245</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">family</span><span class="p">:</span>
</span><span id="ECSWorker-1246"><a href="#ECSWorker-1246"><span class="linenos">1246</span></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span> <span class="ow">and</span> <span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span>
</span><span id="ECSWorker-1247"><a href="#ECSWorker-1247"><span class="linenos">1247</span></a>            <span class="n">family</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-1248"><a href="#ECSWorker-1248"><span class="linenos">1248</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ECS_DEFAULT_FAMILY</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-1249"><a href="#ECSWorker-1249"><span class="linenos">1249</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1250"><a href="#ECSWorker-1250"><span class="linenos">1250</span></a>        <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSWorker-1251"><a href="#ECSWorker-1251"><span class="linenos">1251</span></a>            <span class="n">family</span><span class="p">,</span>
</span><span id="ECSWorker-1252"><a href="#ECSWorker-1252"><span class="linenos">1252</span></a>            <span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span>
</span><span id="ECSWorker-1253"><a href="#ECSWorker-1253"><span class="linenos">1253</span></a>            <span class="n">regex_pattern</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9-_]+&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1254"><a href="#ECSWorker-1254"><span class="linenos">1254</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1255"><a href="#ECSWorker-1255"><span class="linenos">1255</span></a>        <span class="k">return</span> <span class="n">family</span>
</span><span id="ECSWorker-1256"><a href="#ECSWorker-1256"><span class="linenos">1256</span></a>
</span><span id="ECSWorker-1257"><a href="#ECSWorker-1257"><span class="linenos">1257</span></a>    <span class="k">def</span> <span class="nf">_prepare_task_definition</span><span class="p">(</span>
</span><span id="ECSWorker-1258"><a href="#ECSWorker-1258"><span class="linenos">1258</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1259"><a href="#ECSWorker-1259"><span class="linenos">1259</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1260"><a href="#ECSWorker-1260"><span class="linenos">1260</span></a>        <span class="n">region</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1261"><a href="#ECSWorker-1261"><span class="linenos">1261</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="n">FlowRun</span><span class="p">,</span>
</span><span id="ECSWorker-1262"><a href="#ECSWorker-1262"><span class="linenos">1262</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSWorker-1263"><a href="#ECSWorker-1263"><span class="linenos">1263</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1264"><a href="#ECSWorker-1264"><span class="linenos">1264</span></a><span class="sd">        Prepare a task definition by inferring any defaults and merging overrides.</span>
</span><span id="ECSWorker-1265"><a href="#ECSWorker-1265"><span class="linenos">1265</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1266"><a href="#ECSWorker-1266"><span class="linenos">1266</span></a>        <span class="n">task_definition</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-1267"><a href="#ECSWorker-1267"><span class="linenos">1267</span></a>
</span><span id="ECSWorker-1268"><a href="#ECSWorker-1268"><span class="linenos">1268</span></a>        <span class="c1"># Configure the Prefect runtime container</span>
</span><span id="ECSWorker-1269"><a href="#ECSWorker-1269"><span class="linenos">1269</span></a>        <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1270"><a href="#ECSWorker-1270"><span class="linenos">1270</span></a>
</span><span id="ECSWorker-1271"><a href="#ECSWorker-1271"><span class="linenos">1271</span></a>        <span class="c1"># Remove empty container definitions</span>
</span><span id="ECSWorker-1272"><a href="#ECSWorker-1272"><span class="linenos">1272</span></a>        <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1273"><a href="#ECSWorker-1273"><span class="linenos">1273</span></a>            <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="n">d</span>
</span><span id="ECSWorker-1274"><a href="#ECSWorker-1274"><span class="linenos">1274</span></a>        <span class="p">]</span>
</span><span id="ECSWorker-1275"><a href="#ECSWorker-1275"><span class="linenos">1275</span></a>
</span><span id="ECSWorker-1276"><a href="#ECSWorker-1276"><span class="linenos">1276</span></a>        <span class="n">container_name</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
</span><span id="ECSWorker-1277"><a href="#ECSWorker-1277"><span class="linenos">1277</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">container_name</span><span class="p">:</span>
</span><span id="ECSWorker-1278"><a href="#ECSWorker-1278"><span class="linenos">1278</span></a>            <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-1279"><a href="#ECSWorker-1279"><span class="linenos">1279</span></a>                <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-1280"><a href="#ECSWorker-1280"><span class="linenos">1280</span></a>                <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
</span><span id="ECSWorker-1281"><a href="#ECSWorker-1281"><span class="linenos">1281</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1282"><a href="#ECSWorker-1282"><span class="linenos">1282</span></a>
</span><span id="ECSWorker-1283"><a href="#ECSWorker-1283"><span class="linenos">1283</span></a>        <span class="n">container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span>
</span><span id="ECSWorker-1284"><a href="#ECSWorker-1284"><span class="linenos">1284</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">],</span> <span class="n">container_name</span>
</span><span id="ECSWorker-1285"><a href="#ECSWorker-1285"><span class="linenos">1285</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1286"><a href="#ECSWorker-1286"><span class="linenos">1286</span></a>        <span class="k">if</span> <span class="n">container</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1287"><a href="#ECSWorker-1287"><span class="linenos">1287</span></a>            <span class="k">if</span> <span class="n">container_name</span> <span class="o">!=</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span><span class="p">:</span>
</span><span id="ECSWorker-1288"><a href="#ECSWorker-1288"><span class="linenos">1288</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1289"><a href="#ECSWorker-1289"><span class="linenos">1289</span></a>                    <span class="sa">f</span><span class="s2">&quot;Container </span><span class="si">{</span><span class="n">container_name</span><span class="si">!r}</span><span class="s2"> not found in task definition.&quot;</span>
</span><span id="ECSWorker-1290"><a href="#ECSWorker-1290"><span class="linenos">1290</span></a>                <span class="p">)</span>
</span><span id="ECSWorker-1291"><a href="#ECSWorker-1291"><span class="linenos">1291</span></a>
</span><span id="ECSWorker-1292"><a href="#ECSWorker-1292"><span class="linenos">1292</span></a>            <span class="c1"># Look for a container without a name</span>
</span><span id="ECSWorker-1293"><a href="#ECSWorker-1293"><span class="linenos">1293</span></a>            <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]:</span>
</span><span id="ECSWorker-1294"><a href="#ECSWorker-1294"><span class="linenos">1294</span></a>                <span class="k">if</span> <span class="s2">&quot;name&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">container</span><span class="p">:</span>
</span><span id="ECSWorker-1295"><a href="#ECSWorker-1295"><span class="linenos">1295</span></a>                    <span class="n">container</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_name</span>
</span><span id="ECSWorker-1296"><a href="#ECSWorker-1296"><span class="linenos">1296</span></a>                    <span class="k">break</span>
</span><span id="ECSWorker-1297"><a href="#ECSWorker-1297"><span class="linenos">1297</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-1298"><a href="#ECSWorker-1298"><span class="linenos">1298</span></a>                <span class="n">container</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">container_name</span><span class="p">}</span>
</span><span id="ECSWorker-1299"><a href="#ECSWorker-1299"><span class="linenos">1299</span></a>                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">container</span><span class="p">)</span>
</span><span id="ECSWorker-1300"><a href="#ECSWorker-1300"><span class="linenos">1300</span></a>
</span><span id="ECSWorker-1301"><a href="#ECSWorker-1301"><span class="linenos">1301</span></a>        <span class="c1"># Image is required so make sure it&#39;s present</span>
</span><span id="ECSWorker-1302"><a href="#ECSWorker-1302"><span class="linenos">1302</span></a>        <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;image&quot;</span><span class="p">,</span> <span class="n">get_prefect_image_name</span><span class="p">())</span>
</span><span id="ECSWorker-1303"><a href="#ECSWorker-1303"><span class="linenos">1303</span></a>
</span><span id="ECSWorker-1304"><a href="#ECSWorker-1304"><span class="linenos">1304</span></a>        <span class="c1"># Remove any keys that have been explicitly &quot;unset&quot;</span>
</span><span id="ECSWorker-1305"><a href="#ECSWorker-1305"><span class="linenos">1305</span></a>        <span class="n">unset_keys</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">}</span>
</span><span id="ECSWorker-1306"><a href="#ECSWorker-1306"><span class="linenos">1306</span></a>        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])):</span>
</span><span id="ECSWorker-1307"><a href="#ECSWorker-1307"><span class="linenos">1307</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">unset_keys</span> <span class="ow">or</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1308"><a href="#ECSWorker-1308"><span class="linenos">1308</span></a>                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
</span><span id="ECSWorker-1309"><a href="#ECSWorker-1309"><span class="linenos">1309</span></a>
</span><span id="ECSWorker-1310"><a href="#ECSWorker-1310"><span class="linenos">1310</span></a>        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">configure_cloudwatch_logs</span><span class="p">:</span>
</span><span id="ECSWorker-1311"><a href="#ECSWorker-1311"><span class="linenos">1311</span></a>            <span class="n">prefix</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;prefect-logs_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_work_pool_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">flow_run</span><span class="o">.</span><span class="n">deployment_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-1312"><a href="#ECSWorker-1312"><span class="linenos">1312</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;logConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="ECSWorker-1313"><a href="#ECSWorker-1313"><span class="linenos">1313</span></a>                <span class="s2">&quot;logDriver&quot;</span><span class="p">:</span> <span class="s2">&quot;awslogs&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1314"><a href="#ECSWorker-1314"><span class="linenos">1314</span></a>                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSWorker-1315"><a href="#ECSWorker-1315"><span class="linenos">1315</span></a>                    <span class="s2">&quot;awslogs-create-group&quot;</span><span class="p">:</span> <span class="s2">&quot;true&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1316"><a href="#ECSWorker-1316"><span class="linenos">1316</span></a>                    <span class="s2">&quot;awslogs-group&quot;</span><span class="p">:</span> <span class="s2">&quot;prefect&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1317"><a href="#ECSWorker-1317"><span class="linenos">1317</span></a>                    <span class="s2">&quot;awslogs-region&quot;</span><span class="p">:</span> <span class="n">region</span><span class="p">,</span>
</span><span id="ECSWorker-1318"><a href="#ECSWorker-1318"><span class="linenos">1318</span></a>                    <span class="s2">&quot;awslogs-stream-prefix&quot;</span><span class="p">:</span> <span class="p">(</span>
</span><span id="ECSWorker-1319"><a href="#ECSWorker-1319"><span class="linenos">1319</span></a>                        <span class="n">configuration</span><span class="o">.</span><span class="n">cloudwatch_logs_prefix</span> <span class="ow">or</span> <span class="n">prefix</span>
</span><span id="ECSWorker-1320"><a href="#ECSWorker-1320"><span class="linenos">1320</span></a>                    <span class="p">),</span>
</span><span id="ECSWorker-1321"><a href="#ECSWorker-1321"><span class="linenos">1321</span></a>                    <span class="o">**</span><span class="n">configuration</span><span class="o">.</span><span class="n">cloudwatch_logs_options</span><span class="p">,</span>
</span><span id="ECSWorker-1322"><a href="#ECSWorker-1322"><span class="linenos">1322</span></a>                <span class="p">},</span>
</span><span id="ECSWorker-1323"><a href="#ECSWorker-1323"><span class="linenos">1323</span></a>            <span class="p">}</span>
</span><span id="ECSWorker-1324"><a href="#ECSWorker-1324"><span class="linenos">1324</span></a>
</span><span id="ECSWorker-1325"><a href="#ECSWorker-1325"><span class="linenos">1325</span></a>        <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_or_generate_family</span><span class="p">(</span>
</span><span id="ECSWorker-1326"><a href="#ECSWorker-1326"><span class="linenos">1326</span></a>            <span class="n">task_definition</span><span class="p">,</span> <span class="n">flow_run</span>
</span><span id="ECSWorker-1327"><a href="#ECSWorker-1327"><span class="linenos">1327</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1328"><a href="#ECSWorker-1328"><span class="linenos">1328</span></a>        <span class="c1"># CPU and memory are required in some cases, retrieve the value to use</span>
</span><span id="ECSWorker-1329"><a href="#ECSWorker-1329"><span class="linenos">1329</span></a>        <span class="n">cpu</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_CPU</span>
</span><span id="ECSWorker-1330"><a href="#ECSWorker-1330"><span class="linenos">1330</span></a>        <span class="n">memory</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">ECS_DEFAULT_MEMORY</span>
</span><span id="ECSWorker-1331"><a href="#ECSWorker-1331"><span class="linenos">1331</span></a>
</span><span id="ECSWorker-1332"><a href="#ECSWorker-1332"><span class="linenos">1332</span></a>        <span class="n">launch_type</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
</span><span id="ECSWorker-1333"><a href="#ECSWorker-1333"><span class="linenos">1333</span></a>            <span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="n">ECS_DEFAULT_LAUNCH_TYPE</span>
</span><span id="ECSWorker-1334"><a href="#ECSWorker-1334"><span class="linenos">1334</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1335"><a href="#ECSWorker-1335"><span class="linenos">1335</span></a>
</span><span id="ECSWorker-1336"><a href="#ECSWorker-1336"><span class="linenos">1336</span></a>        <span class="k">if</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">or</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1337"><a href="#ECSWorker-1337"><span class="linenos">1337</span></a>            <span class="c1"># Task level memory and cpu are required when using fargate</span>
</span><span id="ECSWorker-1338"><a href="#ECSWorker-1338"><span class="linenos">1338</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cpu</span><span class="p">)</span>
</span><span id="ECSWorker-1339"><a href="#ECSWorker-1339"><span class="linenos">1339</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">memory</span><span class="p">)</span>
</span><span id="ECSWorker-1340"><a href="#ECSWorker-1340"><span class="linenos">1340</span></a>
</span><span id="ECSWorker-1341"><a href="#ECSWorker-1341"><span class="linenos">1341</span></a>            <span class="c1"># The FARGATE compatibility is required if it will be used as as launch type</span>
</span><span id="ECSWorker-1342"><a href="#ECSWorker-1342"><span class="linenos">1342</span></a>            <span class="n">requires_compatibilities</span> <span class="o">=</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span>
</span><span id="ECSWorker-1343"><a href="#ECSWorker-1343"><span class="linenos">1343</span></a>                <span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">,</span> <span class="p">[]</span>
</span><span id="ECSWorker-1344"><a href="#ECSWorker-1344"><span class="linenos">1344</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1345"><a href="#ECSWorker-1345"><span class="linenos">1345</span></a>            <span class="k">if</span> <span class="s2">&quot;FARGATE&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requires_compatibilities</span><span class="p">:</span>
</span><span id="ECSWorker-1346"><a href="#ECSWorker-1346"><span class="linenos">1346</span></a>                <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;requiresCompatibilities&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;FARGATE&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1347"><a href="#ECSWorker-1347"><span class="linenos">1347</span></a>
</span><span id="ECSWorker-1348"><a href="#ECSWorker-1348"><span class="linenos">1348</span></a>            <span class="c1"># Only the &#39;awsvpc&#39; network mode is supported when using FARGATE</span>
</span><span id="ECSWorker-1349"><a href="#ECSWorker-1349"><span class="linenos">1349</span></a>            <span class="c1"># However, we will not enforce that here if the user has set it</span>
</span><span id="ECSWorker-1350"><a href="#ECSWorker-1350"><span class="linenos">1350</span></a>            <span class="n">task_definition</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;awsvpc&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1351"><a href="#ECSWorker-1351"><span class="linenos">1351</span></a>
</span><span id="ECSWorker-1352"><a href="#ECSWorker-1352"><span class="linenos">1352</span></a>        <span class="k">elif</span> <span class="n">launch_type</span> <span class="o">==</span> <span class="s2">&quot;EC2&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1353"><a href="#ECSWorker-1353"><span class="linenos">1353</span></a>            <span class="c1"># Container level memory and cpu are required when using ec2</span>
</span><span id="ECSWorker-1354"><a href="#ECSWorker-1354"><span class="linenos">1354</span></a>            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">cpu</span><span class="p">)</span>
</span><span id="ECSWorker-1355"><a href="#ECSWorker-1355"><span class="linenos">1355</span></a>            <span class="n">container</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">,</span> <span class="n">memory</span><span class="p">)</span>
</span><span id="ECSWorker-1356"><a href="#ECSWorker-1356"><span class="linenos">1356</span></a>
</span><span id="ECSWorker-1357"><a href="#ECSWorker-1357"><span class="linenos">1357</span></a>            <span class="c1"># Ensure set values are cast to integers</span>
</span><span id="ECSWorker-1358"><a href="#ECSWorker-1358"><span class="linenos">1358</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1359"><a href="#ECSWorker-1359"><span class="linenos">1359</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1360"><a href="#ECSWorker-1360"><span class="linenos">1360</span></a>
</span><span id="ECSWorker-1361"><a href="#ECSWorker-1361"><span class="linenos">1361</span></a>        <span class="c1"># Ensure set values are cast to strings</span>
</span><span id="ECSWorker-1362"><a href="#ECSWorker-1362"><span class="linenos">1362</span></a>        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1363"><a href="#ECSWorker-1363"><span class="linenos">1363</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1364"><a href="#ECSWorker-1364"><span class="linenos">1364</span></a>        <span class="k">if</span> <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1365"><a href="#ECSWorker-1365"><span class="linenos">1365</span></a>            <span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">task_definition</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1366"><a href="#ECSWorker-1366"><span class="linenos">1366</span></a>
</span><span id="ECSWorker-1367"><a href="#ECSWorker-1367"><span class="linenos">1367</span></a>        <span class="k">return</span> <span class="n">task_definition</span>
</span><span id="ECSWorker-1368"><a href="#ECSWorker-1368"><span class="linenos">1368</span></a>
</span><span id="ECSWorker-1369"><a href="#ECSWorker-1369"><span class="linenos">1369</span></a>    <span class="k">def</span> <span class="nf">_load_network_configuration</span><span class="p">(</span>
</span><span id="ECSWorker-1370"><a href="#ECSWorker-1370"><span class="linenos">1370</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">vpc_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span>
</span><span id="ECSWorker-1371"><a href="#ECSWorker-1371"><span class="linenos">1371</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSWorker-1372"><a href="#ECSWorker-1372"><span class="linenos">1372</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1373"><a href="#ECSWorker-1373"><span class="linenos">1373</span></a><span class="sd">        Load settings from a specific VPC or the default VPC and generate a task</span>
</span><span id="ECSWorker-1374"><a href="#ECSWorker-1374"><span class="linenos">1374</span></a><span class="sd">        run request&#39;s network configuration.</span>
</span><span id="ECSWorker-1375"><a href="#ECSWorker-1375"><span class="linenos">1375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1376"><a href="#ECSWorker-1376"><span class="linenos">1376</span></a>        <span class="n">ec2_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ec2&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1377"><a href="#ECSWorker-1377"><span class="linenos">1377</span></a>        <span class="n">vpc_message</span> <span class="o">=</span> <span class="s2">&quot;the default VPC&quot;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span> <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;VPC with ID </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-1378"><a href="#ECSWorker-1378"><span class="linenos">1378</span></a>
</span><span id="ECSWorker-1379"><a href="#ECSWorker-1379"><span class="linenos">1379</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span><span class="p">:</span>
</span><span id="ECSWorker-1380"><a href="#ECSWorker-1380"><span class="linenos">1380</span></a>            <span class="c1"># Retrieve the default VPC</span>
</span><span id="ECSWorker-1381"><a href="#ECSWorker-1381"><span class="linenos">1381</span></a>            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Filters&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;isDefault&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;true&quot;</span><span class="p">]}]}</span>
</span><span id="ECSWorker-1382"><a href="#ECSWorker-1382"><span class="linenos">1382</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="ECSWorker-1383"><a href="#ECSWorker-1383"><span class="linenos">1383</span></a>            <span class="n">describe</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;VpcIds&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}</span>
</span><span id="ECSWorker-1384"><a href="#ECSWorker-1384"><span class="linenos">1384</span></a>
</span><span id="ECSWorker-1385"><a href="#ECSWorker-1385"><span class="linenos">1385</span></a>        <span class="n">vpcs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">(</span><span class="o">**</span><span class="n">describe</span><span class="p">)[</span><span class="s2">&quot;Vpcs&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1386"><a href="#ECSWorker-1386"><span class="linenos">1386</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpcs</span><span class="p">:</span>
</span><span id="ECSWorker-1387"><a href="#ECSWorker-1387"><span class="linenos">1387</span></a>            <span class="n">help_message</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-1388"><a href="#ECSWorker-1388"><span class="linenos">1388</span></a>                <span class="s2">&quot;Pass an explicit `vpc_id` or configure a default VPC.&quot;</span>
</span><span id="ECSWorker-1389"><a href="#ECSWorker-1389"><span class="linenos">1389</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="n">vpc_id</span>
</span><span id="ECSWorker-1390"><a href="#ECSWorker-1390"><span class="linenos">1390</span></a>                <span class="k">else</span> <span class="s2">&quot;Check that the VPC exists in the current region.&quot;</span>
</span><span id="ECSWorker-1391"><a href="#ECSWorker-1391"><span class="linenos">1391</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1392"><a href="#ECSWorker-1392"><span class="linenos">1392</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1393"><a href="#ECSWorker-1393"><span class="linenos">1393</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSWorker-1394"><a href="#ECSWorker-1394"><span class="linenos">1394</span></a>                <span class="s2">&quot;Network configuration cannot be inferred. &quot;</span> <span class="o">+</span> <span class="n">help_message</span>
</span><span id="ECSWorker-1395"><a href="#ECSWorker-1395"><span class="linenos">1395</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1396"><a href="#ECSWorker-1396"><span class="linenos">1396</span></a>
</span><span id="ECSWorker-1397"><a href="#ECSWorker-1397"><span class="linenos">1397</span></a>        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;VpcId&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1398"><a href="#ECSWorker-1398"><span class="linenos">1398</span></a>        <span class="n">subnets</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">(</span>
</span><span id="ECSWorker-1399"><a href="#ECSWorker-1399"><span class="linenos">1399</span></a>            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}]</span>
</span><span id="ECSWorker-1400"><a href="#ECSWorker-1400"><span class="linenos">1400</span></a>        <span class="p">)[</span><span class="s2">&quot;Subnets&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1401"><a href="#ECSWorker-1401"><span class="linenos">1401</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">subnets</span><span class="p">:</span>
</span><span id="ECSWorker-1402"><a href="#ECSWorker-1402"><span class="linenos">1402</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1403"><a href="#ECSWorker-1403"><span class="linenos">1403</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find subnets for </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSWorker-1404"><a href="#ECSWorker-1404"><span class="linenos">1404</span></a>                <span class="s2">&quot;Network configuration cannot be inferred.&quot;</span>
</span><span id="ECSWorker-1405"><a href="#ECSWorker-1405"><span class="linenos">1405</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1406"><a href="#ECSWorker-1406"><span class="linenos">1406</span></a>
</span><span id="ECSWorker-1407"><a href="#ECSWorker-1407"><span class="linenos">1407</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="ECSWorker-1408"><a href="#ECSWorker-1408"><span class="linenos">1408</span></a>            <span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="ECSWorker-1409"><a href="#ECSWorker-1409"><span class="linenos">1409</span></a>                <span class="s2">&quot;subnets&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="p">[</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">],</span>
</span><span id="ECSWorker-1410"><a href="#ECSWorker-1410"><span class="linenos">1410</span></a>                <span class="s2">&quot;assignPublicIp&quot;</span><span class="p">:</span> <span class="s2">&quot;ENABLED&quot;</span><span class="p">,</span>
</span><span id="ECSWorker-1411"><a href="#ECSWorker-1411"><span class="linenos">1411</span></a>                <span class="s2">&quot;securityGroups&quot;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="ECSWorker-1412"><a href="#ECSWorker-1412"><span class="linenos">1412</span></a>            <span class="p">}</span>
</span><span id="ECSWorker-1413"><a href="#ECSWorker-1413"><span class="linenos">1413</span></a>        <span class="p">}</span>
</span><span id="ECSWorker-1414"><a href="#ECSWorker-1414"><span class="linenos">1414</span></a>
</span><span id="ECSWorker-1415"><a href="#ECSWorker-1415"><span class="linenos">1415</span></a>    <span class="k">def</span> <span class="nf">_custom_network_configuration</span><span class="p">(</span>
</span><span id="ECSWorker-1416"><a href="#ECSWorker-1416"><span class="linenos">1416</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1417"><a href="#ECSWorker-1417"><span class="linenos">1417</span></a>        <span class="n">vpc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1418"><a href="#ECSWorker-1418"><span class="linenos">1418</span></a>        <span class="n">network_configuration</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-1419"><a href="#ECSWorker-1419"><span class="linenos">1419</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1420"><a href="#ECSWorker-1420"><span class="linenos">1420</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSWorker-1421"><a href="#ECSWorker-1421"><span class="linenos">1421</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1422"><a href="#ECSWorker-1422"><span class="linenos">1422</span></a><span class="sd">        Load settings from a specific VPC or the default VPC and generate a task</span>
</span><span id="ECSWorker-1423"><a href="#ECSWorker-1423"><span class="linenos">1423</span></a><span class="sd">        run request&#39;s network configuration.</span>
</span><span id="ECSWorker-1424"><a href="#ECSWorker-1424"><span class="linenos">1424</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1425"><a href="#ECSWorker-1425"><span class="linenos">1425</span></a>        <span class="n">ec2_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ec2&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1426"><a href="#ECSWorker-1426"><span class="linenos">1426</span></a>        <span class="n">vpc_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;VPC with ID </span><span class="si">{</span><span class="n">vpc_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-1427"><a href="#ECSWorker-1427"><span class="linenos">1427</span></a>
</span><span id="ECSWorker-1428"><a href="#ECSWorker-1428"><span class="linenos">1428</span></a>        <span class="n">vpcs</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_vpcs</span><span class="p">(</span><span class="n">VpcIds</span><span class="o">=</span><span class="p">[</span><span class="n">vpc_id</span><span class="p">])</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Vpcs&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1429"><a href="#ECSWorker-1429"><span class="linenos">1429</span></a>
</span><span id="ECSWorker-1430"><a href="#ECSWorker-1430"><span class="linenos">1430</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">vpcs</span><span class="p">:</span>
</span><span id="ECSWorker-1431"><a href="#ECSWorker-1431"><span class="linenos">1431</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1432"><a href="#ECSWorker-1432"><span class="linenos">1432</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSWorker-1433"><a href="#ECSWorker-1433"><span class="linenos">1433</span></a>                <span class="o">+</span> <span class="s2">&quot;Network configuration cannot be inferred. &quot;</span>
</span><span id="ECSWorker-1434"><a href="#ECSWorker-1434"><span class="linenos">1434</span></a>                <span class="o">+</span> <span class="s2">&quot;Pass an explicit `vpc_id`.&quot;</span>
</span><span id="ECSWorker-1435"><a href="#ECSWorker-1435"><span class="linenos">1435</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1436"><a href="#ECSWorker-1436"><span class="linenos">1436</span></a>
</span><span id="ECSWorker-1437"><a href="#ECSWorker-1437"><span class="linenos">1437</span></a>        <span class="n">vpc_id</span> <span class="o">=</span> <span class="n">vpcs</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;VpcId&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1438"><a href="#ECSWorker-1438"><span class="linenos">1438</span></a>        <span class="n">subnets</span> <span class="o">=</span> <span class="n">ec2_client</span><span class="o">.</span><span class="n">describe_subnets</span><span class="p">(</span>
</span><span id="ECSWorker-1439"><a href="#ECSWorker-1439"><span class="linenos">1439</span></a>            <span class="n">Filters</span><span class="o">=</span><span class="p">[{</span><span class="s2">&quot;Name&quot;</span><span class="p">:</span> <span class="s2">&quot;vpc-id&quot;</span><span class="p">,</span> <span class="s2">&quot;Values&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">vpc_id</span><span class="p">]}]</span>
</span><span id="ECSWorker-1440"><a href="#ECSWorker-1440"><span class="linenos">1440</span></a>        <span class="p">)[</span><span class="s2">&quot;Subnets&quot;</span><span class="p">]</span>
</span><span id="ECSWorker-1441"><a href="#ECSWorker-1441"><span class="linenos">1441</span></a>
</span><span id="ECSWorker-1442"><a href="#ECSWorker-1442"><span class="linenos">1442</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">subnets</span><span class="p">:</span>
</span><span id="ECSWorker-1443"><a href="#ECSWorker-1443"><span class="linenos">1443</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1444"><a href="#ECSWorker-1444"><span class="linenos">1444</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to find subnets for </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="ECSWorker-1445"><a href="#ECSWorker-1445"><span class="linenos">1445</span></a>                <span class="o">+</span> <span class="s2">&quot;Network configuration cannot be inferred.&quot;</span>
</span><span id="ECSWorker-1446"><a href="#ECSWorker-1446"><span class="linenos">1446</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1447"><a href="#ECSWorker-1447"><span class="linenos">1447</span></a>
</span><span id="ECSWorker-1448"><a href="#ECSWorker-1448"><span class="linenos">1448</span></a>        <span class="n">subnet_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">subnet</span><span class="p">[</span><span class="s2">&quot;SubnetId&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">subnet</span> <span class="ow">in</span> <span class="n">subnets</span><span class="p">]</span>
</span><span id="ECSWorker-1449"><a href="#ECSWorker-1449"><span class="linenos">1449</span></a>
</span><span id="ECSWorker-1450"><a href="#ECSWorker-1450"><span class="linenos">1450</span></a>        <span class="n">config_subnets</span> <span class="o">=</span> <span class="n">network_configuration</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subnets&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1451"><a href="#ECSWorker-1451"><span class="linenos">1451</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">conf_sn</span> <span class="ow">in</span> <span class="n">subnet_ids</span> <span class="k">for</span> <span class="n">conf_sn</span> <span class="ow">in</span> <span class="n">config_subnets</span><span class="p">):</span>
</span><span id="ECSWorker-1452"><a href="#ECSWorker-1452"><span class="linenos">1452</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="ECSWorker-1453"><a href="#ECSWorker-1453"><span class="linenos">1453</span></a>                <span class="sa">f</span><span class="s2">&quot;Subnets </span><span class="si">{</span><span class="n">config_subnets</span><span class="si">}</span><span class="s2"> not found within </span><span class="si">{</span><span class="n">vpc_message</span><span class="si">}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-1454"><a href="#ECSWorker-1454"><span class="linenos">1454</span></a>                <span class="o">+</span> <span class="s2">&quot;Please check that VPC is associated with supplied subnets.&quot;</span>
</span><span id="ECSWorker-1455"><a href="#ECSWorker-1455"><span class="linenos">1455</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1456"><a href="#ECSWorker-1456"><span class="linenos">1456</span></a>
</span><span id="ECSWorker-1457"><a href="#ECSWorker-1457"><span class="linenos">1457</span></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;awsvpcConfiguration&quot;</span><span class="p">:</span> <span class="n">network_configuration</span><span class="p">}</span>
</span><span id="ECSWorker-1458"><a href="#ECSWorker-1458"><span class="linenos">1458</span></a>
</span><span id="ECSWorker-1459"><a href="#ECSWorker-1459"><span class="linenos">1459</span></a>    <span class="k">def</span> <span class="nf">_prepare_task_run_request</span><span class="p">(</span>
</span><span id="ECSWorker-1460"><a href="#ECSWorker-1460"><span class="linenos">1460</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1461"><a href="#ECSWorker-1461"><span class="linenos">1461</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1462"><a href="#ECSWorker-1462"><span class="linenos">1462</span></a>        <span class="n">task_definition</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="ECSWorker-1463"><a href="#ECSWorker-1463"><span class="linenos">1463</span></a>        <span class="n">task_definition_arn</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1464"><a href="#ECSWorker-1464"><span class="linenos">1464</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="ECSWorker-1465"><a href="#ECSWorker-1465"><span class="linenos">1465</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1466"><a href="#ECSWorker-1466"><span class="linenos">1466</span></a><span class="sd">        Prepare a task run request payload.</span>
</span><span id="ECSWorker-1467"><a href="#ECSWorker-1467"><span class="linenos">1467</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1468"><a href="#ECSWorker-1468"><span class="linenos">1468</span></a>        <span class="n">task_run_request</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">task_run_request</span><span class="p">)</span>
</span><span id="ECSWorker-1469"><a href="#ECSWorker-1469"><span class="linenos">1469</span></a>
</span><span id="ECSWorker-1470"><a href="#ECSWorker-1470"><span class="linenos">1470</span></a>        <span class="n">task_run_request</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">,</span> <span class="n">task_definition_arn</span><span class="p">)</span>
</span><span id="ECSWorker-1471"><a href="#ECSWorker-1471"><span class="linenos">1471</span></a>        <span class="k">assert</span> <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;taskDefinition&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">task_definition_arn</span>
</span><span id="ECSWorker-1472"><a href="#ECSWorker-1472"><span class="linenos">1472</span></a>        <span class="n">capacityProviderStrategy</span> <span class="o">=</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;capacityProviderStrategy&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1473"><a href="#ECSWorker-1473"><span class="linenos">1473</span></a>
</span><span id="ECSWorker-1474"><a href="#ECSWorker-1474"><span class="linenos">1474</span></a>        <span class="k">if</span> <span class="n">capacityProviderStrategy</span><span class="p">:</span>
</span><span id="ECSWorker-1475"><a href="#ECSWorker-1475"><span class="linenos">1475</span></a>            <span class="c1"># Should not be provided at all if capacityProviderStrategy is set, see https://docs.aws.amazon.com/AmazonECS/latest/APIReference/API_RunTask.html#ECS-RunTask-request-capacityProviderStrategy  # noqa</span>
</span><span id="ECSWorker-1476"><a href="#ECSWorker-1476"><span class="linenos">1476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-1477"><a href="#ECSWorker-1477"><span class="linenos">1477</span></a>                <span class="s2">&quot;Found capacityProviderStrategy. &quot;</span>
</span><span id="ECSWorker-1478"><a href="#ECSWorker-1478"><span class="linenos">1478</span></a>                <span class="s2">&quot;Removing launchType from task run request.&quot;</span>
</span><span id="ECSWorker-1479"><a href="#ECSWorker-1479"><span class="linenos">1479</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1480"><a href="#ECSWorker-1480"><span class="linenos">1480</span></a>            <span class="n">task_run_request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSWorker-1481"><a href="#ECSWorker-1481"><span class="linenos">1481</span></a>
</span><span id="ECSWorker-1482"><a href="#ECSWorker-1482"><span class="linenos">1482</span></a>        <span class="k">elif</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">:</span>
</span><span id="ECSWorker-1483"><a href="#ECSWorker-1483"><span class="linenos">1483</span></a>            <span class="c1"># Should not be provided at all for FARGATE SPOT</span>
</span><span id="ECSWorker-1484"><a href="#ECSWorker-1484"><span class="linenos">1484</span></a>            <span class="n">task_run_request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;launchType&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSWorker-1485"><a href="#ECSWorker-1485"><span class="linenos">1485</span></a>
</span><span id="ECSWorker-1486"><a href="#ECSWorker-1486"><span class="linenos">1486</span></a>            <span class="c1"># A capacity provider strategy is required for FARGATE SPOT</span>
</span><span id="ECSWorker-1487"><a href="#ECSWorker-1487"><span class="linenos">1487</span></a>            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;capacityProviderStrategy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1488"><a href="#ECSWorker-1488"><span class="linenos">1488</span></a>                <span class="p">{</span><span class="s2">&quot;capacityProvider&quot;</span><span class="p">:</span> <span class="s2">&quot;FARGATE_SPOT&quot;</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</span><span id="ECSWorker-1489"><a href="#ECSWorker-1489"><span class="linenos">1489</span></a>            <span class="p">]</span>
</span><span id="ECSWorker-1490"><a href="#ECSWorker-1490"><span class="linenos">1490</span></a>        <span class="n">overrides</span> <span class="o">=</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;overrides&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="ECSWorker-1491"><a href="#ECSWorker-1491"><span class="linenos">1491</span></a>        <span class="n">container_overrides</span> <span class="o">=</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerOverrides&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1492"><a href="#ECSWorker-1492"><span class="linenos">1492</span></a>
</span><span id="ECSWorker-1493"><a href="#ECSWorker-1493"><span class="linenos">1493</span></a>        <span class="c1"># Ensure the network configuration is present if using awsvpc for network mode</span>
</span><span id="ECSWorker-1494"><a href="#ECSWorker-1494"><span class="linenos">1494</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSWorker-1495"><a href="#ECSWorker-1495"><span class="linenos">1495</span></a>            <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span>
</span><span id="ECSWorker-1496"><a href="#ECSWorker-1496"><span class="linenos">1496</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1497"><a href="#ECSWorker-1497"><span class="linenos">1497</span></a>            <span class="ow">and</span> <span class="ow">not</span> <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span>
</span><span id="ECSWorker-1498"><a href="#ECSWorker-1498"><span class="linenos">1498</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-1499"><a href="#ECSWorker-1499"><span class="linenos">1499</span></a>            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;networkConfiguration&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_network_configuration</span><span class="p">(</span>
</span><span id="ECSWorker-1500"><a href="#ECSWorker-1500"><span class="linenos">1500</span></a>                <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span><span class="p">,</span> <span class="n">configuration</span>
</span><span id="ECSWorker-1501"><a href="#ECSWorker-1501"><span class="linenos">1501</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1502"><a href="#ECSWorker-1502"><span class="linenos">1502</span></a>
</span><span id="ECSWorker-1503"><a href="#ECSWorker-1503"><span class="linenos">1503</span></a>        <span class="c1"># Use networkConfiguration if supplied by user</span>
</span><span id="ECSWorker-1504"><a href="#ECSWorker-1504"><span class="linenos">1504</span></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="ECSWorker-1505"><a href="#ECSWorker-1505"><span class="linenos">1505</span></a>            <span class="n">task_definition</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;awsvpc&quot;</span>
</span><span id="ECSWorker-1506"><a href="#ECSWorker-1506"><span class="linenos">1506</span></a>            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span>
</span><span id="ECSWorker-1507"><a href="#ECSWorker-1507"><span class="linenos">1507</span></a>            <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span>
</span><span id="ECSWorker-1508"><a href="#ECSWorker-1508"><span class="linenos">1508</span></a>        <span class="p">):</span>
</span><span id="ECSWorker-1509"><a href="#ECSWorker-1509"><span class="linenos">1509</span></a>            <span class="n">task_run_request</span><span class="p">[</span>
</span><span id="ECSWorker-1510"><a href="#ECSWorker-1510"><span class="linenos">1510</span></a>                <span class="s2">&quot;networkConfiguration&quot;</span>
</span><span id="ECSWorker-1511"><a href="#ECSWorker-1511"><span class="linenos">1511</span></a>            <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom_network_configuration</span><span class="p">(</span>
</span><span id="ECSWorker-1512"><a href="#ECSWorker-1512"><span class="linenos">1512</span></a>                <span class="n">configuration</span><span class="o">.</span><span class="n">vpc_id</span><span class="p">,</span>
</span><span id="ECSWorker-1513"><a href="#ECSWorker-1513"><span class="linenos">1513</span></a>                <span class="n">configuration</span><span class="o">.</span><span class="n">network_configuration</span><span class="p">,</span>
</span><span id="ECSWorker-1514"><a href="#ECSWorker-1514"><span class="linenos">1514</span></a>                <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker-1515"><a href="#ECSWorker-1515"><span class="linenos">1515</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1516"><a href="#ECSWorker-1516"><span class="linenos">1516</span></a>
</span><span id="ECSWorker-1517"><a href="#ECSWorker-1517"><span class="linenos">1517</span></a>        <span class="c1"># Ensure the container name is set if not provided at template time</span>
</span><span id="ECSWorker-1518"><a href="#ECSWorker-1518"><span class="linenos">1518</span></a>
</span><span id="ECSWorker-1519"><a href="#ECSWorker-1519"><span class="linenos">1519</span></a>        <span class="n">container_name</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker-1520"><a href="#ECSWorker-1520"><span class="linenos">1520</span></a>            <span class="n">configuration</span><span class="o">.</span><span class="n">container_name</span>
</span><span id="ECSWorker-1521"><a href="#ECSWorker-1521"><span class="linenos">1521</span></a>            <span class="ow">or</span> <span class="n">_container_name_from_task_definition</span><span class="p">(</span><span class="n">task_definition</span><span class="p">)</span>
</span><span id="ECSWorker-1522"><a href="#ECSWorker-1522"><span class="linenos">1522</span></a>            <span class="ow">or</span> <span class="n">ECS_DEFAULT_CONTAINER_NAME</span>
</span><span id="ECSWorker-1523"><a href="#ECSWorker-1523"><span class="linenos">1523</span></a>        <span class="p">)</span>
</span><span id="ECSWorker-1524"><a href="#ECSWorker-1524"><span class="linenos">1524</span></a>
</span><span id="ECSWorker-1525"><a href="#ECSWorker-1525"><span class="linenos">1525</span></a>        <span class="k">if</span> <span class="n">container_overrides</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">container_overrides</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1526"><a href="#ECSWorker-1526"><span class="linenos">1526</span></a>            <span class="n">container_overrides</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">container_name</span>
</span><span id="ECSWorker-1527"><a href="#ECSWorker-1527"><span class="linenos">1527</span></a>
</span><span id="ECSWorker-1528"><a href="#ECSWorker-1528"><span class="linenos">1528</span></a>        <span class="c1"># Ensure configuration command is respected post-templating</span>
</span><span id="ECSWorker-1529"><a href="#ECSWorker-1529"><span class="linenos">1529</span></a>
</span><span id="ECSWorker-1530"><a href="#ECSWorker-1530"><span class="linenos">1530</span></a>        <span class="n">orchestration_container</span> <span class="o">=</span> <span class="n">_get_container</span><span class="p">(</span><span class="n">container_overrides</span><span class="p">,</span> <span class="n">container_name</span><span class="p">)</span>
</span><span id="ECSWorker-1531"><a href="#ECSWorker-1531"><span class="linenos">1531</span></a>
</span><span id="ECSWorker-1532"><a href="#ECSWorker-1532"><span class="linenos">1532</span></a>        <span class="k">if</span> <span class="n">orchestration_container</span><span class="p">:</span>
</span><span id="ECSWorker-1533"><a href="#ECSWorker-1533"><span class="linenos">1533</span></a>            <span class="c1"># Override the command if given on the configuration</span>
</span><span id="ECSWorker-1534"><a href="#ECSWorker-1534"><span class="linenos">1534</span></a>            <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">command</span><span class="p">:</span>
</span><span id="ECSWorker-1535"><a href="#ECSWorker-1535"><span class="linenos">1535</span></a>                <span class="n">orchestration_container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">command</span>
</span><span id="ECSWorker-1536"><a href="#ECSWorker-1536"><span class="linenos">1536</span></a>
</span><span id="ECSWorker-1537"><a href="#ECSWorker-1537"><span class="linenos">1537</span></a>        <span class="c1"># Clean up templated variable formatting</span>
</span><span id="ECSWorker-1538"><a href="#ECSWorker-1538"><span class="linenos">1538</span></a>
</span><span id="ECSWorker-1539"><a href="#ECSWorker-1539"><span class="linenos">1539</span></a>        <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">container_overrides</span><span class="p">:</span>
</span><span id="ECSWorker-1540"><a href="#ECSWorker-1540"><span class="linenos">1540</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command&quot;</span><span class="p">),</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="ECSWorker-1541"><a href="#ECSWorker-1541"><span class="linenos">1541</span></a>                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shlex</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">container</span><span class="p">[</span><span class="s2">&quot;command&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1542"><a href="#ECSWorker-1542"><span class="linenos">1542</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ECSWorker-1543"><a href="#ECSWorker-1543"><span class="linenos">1543</span></a>                <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1544"><a href="#ECSWorker-1544"><span class="linenos">1544</span></a>                    <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSWorker-1545"><a href="#ECSWorker-1545"><span class="linenos">1545</span></a>                <span class="p">]</span>
</span><span id="ECSWorker-1546"><a href="#ECSWorker-1546"><span class="linenos">1546</span></a>
</span><span id="ECSWorker-1547"><a href="#ECSWorker-1547"><span class="linenos">1547</span></a>            <span class="c1"># Remove null values  they&#39;re not allowed by AWS</span>
</span><span id="ECSWorker-1548"><a href="#ECSWorker-1548"><span class="linenos">1548</span></a>            <span class="n">container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1549"><a href="#ECSWorker-1549"><span class="linenos">1549</span></a>                <span class="n">item</span>
</span><span id="ECSWorker-1550"><a href="#ECSWorker-1550"><span class="linenos">1550</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1551"><a href="#ECSWorker-1551"><span class="linenos">1551</span></a>                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSWorker-1552"><a href="#ECSWorker-1552"><span class="linenos">1552</span></a>            <span class="p">]</span>
</span><span id="ECSWorker-1553"><a href="#ECSWorker-1553"><span class="linenos">1553</span></a>
</span><span id="ECSWorker-1554"><a href="#ECSWorker-1554"><span class="linenos">1554</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">),</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="ECSWorker-1555"><a href="#ECSWorker-1555"><span class="linenos">1555</span></a>            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1556"><a href="#ECSWorker-1556"><span class="linenos">1556</span></a>                <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSWorker-1557"><a href="#ECSWorker-1557"><span class="linenos">1557</span></a>            <span class="p">]</span>
</span><span id="ECSWorker-1558"><a href="#ECSWorker-1558"><span class="linenos">1558</span></a>
</span><span id="ECSWorker-1559"><a href="#ECSWorker-1559"><span class="linenos">1559</span></a>        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;cpu&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1560"><a href="#ECSWorker-1560"><span class="linenos">1560</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;cpu&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1561"><a href="#ECSWorker-1561"><span class="linenos">1561</span></a>
</span><span id="ECSWorker-1562"><a href="#ECSWorker-1562"><span class="linenos">1562</span></a>        <span class="k">if</span> <span class="n">overrides</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;memory&quot;</span><span class="p">):</span>
</span><span id="ECSWorker-1563"><a href="#ECSWorker-1563"><span class="linenos">1563</span></a>            <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">])</span>
</span><span id="ECSWorker-1564"><a href="#ECSWorker-1564"><span class="linenos">1564</span></a>
</span><span id="ECSWorker-1565"><a href="#ECSWorker-1565"><span class="linenos">1565</span></a>        <span class="c1"># Ensure configuration tags and env are respected post-templating</span>
</span><span id="ECSWorker-1566"><a href="#ECSWorker-1566"><span class="linenos">1566</span></a>
</span><span id="ECSWorker-1567"><a href="#ECSWorker-1567"><span class="linenos">1567</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1568"><a href="#ECSWorker-1568"><span class="linenos">1568</span></a>            <span class="n">item</span>
</span><span id="ECSWorker-1569"><a href="#ECSWorker-1569"><span class="linenos">1569</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">task_run_request</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1570"><a href="#ECSWorker-1570"><span class="linenos">1570</span></a>            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ECSWorker-1571"><a href="#ECSWorker-1571"><span class="linenos">1571</span></a>        <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="ECSWorker-1572"><a href="#ECSWorker-1572"><span class="linenos">1572</span></a>            <span class="p">{</span><span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
</span><span id="ECSWorker-1573"><a href="#ECSWorker-1573"><span class="linenos">1573</span></a>            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSWorker-1574"><a href="#ECSWorker-1574"><span class="linenos">1574</span></a>            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSWorker-1575"><a href="#ECSWorker-1575"><span class="linenos">1575</span></a>        <span class="p">]</span>
</span><span id="ECSWorker-1576"><a href="#ECSWorker-1576"><span class="linenos">1576</span></a>
</span><span id="ECSWorker-1577"><a href="#ECSWorker-1577"><span class="linenos">1577</span></a>        <span class="c1"># Slugify tags keys and values</span>
</span><span id="ECSWorker-1578"><a href="#ECSWorker-1578"><span class="linenos">1578</span></a>        <span class="n">tags</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1579"><a href="#ECSWorker-1579"><span class="linenos">1579</span></a>            <span class="p">{</span>
</span><span id="ECSWorker-1580"><a href="#ECSWorker-1580"><span class="linenos">1580</span></a>                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSWorker-1581"><a href="#ECSWorker-1581"><span class="linenos">1581</span></a>                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">],</span>
</span><span id="ECSWorker-1582"><a href="#ECSWorker-1582"><span class="linenos">1582</span></a>                    <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
</span><span id="ECSWorker-1583"><a href="#ECSWorker-1583"><span class="linenos">1583</span></a>                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSWorker-1584"><a href="#ECSWorker-1584"><span class="linenos">1584</span></a>                    <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ECSWorker-1585"><a href="#ECSWorker-1585"><span class="linenos">1585</span></a>                <span class="p">),</span>
</span><span id="ECSWorker-1586"><a href="#ECSWorker-1586"><span class="linenos">1586</span></a>                <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">slugify</span><span class="p">(</span>
</span><span id="ECSWorker-1587"><a href="#ECSWorker-1587"><span class="linenos">1587</span></a>                    <span class="n">item</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">],</span>
</span><span id="ECSWorker-1588"><a href="#ECSWorker-1588"><span class="linenos">1588</span></a>                    <span class="n">regex_pattern</span><span class="o">=</span><span class="n">_TAG_REGEX</span><span class="p">,</span>
</span><span id="ECSWorker-1589"><a href="#ECSWorker-1589"><span class="linenos">1589</span></a>                    <span class="n">allow_unicode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSWorker-1590"><a href="#ECSWorker-1590"><span class="linenos">1590</span></a>                    <span class="n">lowercase</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="ECSWorker-1591"><a href="#ECSWorker-1591"><span class="linenos">1591</span></a>                <span class="p">),</span>
</span><span id="ECSWorker-1592"><a href="#ECSWorker-1592"><span class="linenos">1592</span></a>            <span class="p">}</span>
</span><span id="ECSWorker-1593"><a href="#ECSWorker-1593"><span class="linenos">1593</span></a>            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">tags</span>
</span><span id="ECSWorker-1594"><a href="#ECSWorker-1594"><span class="linenos">1594</span></a>        <span class="p">]</span>
</span><span id="ECSWorker-1595"><a href="#ECSWorker-1595"><span class="linenos">1595</span></a>
</span><span id="ECSWorker-1596"><a href="#ECSWorker-1596"><span class="linenos">1596</span></a>        <span class="k">if</span> <span class="n">tags</span><span class="p">:</span>
</span><span id="ECSWorker-1597"><a href="#ECSWorker-1597"><span class="linenos">1597</span></a>            <span class="n">task_run_request</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tags</span>
</span><span id="ECSWorker-1598"><a href="#ECSWorker-1598"><span class="linenos">1598</span></a>
</span><span id="ECSWorker-1599"><a href="#ECSWorker-1599"><span class="linenos">1599</span></a>        <span class="k">if</span> <span class="n">orchestration_container</span><span class="p">:</span>
</span><span id="ECSWorker-1600"><a href="#ECSWorker-1600"><span class="linenos">1600</span></a>            <span class="n">environment</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="ECSWorker-1601"><a href="#ECSWorker-1601"><span class="linenos">1601</span></a>                <span class="n">item</span>
</span><span id="ECSWorker-1602"><a href="#ECSWorker-1602"><span class="linenos">1602</span></a>                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">orchestration_container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;environment&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1603"><a href="#ECSWorker-1603"><span class="linenos">1603</span></a>                <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span id="ECSWorker-1604"><a href="#ECSWorker-1604"><span class="linenos">1604</span></a>            <span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
</span><span id="ECSWorker-1605"><a href="#ECSWorker-1605"><span class="linenos">1605</span></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>
</span><span id="ECSWorker-1606"><a href="#ECSWorker-1606"><span class="linenos">1606</span></a>                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">configuration</span><span class="o">.</span><span class="n">env</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
</span><span id="ECSWorker-1607"><a href="#ECSWorker-1607"><span class="linenos">1607</span></a>                <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="ECSWorker-1608"><a href="#ECSWorker-1608"><span class="linenos">1608</span></a>            <span class="p">]</span>
</span><span id="ECSWorker-1609"><a href="#ECSWorker-1609"><span class="linenos">1609</span></a>            <span class="k">if</span> <span class="n">environment</span><span class="p">:</span>
</span><span id="ECSWorker-1610"><a href="#ECSWorker-1610"><span class="linenos">1610</span></a>                <span class="n">orchestration_container</span><span class="p">[</span><span class="s2">&quot;environment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">environment</span>
</span><span id="ECSWorker-1611"><a href="#ECSWorker-1611"><span class="linenos">1611</span></a>
</span><span id="ECSWorker-1612"><a href="#ECSWorker-1612"><span class="linenos">1612</span></a>        <span class="c1"># Remove empty container overrides</span>
</span><span id="ECSWorker-1613"><a href="#ECSWorker-1613"><span class="linenos">1613</span></a>
</span><span id="ECSWorker-1614"><a href="#ECSWorker-1614"><span class="linenos">1614</span></a>        <span class="n">overrides</span><span class="p">[</span><span class="s2">&quot;containerOverrides&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">container_overrides</span> <span class="k">if</span> <span class="n">v</span><span class="p">]</span>
</span><span id="ECSWorker-1615"><a href="#ECSWorker-1615"><span class="linenos">1615</span></a>
</span><span id="ECSWorker-1616"><a href="#ECSWorker-1616"><span class="linenos">1616</span></a>        <span class="k">return</span> <span class="n">task_run_request</span>
</span><span id="ECSWorker-1617"><a href="#ECSWorker-1617"><span class="linenos">1617</span></a>
</span><span id="ECSWorker-1618"><a href="#ECSWorker-1618"><span class="linenos">1618</span></a>    <span class="nd">@retry</span><span class="p">(</span>
</span><span id="ECSWorker-1619"><a href="#ECSWorker-1619"><span class="linenos">1619</span></a>        <span class="n">stop</span><span class="o">=</span><span class="n">stop_after_attempt</span><span class="p">(</span><span class="n">MAX_CREATE_TASK_RUN_ATTEMPTS</span><span class="p">),</span>
</span><span id="ECSWorker-1620"><a href="#ECSWorker-1620"><span class="linenos">1620</span></a>        <span class="n">wait</span><span class="o">=</span><span class="n">wait_fixed</span><span class="p">(</span><span class="n">CREATE_TASK_RUN_MIN_DELAY_SECONDS</span><span class="p">)</span>
</span><span id="ECSWorker-1621"><a href="#ECSWorker-1621"><span class="linenos">1621</span></a>        <span class="o">+</span> <span class="n">wait_random</span><span class="p">(</span>
</span><span id="ECSWorker-1622"><a href="#ECSWorker-1622"><span class="linenos">1622</span></a>            <span class="n">CREATE_TASK_RUN_MIN_DELAY_JITTER_SECONDS</span><span class="p">,</span>
</span><span id="ECSWorker-1623"><a href="#ECSWorker-1623"><span class="linenos">1623</span></a>            <span class="n">CREATE_TASK_RUN_MAX_DELAY_JITTER_SECONDS</span><span class="p">,</span>
</span><span id="ECSWorker-1624"><a href="#ECSWorker-1624"><span class="linenos">1624</span></a>        <span class="p">),</span>
</span><span id="ECSWorker-1625"><a href="#ECSWorker-1625"><span class="linenos">1625</span></a>        <span class="n">reraise</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="ECSWorker-1626"><a href="#ECSWorker-1626"><span class="linenos">1626</span></a>    <span class="p">)</span>
</span><span id="ECSWorker-1627"><a href="#ECSWorker-1627"><span class="linenos">1627</span></a>    <span class="k">def</span> <span class="nf">_create_task_run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ecs_client</span><span class="p">:</span> <span class="n">_ECSClient</span><span class="p">,</span> <span class="n">task_run_request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="ECSWorker-1628"><a href="#ECSWorker-1628"><span class="linenos">1628</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1629"><a href="#ECSWorker-1629"><span class="linenos">1629</span></a><span class="sd">        Create a run of a task definition.</span>
</span><span id="ECSWorker-1630"><a href="#ECSWorker-1630"><span class="linenos">1630</span></a>
</span><span id="ECSWorker-1631"><a href="#ECSWorker-1631"><span class="linenos">1631</span></a><span class="sd">        Returns the task run ARN.</span>
</span><span id="ECSWorker-1632"><a href="#ECSWorker-1632"><span class="linenos">1632</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1633"><a href="#ECSWorker-1633"><span class="linenos">1633</span></a>        <span class="n">task</span> <span class="o">=</span> <span class="n">ecs_client</span><span class="o">.</span><span class="n">run_task</span><span class="p">(</span><span class="o">**</span><span class="n">task_run_request</span><span class="p">)</span>
</span><span id="ECSWorker-1634"><a href="#ECSWorker-1634"><span class="linenos">1634</span></a>        <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;failures&quot;</span><span class="p">]:</span>
</span><span id="ECSWorker-1635"><a href="#ECSWorker-1635"><span class="linenos">1635</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-1636"><a href="#ECSWorker-1636"><span class="linenos">1636</span></a>                <span class="sa">f</span><span class="s2">&quot;Failed to run ECS task: </span><span class="si">{</span><span class="n">task</span><span class="p">[</span><span class="s1">&#39;failures&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="ECSWorker-1637"><a href="#ECSWorker-1637"><span class="linenos">1637</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1638"><a href="#ECSWorker-1638"><span class="linenos">1638</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]:</span>
</span><span id="ECSWorker-1639"><a href="#ECSWorker-1639"><span class="linenos">1639</span></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
</span><span id="ECSWorker-1640"><a href="#ECSWorker-1640"><span class="linenos">1640</span></a>                <span class="s2">&quot;Failed to run ECS task: no tasks or failures were returned.&quot;</span>
</span><span id="ECSWorker-1641"><a href="#ECSWorker-1641"><span class="linenos">1641</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1642"><a href="#ECSWorker-1642"><span class="linenos">1642</span></a>        <span class="k">return</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="ECSWorker-1643"><a href="#ECSWorker-1643"><span class="linenos">1643</span></a>
</span><span id="ECSWorker-1644"><a href="#ECSWorker-1644"><span class="linenos">1644</span></a>    <span class="k">def</span> <span class="nf">_task_definitions_equal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">taskdef_1</span><span class="p">,</span> <span class="n">taskdef_2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="ECSWorker-1645"><a href="#ECSWorker-1645"><span class="linenos">1645</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1646"><a href="#ECSWorker-1646"><span class="linenos">1646</span></a><span class="sd">        Compare two task definitions.</span>
</span><span id="ECSWorker-1647"><a href="#ECSWorker-1647"><span class="linenos">1647</span></a>
</span><span id="ECSWorker-1648"><a href="#ECSWorker-1648"><span class="linenos">1648</span></a><span class="sd">        Since one may come from the AWS API and have populated defaults, we do our best</span>
</span><span id="ECSWorker-1649"><a href="#ECSWorker-1649"><span class="linenos">1649</span></a><span class="sd">        to homogenize the definitions without changing their meaning.</span>
</span><span id="ECSWorker-1650"><a href="#ECSWorker-1650"><span class="linenos">1650</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1651"><a href="#ECSWorker-1651"><span class="linenos">1651</span></a>        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span><span class="p">:</span>
</span><span id="ECSWorker-1652"><a href="#ECSWorker-1652"><span class="linenos">1652</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="ECSWorker-1653"><a href="#ECSWorker-1653"><span class="linenos">1653</span></a>
</span><span id="ECSWorker-1654"><a href="#ECSWorker-1654"><span class="linenos">1654</span></a>        <span class="k">if</span> <span class="n">taskdef_1</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">taskdef_2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1655"><a href="#ECSWorker-1655"><span class="linenos">1655</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="ECSWorker-1656"><a href="#ECSWorker-1656"><span class="linenos">1656</span></a>
</span><span id="ECSWorker-1657"><a href="#ECSWorker-1657"><span class="linenos">1657</span></a>        <span class="n">taskdef_1</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
</span><span id="ECSWorker-1658"><a href="#ECSWorker-1658"><span class="linenos">1658</span></a>        <span class="n">taskdef_2</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>
</span><span id="ECSWorker-1659"><a href="#ECSWorker-1659"><span class="linenos">1659</span></a>
</span><span id="ECSWorker-1660"><a href="#ECSWorker-1660"><span class="linenos">1660</span></a>        <span class="k">for</span> <span class="n">taskdef</span> <span class="ow">in</span> <span class="p">(</span><span class="n">taskdef_1</span><span class="p">,</span> <span class="n">taskdef_2</span><span class="p">):</span>
</span><span id="ECSWorker-1661"><a href="#ECSWorker-1661"><span class="linenos">1661</span></a>            <span class="c1"># Set defaults that AWS would set after registration</span>
</span><span id="ECSWorker-1662"><a href="#ECSWorker-1662"><span class="linenos">1662</span></a>            <span class="n">container_definitions</span> <span class="o">=</span> <span class="n">taskdef</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;containerDefinitions&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="ECSWorker-1663"><a href="#ECSWorker-1663"><span class="linenos">1663</span></a>            <span class="n">essential</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span>
</span><span id="ECSWorker-1664"><a href="#ECSWorker-1664"><span class="linenos">1664</span></a>                <span class="n">container</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">container</span> <span class="ow">in</span> <span class="n">container_definitions</span>
</span><span id="ECSWorker-1665"><a href="#ECSWorker-1665"><span class="linenos">1665</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1666"><a href="#ECSWorker-1666"><span class="linenos">1666</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">essential</span><span class="p">:</span>
</span><span id="ECSWorker-1667"><a href="#ECSWorker-1667"><span class="linenos">1667</span></a>                <span class="n">container_definitions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;essential&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
</span><span id="ECSWorker-1668"><a href="#ECSWorker-1668"><span class="linenos">1668</span></a>
</span><span id="ECSWorker-1669"><a href="#ECSWorker-1669"><span class="linenos">1669</span></a>            <span class="n">taskdef</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;networkMode&quot;</span><span class="p">,</span> <span class="s2">&quot;bridge&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1670"><a href="#ECSWorker-1670"><span class="linenos">1670</span></a>
</span><span id="ECSWorker-1671"><a href="#ECSWorker-1671"><span class="linenos">1671</span></a>        <span class="n">_drop_empty_keys_from_task_definition</span><span class="p">(</span><span class="n">taskdef_1</span><span class="p">)</span>
</span><span id="ECSWorker-1672"><a href="#ECSWorker-1672"><span class="linenos">1672</span></a>        <span class="n">_drop_empty_keys_from_task_definition</span><span class="p">(</span><span class="n">taskdef_2</span><span class="p">)</span>
</span><span id="ECSWorker-1673"><a href="#ECSWorker-1673"><span class="linenos">1673</span></a>
</span><span id="ECSWorker-1674"><a href="#ECSWorker-1674"><span class="linenos">1674</span></a>        <span class="c1"># Clear fields that change on registration for comparison</span>
</span><span id="ECSWorker-1675"><a href="#ECSWorker-1675"><span class="linenos">1675</span></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">ECS_POST_REGISTRATION_FIELDS</span><span class="p">:</span>
</span><span id="ECSWorker-1676"><a href="#ECSWorker-1676"><span class="linenos">1676</span></a>            <span class="n">taskdef_1</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSWorker-1677"><a href="#ECSWorker-1677"><span class="linenos">1677</span></a>            <span class="n">taskdef_2</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="ECSWorker-1678"><a href="#ECSWorker-1678"><span class="linenos">1678</span></a>
</span><span id="ECSWorker-1679"><a href="#ECSWorker-1679"><span class="linenos">1679</span></a>        <span class="k">return</span> <span class="n">taskdef_1</span> <span class="o">==</span> <span class="n">taskdef_2</span>
</span><span id="ECSWorker-1680"><a href="#ECSWorker-1680"><span class="linenos">1680</span></a>
</span><span id="ECSWorker-1681"><a href="#ECSWorker-1681"><span class="linenos">1681</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill_infrastructure</span><span class="p">(</span>
</span><span id="ECSWorker-1682"><a href="#ECSWorker-1682"><span class="linenos">1682</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker-1683"><a href="#ECSWorker-1683"><span class="linenos">1683</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker-1684"><a href="#ECSWorker-1684"><span class="linenos">1684</span></a>        <span class="n">infrastructure_pid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker-1685"><a href="#ECSWorker-1685"><span class="linenos">1685</span></a>        <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ECSWorker-1686"><a href="#ECSWorker-1686"><span class="linenos">1686</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1687"><a href="#ECSWorker-1687"><span class="linenos">1687</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1688"><a href="#ECSWorker-1688"><span class="linenos">1688</span></a><span class="sd">        Kill a task running on ECS.</span>
</span><span id="ECSWorker-1689"><a href="#ECSWorker-1689"><span class="linenos">1689</span></a>
</span><span id="ECSWorker-1690"><a href="#ECSWorker-1690"><span class="linenos">1690</span></a><span class="sd">        Args:</span>
</span><span id="ECSWorker-1691"><a href="#ECSWorker-1691"><span class="linenos">1691</span></a><span class="sd">            infrastructure_pid: A cluster and task arn combination. This should match a</span>
</span><span id="ECSWorker-1692"><a href="#ECSWorker-1692"><span class="linenos">1692</span></a><span class="sd">                value yielded by `ECSWorker.run`.</span>
</span><span id="ECSWorker-1693"><a href="#ECSWorker-1693"><span class="linenos">1693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1694"><a href="#ECSWorker-1694"><span class="linenos">1694</span></a>        <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="ECSWorker-1695"><a href="#ECSWorker-1695"><span class="linenos">1695</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker-1696"><a href="#ECSWorker-1696"><span class="linenos">1696</span></a>                <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
</span><span id="ECSWorker-1697"><a href="#ECSWorker-1697"><span class="linenos">1697</span></a>                <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
</span><span id="ECSWorker-1698"><a href="#ECSWorker-1698"><span class="linenos">1698</span></a>                <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSWorker-1699"><a href="#ECSWorker-1699"><span class="linenos">1699</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1700"><a href="#ECSWorker-1700"><span class="linenos">1700</span></a>        <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_identifier</span><span class="p">(</span><span class="n">infrastructure_pid</span><span class="p">)</span>
</span><span id="ECSWorker-1701"><a href="#ECSWorker-1701"><span class="linenos">1701</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</span><span id="ECSWorker-1702"><a href="#ECSWorker-1702"><span class="linenos">1702</span></a>
</span><span id="ECSWorker-1703"><a href="#ECSWorker-1703"><span class="linenos">1703</span></a>    <span class="k">def</span> <span class="nf">_stop_task</span><span class="p">(</span>
</span><span id="ECSWorker-1704"><a href="#ECSWorker-1704"><span class="linenos">1704</span></a>        <span class="bp">self</span><span class="p">,</span> <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">task</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="ECSWorker-1705"><a href="#ECSWorker-1705"><span class="linenos">1705</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker-1706"><a href="#ECSWorker-1706"><span class="linenos">1706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker-1707"><a href="#ECSWorker-1707"><span class="linenos">1707</span></a><span class="sd">        Stop a running ECS task.</span>
</span><span id="ECSWorker-1708"><a href="#ECSWorker-1708"><span class="linenos">1708</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker-1709"><a href="#ECSWorker-1709"><span class="linenos">1709</span></a>        <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cluster</span> <span class="o">!=</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span><span class="p">:</span>
</span><span id="ECSWorker-1710"><a href="#ECSWorker-1710"><span class="linenos">1710</span></a>            <span class="k">raise</span> <span class="n">InfrastructureNotAvailable</span><span class="p">(</span>
</span><span id="ECSWorker-1711"><a href="#ECSWorker-1711"><span class="linenos">1711</span></a>                <span class="s2">&quot;Cannot stop ECS task: this infrastructure block has access to &quot;</span>
</span><span id="ECSWorker-1712"><a href="#ECSWorker-1712"><span class="linenos">1712</span></a>                <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> but the task is running in cluster &quot;</span>
</span><span id="ECSWorker-1713"><a href="#ECSWorker-1713"><span class="linenos">1713</span></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-1714"><a href="#ECSWorker-1714"><span class="linenos">1714</span></a>            <span class="p">)</span>
</span><span id="ECSWorker-1715"><a href="#ECSWorker-1715"><span class="linenos">1715</span></a>
</span><span id="ECSWorker-1716"><a href="#ECSWorker-1716"><span class="linenos">1716</span></a>        <span class="n">ecs_client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span><span class="p">)</span>
</span><span id="ECSWorker-1717"><a href="#ECSWorker-1717"><span class="linenos">1717</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="ECSWorker-1718"><a href="#ECSWorker-1718"><span class="linenos">1718</span></a>            <span class="n">ecs_client</span><span class="o">.</span><span class="n">stop_task</span><span class="p">(</span><span class="n">cluster</span><span class="o">=</span><span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="o">=</span><span class="n">task</span><span class="p">)</span>
</span><span id="ECSWorker-1719"><a href="#ECSWorker-1719"><span class="linenos">1719</span></a>        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
</span><span id="ECSWorker-1720"><a href="#ECSWorker-1720"><span class="linenos">1720</span></a>            <span class="c1"># Raise a special exception if the task does not exist</span>
</span><span id="ECSWorker-1721"><a href="#ECSWorker-1721"><span class="linenos">1721</span></a>            <span class="k">if</span> <span class="s2">&quot;ClusterNotFound&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSWorker-1722"><a href="#ECSWorker-1722"><span class="linenos">1722</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSWorker-1723"><a href="#ECSWorker-1723"><span class="linenos">1723</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> could not be found.&quot;</span>
</span><span id="ECSWorker-1724"><a href="#ECSWorker-1724"><span class="linenos">1724</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSWorker-1725"><a href="#ECSWorker-1725"><span class="linenos">1725</span></a>            <span class="k">if</span> <span class="s2">&quot;not find task&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;referenced task was not found&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="ECSWorker-1726"><a href="#ECSWorker-1726"><span class="linenos">1726</span></a>                <span class="n">exc</span>
</span><span id="ECSWorker-1727"><a href="#ECSWorker-1727"><span class="linenos">1727</span></a>            <span class="p">):</span>
</span><span id="ECSWorker-1728"><a href="#ECSWorker-1728"><span class="linenos">1728</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSWorker-1729"><a href="#ECSWorker-1729"><span class="linenos">1729</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the task </span><span class="si">{</span><span class="n">task</span><span class="si">!r}</span><span class="s2"> could not be found in &quot;</span>
</span><span id="ECSWorker-1730"><a href="#ECSWorker-1730"><span class="linenos">1730</span></a>                    <span class="sa">f</span><span class="s2">&quot;cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2">.&quot;</span>
</span><span id="ECSWorker-1731"><a href="#ECSWorker-1731"><span class="linenos">1731</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSWorker-1732"><a href="#ECSWorker-1732"><span class="linenos">1732</span></a>            <span class="k">if</span> <span class="s2">&quot;no registered tasks&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">):</span>
</span><span id="ECSWorker-1733"><a href="#ECSWorker-1733"><span class="linenos">1733</span></a>                <span class="k">raise</span> <span class="n">InfrastructureNotFound</span><span class="p">(</span>
</span><span id="ECSWorker-1734"><a href="#ECSWorker-1734"><span class="linenos">1734</span></a>                    <span class="sa">f</span><span class="s2">&quot;Cannot stop ECS task: the cluster </span><span class="si">{</span><span class="n">cluster</span><span class="si">!r}</span><span class="s2"> has no tasks.&quot;</span>
</span><span id="ECSWorker-1735"><a href="#ECSWorker-1735"><span class="linenos">1735</span></a>                <span class="p">)</span> <span class="kn">from</span> <span class="nn">exc</span>
</span><span id="ECSWorker-1736"><a href="#ECSWorker-1736"><span class="linenos">1736</span></a>
</span><span id="ECSWorker-1737"><a href="#ECSWorker-1737"><span class="linenos">1737</span></a>            <span class="c1"># Reraise unknown exceptions</span>
</span><span id="ECSWorker-1738"><a href="#ECSWorker-1738"><span class="linenos">1738</span></a>            <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>A Prefect worker to run flow runs as ECS tasks.</p>
</div>


                            <div id="ECSWorker.type" class="classattr">
                                <div class="attr variable">
            <span class="name">type</span>        =
<span class="default_value">&#39;ecs&#39;</span>

        
    </div>
    <a class="headerlink" href="#ECSWorker.type"></a>
    
    

                            </div>
                            <div id="ECSWorker.job_configuration" class="classattr">
                                <div class="attr variable">
            <span class="name">job_configuration</span>        =
<span class="default_value">&lt;class &#39;prefect_aws.workers.ecs_worker.ECSJobConfiguration&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ECSWorker.job_configuration"></a>
    
    

                            </div>
                            <div id="ECSWorker.job_configuration_variables" class="classattr">
                                <div class="attr variable">
            <span class="name">job_configuration_variables</span>        =
<span class="default_value">&lt;class &#39;prefect_aws.workers.ecs_worker.ECSVariables&#39;&gt;</span>

        
    </div>
    <a class="headerlink" href="#ECSWorker.job_configuration_variables"></a>
    
    

                            </div>
                            <div id="ECSWorker.run" class="classattr">
                                        <input id="ECSWorker.run-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">run</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">flow_run</span><span class="p">:</span> <span class="n">prefect</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">schemas</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">FlowRun</span>,</span><span class="param">	<span class="n">configuration</span><span class="p">:</span> <span class="n">prefect_aws</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">ecs_worker</span><span class="o">.</span><span class="n">ECSJobConfiguration</span>,</span><span class="param">	<span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">prefect</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">BaseWorkerResult</span>:</span></span>

                <label class="view-source-button" for="ECSWorker.run-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSWorker.run"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSWorker.run-620"><a href="#ECSWorker.run-620"><span class="linenos">620</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
</span><span id="ECSWorker.run-621"><a href="#ECSWorker.run-621"><span class="linenos">621</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker.run-622"><a href="#ECSWorker.run-622"><span class="linenos">622</span></a>        <span class="n">flow_run</span><span class="p">:</span> <span class="s2">&quot;FlowRun&quot;</span><span class="p">,</span>
</span><span id="ECSWorker.run-623"><a href="#ECSWorker.run-623"><span class="linenos">623</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker.run-624"><a href="#ECSWorker.run-624"><span class="linenos">624</span></a>        <span class="n">task_status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">anyio</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">TaskStatus</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="ECSWorker.run-625"><a href="#ECSWorker.run-625"><span class="linenos">625</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BaseWorkerResult</span><span class="p">:</span>
</span><span id="ECSWorker.run-626"><a href="#ECSWorker.run-626"><span class="linenos">626</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker.run-627"><a href="#ECSWorker.run-627"><span class="linenos">627</span></a><span class="sd">        Runs a given flow run on the current worker.</span>
</span><span id="ECSWorker.run-628"><a href="#ECSWorker.run-628"><span class="linenos">628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker.run-629"><a href="#ECSWorker.run-629"><span class="linenos">629</span></a>        <span class="n">ecs_client</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker.run-630"><a href="#ECSWorker.run-630"><span class="linenos">630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="s2">&quot;ecs&quot;</span>
</span><span id="ECSWorker.run-631"><a href="#ECSWorker.run-631"><span class="linenos">631</span></a>        <span class="p">)</span>
</span><span id="ECSWorker.run-632"><a href="#ECSWorker.run-632"><span class="linenos">632</span></a>
</span><span id="ECSWorker.run-633"><a href="#ECSWorker.run-633"><span class="linenos">633</span></a>        <span class="n">logger</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_flow_run_logger</span><span class="p">(</span><span class="n">flow_run</span><span class="p">)</span>
</span><span id="ECSWorker.run-634"><a href="#ECSWorker.run-634"><span class="linenos">634</span></a>
</span><span id="ECSWorker.run-635"><a href="#ECSWorker.run-635"><span class="linenos">635</span></a>        <span class="p">(</span>
</span><span id="ECSWorker.run-636"><a href="#ECSWorker.run-636"><span class="linenos">636</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker.run-637"><a href="#ECSWorker.run-637"><span class="linenos">637</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker.run-638"><a href="#ECSWorker.run-638"><span class="linenos">638</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker.run-639"><a href="#ECSWorker.run-639"><span class="linenos">639</span></a>            <span class="n">is_new_task_definition</span><span class="p">,</span>
</span><span id="ECSWorker.run-640"><a href="#ECSWorker.run-640"><span class="linenos">640</span></a>        <span class="p">)</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker.run-641"><a href="#ECSWorker.run-641"><span class="linenos">641</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_create_task_and_wait_for_start</span><span class="p">,</span>
</span><span id="ECSWorker.run-642"><a href="#ECSWorker.run-642"><span class="linenos">642</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker.run-643"><a href="#ECSWorker.run-643"><span class="linenos">643</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker.run-644"><a href="#ECSWorker.run-644"><span class="linenos">644</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker.run-645"><a href="#ECSWorker.run-645"><span class="linenos">645</span></a>            <span class="n">flow_run</span><span class="p">,</span>
</span><span id="ECSWorker.run-646"><a href="#ECSWorker.run-646"><span class="linenos">646</span></a>        <span class="p">)</span>
</span><span id="ECSWorker.run-647"><a href="#ECSWorker.run-647"><span class="linenos">647</span></a>
</span><span id="ECSWorker.run-648"><a href="#ECSWorker.run-648"><span class="linenos">648</span></a>        <span class="c1"># The task identifier is &quot;{cluster}::{task}&quot; where we use the configured cluster</span>
</span><span id="ECSWorker.run-649"><a href="#ECSWorker.run-649"><span class="linenos">649</span></a>        <span class="c1"># if set to preserve matching by name rather than arn</span>
</span><span id="ECSWorker.run-650"><a href="#ECSWorker.run-650"><span class="linenos">650</span></a>        <span class="c1"># Note &quot;::&quot; is used despite the Prefect standard being &quot;:&quot; because ARNs contain</span>
</span><span id="ECSWorker.run-651"><a href="#ECSWorker.run-651"><span class="linenos">651</span></a>        <span class="c1"># single colons.</span>
</span><span id="ECSWorker.run-652"><a href="#ECSWorker.run-652"><span class="linenos">652</span></a>        <span class="n">identifier</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="ECSWorker.run-653"><a href="#ECSWorker.run-653"><span class="linenos">653</span></a>            <span class="p">(</span><span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">if</span> <span class="n">configuration</span><span class="o">.</span><span class="n">cluster</span> <span class="k">else</span> <span class="n">cluster_arn</span><span class="p">)</span>
</span><span id="ECSWorker.run-654"><a href="#ECSWorker.run-654"><span class="linenos">654</span></a>            <span class="o">+</span> <span class="s2">&quot;::&quot;</span>
</span><span id="ECSWorker.run-655"><a href="#ECSWorker.run-655"><span class="linenos">655</span></a>            <span class="o">+</span> <span class="n">task_arn</span>
</span><span id="ECSWorker.run-656"><a href="#ECSWorker.run-656"><span class="linenos">656</span></a>        <span class="p">)</span>
</span><span id="ECSWorker.run-657"><a href="#ECSWorker.run-657"><span class="linenos">657</span></a>
</span><span id="ECSWorker.run-658"><a href="#ECSWorker.run-658"><span class="linenos">658</span></a>        <span class="k">if</span> <span class="n">task_status</span><span class="p">:</span>
</span><span id="ECSWorker.run-659"><a href="#ECSWorker.run-659"><span class="linenos">659</span></a>            <span class="n">task_status</span><span class="o">.</span><span class="n">started</span><span class="p">(</span><span class="n">identifier</span><span class="p">)</span>
</span><span id="ECSWorker.run-660"><a href="#ECSWorker.run-660"><span class="linenos">660</span></a>
</span><span id="ECSWorker.run-661"><a href="#ECSWorker.run-661"><span class="linenos">661</span></a>        <span class="n">status_code</span> <span class="o">=</span> <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span>
</span><span id="ECSWorker.run-662"><a href="#ECSWorker.run-662"><span class="linenos">662</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_watch_task_and_get_exit_code</span><span class="p">,</span>
</span><span id="ECSWorker.run-663"><a href="#ECSWorker.run-663"><span class="linenos">663</span></a>            <span class="n">logger</span><span class="p">,</span>
</span><span id="ECSWorker.run-664"><a href="#ECSWorker.run-664"><span class="linenos">664</span></a>            <span class="n">configuration</span><span class="p">,</span>
</span><span id="ECSWorker.run-665"><a href="#ECSWorker.run-665"><span class="linenos">665</span></a>            <span class="n">task_arn</span><span class="p">,</span>
</span><span id="ECSWorker.run-666"><a href="#ECSWorker.run-666"><span class="linenos">666</span></a>            <span class="n">cluster_arn</span><span class="p">,</span>
</span><span id="ECSWorker.run-667"><a href="#ECSWorker.run-667"><span class="linenos">667</span></a>            <span class="n">task_definition</span><span class="p">,</span>
</span><span id="ECSWorker.run-668"><a href="#ECSWorker.run-668"><span class="linenos">668</span></a>            <span class="n">is_new_task_definition</span> <span class="ow">and</span> <span class="n">configuration</span><span class="o">.</span><span class="n">auto_deregister_task_definition</span><span class="p">,</span>
</span><span id="ECSWorker.run-669"><a href="#ECSWorker.run-669"><span class="linenos">669</span></a>            <span class="n">ecs_client</span><span class="p">,</span>
</span><span id="ECSWorker.run-670"><a href="#ECSWorker.run-670"><span class="linenos">670</span></a>        <span class="p">)</span>
</span><span id="ECSWorker.run-671"><a href="#ECSWorker.run-671"><span class="linenos">671</span></a>
</span><span id="ECSWorker.run-672"><a href="#ECSWorker.run-672"><span class="linenos">672</span></a>        <span class="k">return</span> <span class="n">ECSWorkerResult</span><span class="p">(</span>
</span><span id="ECSWorker.run-673"><a href="#ECSWorker.run-673"><span class="linenos">673</span></a>            <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
</span><span id="ECSWorker.run-674"><a href="#ECSWorker.run-674"><span class="linenos">674</span></a>            <span class="c1"># If the container does not start the exit code can be null but we must</span>
</span><span id="ECSWorker.run-675"><a href="#ECSWorker.run-675"><span class="linenos">675</span></a>            <span class="c1"># still report a status code. We use a -1 to indicate a special code.</span>
</span><span id="ECSWorker.run-676"><a href="#ECSWorker.run-676"><span class="linenos">676</span></a>            <span class="n">status_code</span><span class="o">=</span><span class="n">status_code</span> <span class="k">if</span> <span class="n">status_code</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="ECSWorker.run-677"><a href="#ECSWorker.run-677"><span class="linenos">677</span></a>        <span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Runs a given flow run on the current worker.</p>
</div>


                            </div>
                            <div id="ECSWorker.kill_infrastructure" class="classattr">
                                        <input id="ECSWorker.kill_infrastructure-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">async def</span>
        <span class="name">kill_infrastructure</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">configuration</span><span class="p">:</span> <span class="n">prefect_aws</span><span class="o">.</span><span class="n">workers</span><span class="o">.</span><span class="n">ecs_worker</span><span class="o">.</span><span class="n">ECSJobConfiguration</span>,</span><span class="param">	<span class="n">infrastructure_pid</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span></span><span class="return-annotation">) -> <span class="kc">None</span>:</span></span>

                <label class="view-source-button" for="ECSWorker.kill_infrastructure-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ECSWorker.kill_infrastructure"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ECSWorker.kill_infrastructure-1681"><a href="#ECSWorker.kill_infrastructure-1681"><span class="linenos">1681</span></a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">kill_infrastructure</span><span class="p">(</span>
</span><span id="ECSWorker.kill_infrastructure-1682"><a href="#ECSWorker.kill_infrastructure-1682"><span class="linenos">1682</span></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="ECSWorker.kill_infrastructure-1683"><a href="#ECSWorker.kill_infrastructure-1683"><span class="linenos">1683</span></a>        <span class="n">configuration</span><span class="p">:</span> <span class="n">ECSJobConfiguration</span><span class="p">,</span>
</span><span id="ECSWorker.kill_infrastructure-1684"><a href="#ECSWorker.kill_infrastructure-1684"><span class="linenos">1684</span></a>        <span class="n">infrastructure_pid</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="ECSWorker.kill_infrastructure-1685"><a href="#ECSWorker.kill_infrastructure-1685"><span class="linenos">1685</span></a>        <span class="n">grace_seconds</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">,</span>
</span><span id="ECSWorker.kill_infrastructure-1686"><a href="#ECSWorker.kill_infrastructure-1686"><span class="linenos">1686</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ECSWorker.kill_infrastructure-1687"><a href="#ECSWorker.kill_infrastructure-1687"><span class="linenos">1687</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="ECSWorker.kill_infrastructure-1688"><a href="#ECSWorker.kill_infrastructure-1688"><span class="linenos">1688</span></a><span class="sd">        Kill a task running on ECS.</span>
</span><span id="ECSWorker.kill_infrastructure-1689"><a href="#ECSWorker.kill_infrastructure-1689"><span class="linenos">1689</span></a>
</span><span id="ECSWorker.kill_infrastructure-1690"><a href="#ECSWorker.kill_infrastructure-1690"><span class="linenos">1690</span></a><span class="sd">        Args:</span>
</span><span id="ECSWorker.kill_infrastructure-1691"><a href="#ECSWorker.kill_infrastructure-1691"><span class="linenos">1691</span></a><span class="sd">            infrastructure_pid: A cluster and task arn combination. This should match a</span>
</span><span id="ECSWorker.kill_infrastructure-1692"><a href="#ECSWorker.kill_infrastructure-1692"><span class="linenos">1692</span></a><span class="sd">                value yielded by `ECSWorker.run`.</span>
</span><span id="ECSWorker.kill_infrastructure-1693"><a href="#ECSWorker.kill_infrastructure-1693"><span class="linenos">1693</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="ECSWorker.kill_infrastructure-1694"><a href="#ECSWorker.kill_infrastructure-1694"><span class="linenos">1694</span></a>        <span class="k">if</span> <span class="n">grace_seconds</span> <span class="o">!=</span> <span class="mi">30</span><span class="p">:</span>
</span><span id="ECSWorker.kill_infrastructure-1695"><a href="#ECSWorker.kill_infrastructure-1695"><span class="linenos">1695</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
</span><span id="ECSWorker.kill_infrastructure-1696"><a href="#ECSWorker.kill_infrastructure-1696"><span class="linenos">1696</span></a>                <span class="sa">f</span><span class="s2">&quot;Kill grace period of </span><span class="si">{</span><span class="n">grace_seconds</span><span class="si">}</span><span class="s2">s requested, but AWS does not &quot;</span>
</span><span id="ECSWorker.kill_infrastructure-1697"><a href="#ECSWorker.kill_infrastructure-1697"><span class="linenos">1697</span></a>                <span class="s2">&quot;support dynamic grace period configuration so 30s will be used. &quot;</span>
</span><span id="ECSWorker.kill_infrastructure-1698"><a href="#ECSWorker.kill_infrastructure-1698"><span class="linenos">1698</span></a>                <span class="s2">&quot;See https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-agent-config.html for configuration of grace periods.&quot;</span>  <span class="c1"># noqa</span>
</span><span id="ECSWorker.kill_infrastructure-1699"><a href="#ECSWorker.kill_infrastructure-1699"><span class="linenos">1699</span></a>            <span class="p">)</span>
</span><span id="ECSWorker.kill_infrastructure-1700"><a href="#ECSWorker.kill_infrastructure-1700"><span class="linenos">1700</span></a>        <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span> <span class="o">=</span> <span class="n">parse_identifier</span><span class="p">(</span><span class="n">infrastructure_pid</span><span class="p">)</span>
</span><span id="ECSWorker.kill_infrastructure-1701"><a href="#ECSWorker.kill_infrastructure-1701"><span class="linenos">1701</span></a>        <span class="k">await</span> <span class="n">run_sync_in_worker_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_stop_task</span><span class="p">,</span> <span class="n">configuration</span><span class="p">,</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">task</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Kill a task running on ECS.</p>

<p>Args:
    infrastructure_pid: A cluster and task arn combination. This should match a
        value yielded by <code><a href="#ECSWorker.run">ECSWorker.run</a></code>.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>prefect.workers.base.BaseWorker</dt>
                                <dd id="ECSWorker.__init__" class="function">BaseWorker</dd>
                <dd id="ECSWorker.name" class="variable">name</dd>
                <dd id="ECSWorker.is_setup" class="variable">is_setup</dd>
                <dd id="ECSWorker.heartbeat_interval_seconds" class="variable">heartbeat_interval_seconds</dd>
                <dd id="ECSWorker.get_documentation_url" class="function">get_documentation_url</dd>
                <dd id="ECSWorker.get_logo_url" class="function">get_logo_url</dd>
                <dd id="ECSWorker.get_description" class="function">get_description</dd>
                <dd id="ECSWorker.get_default_base_job_template" class="function">get_default_base_job_template</dd>
                <dd id="ECSWorker.get_worker_class_from_type" class="function">get_worker_class_from_type</dd>
                <dd id="ECSWorker.get_all_available_worker_types" class="function">get_all_available_worker_types</dd>
                <dd id="ECSWorker.get_name_slug" class="function">get_name_slug</dd>
                <dd id="ECSWorker.get_flow_run_logger" class="function">get_flow_run_logger</dd>
                <dd id="ECSWorker.setup" class="function">setup</dd>
                <dd id="ECSWorker.teardown" class="function">teardown</dd>
                <dd id="ECSWorker.is_worker_still_polling" class="function">is_worker_still_polling</dd>
                <dd id="ECSWorker.get_and_submit_flow_runs" class="function">get_and_submit_flow_runs</dd>
                <dd id="ECSWorker.check_for_cancelled_flow_runs" class="function">check_for_cancelled_flow_runs</dd>
                <dd id="ECSWorker.cancel_run" class="function">cancel_run</dd>
                <dd id="ECSWorker.sync_with_backend" class="function">sync_with_backend</dd>
                <dd id="ECSWorker.get_status" class="function">get_status</dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
</body>
</html>